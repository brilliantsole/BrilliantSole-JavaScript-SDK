<html>
  <head>
    <title>Kick | BrilliantSole JavaScript SDK</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <script type="module" src="./script.js"></script>
    <script src="../utils/aframe/aframe-master.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.3/dist/aframe-physics-system.min.js"></script>
    <script src="../utils/aframe/grabbable-physics-body.js"></script>
    <script src="../utils/aframe/grabbable-listener.js"></script>
    <script src="../utils/aframe/grabbable-anchor.js"></script>
    <script src="../utils/aframe/occlude-hand-tracking-controls.js"></script>
    <script src="../utils/aframe/palm-up-detector.js"></script>
    <script src="../utils/aframe/grow-shrink.js"></script>
    <script src="./components/platter.js"></script>
    <script src="./components/goomba.js"></script>
    <script src="../utils/aframe/occlude-mesh.js"></script>
  </head>
  <style>
    #scene {
      width: 500px;
      height: 400px;
      margin: auto;
      border-radius: 2rem;
      overflow: hidden;
      border: solid black;
      box-sizing: border-box;
    }

    #title {
      margin: auto;
      height: 70px;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;

      font-size: xx-large;
    }
  </style>
  <body>
    <nav>
      <a href="../../">home</a>
    </nav>

    <h1>Kick | BrilliantSole JavaScript SDK</h1>

    <button id="toggleConnection">connect</button>

    <progress value="0" id="fileTransferProgress"></progress>

    <label>
      is model ready <input type="checkbox" disabled id="isModelReady" />
    </label>

    <div id="title">
      <h1 id="maxClass">Kick</h1>
    </div>

    <a-scene
      id="scene"
      physics="debug: false; restitution: 0.4;"
      embedded
      grabbable-listener
      obb-collider="showColliders: false"
      xr-mode-ui="enabled: true; XRMode: ar;"
      real-world-meshing="meshMixin: realWorldMeshMixin; meshesEnabled: true; planeMixin: realWorldPlaneMixin; planesEnabled: true; filterLabels: table, wall, floor, ceiling;"
      device-orientation-permission-ui="enabled: false"
    >
      <a-assets>
        <a-asset-item
          id="anchorModel"
          src="../../assets/3d/anchor.glb"
        ></a-asset-item>
        <a-mixin id="realWorldPlaneMixin" static-body occlude-mesh> </a-mixin>
        <a-mixin id="realWorldMeshMixin" occlude-mesh></a-mixin>
      </a-assets>
      <a-camera
        class="lookAt"
        id="camera"
        position="0 1 0"
        rotation="0 0 0"
      ></a-camera>

      <a-entity
        class="lookAt"
        id="anchor"
        anchored="persistent: true"
        position="0.2 1 -0.3"
        grabbable
        grabbable-anchor
      >
        <a-entity
          gltf-model="#anchorModel"
          scale="0.020 0.020 0.020"
          rotation="90 0 0"
        ></a-entity>
      </a-entity>

      <a-entity
        goomba="grabbable: true;"
        id="goomba1"
        position="0 1.0 -0.2"
        rotation="0 45 90"
      ></a-entity>
      <a-plane
        width="1"
        height="1"
        rotation="90 0 0"
        static-body
        position="0 0.8 -0.2"
        data-world-mesh="floor"
      ></a-plane>

      <template id="goombaTemplate">
        <a-entity>
          <a-entity class="squash" position="0 -0.07 0">
            <a-entity class="squashOffset" position="0 0.07 0">
              <a-sphere
                class="body"
                color="#a14e00"
                radius="0.1"
                scale="0.9 0.75 0.8"
              ></a-sphere>
              <a-entity
                class="eye left"
                position="-0.02535 0.01077 0.065"
                rotation="-11.205 -20.900 0"
              >
                <a-entity class="scalar" scale="1.460 1.690 0.940">
                  <a-sphere
                    class="white"
                    color="#fafafa"
                    radius="0.017"
                  ></a-sphere>
                  <a-entity class="controller">
                    <a-sphere
                      class="black"
                      color="#000000"
                      position="0 0 0.015"
                      radius="0.008"
                      scale="1 1 -0.600"
                    >
                    </a-sphere>
                  </a-entity>
                </a-entity>
              </a-entity>
            </a-entity>
          </a-entity>
          <a-entity
            class="left leg"
            position="-0.036 -0.026 0"
            rotation="0 -16.292 -8.000"
          >
            <a-sphere
              class="foot"
              color="#301700"
              radius="0.05"
              position="0 -0.048 0"
              scale="0.8 0.418 1"
            ></a-sphere>
          </a-entity>
        </a-entity>
      </template>

      <a-entity
        id="leftHand"
        class="lookAt"
        hand-tracking-controls="hand: left; model-opacity: 0;"
        hand-tracking-grab-controls="hand: left;"
        occlude-hand-tracking-controls
      >
        <a-entity
          id="platter"
          scale="0 0 0"
          platter
          rotation="200 0 -34.3"
          position="0 -0.03 -0.07"
        >
          <a-cylinder color="grey" height="0.01" radius="0.15"></a-cylinder>
        </a-entity>
      </a-entity>
      <a-entity
        id="rightHand"
        class="lookAt"
        hand-tracking-controls="hand: right;"
        occlude-hand-tracking-controls
        hand-tracking-grab-controls="hand: right;"
      ></a-entity>
    </a-scene>
  </body>
  <script>
    const scene = document.querySelector("a-scene");
    scene.addEventListener("loaded", () => {
      return;
      setTimeout(() => {
        const lights = Array.from(document.querySelectorAll("[light]"));
        console.log(lights);
        lights.forEach((light) => {
          if (light.getAttribute("light").type != "ambient") {
            console.log(light.getAttribute("light").type);
            light.setAttribute("light", { castShadow: true });
          }
        });

        const interval = setInterval(() => {
          const realWorldMeshes = Array.from(
            document.querySelectorAll("[data-world-mesh]")
          );
          if (realWorldMeshes.length > 0) {
            clearInterval(interval);
            realWorldMeshes.forEach((entity) => {
              entity.setAttribute("shadow", "cast: false; receive: true;");
            });
          }
        }, 100);
      }, 1);
    });
  </script>
</html>
