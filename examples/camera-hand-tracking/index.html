<html>
  <head>
    <title>Camera Hand Tracking | BrilliantSole JavaScript SDK</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"
      crossorigin="anonymous"
    ></script>
    <script src="../utils/aframe/aframe-master.min.js"></script>
    <script type="module" src="./mediapipe-hand.js"></script>
    <script type="module" src="./script.js"></script>
  </head>
  <style>
    canvas,
    img {
      width: 100%;
      height: 100%;
    }

    #imageContainer {
      position: relative;
      display: inline-block;
      width: 500;
      height: fit-content;
    }
    #imageOverlay {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: 1;
    }

    #sceneContainer {
      z-index: 1;
      aspect-ratio: 4/3;
      position: relative;
    }

    #imageContainer > * {
      height: revert;
    }
    #imageContainer > canvas {
      height: 100%;
    }

    a-scene {
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      position: absolute;
    }
  </style>
  <body>
    <nav>
      <a href="../../">home</a>
    </nav>

    <h1>Camera Hand Tracking | BrilliantSole JavaScript SDK</h1>

    <div style="display: flex; flex-direction: row; gap: 1rem">
      <div>
        <button id="toggleConnection">connect</button>
        <br />

        <label>
          enable rotation?
          <input disabled type="checkbox" id="toggleRotation" />
        </label>
        <button id="resetRotation">reset rotation</button>
        <br />

        <label class="verticalLabel">
          camera
          <select id="cameraInput">
            <optgroup label="select camera"></optgroup>
          </select>
        </label>

        <button id="toggleMirrorCamera">mirror camera</button>

        <br />

        <label><b>camera status:</b> <span id="cameraStatus"></span></label>
        <br />

        <label>auto picture: <input type="checkbox" id="autoPicture" /> </label>
        <br />

        <button disabled id="takePicture">take picture</button>
        <progress value="0" id="cameraImageProgress"></progress>
        <br />
        <button disabled id="focusCamera">focus camera</button>
        <br />
        <button disabled id="sleepCamera">sleep camera</button>

        <label>
          <b>camera configuration: </b>
          <pre id="cameraConfigurationPre"></pre>
        </label>

        <label>
          take picture after update?
          <input type="checkbox" id="takePictureAfterUpdate" />
        </label>

        <div id="cameraConfiguration">
          <template id="cameraConfigurationTypeTemplate">
            <div class="cameraConfigurationType">
              <label>
                <input class="value" type="range" value="" disabled />
                <b class="type"></b> <span></span>
              </label>
            </div>
          </template>
        </div>
      </div>
      <div
        id="mediaContainer"
        style="display: flex; flex-direction: column; gap: 1rem; width: 500px"
      >
        <div id="sceneContainer">
          <a-scene
            embedded
            xr-mode-ui="enabled: false"
            obb-collider="showColliders: false"
          >
            <a-assets>
              <a-asset-item
                id="leftInsoleModel"
                src="../../assets/3d/leftInsole.glb"
              ></a-asset-item>
              <a-asset-item
                id="rightInsoleModel"
                src="../../assets/3d/rightInsole.glb"
              ></a-asset-item>
            </a-assets>

            <a-camera
              id="camera"
              look-controls="enabled:false;"
              wasd-controls="enabled:false;"
              fov="25"
            >
              <!-- <a-sphere color="blue" radius="0.01" position="0 0 -1"></a-sphere> -->
            </a-camera>

            <!-- <a-entity
              gltf-model="#rightInsoleModel"
              position="-0.1 1.6 -0.8"
              rotation="90 0 0"
              scale="-1 1 1"
              grabbable
            ></a-entity> -->
            <!-- <a-entity
              gltf-model="#leftInsoleModel"
              position="0.1 1.6 -0.8"
              rotation="90 0 0"
              scale="-1 1 1"
              grabbable
            ></a-entity> -->

            <a-entity
              mediapipe-hand="side: left; hand: #leftHand; raycaster: #leftHandRaycaster;"
              id="leftHandMediapipe"
            ></a-entity>
            <a-entity
              mediapipe-hand="side: right; hand: #rightHand; raycaster: #rightHandRaycaster;"
              id="rightHandMediapipe"
            ></a-entity>

            <!-- <a-entity
              id="leftHandRaycaster"
              raycaster="color: black; showLine: true;"
            ></a-entity>
            <a-entity
              id="rightHandRaycaster"
              raycaster="color: black; showLine: true;"
            ></a-entity> -->

            <a-entity
              id="leftHand"
              hand-tracking-grab-controls="hand: left;"
              hand-tracking-controls="hand: left; modelStyle: dots;"
            ></a-entity>
            <a-entity
              id="rightHand"
              hand-tracking-grab-controls="hand: right;"
              hand-tracking-controls="hand: right; modelStyle: dots;"
            ></a-entity>

            <a-box
              grabbable
              color="blue"
              position="-0.05 1.6 -0.5"
              scale="0.1 0.1 0.1"
            ></a-box>

            <!-- <a-box
              position="-1 0.5 -3"
              rotation="0 45 0"
              color="#4CC3D9"
            ></a-box> -->
            <!-- <a-box
              position="-1 0.5 -3"
              rotation="0 45 0"
              color="#4CC3D9"
            ></a-box>
            <a-sphere
              position="0 1.25 -5"
              radius="1.25"
              color="#EF2D5E"
            ></a-sphere>
            <a-cylinder
              position="1 0.75 -3"
              radius="0.5"
              height="1.5"
              color="#FFC65D"
            ></a-cylinder> -->
            <!-- <a-plane
              position="0 0 -4"
              rotation="-90 0 0"
              width="4"
              height="4"
              color="#7BC8A4"
            ></a-plane> -->
            <a-sky visible="false" color="#ECECEC"></a-sky>
          </a-scene>
          <img
            id="sceneCameraImage"
            style="z-index: -1; position: absolute; left: 0; top: 0"
          />
        </div>
        <div id="cameraVideoContainer">
          <video
            hidden
            id="cameraVideo"
            autoplay
            playsinline
            width="640"
          ></video>
        </div>
        <div id="imageContainer">
          <canvas width="300" height="300" id="imageOverlay"></canvas>
          <img id="cameraImage" />
        </div>
      </div>
    </div>
  </body>

  <script>
    const sceneEl = document.querySelector("a-scene");
    sceneEl.addEventListener("loaded", () => {
      const camera = sceneEl.camera;
      camera.aspect = 4 / 3;
      camera.updateProjectionMatrix();
    });
  </script>
</html>
