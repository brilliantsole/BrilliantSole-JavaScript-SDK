/**
 * @copyright Zack Qattan 2024
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).BS={})}(this,(function(t){"use strict";function e(t,e,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(t):i?i.value:e.get(t)}function s(t,e,s,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(t,s):n?n.value=s:e.set(t,s),s}"function"==typeof SuppressedError&&SuppressedError;const i=!1,n="undefined"!=typeof window&&void 0!==window?.document,a="undefined"!=typeof process&&null!=process?.versions?.node,r=n&&navigator.userAgent||"";let o=!1;n?o=Boolean(navigator.bluetooth):a&&(o=!0);const h=n&&/Bluefy/i.test(r),c=n&&/WebBLE/i.test(r),l=n&&/Android/i.test(r),f=n&&/Safari/i.test(r)&&!/Chrome/i.test(r),g=n&&/iPad|iPhone|iPod/i.test(r),d=n&&/Macintosh/i.test(r),u=!n&&!a&&"undefined"!=typeof global&&"undefined"!=typeof Studio;var p,m,v,y,w=Object.freeze({__proto__:null,isAndroid:l,get isBluetoothSupported(){return o},isIOS:g,isInBluefy:h,isInBrowser:n,isInDev:i,isInLensStudio:u,isInNode:a,isInProduction:!0,isInWebBLE:c,isMac:d,isSafari:f});if(u){const t=function(...t){Studio.log(t.map((t=>new String(t))).join(","))};(y={}).log=t,y.warn=t.bind(y,"WARNING"),y.error=t.bind(y,"ERROR")}else y=console;function b(t){return(...e)=>{if(a){const s=function(){const t=(new Error).stack;if(!t)return"";const e=t.split("\n"),s=e[3]||e[2],i=s.match(/at (.*?) \(/)||s.match(/at (.*)/);return i?`[${i[1].trim()}]`:""}();t(s,...e)}else t(...e)}}if(!y.assert){const t=(t,...e)=>{t||y.warn(...e)};y.assert=t}if(!y.table){const t=(...t)=>{y.log(...t)};y.table=t}function C(){}const S=a?b(y.log.bind(y)):y.log.bind(y),E=a?b(y.warn.bind(y)):y.warn.bind(y),M=a?b(y.error.bind(y)):y.error.bind(y),D=a?b(y.table.bind(y)):y.table.bind(y),k=y.assert.bind(y);class W{constructor(t){if(v.set(this,{log:i,warn:i,assert:!0,error:!0,table:!0}),e(p,p,"f",m)[t])throw new Error(`"${t}" console already exists`);e(p,p,"f",m)[t]=this}setLevelFlags(t){Object.assign(e(this,v,"f"),t)}static setLevelFlagsForType(t,s){if(!e(this,p,"f",m)[t])throw new Error(`no console found with type "${t}"`);e(this,p,"f",m)[t].setLevelFlags(s)}static setAllLevelFlags(t){for(const s in e(this,p,"f",m))e(this,p,"f",m)[s].setLevelFlags(t)}static create(t,s){return e(this,p,"f",m)[t]||new p(t)}get log(){return e(this,v,"f").log?S:C}get warn(){return e(this,v,"f").warn?E:C}get error(){return e(this,v,"f").error?M:C}get assert(){return e(this,v,"f").assert?k:C}get table(){return e(this,v,"f").table?D:C}assertWithError(t,e){if(!Boolean(t))throw new Error(e)}assertTypeWithError(t,e){this.assertWithError(typeof t==e,`value ${t} of type "${typeof t}" not of type "${e}"`)}assertEnumWithError(t,e){this.assertWithError(e.includes(t),`invalid enum "${t}"`)}assertRangeWithError(t,e,s,i){this.assertWithError(e>=s&&e<=i,`${t} ${e} must be within ${s}-${i}`)}}function T(t,e){return W.create(t,e)}p=W,v=new WeakMap,m={value:{}};const R=T("EventDispatcher",{log:!1});class x{constructor(t,e){this.target=t,this.validEventTypes=e,this.listeners={},this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.removeEventListeners=this.removeEventListeners.bind(this),this.removeAllEventListeners=this.removeAllEventListeners.bind(this),this.dispatchEvent=this.dispatchEvent.bind(this),this.waitForEvent=this.waitForEvent.bind(this)}isValidEventType(t){return this.validEventTypes.includes(t)}updateEventListeners(t){this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter((e=>(e.shouldRemove&&R.log(`removing "${t}" eventListener`,e),!e.shouldRemove))))}addEventListener(t,e,s={once:!1}){if(!this.isValidEventType(t))throw new Error(`Invalid event type: ${t}`);this.listeners[t]||(this.listeners[t]=[],R.log(`creating "${t}" listeners array`,this.listeners[t]));this.listeners[t].find((t=>t.listener==e&&t.once==s.once))?R.log("already added listener"):(R.log(`adding "${t}" listener`,e,s),this.listeners[t].push({listener:e,once:s.once}),R.log(`currently have ${this.listeners[t].length} "${t}" listeners`))}removeEventListener(t,e){if(!this.isValidEventType(t))throw new Error(`Invalid event type: ${t}`);this.listeners[t]&&(R.log(`removing "${t}" listener...`,e),this.listeners[t].forEach((s=>{s.listener===e&&(R.log(`flagging "${t}" listener`,e),s.shouldRemove=!0)})),this.updateEventListeners(t))}removeEventListeners(t){if(!this.isValidEventType(t))throw new Error(`Invalid event type: ${t}`);this.listeners[t]&&(R.log(`removing "${t}" listeners...`),this.listeners[t]=[])}removeAllEventListeners(){R.log("removing listeners..."),this.listeners={}}dispatchEvent(t,e){if(!this.isValidEventType(t))throw new Error(`Invalid event type: ${t}`);this.listeners[t]&&(this.listeners[t].forEach((s=>{if(!s.shouldRemove){R.log(`dispatching "${t}" listener`,s);try{s.listener({type:t,target:this.target,message:e})}catch(t){console.error(t)}s.once&&(R.log(`flagging "${t}" listener`,s),s.shouldRemove=!0)}})),this.updateEventListeners(t))}waitForEvent(t){return new Promise((e=>{this.addEventListener(t,(t=>{e(t)}),{once:!0})}))}}var I,L,U;const A=T("Timer",{log:!1});class F{get callback(){return e(this,I,"f")}set callback(t){A.assertTypeWithError(t,"function"),A.log({newCallback:t}),s(this,I,t,"f"),this.isRunning&&this.restart()}get interval(){return e(this,L,"f")}set interval(t){A.assertTypeWithError(t,"number"),A.assertWithError(t>0,"interval must be above 0"),A.log({newInterval:t}),s(this,L,t,"f"),this.isRunning&&this.restart()}constructor(t,e){I.set(this,void 0),L.set(this,void 0),U.set(this,void 0),this.interval=e,this.callback=t}get isRunning(){return null!=e(this,U,"f")}start(t=!1){this.isRunning?A.log("interval already running"):(A.log(`starting interval every ${e(this,L,"f")}ms`),s(this,U,setInterval(e(this,I,"f"),e(this,L,"f")),"f"),t&&e(this,I,"f").call(this))}stop(){this.isRunning?(A.log("stopping interval"),clearInterval(e(this,U,"f")),s(this,U,void 0,"f")):A.log("interval already not running")}restart(t=!1){this.stop(),this.start(t)}}function _(t){for(let e=0;e<8;++e)t=(1&t?0:3988292384)^t>>>1;return 4278190080^t}I=new WeakMap,L=new WeakMap,U=new WeakMap,T("checksum",{log:!1});const B=new Uint32Array(256);for(let t=0;t<256;++t)B[t]=_(t);function $(t){let e=new Uint8Array(t),s=0;for(let t=0;t<e.byteLength;++t){const i=255&s,n=e[t];s=(B[i^n]^s>>>8)>>>0}return s}var O,P;O="undefined"==typeof TextEncoder?class{encode(t){const e=Array.from(t).map((t=>t.charCodeAt(0)));return Uint8Array.from(e)}}:TextEncoder,P="undefined"==typeof TextDecoder?class{decode(t){return Array.from(new Uint8Array(t)).map((t=>String.fromCharCode(t))).join("")}}:TextDecoder;const N=new O,V=new P,q=T("ArrayBufferUtils",{log:!1});function z(...t){const e=(t=(t=(t=t.filter((t=>null!=t||null!=t))).map((t=>{if("number"==typeof t){const e=t;return Uint8Array.from([Math.floor(e)])}if("boolean"==typeof t){const e=t;return Uint8Array.from([e?1:0])}if("string"==typeof t){return j(t)}if(t instanceof Array){return z(...t)}if(t instanceof ArrayBuffer)return t;if("buffer"in t&&t.buffer instanceof ArrayBuffer){return t.buffer}if(t instanceof DataView){return t.buffer}if("object"==typeof t){return function(t){return j(JSON.stringify(t))}(t)}return t}))).filter((t=>t&&"byteLength"in t))).reduce(((t,e)=>t+e.byteLength),0),s=new Uint8Array(e);let i=0;return t.forEach((t=>{s.set(new Uint8Array(t),i),i+=t.byteLength})),s.buffer}function j(t){const e=N.encode(t);return z(e.byteLength,e)}function G(t,e,s){let i;return null!=s&&(i=t.byteOffset+e+s),q.log({dataView:t,begin:e,end:i,length:s}),new DataView(t.buffer.slice(t.byteOffset+e,i))}async function H(t){let e;if(t instanceof Array)e=Uint8Array.from(t);else if(t instanceof DataView)e=t.buffer;else if("string"==typeof t||t instanceof URL){const s=await fetch(t);e=await s.arrayBuffer()}else if(t instanceof File)e=await t.arrayBuffer();else{if(!(t instanceof ArrayBuffer))throw{error:"invalid file type",file:t};e=t}return e}function X(t){return Uint8Array.from([t]).buffer}function Y(t,{include:e,exclude:s}={}){const i=t=>{const i=e=>"string"==typeof e?t===e:e.test(t);return e?e.some(i):!s||!s.some(i)};for(const[e,s]of(t=>{const e=new Set;do{for(const s of Reflect.ownKeys(t))e.add([t,s])}while((t=Reflect.getPrototypeOf(t))&&t!==Object.prototype);return e})(t.constructor.prototype)){if("constructor"===s||!i(s))continue;const n=Reflect.getOwnPropertyDescriptor(e,s);n&&"function"==typeof n.value&&(t[s]=t[s].bind(t))}return t}var J,K,Q,Z,tt,et,st,it,nt,at,rt,ot,ht,ct,lt,ft,gt,dt,ut,pt,mt,vt,yt,wt,bt,Ct,St,Et,Mt,Dt,kt,Wt,Tt,Rt,xt,It,Lt,Ut,At,Ft,_t;const Bt=T("FileTransferManager",{log:!1}),$t=["getFileTypes","maxFileLength","getFileType","setFileType","getFileLength","setFileLength","getFileChecksum","setFileChecksum","setFileTransferCommand","fileTransferStatus","getFileBlock","setFileBlock","fileBytesTransferred"],Ot=["tflite","wifiServerCert","wifiServerKey"],Pt=["idle","sending","receiving"],Nt=["startSend","startReceive","cancel"],Vt=[...$t,"fileTransferProgress","fileTransferComplete","fileReceived"],qt=["maxFileLength","getFileLength","getFileChecksum","getFileType","fileTransferStatus"];class zt{constructor(){J.add(this),it.set(this,[]),rt.set(this,K.MaxLength),lt.set(this,void 0),ut.set(this,0),yt.set(this,0),Et.set(this,"idle"),Tt.set(this,[]),xt.set(this,void 0),It.set(this,0),Ft.set(this,!1),_t.set(this,!1),Y(this)}get addEventListener(){return this.eventDispatcher.addEventListener}get removeEventListener(){return this.eventDispatcher.removeEventListener}get waitForEvent(){return this.eventDispatcher.waitForEvent}get fileTypes(){return e(this,it,"f")}static get MaxLength(){return e(this,K,"f",at)}get maxLength(){return e(this,rt,"f")}get type(){return e(this,lt,"f")}get length(){return e(this,ut,"f")}get checksum(){return e(this,yt,"f")}get status(){return e(this,Et,"f")}parseMessage(t,s){switch(Bt.log({messageType:t}),t){case"getFileTypes":e(this,J,"m",nt).call(this,s);break;case"maxFileLength":e(this,J,"m",ot).call(this,s);break;case"getFileType":case"setFileType":e(this,J,"m",ft).call(this,s);break;case"getFileLength":case"setFileLength":e(this,J,"m",pt).call(this,s);break;case"getFileChecksum":case"setFileChecksum":e(this,J,"m",wt).call(this,s);break;case"fileTransferStatus":e(this,J,"m",Mt).call(this,s);break;case"getFileBlock":e(this,J,"m",Rt).call(this,s);break;case"fileBytesTransferred":e(this,J,"m",At).call(this,s);break;default:throw Error(`uncaught messageType ${t}`)}}async send(t,s){e(this,J,"m",kt).call(this),e(this,J,"m",Z).call(this,t);const i=await H(s),n=i.byteLength,a=$(i);if(t!=this.type)Bt.log("different fileTypes - sending");else if(n!=this.length)Bt.log("different fileLengths - sending");else{if(a==this.checksum)return Bt.log("already sent file"),!1;Bt.log("different fileChecksums - sending")}const r=[];return r.push(e(this,J,"m",dt).call(this,t,!1)),r.push(e(this,J,"m",vt).call(this,n,!1)),r.push(e(this,J,"m",Ct).call(this,a,!1)),r.push(e(this,J,"m",St).call(this,"startSend",!1)),this.sendMessage(),await Promise.all(r),await e(this,J,"m",Lt).call(this,i),!0}async receive(t){e(this,J,"m",kt).call(this),e(this,J,"m",Z).call(this,t),await e(this,J,"m",dt).call(this,t),await e(this,J,"m",St).call(this,"startReceive")}async cancel(){e(this,J,"m",Wt).call(this),Bt.log("cancelling file transfer..."),s(this,Ft,!0,"f"),await e(this,J,"m",St).call(this,"cancel")}get isServerSide(){return e(this,_t,"f")}set isServerSide(t){e(this,_t,"f")!=t?(Bt.log({newIsServerSide:t}),s(this,_t,t,"f")):Bt.log("redundant isServerSide assignment")}requestRequiredInformation(){Bt.log("requesting required fileTransfer information");const t=qt.map((t=>({type:t})));this.sendMessage(t,!1)}}K=zt,it=new WeakMap,rt=new WeakMap,lt=new WeakMap,ut=new WeakMap,yt=new WeakMap,Et=new WeakMap,Tt=new WeakMap,xt=new WeakMap,It=new WeakMap,Ft=new WeakMap,_t=new WeakMap,J=new WeakSet,Q=function(){return this.eventDispatcher.dispatchEvent},Z=function(t){Bt.assertEnumWithError(t,Ot)},tt=function(t){Bt.assertWithError(t in Ot,`invalid typeEnum ${t}`)},et=function(t){Bt.assertWithError(t in Pt,`invalid statusEnum ${t}`)},st=function(t){Bt.assertEnumWithError(t,Nt)},nt=function(t){const i=Array.from(new Uint8Array(t.buffer)).map((t=>Ot[t])).filter(Boolean);s(this,it,i,"f"),Bt.log("fileTypes",i),e(this,J,"a",Q).call(this,"getFileTypes",{fileTypes:e(this,it,"f")})},ot=function(t){Bt.log("parseFileMaxLength",t);const s=t.getUint32(0,!0);Bt.log(`maxLength: ${s/1024}kB`),e(this,J,"m",ht).call(this,s)},ht=function(t){Bt.log({maxLength:t}),s(this,rt,t,"f"),e(this,J,"a",Q).call(this,"maxFileLength",{maxFileLength:t})},ct=function(t){Bt.assertWithError(t<=this.maxLength,`file length ${t}kB too large - must be ${this.maxLength}kB or less`)},ft=function(t){Bt.log("parseFileType",t);const s=t.getUint8(0);e(this,J,"m",tt).call(this,s);const i=Ot[s];e(this,J,"m",gt).call(this,i)},gt=function(t){Bt.log({fileTransferType:t}),s(this,lt,t,"f"),e(this,J,"a",Q).call(this,"getFileType",{fileType:t})},dt=async function(t,s){if(e(this,J,"m",Z).call(this,t),this.type==t)return void Bt.log(`redundant type assignment ${t}`);const i=this.waitForEvent("getFileType"),n=Ot.indexOf(t);this.sendMessage([{type:"setFileType",data:X(n)}],s),await i},pt=function(t){Bt.log("parseFileLength",t);const s=t.getUint32(0,!0);e(this,J,"m",mt).call(this,s)},mt=function(t){Bt.log(`length: ${t/1024}kB`),s(this,ut,t,"f"),e(this,J,"a",Q).call(this,"getFileLength",{fileLength:t})},vt=async function(t,s){if(Bt.assertTypeWithError(t,"number"),e(this,J,"m",ct).call(this,t),this.length==t)return void Bt.log(`redundant length assignment ${t}`);const i=this.waitForEvent("getFileLength"),n=new DataView(new ArrayBuffer(4));n.setUint32(0,t,!0),this.sendMessage([{type:"setFileLength",data:n.buffer}],s),await i},wt=function(t){Bt.log("checksum",t);const s=t.getUint32(0,!0);e(this,J,"m",bt).call(this,s)},bt=function(t){Bt.log({checksum:t}),s(this,yt,t,"f"),e(this,J,"a",Q).call(this,"getFileChecksum",{fileChecksum:t})},Ct=async function(t,e){if(Bt.assertTypeWithError(t,"number"),this.checksum==t)return void Bt.log(`redundant checksum assignment ${t}`);const s=this.waitForEvent("getFileChecksum"),i=new DataView(new ArrayBuffer(4));i.setUint32(0,t,!0),this.sendMessage([{type:"setFileChecksum",data:i.buffer}],e),await s},St=async function(t,s){e(this,J,"m",st).call(this,t);const i=this.waitForEvent("fileTransferStatus");Bt.log(`setting command ${t}`);const n=Nt.indexOf(t);this.sendMessage([{type:"setFileTransferCommand",data:X(n)}],s),await i},Mt=function(t){Bt.log("parseFileStatus",t);const s=t.getUint8(0);e(this,J,"m",et).call(this,s);const i=Pt[s];e(this,J,"m",Dt).call(this,i)},Dt=function(t){Bt.log({status:t}),s(this,Et,t,"f"),e(this,J,"a",Q).call(this,"fileTransferStatus",{fileTransferStatus:t}),e(this,Tt,"f").length=0,s(this,Ft,!1,"f")},kt=function(){Bt.assertWithError("idle"==e(this,Et,"f"),"status is not idle")},Wt=function(){Bt.assertWithError("idle"!=e(this,Et,"f"),"status is idle")},Rt=async function(t){Bt.log("parseFileBlock",t),e(this,Tt,"f").push(t.buffer);const s=e(this,Tt,"f").reduce(((t,e)=>t+e.byteLength),0),i=s/e(this,ut,"f");if(Bt.log(`received ${s} of ${e(this,ut,"f")} bytes (${100*i}%)`),e(this,J,"a",Q).call(this,"fileTransferProgress",{progress:i}),s!=e(this,ut,"f")){const t=new DataView(new ArrayBuffer(4));if(t.setUint32(0,s,!0),this.isServerSide)return;return void await this.sendMessage([{type:"fileBytesTransferred",data:t.buffer}])}Bt.log("file transfer complete");let n,a=(new Date).toLocaleString();switch(this.type){case"tflite":a+=".tflite";break;case"wifiServerCert":a+="_server.crt";break;case"wifiServerKey":a+="_server.key"}n="undefined"!=typeof File?new File(e(this,Tt,"f"),a):new Blob(e(this,Tt,"f"));const r=$(await n.arrayBuffer());Bt.log({checksum:r}),r==e(this,yt,"f")?(Bt.log("received file",n),e(this,J,"a",Q).call(this,"getFileBlock",{fileTransferBlock:t}),e(this,J,"a",Q).call(this,"fileTransferComplete",{direction:"receiving"}),e(this,J,"a",Q).call(this,"fileReceived",{file:n})):Bt.error(`wrong checksum - expected ${e(this,yt,"f")}, got ${r}`)},Lt=async function(t){return s(this,xt,t,"f"),s(this,It,0,"f"),e(this,J,"m",Ut).call(this)},Ut=async function(){if("sending"!=this.status)return;if(e(this,Ft,"f"))return void Bt.error("not sending block - busy cancelling");if(!e(this,xt,"f"))return void(this.isServerSide||Bt.error("no buffer defined"));const t=e(this,xt,"f");let i=e(this,It,"f");const n=t.slice(i,i+(this.mtu-3-3));Bt.log("slicedBuffer",n);const a=1-(t.byteLength-i)/t.byteLength;Bt.log(`sending bytes ${i}-${i+n.byteLength} of ${t.byteLength} bytes (${100*a}%)`),e(this,J,"a",Q).call(this,"fileTransferProgress",{progress:a}),0==n.byteLength?(Bt.log("finished sending buffer"),e(this,J,"a",Q).call(this,"fileTransferComplete",{direction:"sending"})):(await this.sendMessage([{type:"setFileBlock",data:n}]),s(this,It,i+n.byteLength,"f"))},At=async function(t){Bt.log("parseBytesTransferred",t);const s=t.getUint32(0,!0);if(Bt.log({bytesTransferred:s}),"sending"==this.status)return this.isServerSide||e(this,It,"f")==s?void e(this,J,"m",Ut).call(this):(Bt.error(`bytesTransferred are not equal - got ${s}, expected ${e(this,It,"f")}`),void this.cancel());Bt.error("not currently sending file")},at={value:0};const jt=T("MathUtils",{log:!1});const Gt=65536;function Ht(t,e){const s=Date.now();var i;let n=(i=s)-i%Gt+t.getUint16(e,!0);return Math.abs(s-n)>6e4&&(jt.log("correcting timestamp delta"),n+=Gt*Math.sign(s-n)),n}function Xt(t){const{x:e,y:s}=t;return Math.sqrt(e**2+s**2)}function Yt(t){return t*(Math.PI/180)}const Jt=2*Math.PI;function Kt(t){return(t%Jt+Jt)%Jt}var Qt,Zt,te;const ee={min:1/0,max:-1/0,span:0};class se{constructor(){Qt.add(this),Zt.set(this,Object.assign({},ee))}get min(){return e(this,Zt,"f").min}get max(){return e(this,Zt,"f").max}set min(t){e(this,Zt,"f").min=t,e(this,Zt,"f").max=Math.max(t,e(this,Zt,"f").max),e(this,Qt,"m",te).call(this)}set max(t){e(this,Zt,"f").max=t,e(this,Zt,"f").min=Math.min(t,e(this,Zt,"f").min),e(this,Qt,"m",te).call(this)}reset(){Object.assign(e(this,Zt,"f"),ee)}update(t){e(this,Zt,"f").min=Math.min(t,e(this,Zt,"f").min),e(this,Zt,"f").max=Math.max(t,e(this,Zt,"f").max),e(this,Qt,"m",te).call(this)}getNormalization(t,s){let i=function(t,e,s,i){return null==i&&(i=s-e),(t-e)/i}(t,e(this,Zt,"f").min,e(this,Zt,"f").max,e(this,Zt,"f").span);return s&&(i*=e(this,Zt,"f").span),i||0}updateAndGetNormalization(t,e){return this.update(t),this.getNormalization(t,e)}}var ie,ne,ae,re,oe;Zt=new WeakMap,Qt=new WeakSet,te=function(){e(this,Zt,"f").span=e(this,Zt,"f").max-e(this,Zt,"f").min};class he{constructor(){ie.set(this,{x:new se,y:new se})}reset(){e(this,ie,"f").x.reset(),e(this,ie,"f").y.reset()}update(t){e(this,ie,"f").x.update(t.x),e(this,ie,"f").y.update(t.y)}getNormalization(t,s){return{x:e(this,ie,"f").x.getNormalization(t.x,s),y:e(this,ie,"f").y.getNormalization(t.y,s)}}updateAndGetNormalization(t,e){return this.update(t),this.getNormalization(t,e)}}ie=new WeakMap;const ce=T("PressureDataManager",{log:!1}),le=["pressure"],fe=le;class ge{constructor(){ne.set(this,[]),ae.set(this,void 0),re.set(this,new se),oe.set(this,new he)}get positions(){return e(this,ne,"f")}get numberOfSensors(){return this.positions.length}parsePositions(t){const e=[];for(let s=0,i=0;i<t.byteLength;s++,i+=2)e.push({x:t.getUint8(i)/256,y:t.getUint8(i+1)/256});var i,n;ce.log({positions:e}),s(this,ne,e,"f"),s(this,ae,(i=this.numberOfSensors,n=()=>new se,new Array(i).fill(1).map(((t,e)=>{if("function"==typeof n)return n(e);{const t=n;return Object.assign({},t)}}))),"f"),this.resetRange()}resetRange(){e(this,ae,"f")?.forEach((t=>t.reset())),e(this,oe,"f").reset(),e(this,re,"f").reset()}parseData(t,s){const i={sensors:[],scaledSum:0,normalizedSum:0};for(let n=0,a=0;a<t.byteLength;n++,a+=2){const r=t.getUint16(a,!0);let o=r*s/this.numberOfSensors;const h=e(this,ae,"f")[n].updateAndGetNormalization(o,!1),c=this.positions[n];i.sensors[n]={rawValue:r,scaledValue:o,normalizedValue:h,position:c,weightedValue:0},i.scaledSum+=o}return i.normalizedSum=e(this,re,"f").updateAndGetNormalization(i.scaledSum,!1),i.scaledSum>0&&(i.center={x:0,y:0},i.sensors.forEach((t=>{t.weightedValue=t.scaledValue/i.scaledSum,i.center.x+=t.position.x*t.weightedValue,i.center.y+=t.position.y*t.weightedValue})),i.normalizedCenter=e(this,oe,"f").updateAndGetNormalization(i.center,!1)),ce.log({pressure:i}),i}}ne=new WeakMap,ae=new WeakMap,re=new WeakMap,oe=new WeakMap;const de=T("MotionSensorDataManager",{log:!1}),ue=["still","walking","running","bicycle","vehicle","tilting"],pe=["portraitUpright","landscapeLeft","portraitUpsideDown","landscapeRight","unknown"];class me{parseVector3(t,e){let[s,i,n]=[t.getInt16(0,!0),t.getInt16(2,!0),t.getInt16(4,!0)].map((t=>t*e));const a={x:s,y:i,z:n};return de.log({vector:a}),a}parseQuaternion(t,e){let[s,i,n,a]=[t.getInt16(0,!0),t.getInt16(2,!0),t.getInt16(4,!0),t.getInt16(6,!0)].map((t=>t*e));const r={x:s,y:i,z:n,w:a};return de.log({quaternion:r}),r}parseEuler(t,e){let[s,i,n]=[t.getInt16(0,!0),t.getInt16(2,!0),t.getInt16(4,!0)].map((t=>t*e));i*=-1,s*=-1,s<0&&(s+=360);const a={heading:s,pitch:i,roll:n};return de.log({euler:a}),a}parseStepCounter(t){de.log("parseStepCounter",t);const e=t.getUint32(0,!0);return de.log({stepCount:e}),e}parseActivity(t){de.log("parseActivity",t);const e={},s=t.getUint8(0);return de.log("activityBitfield",s.toString(2)),ue.forEach(((t,i)=>{e[t]=Boolean(s&1<<i)})),de.log("activity",e),e}parseDeviceOrientation(t){de.log("parseDeviceOrientation",t);const e=t.getUint8(0),s=pe[e];return de.assertWithError(s,"undefined deviceOrientation"),de.log({deviceOrientation:s}),s}}var ve,ye;const we=["barometer"],be=we,Ce=T("BarometerSensorDataManager",{log:!1});class Se{constructor(){ve.add(this)}parseData(t,s){const i=t.getUint32(0,!0)*s,n=e(this,ve,"m",ye).call(this,i);return Ce.log({pressure:i,altitude:n}),{pressure:i}}}ve=new WeakSet,ye=function(t){const e=.0065;return 288.15/e*(1-Math.pow(t/101325,.19026643566373183))};const Ee=T("ParseUtils",{log:!1});function Me(t,e=0){const s=t.getUint8(e++);return{string:V.decode(t.buffer.slice(t.byteOffset+e,t.byteOffset+e+s)),byteOffset:e+=s}}function De(t,e,s,i,n=!1){let a=0;for(;a<t.byteLength;){const r=t.getUint8(a++);Ee.assertWithError(r in e,`invalid messageTypeEnum ${r}`);const o=e[r];let h;n?(h=t.getUint16(a,!0),a+=2):h=t.getUint8(a++),Ee.log({messageTypeEnum:r,messageType:o,messageLength:h,dataView:t,byteOffset:a});const c=G(t,a,h);Ee.log({_dataView:c}),s(o,c,i),a+=h}}var ke,We,Te,Re,xe,Ie,Le,Ue,Ae,Fe,_e,Be,$e,Oe,Pe,Ne,Ve,qe,ze,je,Ge,He,Xe,Ye,Je,Ke,Qe,Ze,ts;const es=T("CameraManager",{log:!1}),ss=["focus","takePicture","stop","sleep","wake"],is=["idle","focusing","takingPicture","asleep"],ns=["headerSize","header","imageSize","image","footerSize","footer"],as=["resolution","qualityFactor","shutter","gain","redGain","greenGain","blueGain"],rs=["cameraStatus","cameraCommand","getCameraConfiguration","setCameraConfiguration","cameraData"],os=["getCameraConfiguration","cameraStatus"],hs=[...rs,"cameraImageProgress","cameraImage"];class cs{constructor(){ke.add(this),Re.set(this,void 0),Be.set(this,0),$e.set(this,void 0),Oe.set(this,0),Pe.set(this,0),Ne.set(this,void 0),Ve.set(this,0),qe.set(this,0),ze.set(this,void 0),je.set(this,0),Ge.set(this,!1),Xe.set(this,{}),Ye.set(this,void 0),Je.set(this,{resolution:{min:100,max:720},qualityFactor:{min:15,max:60},shutter:{min:4,max:16383},gain:{min:1,max:248},redGain:{min:0,max:1023},greenGain:{min:0,max:1023},blueGain:{min:0,max:1023}}),Y(this)}get waitForEvent(){return this.eventDispatcher.waitForEvent}requestRequiredInformation(){es.log("requesting required camera information");const t=os.map((t=>({type:t})));this.sendMessage(t,!1)}get cameraStatus(){return e(this,Re,"f")}async focus(){e(this,ke,"m",Ae).call(this),await e(this,ke,"m",Le).call(this,"focus")}async takePicture(){e(this,ke,"m",Ae).call(this),await e(this,ke,"m",Le).call(this,"takePicture")}async stop(){e(this,ke,"m",Ae).call(this),await e(this,ke,"m",Le).call(this,"stop")}async sleep(){e(this,ke,"m",Ae).call(this),await e(this,ke,"m",Le).call(this,"sleep")}async wake(){e(this,ke,"m",Ue).call(this),await e(this,ke,"m",Le).call(this,"wake")}get cameraConfiguration(){return e(this,Xe,"f")}get availableCameraConfigurationTypes(){return e(this,Ye,"f")}get cameraConfigurationRanges(){return e(this,Je,"f")}async setCameraConfiguration(t){if(es.log({newCameraConfiguration:t}),e(this,ke,"m",Qe).call(this,t))return void es.log("redundant camera configuration");const s=e(this,ke,"m",ts).call(this,t);es.log({setCameraConfigurationData:s});const i=this.waitForEvent("getCameraConfiguration");this.sendMessage([{type:"setCameraConfiguration",data:s.buffer}]),await i}static AssertValidCameraConfigurationType(t){es.assertEnumWithError(t,as)}static AssertValidCameraConfigurationTypeEnum(t){es.assertTypeWithError(t,"number"),es.assertWithError(t in as,`invalid cameraConfigurationTypeEnum ${t}`)}parseMessage(t,s){switch(es.log({messageType:t,dataView:s}),t){case"cameraStatus":e(this,ke,"m",xe).call(this,s);break;case"getCameraConfiguration":case"setCameraConfiguration":e(this,ke,"m",Ke).call(this,s);break;case"cameraData":e(this,ke,"m",Fe).call(this,s);break;default:throw Error(`uncaught messageType ${t}`)}}clear(){s(this,Re,void 0,"f"),s(this,Oe,0,"f"),s(this,Ve,0,"f"),s(this,je,0,"f")}}function ls(t,e,s){const i=function(t,e,s){const i=new ArrayBuffer(44+2*t.length),n=new DataView(i);fs(n,0,"RIFF"),n.setUint32(4,36+2*t.length,!0),fs(n,8,"WAVE"),fs(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,s,!0),n.setUint32(24,e,!0),n.setUint32(28,e*s*2,!0),n.setUint16(32,2*s,!0),n.setUint16(34,16,!0),fs(n,36,"data"),n.setUint32(40,2*t.length,!0);for(let e=0;e<t.length;e++)n.setInt16(44+2*e,32767*t[e],!0);return i}(t,e,s);return new Blob([i],{type:"audio/wav"})}function fs(t,e,s){for(let i=0;i<s.length;i++)t.setUint8(e+i,s.charCodeAt(i))}var gs,ds,us,ps,ms,vs,ys,ws,bs,Cs,Ss,Es,Ms,Ds,ks,Ws,Ts,Rs,xs,Is,Ls,Us,As,Fs;We=cs,Re=new WeakMap,Be=new WeakMap,$e=new WeakMap,Oe=new WeakMap,Pe=new WeakMap,Ne=new WeakMap,Ve=new WeakMap,qe=new WeakMap,ze=new WeakMap,je=new WeakMap,Ge=new WeakMap,Xe=new WeakMap,Ye=new WeakMap,Je=new WeakMap,ke=new WeakSet,Te=function(){return this.eventDispatcher.dispatchEvent},xe=function(t){const s=t.getUint8(0),i=is[s];e(this,ke,"m",Ie).call(this,i)},Ie=function(t){if(es.assertEnumWithError(t,is),t==e(this,Re,"f"))return void es.log(`redundant cameraStatus ${t}`);const i=e(this,Re,"f");s(this,Re,t,"f"),es.log(`updated cameraStatus to "${this.cameraStatus}"`),e(this,ke,"a",Te).call(this,"cameraStatus",{cameraStatus:this.cameraStatus,previousCameraStatus:i}),"takingPicture"!=e(this,Re,"f")&&e(this,Ve,"f")>0&&!e(this,Ge,"f")&&e(this,ke,"m",He).call(this)},Le=async function(t,e){es.assertEnumWithError(t,ss),es.log(`sending camera command "${t}"`);const s=this.waitForEvent("cameraStatus");es.log(`setting command "${t}"`);const i=ss.indexOf(t);this.sendMessage([{type:"cameraCommand",data:X(i)}],e),await s},Ue=function(){es.assertWithError("asleep"==e(this,Re,"f"),`camera is not asleep - currently ${e(this,Re,"f")}`)},Ae=function(){es.assertWithError("asleep"!=e(this,Re,"f"),`camera is not awake - currently ${e(this,Re,"f")}`)},Fe=function(t){es.log("parsing camera data",t),De(t,ns,e(this,ke,"m",_e).bind(this),null,!0)},_e=function(t,i){switch(es.log({cameraDataType:t,dataView:i}),t){case"headerSize":s(this,Be,i.getUint16(0,!0),"f"),es.log({headerSize:e(this,Be,"f")}),s(this,$e,void 0,"f"),e(this,Oe,"f");break;case"header":s(this,$e,z(e(this,$e,"f"),i),"f"),es.log({headerData:e(this,$e,"f")}),s(this,Oe,e(this,$e,"f")?.byteLength/e(this,Be,"f"),"f"),es.log({headerProgress:e(this,Oe,"f")}),e(this,ke,"a",Te).call(this,"cameraImageProgress",{progress:e(this,Oe,"f"),type:"header"}),1==e(this,Oe,"f")&&es.log("finished getting header data");break;case"imageSize":s(this,Pe,i.getUint16(0,!0),"f"),es.log({imageSize:e(this,Pe,"f")}),s(this,Ne,void 0,"f"),e(this,Ve,"f"),s(this,Ge,!1,"f");break;case"image":s(this,Ne,z(e(this,Ne,"f"),i),"f"),es.log({imageData:e(this,Ne,"f")}),s(this,Ve,e(this,Ne,"f")?.byteLength/e(this,Pe,"f"),"f"),es.log({imageProgress:e(this,Ve,"f")}),e(this,ke,"a",Te).call(this,"cameraImageProgress",{progress:e(this,Ve,"f"),type:"image"}),1==e(this,Ve,"f")&&(es.log("finished getting image data"),1==e(this,Oe,"f")&&e(this,ke,"m",He).call(this));break;case"footerSize":s(this,qe,i.getUint16(0,!0),"f"),es.log({footerSize:e(this,qe,"f")}),s(this,ze,void 0,"f"),e(this,je,"f");break;case"footer":s(this,ze,z(e(this,ze,"f"),i),"f"),es.log({footerData:e(this,ze,"f")}),s(this,je,e(this,ze,"f")?.byteLength/e(this,qe,"f"),"f"),es.log({footerProgress:e(this,je,"f")}),e(this,ke,"a",Te).call(this,"cameraImageProgress",{progress:e(this,je,"f"),type:"footer"}),1==e(this,je,"f")&&(es.log("finished getting footer data"),1==e(this,Ve,"f")&&e(this,ke,"m",He).call(this))}},He=function(){es.log("building image...");const t=z(e(this,$e,"f"),e(this,Ne,"f"),e(this,ze,"f"));es.log({imageData:t});let i=new Blob([t],{type:"image/jpeg"});es.log("created blob",i);const n=URL.createObjectURL(i);es.log("created url",n),e(this,ke,"a",Te).call(this,"cameraImage",{url:n,blob:i}),s(this,Ge,!0,"f")},Ke=function(t){const i={};let n=0;for(;n<t.byteLength;){const e=t.getUint8(n++),s=as[e];es.assertWithError(s,`invalid cameraConfigurationTypeIndex ${e}`),i[s]=t.getUint16(n,!0),n+=2}es.log({parsedCameraConfiguration:i}),s(this,Ye,Object.keys(i),"f"),s(this,Xe,i,"f"),e(this,ke,"a",Te).call(this,"getCameraConfiguration",{cameraConfiguration:e(this,Xe,"f")})},Qe=function(t){return Object.keys(t).every((e=>this.cameraConfiguration[e]==t[e]))},Ze=function(t){es.assertWithError(e(this,Ye,"f"),"must get initial cameraConfiguration");const s=e(this,Ye,"f")?.includes(t);return es.assertWithError(s,`unavailable camera configuration type "${t}"`),s},ts=function(t){let s=Object.keys(t);s=s.filter((t=>e(this,ke,"m",Ze).call(this,t)));const i=new DataView(new ArrayBuffer(3*s.length));return s.forEach(((e,s)=>{We.AssertValidCameraConfigurationType(e);const n=as.indexOf(e);i.setUint8(3*s,n);const a=t[e];i.setUint16(3*s+1,a,!0)})),es.log({sensorConfigurationData:i}),i},T("AudioUtils",{log:!0});const _s=T("MicrophoneManager",{log:!1}),Bs=["start","stop","vad"],$s=["idle","streaming","vad"],Os=["sampleRate","bitDepth"],Ps=["8","16"],Ns=["microphoneStatus","microphoneCommand","getMicrophoneConfiguration","setMicrophoneConfiguration","microphoneData"],Vs={sampleRate:["8000","16000"],bitDepth:Ps},qs=["getMicrophoneConfiguration","microphoneStatus"],zs=[...Ns,"isRecordingMicrophone","microphoneRecording"];class js{constructor(){gs.add(this),ps.set(this,void 0),Cs.set(this,.001),Ss.set(this,0),Ds.set(this,{}),ks.set(this,void 0),Is.set(this,void 0),Ls.set(this,void 0),Us.set(this,void 0),As.set(this,!1),Fs.set(this,void 0),Y(this)}get waitForEvent(){return this.eventDispatcher.waitForEvent}requestRequiredInformation(){_s.log("requesting required microphone information");const t=qs.map((t=>({type:t})));this.sendMessage(t,!1)}get microphoneStatus(){return e(this,ps,"f")}async start(){await e(this,gs,"m",ys).call(this,"start")}async stop(){e(this,gs,"m",ws).call(this),await e(this,gs,"m",ys).call(this,"stop")}async vad(){await e(this,gs,"m",ys).call(this,"vad")}async toggle(){switch(this.microphoneStatus){case"idle":this.start();break;case"streaming":this.stop()}}get microphoneConfiguration(){return e(this,Ds,"f")}get availableMicrophoneConfigurationTypes(){return e(this,ks,"f")}get bitDepth(){return e(this,Ds,"f").bitDepth}get sampleRate(){return e(this,Ds,"f").sampleRate}async setMicrophoneConfiguration(t){if(_s.log({newMicrophoneConfiguration:t}),e(this,gs,"m",Ts).call(this,t))return void _s.log("redundant microphone configuration");const s=e(this,gs,"m",xs).call(this,t);_s.log({setMicrophoneConfigurationData:s});const i=this.waitForEvent("getMicrophoneConfiguration");this.sendMessage([{type:"setMicrophoneConfiguration",data:s.buffer}]),await i}static AssertValidMicrophoneConfigurationType(t){_s.assertEnumWithError(t,Os)}static AssertValidMicrophoneConfigurationTypeEnum(t){_s.assertTypeWithError(t,"number"),_s.assertWithError(t in Os,`invalid microphoneConfigurationTypeEnum ${t}`)}parseMessage(t,s){switch(_s.log({messageType:t,dataView:s}),t){case"microphoneStatus":e(this,gs,"m",ms).call(this,s);break;case"getMicrophoneConfiguration":case"setMicrophoneConfiguration":e(this,gs,"m",Ws).call(this,s);break;case"microphoneData":e(this,gs,"m",Es).call(this,s);break;default:throw Error(`uncaught messageType ${t}`)}}get audioContext(){return e(this,Is,"f")}set audioContext(t){e(this,Is,"f")!=t?(s(this,Is,t,"f"),_s.log("assigned new audioContext",e(this,Is,"f")),e(this,Is,"f")?s(this,Ss,e(this,Is,"f").currentTime,"f"):(e(this,Us,"f")&&(e(this,Us,"f").disconnect(),s(this,Us,void 0,"f")),e(this,Ls,"f")&&(e(this,Ls,"f").disconnect(),s(this,Ls,void 0,"f")))):_s.log("redundant audioContext assignment",e(this,Is,"f"))}get gainNode(){return _s.assertWithError(e(this,Is,"f"),"audioContext assignment required for gainNode"),e(this,Ls,"f")||(_s.log("creating gainNode..."),s(this,Ls,e(this,Is,"f").createGain(),"f"),_s.log("created gainNode",e(this,Ls,"f"))),e(this,Ls,"f")}get mediaStreamDestination(){return _s.assertWithError(e(this,Is,"f"),"audioContext assignment required for mediaStreamDestination"),e(this,Us,"f")||(_s.log("creating mediaStreamDestination..."),s(this,Us,e(this,Is,"f").createMediaStreamDestination(),"f"),this.gainNode?.connect(e(this,Us,"f")),_s.log("created mediaStreamDestination",e(this,Us,"f"))),e(this,Us,"f")}get isRecording(){return e(this,As,"f")}startRecording(){this.isRecording?_s.log("already recording"):(s(this,Fs,[],"f"),s(this,As,!0,"f"),e(this,gs,"a",us).call(this,"isRecordingMicrophone",{isRecordingMicrophone:this.isRecording}))}stopRecording(){if(this.isRecording){if(s(this,As,!1,"f"),e(this,Fs,"f")&&e(this,Fs,"f").length>0){_s.log("parsing microphone data...",e(this,Fs,"f").length);const t=z(...e(this,Fs,"f")),s=new Float32Array(t),i=ls(s,Number(this.sampleRate),1),n=URL.createObjectURL(i);e(this,gs,"a",us).call(this,"microphoneRecording",{samples:s,sampleRate:this.sampleRate,bitDepth:this.bitDepth,blob:i,url:n})}s(this,Fs,void 0,"f"),e(this,gs,"a",us).call(this,"isRecordingMicrophone",{isRecordingMicrophone:this.isRecording})}else _s.log("already not recording")}toggleRecording(){e(this,As,"f")?this.stopRecording():this.startRecording()}clear(){s(this,ps,void 0,"f"),s(this,Ds,{},"f"),this.isRecording&&this.stopRecording()}}var Gs;ds=js,ps=new WeakMap,Cs=new WeakMap,Ss=new WeakMap,Ds=new WeakMap,ks=new WeakMap,Is=new WeakMap,Ls=new WeakMap,Us=new WeakMap,As=new WeakMap,Fs=new WeakMap,gs=new WeakSet,us=function(){return this.eventDispatcher.dispatchEvent},ms=function(t){const s=t.getUint8(0),i=$s[s];e(this,gs,"m",vs).call(this,i)},vs=function(t){if(_s.assertEnumWithError(t,$s),t==e(this,ps,"f"))return void _s.log(`redundant microphoneStatus ${t}`);const i=e(this,ps,"f");s(this,ps,t,"f"),_s.log(`updated microphoneStatus to "${this.microphoneStatus}"`),e(this,gs,"a",us).call(this,"microphoneStatus",{microphoneStatus:this.microphoneStatus,previousMicrophoneStatus:i})},ys=async function(t,e){_s.assertEnumWithError(t,Bs),_s.log(`sending microphone command "${t}"`);const s=this.waitForEvent("microphoneStatus");_s.log(`setting command "${t}"`);const i=Bs.indexOf(t);this.sendMessage([{type:"microphoneCommand",data:X(i)}],e),await s},ws=function(){_s.assertWithError("idle"!=e(this,ps,"f"),"microphone is idle")},bs=function(){_s.assertEnumWithError(this.bitDepth,Ps)},Es=function(t){e(this,gs,"m",bs).call(this),_s.log("parsing microphone data",t);const i=t.byteLength/e(this,gs,"a",Ms),n=new Float32Array(i);for(let e=0;e<i;e++){let s;switch(this.bitDepth){case"16":s=t.getInt16(2*e,!0),n[e]=s/32768;break;case"8":s=t.getInt8(e),n[e]=s/128}}if(_s.log("samples",n),e(this,As,"f")&&e(this,Fs,"f")&&e(this,Fs,"f").push(n),e(this,Is,"f")&&e(this,Ls,"f")){const t=e(this,Is,"f").createBuffer(1,n.length,Number(this.sampleRate));t.getChannelData(0).set(n);const i=e(this,Is,"f").createBufferSource();i.buffer=t;const a=t.getChannelData(0),r=Number(this.sampleRate);for(let t=0;t<e(this,Cs,"f")*r;t++)a[t]*=t/(e(this,Cs,"f")*r);for(let t=a.length-1;t>=a.length-e(this,Cs,"f")*r;t--)a[t]*=(a.length-t)/(e(this,Cs,"f")*r);i.connect(e(this,Ls,"f")),e(this,Ss,"f")<e(this,Is,"f").currentTime&&s(this,Ss,e(this,Is,"f").currentTime,"f"),i.start(e(this,Ss,"f")),s(this,Ss,e(this,Ss,"f")+t.duration,"f")}e(this,gs,"a",us).call(this,"microphoneData",{samples:n,sampleRate:this.sampleRate,bitDepth:this.bitDepth})},Ms=function(){switch(this.bitDepth){case"8":return 1;case"16":return 2}},Ws=function(t){const i={};let n=0;for(;n<t.byteLength;){const e=t.getUint8(n++),s=Os[e];_s.assertWithError(s,`invalid microphoneConfigurationTypeIndex ${e}`);let a=t.getUint8(n++);const r=Vs[s],o=r[a];_s.assertEnumWithError(o,r),_s.log({microphoneConfigurationType:s,value:o}),i[s]=o}_s.log({parsedMicrophoneConfiguration:i}),s(this,ks,Object.keys(i),"f"),s(this,Ds,i,"f"),e(this,gs,"a",us).call(this,"getMicrophoneConfiguration",{microphoneConfiguration:e(this,Ds,"f")})},Ts=function(t){return Object.keys(t).every((e=>this.microphoneConfiguration[e]==t[e]))},Rs=function(t){_s.assertWithError(e(this,ks,"f"),"must get initial microphoneConfiguration");const s=e(this,ks,"f")?.includes(t);return _s.assertWithError(s,`unavailable microphone configuration type "${t}"`),s},xs=function(t){let s=Object.keys(t);s=s.filter((t=>e(this,gs,"m",Rs).call(this,t)));const i=new DataView(new ArrayBuffer(2*s.length));return s.forEach(((e,s)=>{ds.AssertValidMicrophoneConfigurationType(e);const n=Os.indexOf(e);i.setUint8(2*s,n);let a=t[e];"number"==typeof a&&(a=a.toString());const r=Vs[e];_s.assertEnumWithError(a,r);const o=r.indexOf(a);i.setUint8(2*s+1,o)})),_s.log({sensorConfigurationData:i}),i};const Hs=T("SensorDataManager",{log:!1}),Xs=[...le,"acceleration","gravity","linearAcceleration","gyroscope","magnetometer","gameRotation","rotation","orientation","activity","stepCounter","stepDetector","deviceOrientation","tapDetector",...we,"camera","microphone"],Ys=[...fe,"acceleration","gravity","linearAcceleration","gyroscope","magnetometer","gameRotation","rotation","orientation",...be],Js=["getPressurePositions","getSensorScalars","sensorData"],Ks=["getPressurePositions"],Qs=[...Js,...Xs];class Zs{constructor(){this.pressureSensorDataManager=new ge,this.motionSensorDataManager=new me,this.barometerSensorDataManager=new Se,Gs.set(this,new Map)}static AssertValidSensorType(t){Hs.assertEnumWithError(t,Xs)}static AssertValidSensorTypeEnum(t){Hs.assertTypeWithError(t,"number"),Hs.assertWithError(t in Xs,`invalid sensorTypeEnum ${t}`)}get dispatchEvent(){return this.eventDispatcher.dispatchEvent}parseMessage(t,e){switch(Hs.log({messageType:t}),t){case"getSensorScalars":this.parseScalars(e);break;case"getPressurePositions":this.pressureSensorDataManager.parsePositions(e);break;case"sensorData":this.parseData(e);break;default:throw Error(`uncaught messageType ${t}`)}}parseScalars(t){for(let s=0;s<t.byteLength;s+=5){const i=t.getUint8(s),n=Xs[i];if(!n){Hs.warn(`unknown sensorType index ${i}`);continue}const a=t.getFloat32(s+1,!0);Hs.log({sensorType:n,sensorScalar:a}),e(this,Gs,"f").set(n,a)}}parseData(t){Hs.log("sensorData",Array.from(new Uint8Array(t.buffer)));let e=0;const s=Ht(t,e);e+=2;De(new DataView(t.buffer,e),Xs,this.parseDataCallback.bind(this),{timestamp:s})}parseDataCallback(t,s,{timestamp:i}){const n=e(this,Gs,"f").get(t)||1;let a=null;switch(t){case"pressure":a=this.pressureSensorDataManager.parseData(s,n);break;case"acceleration":case"gravity":case"linearAcceleration":case"gyroscope":case"magnetometer":a=this.motionSensorDataManager.parseVector3(s,n);break;case"gameRotation":case"rotation":a=this.motionSensorDataManager.parseQuaternion(s,n);break;case"orientation":a=this.motionSensorDataManager.parseEuler(s,n);break;case"stepCounter":a=this.motionSensorDataManager.parseStepCounter(s);break;case"stepDetector":case"tapDetector":a={};break;case"activity":a=this.motionSensorDataManager.parseActivity(s);break;case"deviceOrientation":a=this.motionSensorDataManager.parseDeviceOrientation(s);break;case"barometer":a=this.barometerSensorDataManager.parseData(s,n);break;case"camera":case"microphone":return;default:Hs.error(`uncaught sensorType "${t}"`)}Hs.assertWithError(null!=a,`no sensorData defined for sensorType "${t}"`),Hs.log({sensorType:t,sensorData:a}),this.dispatchEvent(t,{sensorType:t,[t]:a,timestamp:i}),this.dispatchEvent("sensorData",{sensorType:t,[t]:a,timestamp:i})}}var ti,ei,si,ii,ni,ai,ri,oi,hi,ci,li,fi,gi;Gs=new WeakMap;const di=T("SensorConfigurationManager",{log:!1}),ui=["getSensorConfiguration","setSensorConfiguration"],pi=ui;class mi{constructor(){ti.add(this),ii.set(this,void 0),ai.set(this,{}),Y(this)}get addEventListener(){return this.eventDispatcher.addEventListener}get waitForEvent(){return this.eventDispatcher.waitForEvent}get configuration(){return e(this,ai,"f")}async setConfiguration(t,s,i){if(s&&(t=Object.assign({...this.zeroSensorConfiguration},t)),di.log({newSensorConfiguration:t}),e(this,ti,"m",oi).call(this,t))return void di.log("redundant sensor configuration");const n=e(this,ti,"m",fi).call(this,t);di.log({setSensorConfigurationData:n});const a=this.waitForEvent("getSensorConfiguration");this.sendMessage([{type:"setSensorConfiguration",data:n.buffer}],i),await a}static get ZeroSensorConfiguration(){return e(this,ei,"f",gi)}get zeroSensorConfiguration(){const t={};return e(this,ii,"f").forEach((e=>{t[e]=0})),t}async clearSensorConfiguration(){return this.setConfiguration(this.zeroSensorConfiguration)}parseMessage(t,s){switch(di.log({messageType:t}),t){case"getSensorConfiguration":case"setSensorConfiguration":const i=e(this,ti,"m",hi).call(this,s);e(this,ti,"m",ri).call(this,i);break;default:throw Error(`uncaught messageType ${t}`)}}}var vi,yi,wi,bi,Ci,Si,Ei,Mi,Di,ki,Wi,Ti,Ri,xi,Ii,Li,Ui,Ai,Fi,_i,Bi,$i,Oi,Pi,Ni,Vi,qi,zi,ji,Gi,Hi;ei=mi,ii=new WeakMap,ai=new WeakMap,ti=new WeakSet,si=function(){return this.eventDispatcher.dispatchEvent},ni=function(t){di.assertWithError(e(this,ii,"f"),"must get initial sensorConfiguration");const s=e(this,ii,"f")?.includes(t);return di.log(s,`unavailable sensor type "${t}"`),s},ri=function(t){s(this,ai,t,"f"),di.log({updatedConfiguration:e(this,ai,"f")}),e(this,ti,"a",si).call(this,"getSensorConfiguration",{sensorConfiguration:this.configuration})},oi=function(t){return Object.keys(t).every((e=>this.configuration[e]==t[e]))},hi=function(t){const e={};for(let s=0;s<t.byteLength;s+=3){const i=t.getUint8(s),n=Xs[i],a=t.getUint16(s+1,!0);di.log({sensorType:n,sensorRate:a}),n?e[n]=a:di.warn(`unknown sensorType index ${i}`)}return di.log({parsedSensorConfiguration:e}),s(this,ii,Object.keys(e),"f"),e},ci=function(t){di.assertTypeWithError(t,"number"),di.assertWithError(t>=0,`sensorRate must be 0 or greater (got ${t})`),di.assertWithError(t<65535,`sensorRate must be 0 or greater (got ${t})`),di.assertWithError(t%5==0,"sensorRate must be multiple of 5")},li=function(t){e(ei,ei,"m",ci).call(ei,t)},fi=function(t){let s=Object.keys(t);s=s.filter((t=>e(this,ti,"m",ni).call(this,t)));const i=new DataView(new ArrayBuffer(3*s.length));return s.forEach(((s,n)=>{Zs.AssertValidSensorType(s);const a=Xs.indexOf(s);i.setUint8(3*n,a);const r=t[s];e(this,ti,"m",li).call(this,r),i.setUint16(3*n+1,r,!0)})),di.log({sensorConfigurationData:i}),i},gi={value:{}},Xs.forEach((t=>{e(ei,ei,"f",gi)[t]=0}));const Xi=T("TfliteManager",{log:!1}),Yi=["getTfliteName","setTfliteName","getTfliteTask","setTfliteTask","getTfliteSampleRate","setTfliteSampleRate","getTfliteSensorTypes","setTfliteSensorTypes","tfliteIsReady","getTfliteCaptureDelay","setTfliteCaptureDelay","getTfliteThreshold","setTfliteThreshold","getTfliteInferencingEnabled","setTfliteInferencingEnabled","tfliteInference"],Ji=Yi,Ki=["getTfliteName","getTfliteTask","getTfliteSampleRate","getTfliteSensorTypes","tfliteIsReady","getTfliteCaptureDelay","getTfliteThreshold","getTfliteInferencingEnabled"],Qi=["classification","regression"],Zi=["pressure","linearAcceleration","gyroscope","magnetometer"];class tn{constructor(){vi.add(this),Ci.set(this,void 0),Mi.set(this,void 0),Wi.set(this,void 0),xi.set(this,[]),Ui.set(this,void 0),Bi.set(this,void 0),Pi.set(this,void 0),qi.set(this,void 0),Hi.set(this,void 0),Y(this)}get addEventListenter(){return this.eventDispatcher.addEventListener}get removeEventListener(){return this.eventDispatcher.removeEventListener}get waitForEvent(){return this.eventDispatcher.waitForEvent}get name(){return e(this,Ci,"f")}async setName(t,e){if(Xi.assertTypeWithError(t,"string"),this.name==t)return void Xi.log(`redundant name assignment ${t}`);const s=this.waitForEvent("getTfliteName"),i=N.encode(t);this.sendMessage([{type:"setTfliteName",data:i.buffer}],e),await s}get task(){return e(this,Mi,"f")}async setTask(t,s){if(e(this,vi,"m",yi).call(this,t),this.task==t)return void Xi.log(`redundant task assignment ${t}`);const i=this.waitForEvent("getTfliteTask");Qi.indexOf(t),this.sendMessage([{type:"setTfliteTask",data:X(commandEnum)}],s),await i}get sampleRate(){return e(this,Wi,"f")}async setSampleRate(t,s){if(Xi.assertTypeWithError(t,"number"),t-=t%5,Xi.assertWithError(t>=5,`sampleRate must be multiple of 5 greater than 0 (got ${t})`),e(this,Wi,"f")==t)return void Xi.log(`redundant sampleRate assignment ${t}`);const i=this.waitForEvent("getTfliteSampleRate"),n=new DataView(new ArrayBuffer(2));n.setUint16(0,t,!0),this.sendMessage([{type:"setTfliteSampleRate",data:n.buffer}],s),await i}static AssertValidSensorType(t){Zs.AssertValidSensorType(t);const e=t;Xi.assertWithError(Zi.includes(e),`invalid tflite sensorType "${t}"`)}get sensorTypes(){return e(this,xi,"f").slice()}async setSensorTypes(t,e){t.forEach((t=>{tn.AssertValidSensorType(t)}));const s=this.waitForEvent("getTfliteSensorTypes");var i;const n=(t=(i=t).filter(((t,e)=>i.indexOf(t)==e))).map((t=>Xs.indexOf(t))).sort();Xi.log(t,n),this.sendMessage([{type:"setTfliteSensorTypes",data:Uint8Array.from(n).buffer}],e),await s}get isReady(){return e(this,Ui,"f")}get captureDelay(){return e(this,Bi,"f")}async setCaptureDelay(t,s){if(Xi.assertTypeWithError(t,"number"),e(this,Bi,"f")==t)return void Xi.log(`redundant captureDelay assignment ${t}`);const i=this.waitForEvent("getTfliteCaptureDelay"),n=new DataView(new ArrayBuffer(2));n.setUint16(0,t,!0),this.sendMessage([{type:"setTfliteCaptureDelay",data:n.buffer}],s),await i}get threshold(){return e(this,Pi,"f")}async setThreshold(t,s){if(Xi.assertTypeWithError(t,"number"),Xi.assertWithError(t>=0,`threshold must be positive (got ${t})`),e(this,Pi,"f")==t)return void Xi.log(`redundant threshold assignment ${t}`);const i=this.waitForEvent("getTfliteThreshold"),n=new DataView(new ArrayBuffer(4));n.setFloat32(0,t,!0),this.sendMessage([{type:"setTfliteThreshold",data:n.buffer}],s),await i}get inferencingEnabled(){return e(this,qi,"f")}async setInferencingEnabled(t,s=!0){if(Xi.assertTypeWithError(t,"boolean"),!t&&!this.isReady)return;if(e(this,vi,"m",_i).call(this),e(this,qi,"f")==t)return void Xi.log(`redundant inferencingEnabled assignment ${t}`);const i=this.waitForEvent("getTfliteInferencingEnabled");this.sendMessage([{type:"setTfliteInferencingEnabled",data:X(Number(t))}],s),await i}async toggleInferencingEnabled(){return this.setInferencingEnabled(!this.inferencingEnabled)}async enableInferencing(){this.inferencingEnabled||this.setInferencingEnabled(!0)}async disableInferencing(){this.inferencingEnabled&&this.setInferencingEnabled(!1)}parseMessage(t,s){switch(Xi.log({messageType:t}),t){case"getTfliteName":case"setTfliteName":e(this,vi,"m",Si).call(this,s);break;case"getTfliteTask":case"setTfliteTask":e(this,vi,"m",Di).call(this,s);break;case"getTfliteSampleRate":case"setTfliteSampleRate":e(this,vi,"m",Ti).call(this,s);break;case"getTfliteSensorTypes":case"setTfliteSensorTypes":e(this,vi,"m",Ii).call(this,s);break;case"tfliteIsReady":e(this,vi,"m",Ai).call(this,s);break;case"getTfliteCaptureDelay":case"setTfliteCaptureDelay":e(this,vi,"m",$i).call(this,s);break;case"getTfliteThreshold":case"setTfliteThreshold":e(this,vi,"m",Ni).call(this,s);break;case"getTfliteInferencingEnabled":case"setTfliteInferencingEnabled":e(this,vi,"m",zi).call(this,s);break;case"tfliteInference":e(this,vi,"m",Gi).call(this,s);break;default:throw Error(`uncaught messageType ${t}`)}}get configuration(){return e(this,Hi,"f")}sendConfiguration(t,i){if(t==e(this,Hi,"f"))return void Xi.log("redundant tflite configuration assignment");if(s(this,Hi,t,"f"),Xi.log("assigned new tflite configuration",this.configuration),!this.configuration)return;const{name:n,task:a,captureDelay:r,sampleRate:o,threshold:h,sensorTypes:c}=this.configuration;this.setName(n,!1),this.setTask(a,!1),null!=r&&this.setCaptureDelay(r,!1),this.setSampleRate(o,!1),null!=h&&this.setThreshold(h,!1),this.setSensorTypes(c,i)}clear(){s(this,Hi,void 0,"f"),s(this,qi,!1,"f"),s(this,xi,[],"f"),s(this,Wi,0,"f"),s(this,Ui,!1,"f")}requestRequiredInformation(){Xi.log("requesting required tflite information");const t=Ki.map((t=>({type:t})));this.sendMessage(t,!1)}}var en,sn,nn,an,rn;Ci=new WeakMap,Mi=new WeakMap,Wi=new WeakMap,xi=new WeakMap,Ui=new WeakMap,Bi=new WeakMap,Pi=new WeakMap,qi=new WeakMap,Hi=new WeakMap,vi=new WeakSet,yi=function(t){Xi.assertEnumWithError(t,Qi)},wi=function(t){Xi.assertWithError(t in Qi,`invalid taskEnum ${t}`)},bi=function(){return this.eventDispatcher.dispatchEvent},Si=function(t){Xi.log("parseName",t);const s=V.decode(t.buffer);e(this,vi,"m",Ei).call(this,s)},Ei=function(t){Xi.log({name:t}),s(this,Ci,t,"f"),e(this,vi,"a",bi).call(this,"getTfliteName",{tfliteName:t})},Di=function(t){Xi.log("parseTask",t);const s=t.getUint8(0);e(this,vi,"m",wi).call(this,s);const i=Qi[s];e(this,vi,"m",ki).call(this,i)},ki=function(t){Xi.log({task:t}),s(this,Mi,t,"f"),e(this,vi,"a",bi).call(this,"getTfliteTask",{tfliteTask:t})},Ti=function(t){Xi.log("parseSampleRate",t);const s=t.getUint16(0,!0);e(this,vi,"m",Ri).call(this,s)},Ri=function(t){Xi.log({sampleRate:t}),s(this,Wi,t,"f"),e(this,vi,"a",bi).call(this,"getTfliteSampleRate",{tfliteSampleRate:t})},Ii=function(t){Xi.log("parseSensorTypes",t);const s=[];for(let e=0;e<t.byteLength;e++){const i=t.getUint8(e),n=Xs[i];n?Zi.includes(n)?s.push(n):Xi.error(`invalid tfliteSensorType ${n}`):Xi.error(`invalid sensorTypeEnum ${i}`)}e(this,vi,"m",Li).call(this,s)},Li=function(t){Xi.log({sensorTypes:t}),s(this,xi,t,"f"),e(this,vi,"a",bi).call(this,"getTfliteSensorTypes",{tfliteSensorTypes:t})},Ai=function(t){Xi.log("parseIsReady",t);const s=Boolean(t.getUint8(0));e(this,vi,"m",Fi).call(this,s)},Fi=function(t){Xi.log({isReady:t}),s(this,Ui,t,"f"),e(this,vi,"a",bi).call(this,"tfliteIsReady",{tfliteIsReady:t})},_i=function(){Xi.assertWithError(this.isReady,"tflite is not ready")},$i=function(t){Xi.log("parseCaptureDelay",t);const s=t.getUint16(0,!0);e(this,vi,"m",Oi).call(this,s)},Oi=function(t){Xi.log({captureDelay:t}),s(this,Bi,t,"f"),e(this,vi,"a",bi).call(this,"getTfliteCaptureDelay",{tfliteCaptureDelay:t})},Ni=function(t){Xi.log("parseThreshold",t);const s=t.getFloat32(0,!0);e(this,vi,"m",Vi).call(this,s)},Vi=function(t){Xi.log({threshold:t}),s(this,Pi,t,"f"),e(this,vi,"a",bi).call(this,"getTfliteThreshold",{tfliteThreshold:t})},zi=function(t){Xi.log("parseInferencingEnabled",t);const s=Boolean(t.getUint8(0));e(this,vi,"m",ji).call(this,s)},ji=function(t){Xi.log({inferencingEnabled:t}),s(this,qi,t,"f"),e(this,vi,"a",bi).call(this,"getTfliteInferencingEnabled",{tfliteInferencingEnabled:t})},Gi=function(t){Xi.log("parseInference",t);const s=Ht(t,0);Xi.log({timestamp:s});const i=[];for(let e=0,s=2;s<t.byteLength;e++,s+=4){const e=t.getFloat32(s,!0);i.push(e)}Xi.log("values",i);const n={timestamp:s,values:i};if("classification"==this.task){let t=0,s=0;if(i.forEach(((e,i)=>{e>t&&(t=e,s=i)})),Xi.log({maxIndex:s,maxValue:t}),n.maxIndex=s,n.maxValue=t,e(this,Hi,"f")?.classes){const{classes:t}=e(this,Hi,"f");n.maxClass=t[s],n.classValues={},i.forEach(((e,s)=>{const i=t[s];n.classValues[i]=e}))}}e(this,vi,"a",bi).call(this,"tfliteInference",{tfliteInference:n})};const on=T("DeviceInformationManager",{log:!1}),hn=["manufacturerName","modelNumber","hardwareRevision","firmwareRevision","softwareRevision","pnpId","serialNumber"],cn=[...hn,"deviceInformation"];class ln{constructor(){en.add(this),nn.set(this,{})}get information(){return e(this,nn,"f")}clear(){s(this,nn,{},"f")}parseMessage(t,s){switch(on.log({messageType:t}),t){case"manufacturerName":const i=V.decode(s.buffer);on.log({manufacturerName:i}),e(this,en,"m",rn).call(this,{manufacturerName:i});break;case"modelNumber":const n=V.decode(s.buffer);on.log({modelNumber:n}),e(this,en,"m",rn).call(this,{modelNumber:n});break;case"softwareRevision":const a=V.decode(s.buffer);on.log({softwareRevision:a}),e(this,en,"m",rn).call(this,{softwareRevision:a});break;case"hardwareRevision":const r=V.decode(s.buffer);on.log({hardwareRevision:r}),e(this,en,"m",rn).call(this,{hardwareRevision:r});break;case"firmwareRevision":const o=V.decode(s.buffer);on.log({firmwareRevision:o}),e(this,en,"m",rn).call(this,{firmwareRevision:o});break;case"pnpId":const h={source:1===s.getUint8(0)?"Bluetooth":"USB",productId:s.getUint16(3,!0),productVersion:s.getUint16(5,!0),vendorId:0};"Bluetooth"==h.source&&(h.vendorId=s.getUint16(1,!0)),on.log({pnpId:h}),e(this,en,"m",rn).call(this,{pnpId:h});break;case"serialNumber":const c=V.decode(s.buffer);on.log({serialNumber:c});break;default:throw Error(`uncaught messageType ${t}`)}}}var fn,gn,dn,un,pn,mn,vn,yn,wn,bn,Cn,Sn,En,Mn,Dn,kn,Wn,Tn;nn=new WeakMap,en=new WeakSet,sn=function(){return this.eventDispatcher.dispatchEvent},an=function(){return hn.filter((t=>"serialNumber"!=t)).every((t=>t in e(this,nn,"f")))},rn=function(t){on.log({partialDeviceInformation:t});Object.keys(t).forEach((s=>{e(this,en,"a",sn).call(this,s,{[s]:t[s]})})),Object.assign(e(this,nn,"f"),t),on.log({deviceInformation:e(this,nn,"f")}),e(this,en,"a",an)&&(on.log("completed deviceInformation"),e(this,en,"a",sn).call(this,"deviceInformation",{deviceInformation:this.information}))};const Rn=T("InformationManager",{log:!1}),xn=["leftInsole","rightInsole","leftGlove","rightGlove","glasses","generic"],In=["left","right"],Ln=["isCharging","getBatteryCurrent","getMtu","getId","getName","setName","getType","setType","getCurrentTime","setCurrentTime"],Un=Ln;class An{constructor(){fn.add(this),dn.set(this,!1),pn.set(this,void 0),vn.set(this,void 0),wn.set(this,""),bn.set(this,void 0),Mn.set(this,0),kn.set(this,!1),Y(this)}get waitForEvent(){return this.eventDispatcher.waitForEvent}get isCharging(){return e(this,dn,"f")}get batteryCurrent(){return e(this,pn,"f")}async getBatteryCurrent(){Rn.log("getting battery current...");const t=this.waitForEvent("getBatteryCurrent");this.sendMessage([{type:"getBatteryCurrent"}]),await t}get id(){return e(this,vn,"f")}get name(){return e(this,wn,"f")}updateName(t){Rn.assertTypeWithError(t,"string"),s(this,wn,t,"f"),Rn.log({updatedName:e(this,wn,"f")}),e(this,fn,"a",gn).call(this,"getName",{name:e(this,wn,"f")})}async setName(t){Rn.assertTypeWithError(t,"string"),Rn.assertRangeWithError("newName",t.length,2,30);const e=N.encode(t);Rn.log({setNameData:e});const s=this.waitForEvent("getName");this.sendMessage([{type:"setName",data:e.buffer}]),await s}get type(){return e(this,bn,"f")}get typeEnum(){return xn.indexOf(this.type)}updateType(t){e(this,fn,"m",Cn).call(this,t),s(this,bn,t,"f"),Rn.log({updatedType:e(this,bn,"f")}),e(this,fn,"a",gn).call(this,"getType",{type:e(this,bn,"f")})}async setType(t){e(this,fn,"m",Cn).call(this,t);const s=xn.indexOf(t);e(this,fn,"m",En).call(this,s)}get isInsole(){switch(this.type){case"leftInsole":case"rightInsole":return!0;default:return!1}}get isGlove(){switch(this.type){case"leftGlove":case"rightGlove":return!0;default:return!1}}get side(){switch(this.type){case"leftInsole":case"leftGlove":default:return"left";case"rightInsole":case"rightGlove":return"right"}}get mtu(){return e(this,Mn,"f")}get isCurrentTimeSet(){return e(this,kn,"f")}parseMessage(t,s){switch(Rn.log({messageType:t}),t){case"isCharging":const i=Boolean(s.getUint8(0));Rn.log({isCharging:i}),e(this,fn,"m",un).call(this,i);break;case"getBatteryCurrent":const n=s.getFloat32(0,!0);Rn.log({batteryCurrent:n}),e(this,fn,"m",mn).call(this,n);break;case"getId":const a=V.decode(s.buffer);Rn.log({id:a}),e(this,fn,"m",yn).call(this,a);break;case"getName":case"setName":const r=V.decode(s.buffer);Rn.log({name:r}),this.updateName(r);break;case"getType":case"setType":const o=s.getUint8(0),h=xn[o];Rn.log({typeEnum:o,type:h}),this.updateType(h);break;case"getMtu":let c=s.getUint16(0,!0);"webSocket"!=this.connectionType&&"udp"!=this.connectionType&&(c=Math.min(c,512)),Rn.log({mtu:c}),e(this,fn,"m",Dn).call(this,c);break;case"getCurrentTime":case"setCurrentTime":const l=Number(s.getBigUint64(0,!0));e(this,fn,"m",Wn).call(this,l);break;default:throw Error(`uncaught messageType ${t}`)}}clear(){s(this,kn,!1,"f")}}dn=new WeakMap,pn=new WeakMap,vn=new WeakMap,wn=new WeakMap,bn=new WeakMap,Mn=new WeakMap,kn=new WeakMap,fn=new WeakSet,gn=function(){return this.eventDispatcher.dispatchEvent},un=function(t){Rn.assertTypeWithError(t,"boolean"),s(this,dn,t,"f"),Rn.log({isCharging:e(this,dn,"f")}),e(this,fn,"a",gn).call(this,"isCharging",{isCharging:e(this,dn,"f")})},mn=function(t){Rn.assertTypeWithError(t,"number"),s(this,pn,t,"f"),Rn.log({batteryCurrent:e(this,pn,"f")}),e(this,fn,"a",gn).call(this,"getBatteryCurrent",{batteryCurrent:e(this,pn,"f")})},yn=function(t){Rn.assertTypeWithError(t,"string"),s(this,vn,t,"f"),Rn.log({id:e(this,vn,"f")}),e(this,fn,"a",gn).call(this,"getId",{id:e(this,vn,"f")})},Cn=function(t){Rn.assertEnumWithError(t,xn)},Sn=function(t){Rn.assertTypeWithError(t,"number"),Rn.assertWithError(t in xn,`invalid typeEnum ${t}`)},En=async function(t){e(this,fn,"m",Sn).call(this,t);const s=X(t);Rn.log({setTypeData:s});const i=this.waitForEvent("getType");this.sendMessage([{type:"setType",data:s}]),await i},Dn=function(t){Rn.assertTypeWithError(t,"number"),e(this,Mn,"f")!=t?(s(this,Mn,t,"f"),e(this,fn,"a",gn).call(this,"getMtu",{mtu:e(this,Mn,"f")})):Rn.log("redundant mtu assignment",t)},Wn=function(t){Rn.log({currentTime:t}),s(this,kn,0!=t||Math.abs(Date.now()-t)<Gt,"f"),e(this,kn,"f")||e(this,fn,"m",Tn).call(this,!1)},Tn=async function(t){Rn.log("setting current time...");const e=new DataView(new ArrayBuffer(8));e.setBigUint64(0,BigInt(Date.now()),!0);const s=this.waitForEvent("getCurrentTime");this.sendMessage([{type:"setCurrentTime",data:e.buffer}],t),await s};const Fn=["none","strongClick100","strongClick60","strongClick30","sharpClick100","sharpClick60","sharpClick30","softBump100","softBump60","softBump30","doubleClick100","doubleClick60","tripleClick100","softFuzz60","strongBuzz100","alert750ms","alert1000ms","strongClick1_100","strongClick2_80","strongClick3_60","strongClick4_30","mediumClick100","mediumClick80","mediumClick60","sharpTick100","sharpTick80","sharpTick60","shortDoubleClickStrong100","shortDoubleClickStrong80","shortDoubleClickStrong60","shortDoubleClickStrong30","shortDoubleClickMedium100","shortDoubleClickMedium80","shortDoubleClickMedium60","shortDoubleSharpTick100","shortDoubleSharpTick80","shortDoubleSharpTick60","longDoubleSharpClickStrong100","longDoubleSharpClickStrong80","longDoubleSharpClickStrong60","longDoubleSharpClickStrong30","longDoubleSharpClickMedium100","longDoubleSharpClickMedium80","longDoubleSharpClickMedium60","longDoubleSharpTick100","longDoubleSharpTick80","longDoubleSharpTick60","buzz100","buzz80","buzz60","buzz40","buzz20","pulsingStrong100","pulsingStrong60","pulsingMedium100","pulsingMedium60","pulsingSharp100","pulsingSharp60","transitionClick100","transitionClick80","transitionClick60","transitionClick40","transitionClick20","transitionClick10","transitionHum100","transitionHum80","transitionHum60","transitionHum40","transitionHum20","transitionHum10","transitionRampDownLongSmooth2_100","transitionRampDownLongSmooth1_100","transitionRampDownMediumSmooth1_100","transitionRampDownMediumSmooth2_100","transitionRampDownShortSmooth1_100","transitionRampDownShortSmooth2_100","transitionRampDownLongSharp1_100","transitionRampDownLongSharp2_100","transitionRampDownMediumSharp1_100","transitionRampDownMediumSharp2_100","transitionRampDownShortSharp1_100","transitionRampDownShortSharp2_100","transitionRampUpLongSmooth1_100","transitionRampUpLongSmooth2_100","transitionRampUpMediumSmooth1_100","transitionRampUpMediumSmooth2_100","transitionRampUpShortSmooth1_100","transitionRampUpShortSmooth2_100","transitionRampUpLongSharp1_100","transitionRampUpLongSharp2_100","transitionRampUpMediumSharp1_100","transitionRampUpMediumSharp2_100","transitionRampUpShortSharp1_100","transitionRampUpShortSharp2_100","transitionRampDownLongSmooth1_50","transitionRampDownLongSmooth2_50","transitionRampDownMediumSmooth1_50","transitionRampDownMediumSmooth2_50","transitionRampDownShortSmooth1_50","transitionRampDownShortSmooth2_50","transitionRampDownLongSharp1_50","transitionRampDownLongSharp2_50","transitionRampDownMediumSharp1_50","transitionRampDownMediumSharp2_50","transitionRampDownShortSharp1_50","transitionRampDownShortSharp2_50","transitionRampUpLongSmooth1_50","transitionRampUpLongSmooth2_50","transitionRampUpMediumSmooth1_50","transitionRampUpMediumSmooth2_50","transitionRampUpShortSmooth1_50","transitionRampUpShortSmooth2_50","transitionRampUpLongSharp1_50","transitionRampUpLongSharp2_50","transitionRampUpMediumSharp1_50","transitionRampUpMediumSharp2_50","transitionRampUpShortSharp1_50","transitionRampUpShortSharp2_50","longBuzz100","smoothHum50","smoothHum40","smoothHum30","smoothHum20","smoothHum10"];var _n,Bn,$n,On,Pn,Nn,Vn,qn,zn,jn,Gn,Hn,Xn,Yn,Jn,Kn,Qn,Zn,ta;const ea=T("VibrationManager",{log:!1}),sa=["front","rear"],ia=["waveformEffect","waveform"],na=["getVibrationLocations","triggerVibration"],aa=na,ra=2550,oa=1270;class ha{constructor(){_n.add(this),Zn.set(this,[]),Y(this)}get waitForEvent(){return this.eventDispatcher.waitForEvent}async triggerVibration(t,s=!0){let i;t.forEach((t=>{const{type:s}=t;let n,{locations:a}=t;switch(a=a||this.vibrationLocations.slice(),a=a.filter((t=>this.vibrationLocations.includes(t))),s){case"waveformEffect":{const{segments:s,loopCount:i}=t;n=e(this,_n,"m",Yn).call(this,a,s,i)}break;case"waveform":{const{segments:s}=t;n=e(this,_n,"m",Jn).call(this,a,s)}break;default:throw Error(`invalid vibration type "${s}"`)}ea.log({type:s,arrayBuffer:n}),i=z(i,n)})),await this.sendMessage([{type:"triggerVibration",data:i}],s)}get vibrationLocations(){return e(this,Zn,"f")}parseMessage(t,s){if(ea.log({messageType:t}),"getVibrationLocations"!==t)throw Error(`uncaught messageType ${t}`);{const t=Array.from(new Uint8Array(s.buffer)).map((t=>sa[t])).filter(Boolean);e(this,_n,"m",ta).call(this,t)}}}var ca,la,fa,ga,da,ua,pa,ma,va,ya,wa,ba,Ca,Sa,Ea,Ma,Da;Zn=new WeakMap,_n=new WeakSet,Bn=function(){return this.eventDispatcher.dispatchEvent},$n=function(t){ea.assertTypeWithError(t,"string"),ea.assertWithError(sa.includes(t),`invalid location "${t}"`)},On=function(t){e(this,_n,"m",Nn).call(this,t),t.forEach((t=>{e(this,_n,"m",$n).call(this,t)}))},Pn=function(t){e(this,_n,"m",On).call(this,t);let s=0;return t.forEach((t=>{const e=sa.indexOf(t);s|=1<<e})),ea.log({locationsBitmask:s}),ea.assertWithError(s>0,"locationsBitmask must not be zero"),s},Nn=function(t){ea.assertWithError(Array.isArray(t),"passed non-array"),ea.assertWithError(t.length>0,"passed empty array")},Vn=function(t){ea.assertWithError(Fn.includes(t),`invalid waveformEffect "${t}"`)},qn=function(t){if(null!=t.effect){const s=t.effect;e(this,_n,"m",Vn).call(this,s)}else{if(null==t.delay)throw Error("no effect or delay found in waveformEffectSegment");{const{delay:e}=t;ea.assertWithError(e>=0,`delay must be 0ms or greater (got ${e})`),ea.assertWithError(e<=oa,`delay must be 1270ms or less (got ${e})`)}}if(null!=t.loopCount){const{loopCount:s}=t;e(this,_n,"m",zn).call(this,s)}},zn=function(t){ea.assertTypeWithError(t,"number"),ea.assertWithError(t>=0,`waveformEffectSegmentLoopCount must be 0 or greater (got ${t})`),ea.assertWithError(t<=3,`waveformEffectSegmentLoopCount must be 3 or fewer (got ${t})`)},jn=function(t){e(this,_n,"m",Nn).call(this,t),ea.assertWithError(t.length<=8,`must have 8 waveformEffectSegments or fewer (got ${t.length})`),t.forEach((t=>{e(this,_n,"m",qn).call(this,t)}))},Gn=function(t){ea.assertTypeWithError(t,"number"),ea.assertWithError(t>=0,`waveformEffectSequenceLoopCount must be 0 or greater (got ${t})`),ea.assertWithError(t<=6,`waveformEffectSequenceLoopCount must be 6 or fewer (got ${t})`)},Hn=function(t){ea.assertTypeWithError(t.amplitude,"number"),ea.assertWithError(t.amplitude>=0,`amplitude must be 0 or greater (got ${t.amplitude})`),ea.assertWithError(t.amplitude<=1,`amplitude must be 1 or less (got ${t.amplitude})`),ea.assertTypeWithError(t.duration,"number"),ea.assertWithError(t.duration>0,`duration must be greater than 0ms (got ${t.duration}ms)`),ea.assertWithError(t.duration<=ra,`duration must be 2550ms or less (got ${t.duration}ms)`)},Xn=function(t){e(this,_n,"m",Nn).call(this,t),ea.assertWithError(t.length<=20,`must have 20 waveformSegments or fewer (got ${t.length})`),t.forEach((t=>{e(this,_n,"m",Hn).call(this,t)}))},Yn=function(t,s,i=0){e(this,_n,"m",jn).call(this,s),e(this,_n,"m",Gn).call(this,i);let n=[],a=0;const r=s.some((t=>{const{loopCount:e}=t;return null!=e&&e>0}))||0!=i;for(let t=0;t<s.length||r&&t<8;t++){const e=s[t]||{effect:"none"};if(null!=e.effect){const t=e.effect;n[a++]=Fn.indexOf(t)}else{if(null==e.delay)throw Error("invalid waveformEffectSegment");{const{delay:t}=e;n[a++]=128|Math.floor(t/10)}}}const o=0!=i;for(let t=0;t<s.length||o&&t<8;t++){const e=s[t]?.loopCount||0;0!=t&&4!=t||(n[a]=0);const i=t%4*2;n[a]|=e<<i,3!=t&&7!=t||a++}0!=i&&(n[a++]=i);const h=new DataView(Uint8Array.from(n).buffer);return ea.log({dataArray:n,dataView:h}),e(this,_n,"m",Qn).call(this,t,"waveformEffect",h)},Jn=function(t,s){e(this,_n,"m",Xn).call(this,s);const i=new DataView(new ArrayBuffer(2*s.length));return s.forEach(((t,e)=>{i.setUint8(2*e,Math.floor(127*t.amplitude)),i.setUint8(2*e+1,Math.floor(t.duration/10))})),ea.log({dataView:i}),e(this,_n,"m",Qn).call(this,t,"waveform",i)},Kn=function(t){ea.assertTypeWithError(t,"string"),ea.assertWithError(ia.includes(t),`invalid vibrationType "${t}"`)},Qn=function(t,s,i){ea.assertWithError(i?.byteLength>0,"no data received");const n=e(this,_n,"m",Pn).call(this,t);e(this,_n,"m",Kn).call(this,s);const a=ia.indexOf(s);ea.log({locationsBitmask:n,vibrationTypeIndex:a,dataView:i});const r=z(n,a,i.byteLength,i);return ea.log({data:r}),r},ta=function(t){s(this,Zn,t,"f"),ea.log("vibrationLocations",t),e(this,_n,"a",Bn).call(this,"getVibrationLocations",{vibrationLocations:e(this,Zn,"f")})};const ka=T("WifiManager",{log:!1}),Wa=["isWifiAvailable","getWifiSSID","setWifiSSID","getWifiPassword","setWifiPassword","getWifiConnectionEnabled","setWifiConnectionEnabled","isWifiConnected","ipAddress","isWifiSecure"],Ta=["getWifiSSID","getWifiPassword","getWifiConnectionEnabled","isWifiConnected","ipAddress","isWifiSecure"],Ra=Wa;class xa{constructor(){ca.add(this),fa.set(this,!1),ua.set(this,""),ma.set(this,""),ya.set(this,void 0),ba.set(this,!1),Sa.set(this,void 0),Ma.set(this,!1),Y(this)}get waitForEvent(){return this.eventDispatcher.waitForEvent}requestRequiredInformation(){ka.log("requesting required wifi information");const t=Ta.map((t=>({type:t})));this.sendMessage(t,!1)}get isWifiAvailable(){return e(this,fa,"f")}get wifiSSID(){return e(this,ua,"f")}async setWifiSSID(t){if(e(this,ca,"m",da).call(this),e(this,ya,"f"))return void ka.error("cannot change ssid while wifi connection is enabled");ka.assertTypeWithError(t,"string"),ka.assertRangeWithError("wifiSSID",t.length,1,32);const s=N.encode(t);ka.log({setWifiSSIDData:s});const i=this.waitForEvent("getWifiSSID");this.sendMessage([{type:"setWifiSSID",data:s.buffer}]),await i}get wifiPassword(){return e(this,ma,"f")}async setWifiPassword(t){if(e(this,ca,"m",da).call(this),e(this,ya,"f"))return void ka.error("cannot change password while wifi connection is enabled");ka.assertTypeWithError(t,"string"),t.length>0&&ka.assertRangeWithError("wifiPassword",t.length,8,64);const s=N.encode(t);ka.log({setWifiPasswordData:s});const i=this.waitForEvent("getWifiPassword");this.sendMessage([{type:"setWifiPassword",data:s.buffer}]),await i}get wifiConnectionEnabled(){return e(this,ya,"f")}async setWifiConnectionEnabled(t,s=!0){if(e(this,ca,"m",da).call(this),ka.assertTypeWithError(t,"boolean"),e(this,ya,"f")==t)return void ka.log(`redundant wifiConnectionEnabled assignment ${t}`);const i=this.waitForEvent("getWifiConnectionEnabled");this.sendMessage([{type:"setWifiConnectionEnabled",data:X(Number(t))}],s),await i}async toggleWifiConnection(){return this.setWifiConnectionEnabled(!this.wifiConnectionEnabled)}async enableWifiConnection(){return this.setWifiConnectionEnabled(!0)}async disableWifiConnection(){return this.setWifiConnectionEnabled(!1)}get isWifiConnected(){return e(this,ba,"f")}get ipAddress(){return e(this,Sa,"f")}get isWifiSecure(){return e(this,Ma,"f")}parseMessage(t,s){switch(ka.log({messageType:t}),t){case"isWifiAvailable":const i=Boolean(s.getUint8(0));ka.log({isWifiAvailable:i}),e(this,ca,"m",ga).call(this,i);break;case"getWifiSSID":case"setWifiSSID":const n=V.decode(s.buffer);ka.log({ssid:n}),e(this,ca,"m",pa).call(this,n);break;case"getWifiPassword":case"setWifiPassword":const a=V.decode(s.buffer);ka.log({password:a}),e(this,ca,"m",va).call(this,a);break;case"getWifiConnectionEnabled":case"setWifiConnectionEnabled":const r=Boolean(s.getUint8(0));ka.log({enableWifiConnection:r}),e(this,ca,"m",wa).call(this,r);break;case"isWifiConnected":const o=Boolean(s.getUint8(0));ka.log({isWifiConnected:o}),e(this,ca,"m",Ca).call(this,o);break;case"ipAddress":let h;4==s.byteLength&&(h=new Uint8Array(s.buffer.slice(0,4)).join(".")),ka.log({ipAddress:h}),e(this,ca,"m",Ea).call(this,h);break;case"isWifiSecure":const c=Boolean(s.getUint8(0));ka.log({isWifiSecure:c}),e(this,ca,"m",Da).call(this,c);break;default:throw Error(`uncaught messageType ${t}`)}}clear(){s(this,ua,"","f"),s(this,ma,"","f"),s(this,Sa,"","f"),s(this,ba,!1,"f"),s(this,fa,!1,"f")}}fa=new WeakMap,ua=new WeakMap,ma=new WeakMap,ya=new WeakMap,ba=new WeakMap,Sa=new WeakMap,Ma=new WeakMap,ca=new WeakSet,la=function(){return this.eventDispatcher.dispatchEvent},ga=function(t){ka.assertTypeWithError(t,"boolean"),s(this,fa,t,"f"),ka.log({isWifiAvailable:e(this,fa,"f")}),e(this,ca,"a",la).call(this,"isWifiAvailable",{isWifiAvailable:e(this,fa,"f")})},da=function(){ka.assertWithError(e(this,fa,"f"),"wifi is not available")},pa=function(t){ka.assertTypeWithError(t,"string"),s(this,ua,t,"f"),ka.log({wifiSSID:e(this,ua,"f")}),e(this,ca,"a",la).call(this,"getWifiSSID",{wifiSSID:e(this,ua,"f")})},va=function(t){ka.assertTypeWithError(t,"string"),s(this,ma,t,"f"),ka.log({wifiPassword:e(this,ma,"f")}),e(this,ca,"a",la).call(this,"getWifiPassword",{wifiPassword:e(this,ma,"f")})},wa=function(t){ka.log({wifiConnectionEnabled:t}),s(this,ya,t,"f"),e(this,ca,"a",la).call(this,"getWifiConnectionEnabled",{wifiConnectionEnabled:t})},Ca=function(t){ka.assertTypeWithError(t,"boolean"),s(this,ba,t,"f"),ka.log({isWifiConnected:e(this,ba,"f")}),e(this,ca,"a",la).call(this,"isWifiConnected",{isWifiConnected:e(this,ba,"f")})},Ea=function(t){s(this,Sa,t,"f"),ka.log({ipAddress:e(this,Sa,"f")}),e(this,ca,"a",la).call(this,"ipAddress",{ipAddress:e(this,Sa,"f")})},Da=function(t){ka.assertTypeWithError(t,"boolean"),s(this,Ma,t,"f"),ka.log({isWifiSecure:e(this,Ma,"f")}),e(this,ca,"a",la).call(this,"isWifiSecure",{isWifiSecure:e(this,Ma,"f")})};const Ia=T("ColorUtils",{log:!0});function La(t){3==(t=t.replace(/^#/,"")).length&&(t=t.split("").map((t=>t+t)).join("")),Ia.assertWithError(6==t.length,`hex length must be 6 (got ${t.length})`);return{r:parseInt(t.substring(0,2),16),g:parseInt(t.substring(2,4),16),b:parseInt(t.substring(4,6),16)}}const Ua={r:0,g:0,b:0};function Aa(t){return t.startsWith("#")?La(t):function(t){const e=document.createElement("div");e.style.color=t,document.body.appendChild(e);const s=getComputedStyle(e).color;document.body.removeChild(e);const i=s.match(/^rgba?\((\d+), (\d+), (\d+)/);return i?{r:parseInt(i[1],10),g:parseInt(i[2],10),b:parseInt(i[3],10)}:Ua}(t)}function Fa({r:t,g:e,b:s}){const i=t=>t.toString(16).padStart(2,"0").toUpperCase();return Ia.assertWithError([t,e,s].every((t=>t>=0&&t<=255)),`RGB values must be between 0 and 255 (got r=${t}, g=${e}, b=${s})`),`#${i(t)}${i(e)}${i(s)}`}var _a;const Ba=T("DisplayContextStateHelper",{log:!1});class $a{constructor(){_a.set(this,Object.assign({},xr))}get state(){return e(this,_a,"f")}diff(t){let s=[];return Object.keys(t).forEach((i=>{const n=t[i];e(this,_a,"f")[i]!=n&&s.push(i)})),Ba.log("diff",t,s),s}update(t){let s=this.diff(t);return 0==s.length&&Ba.log("redundant contextState",t),s.forEach((s=>{const i=t[s];e(this,_a,"f")[s]=i})),s}reset(){Object.assign(e(this,_a,"f"),xr)}}_a=new WeakMap;const Oa=T("DisplayUtils",{log:!1});function Pa(t){Oa.assertEnumWithError(t,Rr)}function Na(t){Oa.assertEnumWithError(t,Wr)}function Va(t,e){Oa.assertRangeWithError(t,e,0,255)}function qa(t){Va("red",t.r),Va("green",t.g),Va("blue",t.b)}function za(t){Oa.assertRangeWithError("opacity",t,0,1)}const ja=["top","right","bottom","left"],Ga={top:"cropTop",right:"cropRight",bottom:"cropBottom",left:"cropLeft"},Ha={top:"setCropTop",right:"setCropRight",bottom:"setCropBottom",left:"setCropLeft"},Xa={top:"rotationCropTop",right:"rotationCropRight",bottom:"rotationCropBottom",left:"rotationCropLeft"},Ya={top:"setRotationCropTop",right:"setRotationCropRight",bottom:"setRotationCropBottom",left:"setRotationCropLeft"};var Ja,Ka,Qa,Za,tr,er,sr,ir,nr,ar,rr,or,hr,cr,lr,fr,gr,dr,ur,pr,mr,vr,yr,wr,br,Cr,Sr;const Er=T("DisplayManager",{log:!1}),Mr=["sleep","wake"],Dr=["awake","asleep"],kr=["type","width","height","pixelDepth"],Wr=["veryLow","low","medium","high","veryHigh"],Tr=["isDisplayAvailable","displayStatus","displayInformation","displayCommand","getDisplayBrightness","setDisplayBrightness","displayContextCommands"],Rr=["flat","round"],xr={fillColorIndex:1,lineColorIndex:1,lineWidth:0,rotation:0,segmentStartCap:"flat",segmentEndCap:"flat",segmentStartRadius:1,segmentEndRadius:1,cropTop:0,cropRight:0,cropBottom:0,cropLeft:0,rotationCropTop:0,rotationCropRight:0,rotationCropBottom:0,rotationCropLeft:0},Ir={type:["none","generic","monocularLeft","monocularRight","binocular"],pixelDepth:["1","2","4"]},Lr=["show","clear","setColor","setColorOpacity","setOpacity","saveContext","restoreContext","selectFillColor","selectLineColor","setLineWidth","setRotation","clearRotation","setSegmentStartCap","setSegmentEndCap","setSegmentCap","setSegmentStartRadius","setSegmentEndRadius","setSegmentRadius","setCropTop","setCropRight","setCropBottom","setCropLeft","clearCrop","setRotationCropTop","setRotationCropRight","setRotationCropBottom","setRotationCropLeft","clearRotationCrop","clearRect","drawRect","drawRoundRect","drawCircle","drawEllipse","drawPolygon","drawSegment","selectSpriteSheet","sprite","selectFont","drawText"],Ur=["isDisplayAvailable","displayInformation","displayStatus","getDisplayBrightness"],Ar=[...Tr,"displayContextState","displayColor","displayColorOpacity","displayOpacity"];class Fr{constructor(){Ja.add(this),Qa.set(this,!1),er.set(this,new $a),ir.set(this,void 0),cr.set(this,void 0),fr.set(this,void 0),ur.set(this,[]),yr.set(this,[]),wr.set(this,[]),Sr.set(this,void 0),Y(this)}get waitForEvent(){return this.eventDispatcher.waitForEvent}requestRequiredInformation(){Er.log("requesting required display information");const t=Ur.map((t=>({type:t})));this.sendMessage(t,!1)}get isDisplayAvailable(){return e(this,Qa,"f")}get displayContextState(){return e(this,er,"f").state}async setContextState(t,s){const i=e(this,er,"f").diff(t);0!=i.length&&(i.forEach((e=>{switch(e){case"fillColorIndex":this.selectFillColor(t.fillColorIndex);break;case"lineColorIndex":this.selectLineColor(t.lineColorIndex);break;case"lineWidth":this.setLineWidth(t.lineWidth);break;case"rotation":this.setRotation(t.rotation,!0);break;case"segmentStartCap":this.setSegmentStartCap(t.segmentStartCap);break;case"segmentEndCap":this.setSegmentEndCap(t.segmentEndCap);break;case"segmentStartRadius":this.setSegmentStartRadius(t.segmentStartRadius);break;case"segmentEndRadius":this.setSegmentEndRadius(t.segmentEndRadius);break;case"cropTop":this.setCropTop(t.cropTop);break;case"cropRight":this.setCropRight(t.cropRight);break;case"cropBottom":this.setCropBottom(t.cropBottom);break;case"cropLeft":this.setCropLeft(t.cropLeft);break;case"rotationCropTop":this.setRotationCropTop(t.rotationCropTop);break;case"rotationCropRight":this.setRotationCropRight(t.rotationCropRight);break;case"rotationCropBottom":this.setRotationCropBottom(t.rotationCropBottom);break;case"rotationCropLeft":this.setRotationCropLeft(t.rotationCropLeft)}})),s&&await e(this,Ja,"m",mr).call(this))}get displayStatus(){return e(this,ir,"f")}get isDisplayAwake(){return"awake"==e(this,ir,"f")}async wake(){e(this,Ja,"m",hr).call(this),await e(this,Ja,"m",rr).call(this,"wake")}async sleep(){e(this,Ja,"m",or).call(this),await e(this,Ja,"m",rr).call(this,"sleep")}async toggle(){switch(this.displayStatus){case"asleep":this.wake();break;case"awake":this.sleep()}}get numberOfColors(){return 2**Number(this.pixelDepth)}get displayInformation(){return e(this,cr,"f")}get pixelDepth(){return e(this,cr,"f")?.pixelDepth}get width(){return e(this,cr,"f")?.width}get height(){return e(this,cr,"f")?.width}get size(){return{width:this.width,height:this.height}}get type(){return e(this,cr,"f")?.type}get displayBrightness(){return e(this,fr,"f")}async setDisplayBrightness(t,s){if(e(this,Ja,"m",Za).call(this),Na(t),this.displayBrightness==t)return void Er.log(`redundant displayBrightness ${t}`);const i=X(Wr.indexOf(t)),n=this.waitForEvent("getDisplayBrightness");this.sendMessage([{type:"setDisplayBrightness",data:i}],s),await n}flushDisplayContextCommands(){e(this,Ja,"m",mr).call(this)}showDisplay(t=!0){e(this,Ja,"m",pr).call(this,"show",void 0,t)}clearDisplay(t=!0){e(this,Ja,"m",pr).call(this,"clear",void 0,t)}get colors(){return e(this,yr,"f")}setColor(t,s,i){"string"==typeof s&&(s=Aa(s));const n=Fa(s);if(this.colors[t]==n)return void Er.log(`redundant color #${t} ${n}`);Er.log(`setting color #${t}`,s),e(this,Ja,"m",vr).call(this,t),qa(s);const a=new DataView(new ArrayBuffer(4));a.setUint8(0,t),a.setUint8(1,s.r),a.setUint8(2,s.g),a.setUint8(3,s.b),e(this,Ja,"m",pr).call(this,"setColor",a.buffer,i),this.colors[t]=n,e(this,Ja,"a",Ka).call(this,"displayColor",{colorIndex:t,color:s,colorHex:n})}get opacities(){return e(this,wr,"f")}setColorOpacity(t,s,i){if(e(this,Ja,"m",vr).call(this,t),za(s),Math.floor(255*e(this,wr,"f")[t])==Math.floor(255*s))return void Er.log(`redundant opacity #${t} ${s}`);const n=new DataView(new ArrayBuffer(2));n.setUint8(0,t),n.setUint8(1,255*s),e(this,Ja,"m",pr).call(this,"setColorOpacity",n.buffer,i),e(this,wr,"f")[t]=s,e(this,Ja,"a",Ka).call(this,"displayColorOpacity",{colorIndex:t,opacity:s})}setOpacity(t,s){za(t),e(this,Ja,"m",pr).call(this,"setOpacity",X(Math.round(255*t)),s),e(this,wr,"f").fill(t),e(this,Ja,"a",Ka).call(this,"displayOpacity",{opacity:t})}saveContext(t){e(this,Ja,"m",pr).call(this,"saveContext",void 0,t)}restoreContext(t){e(this,Ja,"m",pr).call(this,"restoreContext",void 0,t)}selectFillColor(t,s){e(this,Ja,"m",vr).call(this,t);const i=e(this,er,"f").update({fillColorIndex:t});0!=i.length&&(e(this,Ja,"m",pr).call(this,"selectFillColor",X(t),s),e(this,Ja,"m",sr).call(this,i))}selectLineColor(t,s){e(this,Ja,"m",vr).call(this,t);const i=e(this,er,"f").update({lineColorIndex:t});0!=i.length&&(e(this,Ja,"m",pr).call(this,"selectLineColor",X(t),s),e(this,Ja,"m",sr).call(this,i))}setLineWidth(t,s){e(this,Ja,"m",br).call(this,t);const i=e(this,er,"f").update({lineWidth:t});if(0==i.length)return;const n=new DataView(new ArrayBuffer(2));n.setUint16(0,t,!0),e(this,Ja,"m",pr).call(this,"setLineWidth",n.buffer,s),e(this,Ja,"m",sr).call(this,i)}setRotation(t,s,i){t=Kt(t=s?t:Yt(t)),Er.log({rotation:t});const n=e(this,er,"f").update({rotation:t});if(0==n.length)return;const a=new DataView(new ArrayBuffer(2));a.setUint16(0,function(t){{const e=t;Oa.log({rotationRad:e}),t%=2*Math.PI,t/=2*Math.PI}return t*=Gt,Math.floor(t)}(t),!0),e(this,Ja,"m",pr).call(this,"setRotation",a.buffer,i),e(this,Ja,"m",sr).call(this,n)}clearRotation(t){const s=e(this,er,"f").update({rotation:0});0!=s.length&&(e(this,Ja,"m",pr).call(this,"clearRotation",void 0,t),e(this,Ja,"m",sr).call(this,s))}setSegmentStartCap(t,s){Pa(t);const i=e(this,er,"f").update({segmentStartCap:t});if(0==i.length)return;Er.log({segmentStartCap:t});const n=new DataView(new ArrayBuffer(1)),a=Rr.indexOf(t);n.setUint8(0,a),e(this,Ja,"m",pr).call(this,"setSegmentStartCap",n.buffer,s),e(this,Ja,"m",sr).call(this,i)}setSegmentEndCap(t,s){Pa(t);const i=e(this,er,"f").update({segmentEndCap:t});if(0==i.length)return;Er.log({segmentEndCap:t});const n=new DataView(new ArrayBuffer(1)),a=Rr.indexOf(t);n.setUint8(0,a),e(this,Ja,"m",pr).call(this,"setSegmentEndCap",n.buffer,s),e(this,Ja,"m",sr).call(this,i)}setSegmentCap(t,s){Pa(t);const i=e(this,er,"f").update({segmentStartCap:t,segmentEndCap:t});if(0==i.length)return;Er.log({segmentCap:t});const n=new DataView(new ArrayBuffer(1)),a=Rr.indexOf(t);n.setUint8(0,a),e(this,Ja,"m",pr).call(this,"setSegmentCap",n.buffer,s),e(this,Ja,"m",sr).call(this,i)}setSegmentStartRadius(t,s){const i=e(this,er,"f").update({segmentStartRadius:t});if(0==i.length)return;Er.log({segmentStartRadius:t});const n=new DataView(new ArrayBuffer(2));n.setUint16(0,t,!0),e(this,Ja,"m",pr).call(this,"setSegmentStartRadius",n.buffer,s),e(this,Ja,"m",sr).call(this,i)}setSegmentEndRadius(t,s){const i=e(this,er,"f").update({segmentEndRadius:t});if(0==i.length)return;Er.log({segmentEndRadius:t});const n=new DataView(new ArrayBuffer(2));n.setUint16(0,t,!0),e(this,Ja,"m",pr).call(this,"setSegmentEndRadius",n.buffer,s),e(this,Ja,"m",sr).call(this,i)}setSegmentRadius(t,s){const i=e(this,er,"f").update({segmentStartRadius:t,segmentEndRadius:t});if(0==i.length)return;Er.log({segmentRadius:t});const n=new DataView(new ArrayBuffer(2));n.setUint16(0,t,!0),e(this,Ja,"m",pr).call(this,"setSegmentRadius",n.buffer,s),e(this,Ja,"m",sr).call(this,i)}setCrop(t,s,i){Er.assertEnumWithError(t,ja),s=Math.max(0,s);const n=Ha[t],a=Ga[t],r=e(this,er,"f").update({[a]:s});if(0==r.length)return;Er.log({[n]:s});const o=new DataView(new ArrayBuffer(2));o.setUint16(0,s,!0),e(this,Ja,"m",pr).call(this,n,o.buffer,i),e(this,Ja,"m",sr).call(this,r)}setCropTop(t,e){this.setCrop("top",t,e)}setCropRight(t,e){this.setCrop("right",t,e)}setCropBottom(t,e){this.setCrop("bottom",t,e)}setCropLeft(t,e){this.setCrop("left",t,e)}clearCrop(t){const s=e(this,er,"f").update({cropTop:0,cropRight:0,cropBottom:0,cropLeft:0});0!=s.length&&(e(this,Ja,"m",pr).call(this,"clearCrop",void 0,t),e(this,Ja,"m",sr).call(this,s))}setRotationCrop(t,s,i){Er.assertEnumWithError(t,ja);const n=Ya[t],a=Xa[t],r=e(this,er,"f").update({[a]:s});if(0==r.length)return;Er.log({[n]:s});const o=new DataView(new ArrayBuffer(2));o.setUint16(0,s,!0),e(this,Ja,"m",pr).call(this,n,o.buffer,i),e(this,Ja,"m",sr).call(this,r)}setRotationCropTop(t,e){this.setRotationCrop("top",t,e)}setRotationCropRight(t,e){this.setRotationCrop("right",t,e)}setRotationCropBottom(t,e){this.setRotationCrop("bottom",t,e)}setRotationCropLeft(t,e){this.setRotationCrop("left",t,e)}clearRotationCrop(t){const s=e(this,er,"f").update({rotationCropTop:0,rotationCropRight:0,rotationCropBottom:0,rotationCropLeft:0});0!=s.length&&(e(this,Ja,"m",pr).call(this,"clearRotationCrop",void 0,t),e(this,Ja,"m",sr).call(this,s))}clearRect(t,s,i,n,a){const{x:r,y:o,width:h,height:c}=e(this,Ja,"m",Cr).call(this,t,s,i,n),l=new DataView(new ArrayBuffer(8));l.setUint16(0,r,!0),l.setUint16(2,o,!0),l.setUint16(4,h,!0),l.setUint16(6,c,!0),e(this,Ja,"m",pr).call(this,"clearRect",l.buffer,a)}drawRect(t,s,i,n,a){const r=new DataView(new ArrayBuffer(8));r.setInt16(0,t,!0),r.setInt16(2,s,!0),r.setUint16(4,i,!0),r.setUint16(6,n,!0),Er.log("drawRect data",r),e(this,Ja,"m",pr).call(this,"drawRect",r.buffer,a)}drawRoundRect(t,s,i,n,a,r){const o=new DataView(new ArrayBuffer(9));o.setInt16(0,t,!0),o.setInt16(2,s,!0),o.setUint16(4,i,!0),o.setUint16(6,n,!0),o.setUint8(8,a),Er.log("drawRoundRect data",o),e(this,Ja,"m",pr).call(this,"drawRoundRect",o.buffer,r)}drawCircle(t,s,i,n){const a=new DataView(new ArrayBuffer(6));a.setInt16(0,t,!0),a.setInt16(2,s,!0),a.setUint16(4,i,!0),Er.log("drawCircle data",a),e(this,Ja,"m",pr).call(this,"drawCircle",a.buffer,n)}drawEllipse(t,s,i,n,a){const r=new DataView(new ArrayBuffer(8));r.setInt16(0,t,!0),r.setInt16(2,s,!0),r.setUint16(4,i,!0),r.setUint16(6,n,!0),Er.log("drawEllipse data",r),e(this,Ja,"m",pr).call(this,"drawEllipse",r.buffer,a)}drawPolygon(t,s,i,n,a){const r=new DataView(new ArrayBuffer(7));r.setInt16(0,t,!0),r.setInt16(2,s,!0),r.setUint16(4,i,!0),r.setUint8(6,n),Er.log("drawPolygon data",r),e(this,Ja,"m",pr).call(this,"drawPolygon",r.buffer,a)}drawSegment(t,s,i,n,a){const r=new DataView(new ArrayBuffer(8));Er.log({startX:t,startY:s,endX:i,endY:n}),r.setInt16(0,t,!0),r.setInt16(2,s,!0),r.setInt16(4,i,!0),r.setInt16(6,n,!0),Er.log("drawSegment data",r),e(this,Ja,"m",pr).call(this,"drawSegment",r.buffer,a)}selectSpriteSheet(t,e){}drawSprite(t,e,s,i){}parseMessage(t,s){switch(Er.log({messageType:t,dataView:s}),t){case"isDisplayAvailable":e(this,Ja,"m",tr).call(this,s);break;case"displayStatus":e(this,Ja,"m",nr).call(this,s);break;case"displayInformation":e(this,Ja,"m",lr).call(this,s);break;case"getDisplayBrightness":case"setDisplayBrightness":e(this,Ja,"m",gr).call(this,s);break;default:throw Error(`uncaught messageType ${t}`)}}clear(){Er.log("clearing displayManager"),s(this,ir,void 0,"f"),s(this,Qa,!1,"f"),s(this,cr,void 0,"f"),s(this,fr,void 0,"f"),s(this,ur,[],"f"),s(this,Qa,!1,"f"),e(this,er,"f").reset(),e(this,yr,"f").length=0,e(this,wr,"f").length=0}get mtu(){return e(this,Sr,"f")}set mtu(t){s(this,Sr,t,"f")}}var _r,Br,$r,Or,Pr,Nr,Vr,qr,zr,jr,Gr,Hr;Qa=new WeakMap,er=new WeakMap,ir=new WeakMap,cr=new WeakMap,fr=new WeakMap,ur=new WeakMap,yr=new WeakMap,wr=new WeakMap,Sr=new WeakMap,Ja=new WeakSet,Ka=function(){return this.eventDispatcher.dispatchEvent},Za=function(){Er.assertWithError(e(this,Qa,"f"),"display is not available")},tr=function(t){const i=1==t.getUint8(0);s(this,Qa,i,"f"),Er.log({isDisplayAvailable:e(this,Qa,"f")}),e(this,Ja,"a",Ka).call(this,"isDisplayAvailable",{isDisplayAvailable:e(this,Qa,"f")})},sr=function(t){e(this,Ja,"a",Ka).call(this,"displayContextState",{displayContextState:{...this.displayContextState},differences:t})},nr=function(t){const s=t.getUint8(0),i=Dr[s];e(this,Ja,"m",ar).call(this,i)},ar=function(t){if(Er.assertEnumWithError(t,Dr),t==e(this,ir,"f"))return void Er.log(`redundant displayStatus ${t}`);const i=e(this,ir,"f");s(this,ir,t,"f"),Er.log(`updated displayStatus to "${this.displayStatus}"`),e(this,Ja,"a",Ka).call(this,"displayStatus",{displayStatus:this.displayStatus,previousDisplayStatus:i})},rr=async function(t,e){Er.assertEnumWithError(t,Mr),Er.log(`sending display command "${t}"`);const s=this.waitForEvent("displayStatus");Er.log(`setting command "${t}"`);const i=Mr.indexOf(t);this.sendMessage([{type:"displayCommand",data:X(i)}],e),await s},or=function(){Er.assertWithError("awake"==e(this,ir,"f"),`display is not awake - currently ${e(this,ir,"f")}`)},hr=function(){Er.assertWithError("awake"!=e(this,ir,"f"),"display is awake")},lr=function(t){const i={};let n=0;for(;n<t.byteLength;){const e=t.getUint8(n++),s=kr[e];switch(Er.assertWithError(s,`invalid displayInformationTypeIndex ${s}`),Er.log({displayInformationType:s}),s){case"width":case"height":{const e=t.getUint16(n,!0);i[s]=e,n+=2}break;case"pixelDepth":case"type":{const e=Ir[s];const a=e[t.getUint8(n++)];Er.assertEnumWithError(a,e),i[s]=a}}}Er.log({parsedDisplayInformation:i});const a=kr.find((t=>!(t in i)));Er.assertWithError(!a,`missingDisplayInformationType ${a}`),s(this,cr,i,"f"),s(this,yr,new Array(this.numberOfColors).fill("#000000"),"f"),s(this,wr,new Array(this.numberOfColors).fill(1),"f"),e(this,Ja,"a",Ka).call(this,"displayInformation",{displayInformation:e(this,cr,"f")})},gr=function(t){const i=t.getUint8(0),n=Wr[i];Na(n),s(this,fr,n,"f"),Er.log({displayBrightness:e(this,fr,"f")}),e(this,Ja,"a",Ka).call(this,"getDisplayBrightness",{displayBrightness:e(this,fr,"f")})},dr=function(t){Er.assertEnumWithError(t,Lr)},pr=async function(t,s,i){e(this,Ja,"m",dr).call(this,t);const n=z(Lr.indexOf(t),s);e(this,ur,"f").reduce(((t,e)=>t+e.byteLength),n.byteLength)>this.mtu-6&&(Er.log("displayContextCommandBuffers too full - sending now"),await e(this,Ja,"m",mr).call(this)),e(this,ur,"f").push(n),i&&await e(this,Ja,"m",mr).call(this)},mr=async function(){if(0==e(this,ur,"f").length)return;const t=z(e(this,ur,"f"));Er.log("sending displayContextCommands",e(this,ur,"f"),t),await this.sendMessage([{type:"displayContextCommands",data:t}],!0),e(this,ur,"f").length=0},vr=function(t){Er.assertRangeWithError("colorIndex",t,0,this.numberOfColors)},br=function(t){Er.assertRangeWithError("lineWidth",t,0,this.width)},Cr=function(t,e,s,i){return Er.log("clampBox",{x:t,y:e,width:s,height:i}),{x:t,y:e,width:s,height:i}};const Xr=T("BaseConnectionManager",{log:!1}),Yr=["webBluetooth","noble","client","webSocket","udp"],Jr=["notConnected","connecting","connected","disconnecting"],Kr=[...Jr,"connectionStatus","isConnected"],Qr=[...Ln,...ui,...Js,...na,...$t,...Yi,...Wa,...rs,...Ns,...Tr],Zr=["batteryLevel"],to=["rx","tx"],eo=[...Zr,...hn,...to,...Qr,"smp"];class so{get baseConstructor(){return this.constructor}static get isSupported(){return!1}get isSupported(){return this.baseConstructor.isSupported}get canUpdateFirmware(){return!1}get type(){return this.baseConstructor.type}constructor(){_r.add(this),Pr.set(this,"notConnected"),qr.set(this,[]),zr.set(this,!1),this.defaultMtu=23,this.mtu=this.defaultMtu,Gr.set(this,new F(e(this,_r,"m",Hr).bind(this),5e3)),e(this,_r,"m",Or).call(this)}get status(){return e(this,Pr,"f")}set status(t){Xr.assertEnumWithError(t,Jr),e(this,Pr,"f")!=t?(Xr.log(`new connection status "${t}"`),s(this,Pr,t,"f"),this.onStatusUpdated(this.status),this.isConnected?e(this,Gr,"f").start():e(this,Gr,"f").stop(),"notConnected"==e(this,Pr,"f")&&(this.mtu=this.defaultMtu)):Xr.log(`tried to assign same connection status "${t}"`)}get isConnected(){return"connected"==this.status}get isAvailable(){return!1}assertIsNotConnected(){Xr.assertWithError(!this.isConnected,"device is already connected")}assertIsConnected(){Xr.assertWithError(this.isConnected,"device is not connected")}assertIsConnectedAndNotDisconnecting(){this.assertIsConnected(),e(this,_r,"m",Vr).call(this)}async connect(){this.assertIsNotConnected(),e(this,_r,"m",Nr).call(this),this.status="connecting"}get canReconnect(){return!1}async reconnect(){this.assertIsNotConnected(),e(this,_r,"m",Nr).call(this),Xr.assertWithError(this.canReconnect,"unable to reconnect"),this.status="connecting",Xr.log("attempting to reconnect...")}async disconnect(){this.assertIsConnected(),e(this,_r,"m",Vr).call(this),this.status="disconnecting",Xr.log("disconnecting from device...")}async sendSmpMessage(t){this.assertIsConnectedAndNotDisconnecting(),Xr.log("sending smp message",t)}async sendTxMessages(t,i=!0){if(this.assertIsConnectedAndNotDisconnecting(),t&&(e(this,qr,"f").push(...t),Xr.log(`appended ${t.length} messages`)),!i)return void Xr.log("not sending immediately - waiting until later");if(e(this,zr,"f"))return void Xr.log("already sending messages - waiting until later");if(0==e(this,qr,"f").length)return void Xr.log("no pendingMessages");s(this,zr,!0,"f"),Xr.log("sendTxMessages",e(this,qr,"f").slice());const n=e(this,qr,"f").map((t=>{e(Br,Br,"m",$r).call(Br,t.type);const s=Qr.indexOf(t.type),i=new DataView(new ArrayBuffer(2));return i.setUint16(0,t.data?.byteLength||0,!0),z(s,i,t.data)}));if(e(this,qr,"f").length=0,this.mtu)for(;n.length>0;){if(n.every((t=>t.byteLength>this.mtu-3))){Xr.log("every arrayBuffer is too big to send");break}Xr.log("remaining arrayBuffers.length",n.length);let t=0,e=0;n.some((s=>{if(t+s.byteLength>this.mtu-3)return Xr.log(`stopping appending arrayBuffers ( length ${s.byteLength} too much)`),!0;Xr.log(`allowing arrayBuffer with length ${s.byteLength}`),e++,t+=s.byteLength}));const s=n.splice(0,e);Xr.log({arrayBufferCount:e,arrayBuffersToSend:s});const i=z(...s);Xr.log("sending arrayBuffer (partitioned)",i),await this.sendTxData(i)}else{const t=z(...n);Xr.log("sending arrayBuffer (all)",t),await this.sendTxData(t)}s(this,zr,!1,"f"),this.sendTxMessages(void 0,!0)}async sendTxData(t){Xr.log("sendTxData",t)}parseRxMessage(t){De(t,Qr,e(this,_r,"m",jr).bind(this),null,!0),this.onMessagesReceived()}clear(){s(this,zr,!1,"f"),e(this,qr,"f").length=0}remove(){this.clear(),this.onStatusUpdated=void 0,this.onMessageReceived=void 0,this.onMessagesReceived=void 0}}Br=so,Pr=new WeakMap,qr=new WeakMap,zr=new WeakMap,Gr=new WeakMap,_r=new WeakSet,$r=function(t){Xr.assertEnumWithError(t,Qr)},Or=function(){Xr.assertWithError(this.isSupported,`${this.constructor.name} is not supported`)},Nr=function(){Xr.assertWithError("connecting"!=this.status,"device is already connecting")},Vr=function(){Xr.assertWithError("disconnecting"!=this.status,"device is already disconnecting")},jr=function(t,e){Xr.log({messageType:t,dataView:e}),this.onMessageReceived(t,e)},Hr=function(){this.isConnected||(Xr.log("timer detected disconnection"),this.status="notConnected")};const io=T("EventUtils",{log:!1});function no(t,e){let s=t.addEventListener||t.addListener||t.on||t.AddEventListener;io.assertWithError(s,"no add listener function found for target"),s=s.bind(t),Object.entries(e).forEach((([t,e])=>{s(t,e)}))}function ao(t,e){let s=t.removeEventListener||t.removeListener||t.RemoveEventListener;io.assertWithError(s,"no remove listener function found for target"),s=s.bind(t),Object.entries(e).forEach((([t,e])=>{s(t,e)}))}const ro=T("bluetoothUUIDs",{log:!1});if(n)var oo=window.BluetoothUUID;function ho(t){return ro.assertTypeWithError(t,"string"),ro.assertWithError(4==t.length,"value must be 4 characters long"),`ea6d${t}-a725-4f9b-893d-c3913e33b39f`}function co(t){return oo?.getCharacteristic?.(t)}function lo(t){return oo?.getService?.(t)}const fo=Object.freeze({services:{deviceInformation:{uuid:lo("device_information"),characteristics:{manufacturerName:{uuid:co("manufacturer_name_string")},modelNumber:{uuid:co("model_number_string")},hardwareRevision:{uuid:co("hardware_revision_string")},firmwareRevision:{uuid:co("firmware_revision_string")},softwareRevision:{uuid:co("software_revision_string")},pnpId:{uuid:co("pnp_id")},serialNumber:{uuid:co("serial_number_string")}}},battery:{uuid:lo("battery_service"),characteristics:{batteryLevel:{uuid:co("battery_level")}}},main:{uuid:ho("0000"),characteristics:{rx:{uuid:ho("1000")},tx:{uuid:ho("1001")}}},smp:{uuid:"8d53dc1d-1db7-4cd3-868b-8a527460aa84",characteristics:{smp:{uuid:"da2e7828-fbce-4e01-ae9e-261174997c48"}}}}}),go=[fo.services.main.uuid],uo=[fo.services.deviceInformation.uuid,fo.services.battery.uuid,fo.services.smp.uuid];function po(t){t=t.toString().toLowerCase();return Object.keys(fo.services).find((e=>{let s=fo.services[e].uuid.toString();return 4==t.length&&(s=s.slice(4,8)),t.includes("-")||(s=s.replaceAll("-","")),t==s}))}const mo=[],vo=[];function yo(t){var e;return t=t.toString().toLowerCase(),Object.values(fo.services).some((s=>{const i=Object.keys(s.characteristics);return e=i.find((e=>{let i=s.characteristics[e].uuid.toString();return 4==t.length&&(i=i.slice(4,8)),t.includes("-")||(i=i.replaceAll("-","")),t==i}))})),e}function wo(t){const e={broadcast:!1,read:!0,writeWithoutResponse:!1,write:!1,notify:!1,indicate:!1,authenticatedSignedWrites:!1,reliableWrite:!1,writableAuxiliaries:!1};switch(t){case"rx":case"tx":case"smp":e.read=!1}switch(t){case"batteryLevel":case"rx":case"smp":e.notify=!0}if("smp"===t)e.writeWithoutResponse=!0;if("tx"===t)e.write=!0;return e}Object.values(fo.services).forEach((t=>{if(!t.characteristics)return;const e=Object.keys(t.characteristics);e.forEach((s=>{const i=t.characteristics[s];go.includes(t.uuid)&&(mo.push(i.uuid),e.push(s)),vo.push(i.uuid)}))}),[]);const bo=T("BluetoothConnectionManager",{log:!1});class Co extends so{constructor(){super(...arguments),this.isInRange=!0}get isAvailable(){return!0}onCharacteristicValueChanged(t,e){"rx"==t?this.parseRxMessage(e):this.onMessageReceived?.(t,e)}async writeCharacteristic(t,e){bo.log("writeCharacteristic",...arguments)}async sendSmpMessage(t){super.sendSmpMessage(t),await this.writeCharacteristic("smp",t)}async sendTxData(t){super.sendTxData(t),0!=t.byteLength&&await this.writeCharacteristic("tx",t)}}var So,Eo,Mo,Do,ko,Wo,To,Ro,xo,Io,Lo;const Uo=T("WebBluetoothConnectionManager",{log:!1});var Ao;n&&(Ao=window.navigator.bluetooth);class Fo extends Co{constructor(){super(...arguments),So.add(this),Eo.set(this,{characteristicvaluechanged:e(this,So,"m",xo).bind(this)}),Mo.set(this,{gattserverdisconnected:e(this,So,"m",Lo).bind(this)}),Do.set(this,void 0),ko.set(this,new Map),Wo.set(this,new Map)}get bluetoothId(){return this.device.id}get canUpdateFirmware(){return e(this,Wo,"f").has("smp")}static get isSupported(){return Boolean(Ao)}static get type(){return"webBluetooth"}get device(){return e(this,Do,"f")}set device(t){e(this,Do,"f")!=t?(e(this,Do,"f")&&ao(e(this,Do,"f"),e(this,Mo,"f")),t&&no(t,e(this,Mo,"f")),s(this,Do,t,"f")):Uo.log("tried to assign the same BluetoothDevice")}get server(){return e(this,Do,"f")?.gatt}get isConnected(){return this.server?.connected||!1}async connect(){await super.connect();try{const t=await Ao.requestDevice({filters:[{services:go}],optionalServices:n?uo:[]});Uo.log("got BluetoothDevice"),this.device=t,Uo.log("connecting to device...");const s=await this.server.connect();Uo.log(`connected to device? ${s.connected}`),await e(this,So,"m",To).call(this),Uo.log("fully connected"),this.status="connected"}catch(t){Uo.error(t),this.status="notConnected",this.server?.disconnect(),e(this,So,"m",Ro).call(this)}}async disconnect(){await e(this,So,"m",Ro).call(this),await super.disconnect(),this.server?.disconnect(),this.status="notConnected"}async writeCharacteristic(t,s){super.writeCharacteristic(t,s);const i=e(this,Wo,"f").get(t);Uo.assertWithError(i,`${t} characteristic not found`),Uo.log("writing characteristic",i,s);const n=i.properties||wo(t);n.writeWithoutResponse?(Uo.log("writing without response"),await i.writeValueWithoutResponse(s)):(Uo.log("writing with response"),await i.writeValueWithResponse(s)),Uo.log("wrote characteristic"),n.read&&!n.notify&&(Uo.log("reading value after write..."),await i.readValue(),(h||c)&&e(this,So,"m",Io).call(this,i))}get canReconnect(){return Boolean(this.server&&!this.server.connected&&this.isInRange)}async reconnect(){await super.reconnect();try{await this.server.connect()}catch(t){Uo.error(t),this.isInRange=!1}this.isConnected?(Uo.log("successfully reconnected!"),await e(this,So,"m",To).call(this),this.status="connected"):(Uo.log("unable to reconnect"),this.status="notConnected")}remove(){super.remove(),this.device=void 0}}Eo=new WeakMap,Mo=new WeakMap,Do=new WeakMap,ko=new WeakMap,Wo=new WeakMap,So=new WeakSet,To=async function(){e(this,So,"m",Ro).call(this),Uo.log("getting services...");const t=await this.server.getPrimaryServices();Uo.log("got services",t.length),Uo.log("getting characteristics...");for(const s in t){const i=t[s];Uo.log({service:i});const n=po(i.uuid);Uo.assertWithError(n,`no name found for service uuid "${i.uuid}"`),Uo.log(`got "${n}" service`),i.name=n,e(this,ko,"f").set(n,i),Uo.log(`getting characteristics for "${n}" service`);const a=await i.getCharacteristics();Uo.log(`got characteristics for "${n}" service`);for(const t in a){const s=a[t];Uo.log({characteristic:s});const i=yo(s.uuid);Uo.assertWithError(Boolean(i),`no name found for characteristic uuid "${s.uuid}" in "${n}" service`),Uo.log(`got "${i}" characteristic in "${n}" service`),s.name=i,e(this,Wo,"f").set(i,s),no(s,e(this,Eo,"f"));const r=s.properties||wo(i);r.notify&&(Uo.log(`starting notifications for "${i}" characteristic`),await s.startNotifications()),r.read&&(Uo.log(`reading "${i}" characteristic...`),await s.readValue(),(h||c)&&e(this,So,"m",Io).call(this,s))}}},Ro=async function(){this.device&&ao(this.device,e(this,Mo,"f"));const t=Array.from(e(this,Wo,"f").keys()).map((t=>{const s=e(this,Wo,"f").get(t);ao(s,e(this,Eo,"f"));if((s.properties||wo(t)).notify)return Uo.log(`stopping notifications for "${t}" characteristic`),s.stopNotifications()}));return Promise.allSettled(t)},xo=function(t){Uo.log("oncharacteristicvaluechanged");const s=t.target;e(this,So,"m",Io).call(this,s)},Io=function(t){Uo.log("onCharacteristicValue");const e=t.name;Uo.assertWithError(Boolean(e),`no name found for characteristic with uuid "${t.uuid}"`),Uo.log(`oncharacteristicvaluechanged for "${e}" characteristic`);const s=t.value;Uo.assertWithError(s,`no data found for "${e}" characteristic`),Uo.log(`data for "${e}" characteristic`,Array.from(new Uint8Array(s.buffer)));try{this.onCharacteristicValueChanged(e,s)}catch(t){Uo.error(t)}},Lo=function(){Uo.log("gattserverdisconnected"),this.status="notConnected"};const _o=4294967296,Bo=9007199254740992;const $o={encode:function(t){let e,s=new ArrayBuffer(256),i=new DataView(s),n=0;function a(t){let a=s.byteLength;const r=n+t;for(;a<r;)a<<=1;if(a!==s.byteLength){const t=i;s=new ArrayBuffer(a),i=new DataView(s);const e=n+3>>2;for(let s=0;s<e;++s)i.setUint32(s<<2,t.getUint32(s<<2))}return e=t,i}function r(){n+=e}function o(t){r(a(1).setUint8(n,t))}function h(t){const e=a(t.length);for(let s=0;s<t.length;++s)e.setUint8(n+s,t[s]);r()}function c(t,e){e<24?o(t<<5|e):e<256?(o(t<<5|24),o(e)):e<65536?(o(t<<5|25),function(t){r(a(2).setUint16(n,t))}(e)):e<4294967296?(o(t<<5|26),function(t){r(a(4).setUint32(n,t))}(e)):(o(t<<5|27),function(t){const e=t%_o,s=(t-e)/_o,i=a(8);i.setUint32(n,s),i.setUint32(n+4,e),r()}(e))}if(function t(e){let s;const i=[];let l;if(!1===e)return o(244);if(!0===e)return o(245);if(null===e)return o(246);if(void 0===e)return o(247);switch(typeof e){case"number":if(Math.floor(e)===e){if(e>=0&&e<=Bo)return c(0,e);if(-Bo<=e&&e<0)return c(1,-(e+1))}return o(251),function(t){r(a(8).setFloat64(n,t))}(e);case"string":for(s=0;s<e.length;++s){let t=e.charCodeAt(s);t<128?i.push(t):t<2048?(i.push(192|t>>6),i.push(128|63&t)):t<55296?(i.push(224|t>>12),i.push(128|t>>6&63),i.push(128|63&t)):(t=(1023&t)<<10,t|=1023&e.charCodeAt(++s),t+=65536,i.push(240|t>>18),i.push(128|t>>12&63),i.push(128|t>>6&63),i.push(128|63&t))}return c(3,i.length),h(i);default:if(Array.isArray(e))for(l=e.length,c(4,l),s=0;s<l;++s)t(e[s]);else if(e instanceof Uint8Array)c(2,e.length),h(e);else{const i=Object.keys(e);for(l=i.length,c(5,l),s=0;s<l;++s){const n=i[s];t(n),t(e[n])}}}}(t),"slice"in s)return s.slice(0,n);const l=new ArrayBuffer(n),f=new DataView(l);for(let t=0;t<n;++t)f.setUint8(t,i.getUint8(t));return l},decode:function(t,e,s){const i=new DataView(t);let n=0;function a(t,e){return n+=t,e}function r(e){return a(e,new Uint8Array(t,n,e))}function o(){return a(1,i.getUint8(n))}function h(){return a(2,i.getUint16(n))}function c(){return a(4,i.getUint32(n))}function l(){return 255===i.getUint8(n)&&(n+=1,!0)}function f(t){if(t<24)return t;if(24===t)return o();if(25===t)return h();if(26===t)return c();if(27===t)return c()*_o+c();if(31===t)return-1;throw new Error("Invalid length encoding")}function g(t){const e=o();if(255===e)return-1;const s=f(31&e);if(s<0||e>>5!==t)throw new Error("Invalid indefinite length element");return s}function d(t,e){for(let s=0;s<e;++s){let s=o();128&s&&(s<224?(s=(31&s)<<6|63&o(),e-=1):s<240?(s=(15&s)<<12|(63&o())<<6|63&o(),e-=2):(s=(15&s)<<18|(63&o())<<12|(63&o())<<6|63&o(),e-=3)),s<65536?t.push(s):(s-=65536,t.push(55296|s>>10),t.push(56320|1023&s))}}"function"!=typeof e&&(e=function(t){return t}),"function"!=typeof s&&(s=function(){});const u=function t(){const c=o(),u=c>>5,p=31&c;let m,v;if(7===u)switch(p){case 25:return function(){const t=new ArrayBuffer(4),e=new DataView(t),s=h(),i=32768&s;let n=31744&s;const a=1023&s;if(31744===n)n=261120;else if(0!==n)n+=114688;else if(0!==a)return(i?-1:1)*a*5.960464477539063e-8;return e.setUint32(0,i<<16|n<<13|a<<13),e.getFloat32(0)}();case 26:return a(4,i.getFloat32(n));case 27:return a(8,i.getFloat64(n))}if(v=f(p),v<0&&(u<2||u>6))throw new Error("Invalid length");const y=[];let w;const b={};switch(u){case 0:return v;case 1:return-1-v;case 2:if(v<0){const t=[];let e=0;for(;(v=g(u))>=0;)e+=v,t.push(r(v));const s=new Uint8Array(e);let i=0;for(m=0;m<t.length;++m)s.set(t[m],i),i+=t[m].length;return s}return r(v);case 3:if(v<0)for(;(v=g(u))>=0;)d(y,v);else d(y,v);return String.fromCharCode.apply(null,y);case 4:if(v<0)for(w=[];!l();)w.push(t());else for(w=new Array(v),m=0;m<v;++m)w[m]=t();return w;case 5:for(m=0;m<v||v<0&&!l();++m){b[t()]=t()}return b;case 6:return e(t(),v);case 7:switch(v){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;default:return s(v)}}}();if(n!==t.byteLength)throw new Error("Remaining bytes");return u}},Oo=T("mcumgr",{log:!1}),Po=0,No=1,Vo=2,qo=3,zo=0,jo=1,Go=8,Ho=0,Xo=2,Yo=3,Jo=5,Ko=0,Qo=1,Zo=5,th=0;class eh{constructor(){this._mtu=256,this._messageCallback=null,this._imageUploadProgressCallback=null,this._imageUploadNextCallback=null,this._fileUploadProgressCallback=null,this._fileUploadNextCallback=null,this._uploadIsInProgress=!1,this._downloadIsInProgress=!1,this._buffer=new Uint8Array,this._seq=0}onMessage(t){return this._messageCallback=t,this}onImageUploadNext(t){return this._imageUploadNextCallback=t,this}onImageUploadProgress(t){return this._imageUploadProgressCallback=t,this}onImageUploadFinished(t){return this._imageUploadFinishedCallback=t,this}onFileUploadNext(t){return this._fileUploadNextCallback=t,this}onFileUploadProgress(t){return this._fileUploadProgressCallback=t,this}onFileUploadFinished(t){return this._fileUploadFinishedCallback=t,this}onFileDownloadNext(t){return this._fileDownloadNextCallback=t,this}onFileDownloadProgress(t){return this._fileDownloadProgressCallback=t,this}onFileDownloadFinished(t){return this._fileDownloadFinishedCallback=t,this}_getMessage(t,e,s,i){let n=[];void 0!==i&&(n=[...new Uint8Array($o.encode(i))]);const a=255&n.length,r=[t,0,n.length>>8,a,e>>8,255&e,this._seq,s,...n];return this._seq=(this._seq+1)%256,r}_notification(t){Oo.log("mcumgr - message received");const e=new Uint8Array(t);this._buffer=new Uint8Array([...this._buffer,...e]);const s=256*this._buffer[2]+this._buffer[3];this._buffer.length<s+8||(this._processMessage(this._buffer.slice(0,s+8)),this._buffer=this._buffer.slice(s+8))}_processMessage(t){const[e,,s,i,n,a,,r]=t,o=$o.decode(t.slice(8).buffer),h=256*s+i,c=256*n+a;return Oo.log("mcumgr - Process Message - Group: "+c+", Id: "+r+", Off: "+o.off),c===jo&&r===Qo&&o.off?(this._uploadOffset=o.off,void this._uploadNext()):e===qo&&c===Go&&r===th&&o.off?(this._uploadFileOffset=o.off,void this._uploadFileNext()):e===No&&c===Go&&r===th?(this._downloadFileOffset+=o.data.length,null!=o.len&&(this._downloadFileLength=o.len),Oo.log("downloaded "+this._downloadFileOffset+" bytes of "+this._downloadFileLength),this._downloadFileLength>0&&this._fileDownloadProgressCallback({percentage:Math.floor(this._downloadFileOffset/this._downloadFileLength*100)}),this._messageCallback&&this._messageCallback({op:e,group:c,id:r,data:o,length:h}),void this._downloadFileNext()):void(this._messageCallback&&this._messageCallback({op:e,group:c,id:r,data:o,length:h}))}cmdReset(){return this._getMessage(Vo,zo,Jo)}smpEcho(t){return this._getMessage(Vo,zo,Ho,{d:t})}cmdImageState(){return this._getMessage(Po,jo,Ko)}cmdImageErase(){return this._getMessage(Vo,jo,Zo,{})}cmdImageTest(t){return this._getMessage(Vo,jo,Ko,{hash:t,confirm:!1})}cmdImageConfirm(t){return this._getMessage(Vo,jo,Ko,{hash:t,confirm:!0})}_hash(t){return crypto.subtle.digest("SHA-256",t)}async _uploadNext(){if(!this._uploadImage)return;if(this._uploadOffset>=this._uploadImage.byteLength)return this._uploadIsInProgress=!1,void this._imageUploadFinishedCallback();const t={data:new Uint8Array,off:this._uploadOffset};0===this._uploadOffset&&(t.len=this._uploadImage.byteLength,t.sha=new Uint8Array(await this._hash(this._uploadImage))),this._imageUploadProgressCallback({percentage:Math.floor(this._uploadOffset/this._uploadImage.byteLength*100)});const e=this._mtu-$o.encode(t).byteLength-8-3-5;t.data=new Uint8Array(this._uploadImage.slice(this._uploadOffset,this._uploadOffset+e)),this._uploadOffset+=e;const s=this._getMessage(Vo,jo,Qo,t);Oo.log("mcumgr - _uploadNext: Message Length: "+s.length),this._imageUploadNextCallback({packet:s})}async reset(){this._messageCallback=null,this._imageUploadProgressCallback=null,this._imageUploadNextCallback=null,this._fileUploadProgressCallback=null,this._fileUploadNextCallback=null,this._uploadIsInProgress=!1,this._downloadIsInProgress=!1,this._buffer=new Uint8Array,this._seq=0}async cmdUpload(t,e=0){this._uploadIsInProgress?Oo.error("Upload is already in progress."):(this._uploadIsInProgress=!0,this._uploadOffset=0,this._uploadImage=t,this._uploadSlot=e,this._uploadNext())}async cmdUploadFile(t,e){this._uploadIsInProgress?Oo.error("Upload is already in progress."):(this._uploadIsInProgress=!0,this._uploadFileOffset=0,this._uploadFile=t,this._uploadFilename=e,this._uploadFileNext())}async _uploadFileNext(){if(Oo.log("uploadFileNext - offset: "+this._uploadFileOffset+", length: "+this._uploadFile.byteLength),this._uploadFileOffset>=this._uploadFile.byteLength)return this._uploadIsInProgress=!1,void this._fileUploadFinishedCallback();const t={data:new Uint8Array,off:this._uploadFileOffset};0===this._uploadFileOffset&&(t.len=this._uploadFile.byteLength),t.name=this._uploadFilename,this._fileUploadProgressCallback({percentage:Math.floor(this._uploadFileOffset/this._uploadFile.byteLength*100)});const e=this._mtu-$o.encode(t).byteLength-8;t.data=new Uint8Array(this._uploadFile.slice(this._uploadFileOffset,this._uploadFileOffset+e)),this._uploadFileOffset+=e;const s=this._getMessage(Vo,Go,th,t);Oo.log("mcumgr - _uploadNext: Message Length: "+s.length),this._fileUploadNextCallback({packet:s})}async cmdDownloadFile(t,e){this._downloadIsInProgress?Oo.error("Download is already in progress."):(this._downloadIsInProgress=!0,this._downloadFileOffset=0,this._downloadFileLength=0,this._downloadRemoteFilename=t,this._downloadLocalFilename=e,this._downloadFileNext())}async _downloadFileNext(){if(this._downloadFileLength>0&&this._downloadFileOffset>=this._downloadFileLength)return this._downloadIsInProgress=!1,void this._fileDownloadFinishedCallback();const t={off:this._downloadFileOffset};0===this._downloadFileOffset&&(t.name=this._downloadRemoteFilename);const e=this._getMessage(Po,Go,th,t);Oo.log("mcumgr - _downloadNext: Message Length: "+e.length),this._fileDownloadNextCallback({packet:e})}async imageInfo(t){const e={},s=new Uint8Array(t);if(s.length<32)throw new Error("Invalid image (too short file)");if(61!==s[0]||184!==s[1]||243!==s[2]||150!==s[3])throw new Error("Invalid image (wrong magic bytes)");if(0!==s[4]||0!==s[5]||0!==s[6]||0!==s[7])throw new Error("Invalid image (wrong load address)");const i=s[8]+256*s[9];if(0!==s[10]||0!==s[11])throw new Error("Invalid image (wrong protected TLV area size)");const n=s[12]+256*s[13]+65536*s[14]+s[15]*2**24;if(e.imageSize=n,s.length<n+i)throw new Error("Invalid image (wrong image size)");if(0!==s[16]||0!==s[17]||0!==s[18]||0!==s[19])throw new Error("Invalid image (wrong flags)");const a=`${s[20]}.${s[21]}.${s[22]+256*s[23]}`;return e.version=a,e.hash=[...new Uint8Array(await this._hash(t.slice(0,n+32)))].map((t=>t.toString(16).padStart(2,"0"))).join(""),e}}var sh,ih,nh,ah,rh,oh,hh,ch,lh,fh,gh,dh,uh,ph,mh,vh,yh,wh,bh,Ch,Sh;const Eh=T("FirmwareManager",{log:!1}),Mh=["smp"],Dh=[...Mh,"firmwareImages","firmwareUploadProgress","firmwareStatus","firmwareUploadComplete"],kh=["idle","uploading","uploaded","pending","testing","erasing"];class Wh{constructor(){sh.add(this),nh.set(this,"idle"),rh.set(this,void 0),ch.set(this,void 0),lh.set(this,new eh),e(this,sh,"m",fh).call(this),Y(this)}get addEventListenter(){return this.eventDispatcher.addEventListener}get removeEventListener(){return this.eventDispatcher.removeEventListener}get waitForEvent(){return this.eventDispatcher.waitForEvent}parseMessage(t,s){if(Eh.log({messageType:t}),"smp"!==t)throw Error(`uncaught messageType ${t}`);e(this,lh,"f")._notification(Array.from(new Uint8Array(s.buffer))),e(this,sh,"a",ih).call(this,"smp",{dataView:s})}async uploadFirmware(t){Eh.log("uploadFirmware",t);const s=this.waitForEvent("firmwareUploadComplete");await this.getImages();const i=await H(t),n=await e(this,lh,"f").imageInfo(i);Eh.log({imageInfo:n}),e(this,lh,"f").cmdUpload(i,1),e(this,sh,"m",ah).call(this,"uploading"),await s}get status(){return e(this,nh,"f")}get images(){return e(this,rh,"f")}async getImages(){const t=this.waitForEvent("firmwareImages");Eh.log("getting firmware image state..."),this.sendMessage(Uint8Array.from(e(this,lh,"f").cmdImageState()).buffer),await t}async testImage(t=1){if(e(this,sh,"m",hh).call(this,t),e(this,sh,"m",oh).call(this),!e(this,rh,"f")[t])return void Eh.log(`image ${t} not found`);if(1==e(this,rh,"f")[t].pending)return void Eh.log(`image ${t} is already pending`);if(e(this,rh,"f")[t].empty)return void Eh.log(`image ${t} is empty`);const s=this.waitForEvent("smp");Eh.log("testing firmware image..."),this.sendMessage(Uint8Array.from(e(this,lh,"f").cmdImageTest(e(this,rh,"f")[t].hash)).buffer),await s}async eraseImage(){e(this,sh,"m",oh).call(this);const t=this.waitForEvent("smp");Eh.log("erasing image..."),this.sendMessage(Uint8Array.from(e(this,lh,"f").cmdImageErase()).buffer),e(this,sh,"m",ah).call(this,"erasing"),await t,await this.getImages()}async confirmImage(t=0){if(e(this,sh,"m",hh).call(this,t),e(this,sh,"m",oh).call(this),!0===e(this,rh,"f")[t].confirmed)return void Eh.log(`image ${t} is already confirmed`);const s=this.waitForEvent("smp");Eh.log("confirming image..."),this.sendMessage(Uint8Array.from(e(this,lh,"f").cmdImageConfirm(e(this,rh,"f")[t].hash)).buffer),await s}async echo(t){Eh.assertTypeWithError(t,"string");const s=this.waitForEvent("smp");Eh.log("sending echo..."),this.sendMessage(Uint8Array.from(e(this,lh,"f").smpEcho(t)).buffer),await s}async reset(){const t=this.waitForEvent("smp");Eh.log("resetting..."),this.sendMessage(Uint8Array.from(e(this,lh,"f").cmdReset()).buffer),await t}get mtu(){return e(this,ch,"f")}set mtu(t){s(this,ch,t,"f"),e(this,lh,"f")._mtu=t}}var Th,Rh,xh,Ih,Lh,Uh,Ah,Fh,_h,Bh,$h,Oh,Ph,Nh,Vh,qh,zh,jh;nh=new WeakMap,rh=new WeakMap,ch=new WeakMap,lh=new WeakMap,sh=new WeakSet,ih=function(){return this.eventDispatcher.dispatchEvent},ah=function(t){Eh.assertEnumWithError(t,kh),e(this,nh,"f")!=t?(s(this,nh,t,"f"),Eh.log({firmwareStatus:e(this,nh,"f")}),e(this,sh,"a",ih).call(this,"firmwareStatus",{firmwareStatus:e(this,nh,"f")})):Eh.log(`redundant firmwareStatus assignment "${t}"`)},oh=function(){Eh.assertWithError(e(this,rh,"f"),"didn't get imageState")},hh=function(t){Eh.assertTypeWithError(t,"number"),Eh.assertWithError(0==t||1==t,"imageIndex must be 0 or 1")},fh=function(){e(this,lh,"f").onMessage(e(this,sh,"m",gh).bind(this)),e(this,lh,"f").onFileDownloadNext(e(this,sh,"m",dh)),e(this,lh,"f").onFileDownloadProgress(e(this,sh,"m",uh).bind(this)),e(this,lh,"f").onFileDownloadFinished(e(this,sh,"m",ph).bind(this)),e(this,lh,"f").onFileUploadNext(e(this,sh,"m",mh).bind(this)),e(this,lh,"f").onFileUploadProgress(e(this,sh,"m",vh).bind(this)),e(this,lh,"f").onFileUploadFinished(e(this,sh,"m",yh).bind(this)),e(this,lh,"f").onImageUploadNext(e(this,sh,"m",wh).bind(this)),e(this,lh,"f").onImageUploadProgress(e(this,sh,"m",bh).bind(this)),e(this,lh,"f").onImageUploadFinished(e(this,sh,"m",Ch).bind(this))},gh=function({op:t,group:s,id:i,data:n,length:a}){switch(Eh.log("onMcuMessage",...arguments),s){case zo:switch(i){case Ho:Eh.log(`echo "${n.r}"`);break;case Xo:Eh.table(n.tasks);break;case Yo:Eh.log(n)}break;case jo:if(i===Ko)e(this,sh,"m",Sh).call(this,n);break;default:throw Error(`uncaught mcuMessage group ${s}`)}},dh=function(){Eh.log("onMcuFileDownloadNext",...arguments)},uh=function(){Eh.log("onMcuFileDownloadProgress",...arguments)},ph=function(){Eh.log("onMcuFileDownloadFinished",...arguments)},mh=function(){Eh.log("onMcuFileUploadNext")},vh=function(){Eh.log("onMcuFileUploadProgress")},yh=function(){Eh.log("onMcuFileUploadFinished")},wh=function({packet:t}){Eh.log("onMcuImageUploadNext"),this.sendMessage(Uint8Array.from(t).buffer)},bh=function({percentage:t}){const s=t/100;Eh.log("onMcuImageUploadProgress",...arguments),e(this,sh,"a",ih).call(this,"firmwareUploadProgress",{progress:s})},Ch=async function(){Eh.log("onMcuImageUploadFinished",...arguments),await this.getImages(),e(this,sh,"a",ih).call(this,"firmwareUploadProgress",{progress:100}),e(this,sh,"a",ih).call(this,"firmwareUploadComplete",{})},Sh=function({images:t}){if(!t)return void Eh.log("no images found");s(this,rh,t,"f"),Eh.log("images",e(this,rh,"f"));let i="idle";2==e(this,rh,"f").length&&(e(this,rh,"f")[1].bootable?e(this,rh,"f")[0].confirmed?e(this,rh,"f")[1].pending?(Eh.log("reset to upload to the new firmware image"),i="pending"):(Eh.log("Slot 1 has a valid image. run testImage() to test it or upload a different image."),i="uploaded"):(Eh.log('Slot 0 has a valid image. Click "Confirm Image" to confirm it or wait and the device will swap images back.'),i="testing"):Eh.warn('Slot 1 has a invalid image. Click "Erase Image" to erase it or upload a different image')),1==e(this,rh,"f").length&&(e(this,rh,"f").push({slot:1,empty:!0,version:"Empty",pending:!1,confirmed:!1,bootable:!1,active:!1,permanent:!1}),Eh.log("Select a firmware upload image to upload to slot 1.")),e(this,sh,"m",ah).call(this,i),e(this,sh,"a",ih).call(this,"firmwareImages",{firmwareImages:e(this,rh,"f")})};const Gh=T("DeviceManager",{log:!1}),Hh=["deviceConnected","deviceDisconnected","deviceIsConnected","availableDevices","connectedDevices"];class Xh{constructor(){if(Th.add(this),Rh.set(this,{getType:e(this,Th,"m",xh).bind(this),isConnected:e(this,Th,"m",qh).bind(this)}),Ih.set(this,[]),Lh.set(this,!1),Uh.set(this,{devices:[]}),Ah.set(this,void 0),_h.set(this,"BS.Device"),Ph.set(this,[]),Nh.set(this,new x(this,Hh)),Xh.shared&&this!=Xh.shared)throw Error("DeviceManager is a singleton - use DeviceManager.shared");this.CanUseLocalStorage&&(this.UseLocalStorage=!0)}onDevice(t){no(t,e(this,Rh,"f"))}OnDeviceConnectionStatusUpdated(t,s){if("notConnected"==s&&!t.canReconnect&&e(this,Ph,"f").includes(t)){const s=e(this,Ph,"f").indexOf(t);this.AvailableDevices.splice(s,1),e(this,Th,"m",zh).call(this)}}get ConnectedDevices(){return e(this,Ih,"f")}get UseLocalStorage(){return e(this,Lh,"f")}set UseLocalStorage(t){e(this,Th,"m",Fh).call(this),Gh.assertTypeWithError(t,"boolean"),s(this,Lh,t,"f"),e(this,Lh,"f")&&!e(this,Ah,"f")&&e(this,Th,"m",$h).call(this)}get CanUseLocalStorage(){return n&&window.localStorage}get AvailableDevices(){return e(this,Ph,"f")}get CanGetDevices(){return n&&navigator.bluetooth?.getDevices}async GetDevices(){if(!n)return void Gh.warn("GetDevices is only available in the browser");if(!navigator.bluetooth)return void Gh.warn("bluetooth is not available in this browser");if(h)return void Gh.warn("bluefy lists too many devices...");if(!navigator.bluetooth.getDevices)return void Gh.warn("bluetooth.getDevices() is not available in this browser");if(!this.CanGetDevices)return void Gh.log("CanGetDevices is false");e(this,Ah,"f")||e(this,Th,"m",$h).call(this);const t=e(this,Ah,"f");if(!t.devices||0==t.devices.length)return void Gh.log("no devices found in configuration");const s=await navigator.bluetooth.getDevices();return Gh.log({bluetoothDevices:s}),s.forEach((s=>{if(!s.gatt)return;let i=t.devices.find((t=>s.id==t.bluetoothId));if(!i)return;let n=this.ConnectedDevices.filter((t=>"webBluetooth"==t.connectionType)).find((t=>t.bluetoothId==s.id));const a=this.AvailableDevices.filter((t=>"webBluetooth"==t.connectionType)).find((t=>t.bluetoothId==s.id));if(a)return void(n&&n?.bluetoothId==a.bluetoothId&&n!=a&&(this.AvailableDevices[e(this,Ph,"f").indexOf(a)]=n));if(n)return void this.AvailableDevices.push(n);const r=new bl,o=new Fo;o.device=s,s.name&&r._informationManager.updateName(s.name),r._informationManager.updateType(i.type),r.connectionManager=o,this.AvailableDevices.push(r)})),e(this,Th,"m",zh).call(this),this.AvailableDevices}get AddEventListener(){return e(this,Nh,"f").addEventListener}get RemoveEventListener(){return e(this,Nh,"f").removeEventListener}get RemoveEventListeners(){return e(this,Nh,"f").removeEventListeners}get RemoveAllEventListeners(){return e(this,Nh,"f").removeAllEventListeners}_CheckDeviceAvailability(t){t.isConnected||t.isAvailable||!e(this,Ph,"f").includes(t)||(Gh.log("removing device from availableDevices..."),e(this,Ph,"f").splice(e(this,Ph,"f").indexOf(t),1),e(this,Th,"m",zh).call(this))}}Rh=new WeakMap,Ih=new WeakMap,Lh=new WeakMap,Uh=new WeakMap,Ah=new WeakMap,_h=new WeakMap,Ph=new WeakMap,Nh=new WeakMap,Th=new WeakSet,xh=function(t){e(this,Lh,"f")&&e(this,Th,"m",Oh).call(this,t.target)},Fh=function(){Gh.assertWithError(n,"localStorage is only available in the browser"),Gh.assertWithError(window.localStorage,"localStorage not found")},Bh=function(){e(this,Th,"m",Fh).call(this),localStorage.setItem(e(this,_h,"f"),JSON.stringify(e(this,Ah,"f")))},$h=async function(){e(this,Th,"m",Fh).call(this);let t=localStorage.getItem(e(this,_h,"f"));if("string"!=typeof t)return Gh.log("no info found in localStorage"),s(this,Ah,Object.assign({},e(this,Uh,"f")),"f"),void e(this,Th,"m",Bh).call(this);try{const e=JSON.parse(t);Gh.log({configuration:e}),s(this,Ah,e,"f"),this.CanGetDevices&&await this.GetDevices()}catch(t){Gh.error(t)}},Oh=function(t){if("webBluetooth"!=t.connectionType)return void Gh.log("localStorage is only for webBluetooth devices");e(this,Th,"m",Fh).call(this);const s=e(this,Ah,"f").devices.findIndex((e=>e.bluetoothId==t.bluetoothId));-1!=s&&(e(this,Ah,"f").devices[s].type=t.type,e(this,Th,"m",Bh).call(this))},Vh=function(){return e(this,Nh,"f").dispatchEvent},qh=function(t){const{target:s}=t;if(s.isConnected)if(e(this,Ih,"f").includes(s))Gh.log("device already included");else{if(Gh.log("adding device",s),e(this,Ih,"f").push(s),this.UseLocalStorage&&"webBluetooth"==s.connectionType){const t={type:s.type,bluetoothId:s.bluetoothId,ipAddress:s.ipAddress,isWifiSecure:s.isWifiSecure},i=e(this,Ah,"f").devices.findIndex((e=>e.bluetoothId==t.bluetoothId));-1==i?e(this,Ah,"f").devices.push(t):e(this,Ah,"f").devices[i]=t,e(this,Th,"m",Bh).call(this)}e(this,Th,"a",Vh).call(this,"deviceConnected",{device:s}),e(this,Th,"a",Vh).call(this,"deviceIsConnected",{device:s}),e(this,Th,"m",jh).call(this)}else e(this,Ih,"f").includes(s)?(Gh.log("removing device",s),e(this,Ih,"f").splice(e(this,Ih,"f").indexOf(s),1),e(this,Th,"a",Vh).call(this,"deviceDisconnected",{device:s}),e(this,Th,"a",Vh).call(this,"deviceIsConnected",{device:s}),e(this,Th,"m",jh).call(this)):Gh.log("device already not included");if(this.CanGetDevices&&this.GetDevices(),s.isConnected&&!this.AvailableDevices.includes(s)){const t=this.AvailableDevices.find((t=>t.bluetoothId==s.bluetoothId));Gh.log({existingAvailableDevice:t}),t?this.AvailableDevices[this.AvailableDevices.indexOf(t)]=s:this.AvailableDevices.push(s),e(this,Th,"m",zh).call(this)}this._CheckDeviceAvailability(s)},zh=function(){Gh.log({AvailableDevices:this.AvailableDevices}),e(this,Th,"a",Vh).call(this,"availableDevices",{availableDevices:this.AvailableDevices})},jh=function(){Gh.log({ConnectedDevices:this.ConnectedDevices}),e(this,Th,"a",Vh).call(this,"connectedDevices",{connectedDevices:this.ConnectedDevices})},Xh.shared=new Xh;var Yh=Xh.shared;const Jh=T("ServerUtils",{log:!1}),Kh=["isScanningAvailable","isScanning","startScan","stopScan","discoveredDevice","discoveredDevices","expiredDiscoveredDevice","connectToDevice","disconnectFromDevice","connectedDevices","deviceMessage","requiredDeviceInformation"];function Qh(t,...e){Jh.log("createMessage",...e);const s=e.map((e=>{"string"==typeof e&&(e={type:e}),null!=e.data?Array.isArray(e.data)||(e.data=[e.data]):e.data=[];const s=z(...e.data),i=s.byteLength;Jh.assertEnumWithError(e.type,t);const n=t.indexOf(e.type),a=new DataView(new ArrayBuffer(2));return a.setUint16(0,i,!0),z(n,a,s)}));return Jh.log("messageBuffers",...s),z(...s)}function Zh(...t){return Jh.log("createServerMessage",...t),Qh(Kh,...t)}function tc(...t){return Jh.log("createClientDeviceMessage",...t),Qh(eo,...t)}Zh("isScanningAvailable"),Zh("isScanning"),Zh("startScan"),Zh("stopScan"),Zh("discoveredDevices");const ec=T("WebSocketUtils",{log:!1}),sc=["ping","pong","serverMessage"];function ic(...t){return ec.log("createWebSocketMessage",...t),Qh(sc,...t)}var nc,ac,rc,oc,hc,cc,lc,fc,gc,dc,uc,pc,mc,vc,yc,wc,bc,Cc;ic("ping"),ic("pong");const Sc=T("WebSocketConnectionManager",{log:!1}),Ec=["ping","pong","batteryLevel","deviceInformation","message"];const Mc=["deviceInformation","batteryLevel"];class Dc extends so{get bluetoothId(){return e(this,ac,"f")??""}constructor(t,i=!1,n){super(),nc.add(this),ac.set(this,void 0),this.defaultMtu=1024,rc.set(this,void 0),oc.set(this,void 0),hc.set(this,!1),fc.set(this,{open:e(this,nc,"m",gc).bind(this),message:e(this,nc,"m",dc).bind(this),close:e(this,nc,"m",uc).bind(this),error:e(this,nc,"m",pc).bind(this)}),yc.set(this,new F(e(this,nc,"m",wc).bind(this),29e3)),this.ipAddress=t,this.isSecure=i,this.mtu=this.defaultMtu,s(this,ac,n,"f")}get isAvailable(){return!0}static get isSupported(){return!0}static get type(){return"webSocket"}get webSocket(){return e(this,rc,"f")}set webSocket(t){e(this,rc,"f")!=t?(Sc.log("assigning webSocket",t),e(this,rc,"f")&&(ao(e(this,rc,"f"),e(this,fc,"f")),e(this,rc,"f").readyState==e(this,rc,"f").OPEN&&e(this,rc,"f").close()),t&&no(t,e(this,fc,"f")),s(this,rc,t,"f"),Sc.log("assigned webSocket")):Sc.log("redundant webSocket assignment")}get ipAddress(){return e(this,oc,"f")}set ipAddress(t){this.assertIsNotConnected(),e(this,oc,"f")!=t?(s(this,oc,t,"f"),Sc.log(`updated ipAddress to "${this.ipAddress}"`)):Sc.log(`redundnant ipAddress assignment "${t}"`)}get isSecure(){return e(this,hc,"f")}set isSecure(t){this.assertIsNotConnected(),e(this,hc,"f")!=t?(s(this,hc,t,"f"),Sc.log(`updated isSecure to "${this.isSecure}"`)):Sc.log(`redundant isSecure assignment ${t}`)}get url(){return`${this.isSecure?"wss":"ws"}://${this.ipAddress}/ws`}async connect(){await super.connect();try{this.webSocket=new WebSocket(this.url)}catch(t){Sc.error("error connecting to webSocket",t),this.status="notConnected"}}async disconnect(){await super.disconnect(),Sc.log("closing websocket"),e(this,yc,"f").stop(),e(this,rc,"f")?.close()}get canReconnect(){return Boolean(this.webSocket)}async reconnect(){await super.reconnect(),this.webSocket=new WebSocket(this.url)}async sendSmpMessage(t){super.sendSmpMessage(t),Sc.error("smp not supported on webSockets")}async sendTxData(t){await super.sendTxData(t),0!=t.byteLength&&e(this,nc,"m",lc).call(this,{type:"message",data:t})}remove(){super.remove(),this.webSocket=void 0}}var kc,Wc,Tc,Rc,xc,Ic,Lc,Uc,Ac,Fc,_c,Bc,$c,Oc,Pc,Nc,Vc,qc,zc,jc,Gc,Hc,Xc,Yc,Jc,Kc,Qc,Zc,tl,el,sl,il,nl,al,rl,ol,hl,cl,ll,fl,gl,dl,ul,pl,ml;ac=new WeakMap,rc=new WeakMap,oc=new WeakMap,hc=new WeakMap,fc=new WeakMap,yc=new WeakMap,nc=new WeakSet,cc=function(t){this.assertIsConnected(),Sc.log("sending webSocket message",t),e(this,rc,"f").send(t),e(this,yc,"f").restart()},lc=function(...t){e(this,nc,"m",cc).call(this,function(...t){return Sc.log("createWebSocketMessage",...t),Qh(Ec,...t)}(...t))},gc=function(t){Sc.log("webSocket.open",t),e(this,yc,"f").start(),this.status="connected",e(this,nc,"m",Cc).call(this)},dc=async function(t){const s=await t.data.arrayBuffer(),i=new DataView(s);Sc.log(`webSocket.message (${i.byteLength} bytes)`),e(this,nc,"m",mc).call(this,i)},uc=function(t){Sc.log("webSocket.close",t),this.status="notConnected",e(this,yc,"f").stop()},pc=function(t){Sc.error("webSocket.error",t)},mc=function(t){De(t,Ec,e(this,nc,"m",vc).bind(this),null,!0)},vc=function(t,s){switch(Sc.log(`received "${t}" message (${s.byteLength} bytes)`),t){case"ping":e(this,nc,"m",bc).call(this);break;case"pong":break;case"batteryLevel":this.onMessageReceived?.("batteryLevel",s);break;case"deviceInformation":De(s,hn,((t,e)=>{this.onMessageReceived(t,e)}));break;case"message":this.parseRxMessage(s);break;default:Sc.error(`uncaught messageType "${t}"`)}},wc=function(){Sc.log("pinging"),e(this,nc,"m",lc).call(this,"ping")},bc=function(){Sc.log("ponging"),e(this,nc,"m",lc).call(this,"pong")},Cc=function(){e(this,nc,"m",lc).call(this,...Mc)};const vl=T("Device",{log:!0}),yl=["connectionMessage",...Kr,...to,...Zr,...Un,...cn,...pi,...Qs,...aa,...Vt,...Ji,...Ra,...hs,...zs,...Ar,...Dh],wl=["isCharging","getBatteryCurrent","getId","getMtu","getName","getType","getCurrentTime","getSensorConfiguration","getSensorScalars","getVibrationLocations","getFileTypes","isWifiAvailable"];class bl{get bluetoothId(){return e(this,Ic,"f")?.bluetoothId}get isAvailable(){return e(this,Ic,"f")?.isAvailable}constructor(){kc.add(this),Rc.set(this,new x(this,yl)),Ic.set(this,void 0),this.sendTxMessages=e(this,kc,"m",Lc).bind(this),Uc.set(this,!1),Pc.set(this,Wc.ReconnectOnDisconnection),Nc.set(this,void 0),this.latestConnectionMessages=new Map,Yc.set(this,new ln),Jc.set(this,0),this._informationManager=new An,Qc.set(this,new mi),tl.set(this,Wc.ClearSensorConfigurationOnLeave),el.set(this,new Zs),sl.set(this,new ha),il.set(this,new zt),nl.set(this,new tn),al.set(this,new Wh),this.sendSmpMessage=e(this,kc,"m",ol).bind(this),hl.set(this,!1),cl.set(this,new xa),ll.set(this,new cs),gl.set(this,new js),pl.set(this,new Fr),e(this,Yc,"f").eventDispatcher=e(this,Rc,"f"),this._informationManager.sendMessage=this.sendTxMessages,this._informationManager.eventDispatcher=e(this,Rc,"f"),e(this,Qc,"f").sendMessage=this.sendTxMessages,e(this,Qc,"f").eventDispatcher=e(this,Rc,"f"),e(this,el,"f").eventDispatcher=e(this,Rc,"f"),e(this,sl,"f").sendMessage=this.sendTxMessages,e(this,sl,"f").eventDispatcher=e(this,Rc,"f"),e(this,nl,"f").sendMessage=this.sendTxMessages,e(this,nl,"f").eventDispatcher=e(this,Rc,"f"),e(this,il,"f").sendMessage=this.sendTxMessages,e(this,il,"f").eventDispatcher=e(this,Rc,"f"),e(this,cl,"f").sendMessage=this.sendTxMessages,e(this,cl,"f").eventDispatcher=e(this,Rc,"f"),e(this,ll,"f").sendMessage=this.sendTxMessages,e(this,ll,"f").eventDispatcher=e(this,Rc,"f"),e(this,gl,"f").sendMessage=this.sendTxMessages,e(this,gl,"f").eventDispatcher=e(this,Rc,"f"),e(this,pl,"f").sendMessage=this.sendTxMessages,e(this,pl,"f").eventDispatcher=e(this,Rc,"f"),e(this,al,"f").sendMessage=this.sendSmpMessage,e(this,al,"f").eventDispatcher=e(this,Rc,"f"),this.addEventListener("getMtu",(()=>{e(this,al,"f").mtu=this.mtu,e(this,il,"f").mtu=this.mtu,this.connectionManager.mtu=this.mtu,e(this,pl,"f").mtu=this.mtu})),this.addEventListener("getSensorConfiguration",(()=>{if("connecting"==this.connectionStatus){if(this.sensorTypes.includes("pressure")){vl.log("requesting required pressure information");const t=Ks.map((t=>({type:t})));this.sendTxMessages(t,!1)}else vl.log("don't need to request pressure infomration");if(this.sensorTypes.includes("camera")){vl.log("requesting required camera information");const t=os.map((t=>({type:t})));this.sendTxMessages(t,!1)}else vl.log("don't need to request camera infomration");if(this.sensorTypes.includes("microphone")){vl.log("requesting required microphone information");const t=qs.map((t=>({type:t})));this.sendTxMessages(t,!1)}else vl.log("don't need to request microphone infomration")}})),this.addEventListener("getFileTypes",(()=>{"connecting"==this.connectionStatus&&(this.fileTypes.length>0&&e(this,il,"f").requestRequiredInformation(),this.fileTypes.includes("tflite")&&e(this,nl,"f").requestRequiredInformation())})),this.addEventListener("isWifiAvailable",(()=>{"connecting"==this.connectionStatus&&("client"!=this.connectionType||a)&&this.isWifiAvailable&&"client"!=this.connectionType&&e(this,cl,"f").requestRequiredInformation()})),this.addEventListener("getType",(()=>{"connecting"==this.connectionStatus&&(console.log("lozers",this.type),("client"!=this.connectionType||a)&&"glasses"==this.type&&"client"!=this.connectionType&&e(this,pl,"f").requestRequiredInformation())})),Yh.onDevice(this),n&&window.addEventListener("beforeunload",(()=>{this.isConnected&&this.clearSensorConfigurationOnLeave&&this.clearSensorConfiguration()})),a&&process.on("exit",(()=>{this.isConnected&&this.clearSensorConfigurationOnLeave&&this.clearSensorConfiguration()}))}get addEventListener(){return e(this,Rc,"f").addEventListener}get removeEventListener(){return e(this,Rc,"f").removeEventListener}get waitForEvent(){return e(this,Rc,"f").waitForEvent}get removeEventListeners(){return e(this,Rc,"f").removeEventListeners}get removeAllEventListeners(){return e(this,Rc,"f").removeAllEventListeners}get connectionManager(){return e(this,Ic,"f")}set connectionManager(t){this.connectionManager!=t?(this.connectionManager&&this.connectionManager.remove(),t&&(t.onStatusUpdated=e(this,kc,"m",Vc).bind(this),t.onMessageReceived=e(this,kc,"m",Hc).bind(this),t.onMessagesReceived=e(this,kc,"m",Xc).bind(this)),s(this,Ic,t,"f"),vl.log("assigned new connectionManager",e(this,Ic,"f")),this._informationManager.connectionType=this.connectionType):vl.log("same connectionManager is already assigned")}async connect(t){if(vl.log("connect options",t),t)switch(t.type){case"webBluetooth":"webBluetooth"!=this.connectionType&&(this.connectionManager=new Fo);break;case"webSocket":{let e=!1;if("webSocket"==this.connectionType){const s=this.connectionManager;s.ipAddress==t.ipAddress&&s.isSecure==t.isWifiSecure||(e=!0)}else e=!0;e&&(this.connectionManager=new Dc(t.ipAddress,t.isWifiSecure,this.bluetoothId))}break;case"udp":{let e=!1;if("udp"==this.connectionType){this.connectionManager.ipAddress!=t.ipAddress&&(e=!0),this.reconnectOnDisconnection=!0}else e=!0;e&&(this.connectionManager=new UDPConnectionManager(t.ipAddress,this.bluetoothId))}}if(this.connectionManager||(this.connectionManager=e(Wc,Wc,"m",Tc).call(Wc)),e(this,kc,"m",jc).call(this),"client"==t?.type){vl.assertWithError("client"==this.connectionType,"expected clientConnectionManager");const e=this.connectionManager;return e.subType=t.subType,e.connect()}return vl.log("connectionManager type",this.connectionManager.type),this.connectionManager.connect()}get isConnected(){return e(this,Uc,"f")}get canReconnect(){return this.connectionManager?.canReconnect}async reconnect(){return e(this,kc,"m",$c).call(this),e(this,kc,"m",jc).call(this),this.connectionManager?.reconnect()}static async Connect(){const t=new Wc;return await t.connect(),t}static get ReconnectOnDisconnection(){return e(this,Wc,"f",Oc)}static set ReconnectOnDisconnection(t){vl.assertTypeWithError(t,"boolean"),s(this,Wc,t,"f",Oc)}get reconnectOnDisconnection(){return e(this,Pc,"f")}set reconnectOnDisconnection(t){vl.assertTypeWithError(t,"boolean"),s(this,Pc,t,"f")}get connectionType(){return this.connectionManager?.type}async disconnect(){return e(this,kc,"m",Ac).call(this),this.reconnectOnDisconnection&&(this.reconnectOnDisconnection=!1,this.addEventListener("isConnected",(()=>{this.reconnectOnDisconnection=!0}),{once:!0})),this.connectionManager.disconnect()}toggleConnection(){if(this.isConnected)this.disconnect();else if(this.canReconnect)try{this.reconnect()}catch(t){vl.error("error trying to reconnect",t),this.connect()}else this.connect()}get connectionStatus(){switch(e(this,Ic,"f")?.status){case"connected":return this.isConnected?"connected":"connecting";case"notConnected":case"connecting":case"disconnecting":return e(this,Ic,"f").status;default:return"notConnected"}}get isConnectionBusy(){return"connecting"==this.connectionStatus||"disconnecting"==this.connectionStatus}get deviceInformation(){return e(this,Yc,"f").information}get batteryLevel(){return e(this,Jc,"f")}get id(){return this._informationManager.id}get isCharging(){return this._informationManager.isCharging}get batteryCurrent(){return this._informationManager.batteryCurrent}get getBatteryCurrent(){return this._informationManager.getBatteryCurrent}get name(){return this._informationManager.name}get setName(){return this._informationManager.setName}get type(){return this._informationManager.type}get setType(){return this._informationManager.setType}get isInsole(){return this._informationManager.isInsole}get isGlove(){return this._informationManager.isGlove}get side(){return this._informationManager.side}get mtu(){return this._informationManager.mtu}get sensorTypes(){return Object.keys(this.sensorConfiguration)}get continuousSensorTypes(){return Ys.filter((t=>this.sensorTypes.includes(t)))}get sensorConfiguration(){return e(this,Qc,"f").configuration}get setSensorConfiguration(){return e(this,Qc,"f").setConfiguration}async clearSensorConfiguration(){return e(this,Qc,"f").clearSensorConfiguration()}static get ClearSensorConfigurationOnLeave(){return e(this,Wc,"f",Zc)}static set ClearSensorConfigurationOnLeave(t){vl.assertTypeWithError(t,"boolean"),s(this,Wc,t,"f",Zc)}get clearSensorConfigurationOnLeave(){return e(this,tl,"f")}set clearSensorConfigurationOnLeave(t){vl.assertTypeWithError(t,"boolean"),s(this,tl,t,"f")}get numberOfPressureSensors(){return e(this,el,"f").pressureSensorDataManager.numberOfSensors}resetPressureRange(){e(this,el,"f").pressureSensorDataManager.resetRange()}get vibrationLocations(){return e(this,sl,"f").vibrationLocations}async triggerVibration(t,s){e(this,sl,"f").triggerVibration(t,s)}get fileTypes(){return e(this,il,"f").fileTypes}get maxFileLength(){return e(this,il,"f").maxLength}get validFileTypes(){return Ot.filter((t=>!(t.includes("wifi")&&!this.isWifiAvailable)))}async sendFile(t,s){vl.assertWithError(this.validFileTypes.includes(t),`invalid fileType ${t}`);const i=this.waitForEvent("fileTransferComplete");e(this,il,"f").send(t,s),await i}async receiveFile(t){const s=this.waitForEvent("fileTransferComplete");e(this,il,"f").receive(t),await s}get fileTransferStatus(){return e(this,il,"f").status}cancelFileTransfer(){e(this,il,"f").cancel()}get tfliteName(){return e(this,nl,"f").name}get setTfliteName(){return e(this,nl,"f").setName}async sendTfliteConfiguration(t){t.type="tflite",e(this,nl,"f").sendConfiguration(t,!1);await e(this,il,"f").send(t.type,t.file)||e(this,kc,"m",Lc).call(this)}get tfliteTask(){return e(this,nl,"f").task}get setTfliteTask(){return e(this,nl,"f").setTask}get tfliteSampleRate(){return e(this,nl,"f").sampleRate}get setTfliteSampleRate(){return e(this,nl,"f").setSampleRate}get tfliteSensorTypes(){return e(this,nl,"f").sensorTypes}get allowedTfliteSensorTypes(){return this.sensorTypes.filter((t=>Zi.includes(t)))}get setTfliteSensorTypes(){return e(this,nl,"f").setSensorTypes}get tfliteIsReady(){return e(this,nl,"f").isReady}get tfliteInferencingEnabled(){return e(this,nl,"f").inferencingEnabled}get setTfliteInferencingEnabled(){return e(this,nl,"f").setInferencingEnabled}async enableTfliteInferencing(){return this.setTfliteInferencingEnabled(!0)}async disableTfliteInferencing(){return this.setTfliteInferencingEnabled(!1)}get toggleTfliteInferencing(){return e(this,nl,"f").toggleInferencingEnabled}get tfliteCaptureDelay(){return e(this,nl,"f").captureDelay}get setTfliteCaptureDelay(){return e(this,nl,"f").setCaptureDelay}get tfliteThreshold(){return e(this,nl,"f").threshold}get setTfliteThreshold(){return e(this,nl,"f").setThreshold}get canUpdateFirmware(){return e(this,Ic,"f")?.canUpdateFirmware}get uploadFirmware(){return e(this,kc,"m",rl).call(this),e(this,al,"f").uploadFirmware}get canReset(){return this.canUpdateFirmware}async reset(){return vl.assertWithError(this.canReset,"reset is not enabled for this device"),await e(this,al,"f").reset(),e(this,Ic,"f").disconnect()}get firmwareStatus(){return e(this,al,"f").status}get getFirmwareImages(){return e(this,kc,"m",rl).call(this),e(this,al,"f").getImages}get firmwareImages(){return e(this,al,"f").images}get eraseFirmwareImage(){return e(this,kc,"m",rl).call(this),e(this,al,"f").eraseImage}get confirmFirmwareImage(){return e(this,kc,"m",rl).call(this),e(this,al,"f").confirmImage}get testFirmwareImage(){return e(this,kc,"m",rl).call(this),e(this,al,"f").testImage}get isServerSide(){return e(this,hl,"f")}set isServerSide(t){e(this,hl,"f")!=t?(vl.log({newIsServerSide:t}),s(this,hl,t,"f"),e(this,il,"f").isServerSide=this.isServerSide):vl.log("redundant isServerSide assignment")}get isUkaton(){return this.deviceInformation.modelNumber.includes("Ukaton")}get isWifiAvailable(){return e(this,cl,"f").isWifiAvailable}get wifiSSID(){return e(this,cl,"f").wifiSSID}async setWifiSSID(t){return e(this,cl,"f").setWifiSSID(t)}get wifiPassword(){return e(this,cl,"f").wifiPassword}async setWifiPassword(t){return e(this,cl,"f").setWifiPassword(t)}get isWifiConnected(){return e(this,cl,"f").isWifiConnected}get ipAddress(){return e(this,cl,"f").ipAddress}get wifiConnectionEnabled(){return e(this,cl,"f").wifiConnectionEnabled}get enableWifiConnection(){return e(this,cl,"f").enableWifiConnection}get setWifiConnectionEnabled(){return e(this,cl,"f").setWifiConnectionEnabled}get disableWifiConnection(){return e(this,cl,"f").disableWifiConnection}get toggleWifiConnection(){return e(this,cl,"f").toggleWifiConnection}get isWifiSecure(){return e(this,cl,"f").isWifiSecure}async reconnectViaWebSockets(){vl.assertWithError(this.isWifiConnected,"wifi is not connected"),vl.assertWithError("webSocket"!=this.connectionType,"already connected via webSockets"),vl.assertTypeWithError(this.ipAddress,"string"),vl.log("reconnecting via websockets..."),await this.disconnect(),await this.connect({type:"webSocket",ipAddress:this.ipAddress,isWifiSecure:this.isWifiSecure})}async reconnectViaUDP(){vl.assertWithError(a,"udp is only available in node"),vl.assertWithError(this.isWifiConnected,"wifi is not connected"),vl.assertWithError("udp"!=this.connectionType,"already connected via udp"),vl.assertTypeWithError(this.ipAddress,"string"),vl.log("reconnecting via udp..."),await this.disconnect(),await this.connect({type:"udp",ipAddress:this.ipAddress})}get hasCamera(){return this.sensorTypes.includes("camera")}get cameraStatus(){return e(this,ll,"f").cameraStatus}async takePicture(t=10){e(this,kc,"m",fl).call(this),0==this.sensorConfiguration.camera&&this.setSensorConfiguration({camera:t},!1,!1),await e(this,ll,"f").takePicture()}async focusCamera(t=10){e(this,kc,"m",fl).call(this),0==this.sensorConfiguration.camera&&this.setSensorConfiguration({camera:t},!1,!1),await e(this,ll,"f").focus()}async stopCamera(){e(this,kc,"m",fl).call(this),await e(this,ll,"f").stop()}async wakeCamera(){e(this,kc,"m",fl).call(this),await e(this,ll,"f").wake()}async sleepCamera(){e(this,kc,"m",fl).call(this),await e(this,ll,"f").sleep()}get cameraConfiguration(){return e(this,ll,"f").cameraConfiguration}get availableCameraConfigurationTypes(){return e(this,ll,"f").availableCameraConfigurationTypes}get cameraConfigurationRanges(){return e(this,ll,"f").cameraConfigurationRanges}get setCameraConfiguration(){return e(this,ll,"f").setCameraConfiguration}get hasMicrophone(){return this.sensorTypes.includes("microphone")}get microphoneStatus(){return e(this,gl,"f").microphoneStatus}async startMicrophone(){e(this,kc,"m",dl).call(this),await e(this,gl,"f").start()}async stopMicrophone(){e(this,kc,"m",dl).call(this),await e(this,gl,"f").stop()}async enableMicrophoneVad(){e(this,kc,"m",dl).call(this),await e(this,gl,"f").vad()}async toggleMicrophone(){e(this,kc,"m",dl).call(this),await e(this,gl,"f").toggle()}get microphoneConfiguration(){return e(this,gl,"f").microphoneConfiguration}get availableMicrophoneConfigurationTypes(){return e(this,gl,"f").availableMicrophoneConfigurationTypes}get setMicrophoneConfiguration(){return e(this,gl,"f").setMicrophoneConfiguration}get audioContext(){return e(this,kc,"m",ul).call(this),e(this,gl,"f").audioContext}set audioContext(t){e(this,kc,"m",ul).call(this),e(this,gl,"f").audioContext=t}get microphoneMediaStreamDestination(){return e(this,kc,"m",ul).call(this),e(this,gl,"f").mediaStreamDestination}get microphoneGainNode(){return e(this,kc,"m",ul).call(this),e(this,gl,"f").gainNode}get isRecordingMicrophone(){return e(this,gl,"f").isRecording}startRecordingMicrophone(){e(this,kc,"m",ul).call(this),e(this,gl,"f").startRecording()}stopRecordingMicrophone(){e(this,kc,"m",ul).call(this),e(this,gl,"f").stopRecording()}toggleMicrophoneRecording(){e(this,kc,"m",ul).call(this),e(this,gl,"f").toggleRecording()}get isDisplayAvailable(){return e(this,pl,"f").isDisplayAvailable}get displayContextState(){return e(this,pl,"f").displayContextState}get displayColors(){return e(this,pl,"f").colors}get displayColorOpacities(){return e(this,pl,"f").opacities}get displayStatus(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").displayStatus}get displayBrightness(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").displayBrightness}get setDisplayBrightness(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setDisplayBrightness}get displayInformation(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").displayInformation}get numberOfDisplayColors(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").numberOfColors}get wakeDisplay(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").wake}get sleepDisplay(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").sleep}get toggleDisplay(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").toggle}get isDisplayAwake(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").isDisplayAwake}get showDisplay(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").showDisplay}get clearDisplay(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").clearDisplay}get setDisplayColor(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setColor}get setDisplayColorOpacity(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setColorOpacity}get setDisplayOpacity(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setOpacity}get saveDisplayContext(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").saveContext}get restoreDisplayContext(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").restoreContext}get clearDisplayRect(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").clearRect}get selectDisplayFillColor(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").selectFillColor}get selectDisplayLineColor(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").selectLineColor}get setDisplayLineWidth(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setLineWidth}get setDisplayRotation(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setRotation}get clearDisplayRotation(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").clearRotation}get setDisplaySegmentStartCap(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setSegmentStartCap}get setDisplaySegmentEndCap(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setSegmentEndCap}get setDisplaySegmentCap(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setSegmentCap}get setDisplaySegmentStartRadius(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setSegmentStartRadius}get setDisplaySegmentEndRadius(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setSegmentEndRadius}get setDisplaySegmentRadius(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setSegmentRadius}get setDisplayCropTop(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setCropTop}get setDisplayCropRight(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setCropRight}get setDisplayCropBottom(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setCropBottom}get setDisplayCropLeft(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setCropLeft}get setDisplayCrop(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setCrop}get clearDisplayCrop(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").clearCrop}get setDisplayRotationCropTop(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setRotationCropTop}get setDisplayRotationCropRight(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setRotationCropRight}get setDisplayRotationCropBottom(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setRotationCropBottom}get setDisplayRotationCropLeft(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setRotationCropLeft}get setDisplayRotationCrop(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setRotationCrop}get clearDisplayRotationCrop(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").clearRotationCrop}get flushDisplayContextCommands(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").flushDisplayContextCommands}get drawDisplayRect(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").drawRect}get drawDisplayCircle(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").drawCircle}get drawDisplayEllipse(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").drawEllipse}get drawDisplayRoundRect(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").drawRoundRect}get drawDisplayPolygon(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").drawPolygon}get drawDisplaySegment(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").drawSegment}get setDisplayContextState(){return e(this,kc,"m",ml).call(this),e(this,pl,"f").setContextState}}var Cl,Sl,El,Ml,Dl,kl,Wl,Tl,Rl,xl,Il,Ll,Ul,Al,Fl,_l,Bl,$l,Ol,Pl,Nl,Vl,ql,zl,jl,Gl,Hl,Xl,Yl,Jl,Kl,Ql,Zl,tf,ef,sf,nf,af,rf,of,hf,cf,lf,ff,gf,df,uf,pf,mf,vf,yf,wf,bf,Cf,Sf,Ef;Wc=bl,Rc=new WeakMap,Ic=new WeakMap,Uc=new WeakMap,Pc=new WeakMap,Nc=new WeakMap,Yc=new WeakMap,Jc=new WeakMap,Qc=new WeakMap,tl=new WeakMap,el=new WeakMap,sl=new WeakMap,il=new WeakMap,nl=new WeakMap,al=new WeakMap,hl=new WeakMap,cl=new WeakMap,ll=new WeakMap,gl=new WeakMap,pl=new WeakMap,kc=new WeakSet,Tc=function(){return new Fo},xc=function(){return e(this,Rc,"f").dispatchEvent},Lc=async function(t,s){await(e(this,Ic,"f")?.sendTxMessages(t,s))},Ac=function(){vl.assertWithError(this.isConnected,"notConnected")},Fc=function(t){return t.every((t=>{const e=this.latestConnectionMessages.has(t);return e||vl.log(`didn't receive "${t}" message`),e}))},_c=function(){let t=e(this,kc,"m",Fc).call(this,wl);return t&&this.sensorTypes.includes("pressure")&&(t=e(this,kc,"m",Fc).call(this,Ks)),t&&this.isWifiAvailable&&(t=e(this,kc,"m",Fc).call(this,Ta)),t&&this.fileTypes.length>0&&(t=e(this,kc,"m",Fc).call(this,qt)),t&&this.fileTypes.includes("tflite")&&(t=e(this,kc,"m",Fc).call(this,Ki)),t&&this.hasCamera&&(t=e(this,kc,"m",Fc).call(this,os)),t&&this.hasMicrophone&&(t=e(this,kc,"m",Fc).call(this,qs)),t&&this.isDisplayAvailable&&(t=e(this,kc,"m",Fc).call(this,Ur)),t},Bc=function(){vl.log("requesting required information");const t=wl.map((t=>({type:t})));e(this,kc,"m",Lc).call(this,t)},$c=function(){vl.assertWithError(this.canReconnect,"cannot reconnect to device")},Vc=function(t){vl.log({connectionStatus:t}),"notConnected"==t?(e(this,kc,"m",Gc).call(this),this.canReconnect&&this.reconnectOnDisconnection&&(vl.log("starting reconnect interval..."),s(this,Nc,setInterval((()=>{vl.log("attempting reconnect..."),this.reconnect()}),1e3),"f"))):null!=e(this,Nc,"f")&&(vl.log("clearing reconnect interval"),clearInterval(e(this,Nc,"f")),s(this,Nc,void 0,"f")),e(this,kc,"m",zc).call(this),"connected"!=t||e(this,Uc,"f")||"client"!=this.connectionType&&e(this,kc,"m",Bc).call(this),Yh.OnDeviceConnectionStatusUpdated(this,t)},qc=function(t=!1){e(this,kc,"a",xc).call(this,"connectionStatus",{connectionStatus:this.connectionStatus}),e(this,kc,"a",xc).call(this,this.connectionStatus,{}),t&&e(this,kc,"a",xc).call(this,"isConnected",{isConnected:this.isConnected})},zc=function(){switch(s(this,Uc,Boolean(this.connectionManager?.isConnected)&&e(this,kc,"a",_c)&&this._informationManager.isCurrentTimeSet,"f"),this.connectionStatus){case"connected":e(this,Uc,"f")&&e(this,kc,"m",qc).call(this,!0);break;case"notConnected":e(this,kc,"m",qc).call(this,!0);break;default:e(this,kc,"m",qc).call(this,!1)}},jc=function(){e(this,kc,"m",Gc).call(this),this._informationManager.clear(),e(this,Yc,"f").clear(),e(this,nl,"f").clear(),e(this,cl,"f").clear(),e(this,ll,"f").clear(),e(this,gl,"f").clear(),e(this,pl,"f").clear()},Gc=function(){this.connectionManager?.clear(),this.latestConnectionMessages.clear()},Hc=function(t,s){if(vl.log({messageType:t,dataView:s}),"batteryLevel"===t){const t=s.getUint8(0);vl.log("received battery level",{batteryLevel:t}),e(this,kc,"m",Kc).call(this,t)}else if($t.includes(t))e(this,il,"f").parseMessage(t,s);else if(Yi.includes(t))e(this,nl,"f").parseMessage(t,s);else if(Js.includes(t))e(this,el,"f").parseMessage(t,s);else if(Mh.includes(t))e(this,al,"f").parseMessage(t,s);else if(hn.includes(t))e(this,Yc,"f").parseMessage(t,s);else if(Ln.includes(t))this._informationManager.parseMessage(t,s);else if(ui.includes(t))e(this,Qc,"f").parseMessage(t,s);else if(na.includes(t))e(this,sl,"f").parseMessage(t,s);else if(Wa.includes(t))e(this,cl,"f").parseMessage(t,s);else if(rs.includes(t))e(this,ll,"f").parseMessage(t,s);else if(Ns.includes(t))e(this,gl,"f").parseMessage(t,s);else{if(!Tr.includes(t))throw Error(`uncaught messageType ${t}`);e(this,pl,"f").parseMessage(t,s)}this.latestConnectionMessages.set(t,s),t.startsWith("set")&&this.latestConnectionMessages.set(t.replace("set","get"),s),e(this,kc,"a",xc).call(this,"connectionMessage",{messageType:t,dataView:s})},Xc=function(){!this.isConnected&&e(this,kc,"a",_c)&&e(this,kc,"m",zc).call(this),"notConnected"!=this.connectionStatus&&e(this,kc,"m",Lc).call(this)},Kc=function(t){vl.assertTypeWithError(t,"number"),e(this,Jc,"f")!=t?(s(this,Jc,t,"f"),vl.log({updatedBatteryLevel:e(this,Jc,"f")}),e(this,kc,"a",xc).call(this,"batteryLevel",{batteryLevel:e(this,Jc,"f")})):vl.log(`duplicate batteryLevel assignment ${t}`)},rl=function(){vl.assertWithError(this.canUpdateFirmware,"can't update firmware")},ol=function(t){return e(this,kc,"m",rl).call(this),e(this,Ic,"f").sendSmpMessage(t)},fl=function(){vl.assertWithError(this.hasCamera,"camera not available")},dl=function(){vl.assertWithError(this.hasMicrophone,"microphone not available")},ul=function(){vl.assertWithError(AudioContext,"WebAudio is not supported")},ml=function(){vl.assertWithError(this.isDisplayAvailable,"display not available")},Oc={value:!1},Zc={value:!0};const Mf=T("DisplayCanvasHelper",{log:!1}),Df=["contextState","numberOfColors","brightness","color","colorOpacity","opacity","resize","update"];var kf,Wf,Tf,Rf,xf,If;Sl=new WeakMap,Ml=new WeakMap,Dl=new WeakMap,Wl=new WeakMap,Tl=new WeakMap,Ll=new WeakMap,Ul=new WeakMap,Al=new WeakMap,$l=new WeakMap,Pl=new WeakMap,Vl=new WeakMap,zl=new WeakMap,Zl=new WeakMap,Cf=new WeakMap,Sf=new WeakMap,Cl=new WeakSet,El=function(){return e(this,Sl,"f").dispatchEvent},kl=function(){if(!this.canvas)return;if(this.canvas.style.aspectRatio=`${this.aspectRatio}`,!this.device?.isConnected)return;const{width:t,height:s}=this.device.displayInformation;Mf.log({width:t,height:s}),this.canvas.width=t,this.canvas.height=s,this.canvas.style.aspectRatio=""+t/s,e(this,Cl,"a",El).call(this,"resize",{width:this.width,height:this.height}),this.clearDisplay()},Rl=function(){e(this,Dl,"f").clearRect(0,0,this.width,this.height),e(this,Cl,"m",Il).call(this),e(this,Wl,"f").forEach((t=>t())),e(this,Ll,"f")&&e(this,Cl,"m",xl).call(this),e(this,Cl,"a",El).call(this,"update",{})},xl=function(){const t=this.context,e=t.getImageData(0,0,this.canvas.width,this.canvas.height),s=e.data;for(let t=0;t<s.length;t+=4){const e=s[t],i=s[t+1],n=s[t+2],a=.299*e+.587*i+.114*n,r=Math.min(255,1.5*a),o=r>0?255/r:0;s[t]=Math.min(255,e*o),s[t+1]=Math.min(255,i*o),s[t+2]=Math.min(255,n*o),s[t+3]=r}t.putImageData(e,0,0)},Il=function(){e(this,Cl,"m",Yl).call(this),this.context.fillStyle=e(this,Cl,"m",rf).call(this,0),this.context.fillRect(0,0,this.width,this.height),e(this,Cl,"m",Jl).call(this)},Fl=function(t){Mf.log("device connected"),e(this,Cl,"m",kl).call(this),e(this,Cl,"m",Bl).call(this)},_l=function(t){Mf.log("device not connected")},Bl=function(){e(this,Cl,"m",Nl).call(this,!0),e(this,Cl,"m",ql).call(this,!0),e(this,Cl,"m",Gl).call(this,!0),e(this,Cl,"m",Ef).call(this,!0)},Ol=function(t){Mf.assertRangeWithError("colorIndex",t,0,this.numberOfColors)},Nl=function(t){this.device?.isConnected&&(this.colors.forEach(((e,s)=>{this.device?.setDisplayColor(s,e,t)})),t&&e(this,Ul,"f")?.flushDisplayContextCommands())},ql=function(t){this.device?.isConnected&&e(this,Vl,"f").forEach(((e,s)=>{this.device?.setDisplayColorOpacity(s,e,t&&s==this.colors.length-1)}))},jl=function(t){e(this,Cl,"a",El).call(this,"contextState",{contextState:{...this.contextState},differences:t})},Gl=function(t){this.device?.isConnected&&(Mf.log("updateDeviceContextState"),this.device?.setDisplayContextState(this.contextState,t))},Hl=function(t){Mf.assertRangeWithError("lineWidth",t,0,this.width)},Xl=function(t,s,i,n){e(this,Cl,"m",Yl).call(this),this.context.resetTransform(),this.context.fillStyle=e(this,Cl,"m",rf).call(this,0),this.context.fillRect(t,s,i,n),e(this,Cl,"m",Jl).call(this)},Yl=function(){this.context.save()},Jl=function(){this.context.restore()},Kl=function(t,e,s){const i=this.context;i.translate(t,e),i.rotate(s)},Ql=function(t,e){const s=t.x+t.width/2,i=t.y+t.height/2,n=t.width/2,a=t.height/2,r=Math.cos(e),o=Math.sin(e),h=[{x:-n,y:-a},{x:n,y:-a},{x:n,y:a},{x:-n,y:a}].map((({x:t,y:e})=>({x:t*r-e*o,y:t*o+e*r}))),c=h.map((t=>t.x)),l=h.map((t=>t.y)),f=Math.min(...c),g=Math.max(...c),d=Math.min(...l);return{x:s+f,y:i+d,width:g-f,height:Math.max(...l)-d}},tf=function({x:t,y:s,width:i,height:n}){e(this,Cl,"m",Xl).call(this,t,s,i,n)},ef=function(t,e,s,i,{lineWidth:n}){const a=Math.ceil(n/2);return{x:t-s/2-a,y:e-i/2-a,width:s+2*a,height:i+2*a}},sf=function({x:t,y:e,height:s,width:i},{cropTop:n,cropRight:a,cropBottom:r,cropLeft:o}){const h=this.context;h.beginPath(),h.rect(t+o,e+n,i-a,s-r),h.clip()},nf=function({x:t,y:e,height:s,width:i},{rotationCropTop:n,rotationCropRight:a,rotationCropBottom:r,rotationCropLeft:o}){const h=this.context;h.beginPath(),h.rect(-i/2+o,-s/2+n,i-o-a,s-n-r),h.clip()},af=function(t,e){4===t.length&&(t="#"+[...t.slice(1)].map((t=>t+t)).join(""));const s=parseInt(t.slice(1,3),16),i=parseInt(t.slice(3,5),16),n=parseInt(t.slice(5,7),16),a=t=>Math.round(t*e);return`rgb(${a(s)}, ${a(i)}, ${a(n)})`},rf=function(t){return e(this,Cl,"m",af).call(this,this.colors[t],1)},of=function({lineWidth:t,fillColorIndex:s,lineColorIndex:i}){this.context.fillStyle=e(this,Cl,"m",rf).call(this,s),this.context.strokeStyle=e(this,Cl,"m",rf).call(this,i),this.context.lineWidth=t},hf=function(t,s,i,n,a){e(this,Cl,"m",of).call(this,a),e(this,Cl,"m",Yl).call(this);const r=e(this,Cl,"m",ef).call(this,t,s,i,n,a);e(this,Zl,"f")&&e(this,Cl,"m",tf).call(this,r);const o=e(this,Cl,"m",Ql).call(this,r,a.rotation);e(this,Cl,"m",sf).call(this,o,a),e(this,Cl,"m",Kl).call(this,t,s,a.rotation),e(this,Cl,"m",nf).call(this,r,a);const h=-i/2,c=-n/2;this.context.fillRect(h,c,i,n),a.lineWidth>0&&this.context.strokeRect(h,c,i,n),e(this,Cl,"m",Jl).call(this)},cf=function(t,s,i,n,a,r){e(this,Cl,"m",of).call(this,r),e(this,Cl,"m",Yl).call(this);const o=e(this,Cl,"m",ef).call(this,t,s,i,n,r);e(this,Zl,"f")&&e(this,Cl,"m",tf).call(this,o);const h=e(this,Cl,"m",Ql).call(this,o,r.rotation);e(this,Cl,"m",sf).call(this,h,r),e(this,Cl,"m",Kl).call(this,t,s,r.rotation),e(this,Cl,"m",nf).call(this,o,r);const c=-i/2,l=-n/2;this.context.beginPath(),this.context.roundRect(c,l,i,n,a),this.context.fill(),r.lineWidth>0&&this.context.stroke(),e(this,Cl,"m",Jl).call(this)},lf=function(t,s,i,n){const a=2*i;return e(this,Cl,"m",ef).call(this,t,s,a,a,n)},ff=function(t,s,i,n){e(this,Cl,"m",of).call(this,n),e(this,Cl,"m",Yl).call(this);const a=e(this,Cl,"m",lf).call(this,t,s,i,n);e(this,Zl,"f")&&e(this,Cl,"m",tf).call(this,a),e(this,Cl,"m",sf).call(this,a,n),e(this,Cl,"m",Kl).call(this,t,s,n.rotation),e(this,Cl,"m",nf).call(this,a,n),this.context.beginPath(),this.context.arc(0,0,i,0,2*Math.PI),this.context.fill(),n.lineWidth&&this.context.stroke(),e(this,Cl,"m",Jl).call(this)},gf=function(t,s,i,n,a){const r=2*i,o=2*n;return e(this,Cl,"m",ef).call(this,t,s,r,o,a)},df=function(t,s,i,n,a){e(this,Cl,"m",of).call(this,a),e(this,Cl,"m",Yl).call(this);const r=e(this,Cl,"m",gf).call(this,t,s,i,n,a);e(this,Zl,"f")&&e(this,Cl,"m",tf).call(this,r);const o=e(this,Cl,"m",Ql).call(this,r,a.rotation);e(this,Cl,"m",sf).call(this,o,a),e(this,Cl,"m",Kl).call(this,t,s,a.rotation),e(this,Cl,"m",nf).call(this,r,a),this.context.beginPath(),this.context.ellipse(0,0,i,n,0,0,2*Math.PI),this.context.fill(),a.lineWidth>0&&this.context.stroke(),e(this,Cl,"m",Jl).call(this)},uf=function(t,e,s,i,{lineWidth:n}){let a=Math.ceil(n/2);const r=1/Math.cos(Math.PI/i);a=Math.ceil(a*r);const o=2*s;return{x:t-s-a,y:e-s-a,width:o+2*a,height:o+2*a}},pf=function(t,s,i,n,a){e(this,Cl,"m",of).call(this,a),e(this,Cl,"m",Yl).call(this);const r=e(this,Cl,"m",uf).call(this,t,s,i,n,a);e(this,Zl,"f")&&e(this,Cl,"m",tf).call(this,r),e(this,Cl,"m",sf).call(this,r,a),e(this,Cl,"m",Kl).call(this,t,s,a.rotation),e(this,Cl,"m",nf).call(this,r,a),this.context.beginPath();const o=2*Math.PI/n;for(let t=0;t<n;t++){const e=t*o,s=i*Math.cos(e),n=i*Math.sin(e);0===t?this.context.moveTo(s,n):this.context.lineTo(s,n)}this.context.closePath(),this.context.fill(),a.lineWidth>0&&this.context.stroke(),e(this,Cl,"m",Jl).call(this)},mf=function(t,e,s,i,{lineWidth:n,segmentStartRadius:a,segmentEndRadius:r}){const o=Math.ceil(n/2),h=a+o,c=r+o;Mf.log({segmentStartFullRadius:h,segmentEndFullRadius:c});const l=Math.min(t-h,s-c),f=Math.max(t+h,s+c),g=Math.min(e-h,i-c),d=Math.max(e+h,i+c);Mf.log("segmentBounds",{minX:l,minY:g,maxX:f,maxY:d});const u={x:l,y:g,width:f-l,height:d-g};return Mf.log("getSegmentBoundingBox",u),u},vf=function(t,e,s,i,{lineWidth:n,segmentStartRadius:a,segmentEndRadius:r,segmentEndCap:o,segmentStartCap:h}){const c=Math.ceil(n/2),l="round"==h?a+c:c,f="round"==o?r+c:c,g=function(t){return function(t,e){let{x:s,y:i}=t;return s*=e,i*=e,{x:s,y:i}}(t,1/Xt(t))}({x:s-t,y:i-e}),d=t-g.x*l,u=e-g.y*l;return{x:(d+(s+g.x*f))/2,y:(u+(i+g.y*f))/2}},yf=function(t,e,s,i,{lineWidth:n,segmentStartRadius:a,segmentEndRadius:r,segmentEndCap:o,segmentStartCap:h}){const c=Math.ceil(n/2),l="round"==h?a+c:c,f="round"==o?r+c:c,g=Xt({x:s-t,y:i-e})+l+f,d=2*(Math.max(a,r)+c);return{x:-d/2,y:-g/2,width:d,height:g}},wf=function(t,s,i,n,a){let r=function(t){const{x:e,y:s}=t;return Math.atan2(s,e)}({x:i-t,y:n-s});r-=Math.PI/2,Mf.log({segmentRotation:r});const o=e(this,Cl,"m",vf).call(this,t,s,i,n,a);this.context.translate(o.x,o.y),this.context.rotate(r);const h=e(this,Cl,"m",yf).call(this,t,s,i,n,a);e(this,Cl,"m",nf).call(this,h,a),this.context.resetTransform()},bf=function(t,s,i,n,a){e(this,Cl,"m",of).call(this,a),Mf.log("drawSegmentToCanvas",{startX:t,startY:s,endX:i,endY:n}),e(this,Cl,"m",Yl).call(this);const r=e(this,Cl,"m",mf).call(this,t,s,i,n,a);e(this,Zl,"f")&&e(this,Cl,"m",tf).call(this,r),e(this,Cl,"m",sf).call(this,r,a),e(this,Cl,"m",wf).call(this,t,s,i,n,a);const o=t,h=i,c=s,l=n,f=a.segmentStartRadius,g=a.segmentEndRadius,d=h-o,u=l-c,p=Math.sqrt(d*d+u*u);if(0===p)return;const m=d/p,v=-(u/p),y=o+v*f,w=c+m*f,b=o-v*f,C=c-m*f,S=h+v*g,E=l+m*g,M=h-v*g,D=l-m*g;"round"==a.segmentStartCap&&(this.context.beginPath(),this.context.arc(o,c,f,0,2*Math.PI),this.context.closePath(),this.context.fill(),a.lineWidth>0&&this.context.stroke()),"round"==a.segmentEndCap&&(this.context.beginPath(),this.context.arc(h,l,g,0,2*Math.PI),this.context.closePath(),this.context.fill(),a.lineWidth>0&&this.context.stroke()),this.context.beginPath(),this.context.moveTo(y,w),this.context.lineTo(S,E),this.context.lineTo(M,D),this.context.lineTo(b,C),this.context.closePath(),this.context.fill(),a.lineWidth>0&&(this.context.beginPath(),this.context.moveTo(y,w),this.context.lineTo(S,E),"flat"===a.segmentEndCap?this.context.lineTo(M,D):this.context.moveTo(M,D),this.context.lineTo(b,C),"flat"===a.segmentStartCap&&"flat"===a.segmentEndCap?this.context.closePath():"flat"===a.segmentStartCap&&(this.context.lineTo(y,w),this.context.lineTo(S,E)),this.context.stroke()),e(this,Cl,"m",Jl).call(this)},Ef=function(t){this.device?.isConnected&&(Mf.log("updateDeviceBrightness"),this.device?.setDisplayBrightness(this.brightness,t))};const Lf=T("DevicePairPressureSensorDataManager",{log:!1});class Uf{constructor(){kf.add(this),Wf.set(this,{}),Tf.set(this,new he),Rf.set(this,new se),this.resetPressureRange()}resetPressureRange(){e(this,Tf,"f").reset(),e(this,Rf,"f").reset()}onDevicePressureData(t){const{pressure:s}=t.message,{side:i}=t.target;if(Lf.log({pressure:s,side:i}),e(this,Wf,"f")[i]=s,e(this,kf,"a",xf))return e(this,kf,"m",If).call(this);Lf.log("doesn't have all pressure data yet...")}}var Af;Wf=new WeakMap,Tf=new WeakMap,Rf=new WeakMap,kf=new WeakSet,xf=function(){return In.every((t=>t in e(this,Wf,"f")))},If=function(){const t={scaledSum:0,normalizedSum:0,sensors:{left:[],right:[]}};return In.forEach((s=>{const i=e(this,Wf,"f")[s];t.scaledSum+=i.scaledSum})),t.normalizedSum+=e(this,Rf,"f").updateAndGetNormalization(t.scaledSum,!1),t.scaledSum>0&&(t.center={x:0,y:0},In.forEach((s=>{e(this,Wf,"f")[s].sensors.forEach((e=>{const i={...e};i.weightedValue=e.scaledValue/t.scaledSum;let{x:n,y:a}=e.position;n/=2,"right"==s&&(n+=.5),i.position={x:n,y:a},t.center.x+=i.position.x*i.weightedValue,t.center.y+=i.position.y*i.weightedValue,t.sensors[s].push(i)}))})),t.normalizedCenter=e(this,Tf,"f").updateAndGetNormalization(t.center,!1)),Lf.log({devicePairPressure:t}),t};const Ff=T("DevicePairSensorDataManager",{log:!1}),_f=["pressure","sensorData"];class Bf{constructor(){Af.set(this,{}),this.pressureSensorDataManager=new Uf}get dispatchEvent(){return this.eventDispatcher.dispatchEvent}resetPressureRange(){this.pressureSensorDataManager.resetPressureRange()}onDeviceSensorData(t){const{timestamp:s,sensorType:i}=t.message;let n;if(Ff.log({sensorType:i,timestamp:s,event:t}),e(this,Af,"f")[i]||(e(this,Af,"f")[i]={}),e(this,Af,"f")[i][t.target.side]=s,"pressure"===i)n=this.pressureSensorDataManager.onDevicePressureData(t);else Ff.log(`uncaught sensorType "${i}"`);if(n){const t=Object.assign({},e(this,Af,"f")[i]);this.dispatchEvent(i,{sensorType:i,timestamps:t,[i]:n}),this.dispatchEvent("sensorData",{sensorType:i,timestamps:t,[i]:n})}else Ff.log("no value received")}}var $f,Of,Pf,Nf,Vf,qf,zf,jf,Gf,Hf,Xf,Yf,Jf,Kf,Qf,Zf,tg,eg,sg;Af=new WeakMap;const ig=T("DevicePair",{log:!1});function ng(t){return`device${e=t,e[0].toUpperCase()+e.slice(1)}`;var e}const ag=["isConnected",..._f,...yl.map((t=>ng(t)))];class rg{constructor(t){$f.add(this),Pf.set(this,void 0),Nf.set(this,new x(this,ag)),qf.set(this,void 0),zf.set(this,void 0),Yf.set(this,{isConnected:e(this,$f,"m",Kf).bind(this),sensorData:e(this,$f,"m",tg).bind(this),getType:e(this,$f,"m",Qf).bind(this)}),Zf.set(this,new Bf),s(this,Pf,t,"f"),e(this,Zf,"f").eventDispatcher=e(this,Nf,"f")}get sides(){return In}get type(){return e(this,Pf,"f")}get addEventListener(){return e(this,Nf,"f").addEventListener}get removeEventListener(){return e(this,Nf,"f").removeEventListener}get waitForEvent(){return e(this,Nf,"f").waitForEvent}get removeEventListeners(){return e(this,Nf,"f").removeEventListeners}get removeAllEventListeners(){return e(this,Nf,"f").removeAllEventListeners}get left(){return e(this,qf,"f")}get right(){return e(this,zf,"f")}get isConnected(){return In.every((t=>this[t]?.isConnected))}get isPartiallyConnected(){return In.some((t=>this[t]?.isConnected))}get isHalfConnected(){return this.isPartiallyConnected&&!this.isConnected}assignDevice(t){if(!e(this,$f,"m",jf).call(this,t))return void ig.log(`device is incorrect type ${t.type} for ${this.type} devicePair`);const i=t.side,n=this[i];if(t!=n){switch(n&&e(this,$f,"m",Hf).call(this,n),e(this,$f,"m",Gf).call(this,t),i){case"left":s(this,qf,t,"f");break;case"right":s(this,zf,t,"f")}return ig.log(`assigned ${i} ${this.type} device`,t),this.resetPressureRange(),e(this,$f,"a",Vf).call(this,"isConnected",{isConnected:this.isConnected}),e(this,$f,"a",Vf).call(this,"deviceIsConnected",{device:t,isConnected:t.isConnected,side:i}),n}ig.log("device already assigned")}async setSensorConfiguration(t){for(let e=0;e<In.length;e++){const s=In[e];this[s]?.isConnected&&await this[s].setSensorConfiguration(t)}}resetPressureRange(){In.forEach((t=>this[t]?.resetPressureRange())),e(this,Zf,"f").resetPressureRange()}async triggerVibration(t,e){const s=In.map((s=>this[s]?.triggerVibration(t,e))).filter(Boolean);return Promise.allSettled(s)}static get insoles(){return e(this,Of,"f",eg)}static get gloves(){return e(this,Of,"f",sg)}}var og,hg,cg,lg,fg;Of=rg,Pf=new WeakMap,Nf=new WeakMap,qf=new WeakMap,zf=new WeakMap,Yf=new WeakMap,Zf=new WeakMap,$f=new WeakSet,Vf=function(){return e(this,Nf,"f").dispatchEvent},jf=function(t){switch(this.type){case"insoles":return t.isInsole;case"gloves":return t.isGlove}},Gf=function(t){no(t,e(this,Yf,"f")),yl.forEach((s=>{t.addEventListener(s,e(this,$f,"m",Jf).bind(this))}))},Hf=function(t){ao(t,e(this,Yf,"f")),yl.forEach((s=>{t.removeEventListener(s,e(this,$f,"m",Jf).bind(this))}))},Xf=function(t){const i=In.some((i=>{if(this[i]!=t)return!1;switch(ig.log(`removing ${i} ${this.type} device`,t),ao(t,e(this,Yf,"f")),i){case"left":s(this,qf,void 0,"f");break;case"right":s(this,zf,void 0,"f")}return!0}));return i&&e(this,$f,"a",Vf).call(this,"isConnected",{isConnected:this.isConnected}),i},Jf=function(t){const{type:s,target:i,message:n}=t;e(this,$f,"a",Vf).call(this,ng(s),{...n,device:i,side:i.side})},Kf=function(t){e(this,$f,"a",Vf).call(this,"isConnected",{isConnected:this.isConnected})},Qf=function(t){const{target:s}=t;if(this[s.side]==s)return;e(this,$f,"m",Xf).call(this,s)&&this.assignDevice(s)},tg=function(t){this.isConnected&&e(this,Zf,"f").onDeviceSensorData(t)},eg={value:new Of("insoles")},sg={value:new Of("gloves")},Yh.AddEventListener("deviceConnected",(t=>{const{device:s}=t.message;s.isInsole&&e(Of,Of,"f",eg).assignDevice(s),s.isGlove&&e(Of,Of,"f",sg).assignDevice(s)}));const gg=T("ClientConnectionManager",{log:!0});class dg extends so{constructor(){super(...arguments),og.add(this),hg.set(this,void 0),cg.set(this,!1)}static get isSupported(){return n}static get type(){return"client"}get canUpdateFirmware(){return!1}get bluetoothId(){return e(this,hg,"f")}set bluetoothId(t){gg.assertTypeWithError(t,"string"),e(this,hg,"f")!=t?s(this,hg,t,"f"):gg.log("redundant bluetoothId assignment")}get isConnected(){return e(this,cg,"f")}set isConnected(t){gg.assertTypeWithError(t,"boolean"),e(this,cg,"f")!=t?(s(this,cg,t,"f"),this.status=e(this,cg,"f")?"connected":"notConnected",this.isConnected&&e(this,og,"m",lg).call(this)):gg.log("redundant newIsConnected assignment",t)}get isAvailable(){return this.client.isConnected}async connect(){await super.connect(),this.sendClientConnectMessage(this.subType)}async disconnect(){await super.disconnect(),this.sendClientDisconnectMessage()}get canReconnect(){return!0}async reconnect(){await super.reconnect(),this.sendClientConnectMessage()}async sendSmpMessage(t){super.sendSmpMessage(t),this.sendClientMessage({type:"smp",data:t})}async sendTxData(t){super.sendTxData(t),0!=t.byteLength&&this.sendClientMessage({type:"tx",data:t})}onClientMessage(t){gg.log({dataView:t}),De(t,yl,e(this,og,"m",fg).bind(this),null,!0),this.onMessagesReceived()}}var ug,pg,mg,vg,yg,wg,bg,Cg,Sg,Eg,Mg,Dg,kg,Wg,Tg,Rg,xg,Ig,Lg,Ug,Ag,Fg,_g,Bg;hg=new WeakMap,cg=new WeakMap,og=new WeakSet,lg=function(){this.sendRequiredDeviceInformationMessage()},fg=function(t,e){let s=0;switch(gg.log({messageType:t},e),t){case"isConnected":const i=Boolean(e.getUint8(s++));gg.log({isConnected:i}),this.isConnected=i;break;case"rx":this.parseRxMessage(e);break;default:this.onMessageReceived(t,e)}};const $g=T("BaseClient",{log:!0}),Og=["notConnected","connecting","connected","disconnecting","connectionStatus","isConnected","isScanningAvailable","isScanning","discoveredDevice","expiredDiscoveredDevice"];class Pg{constructor(){ug.add(this),vg.set(this,{}),yg.set(this,new x(this,Og)),this._reconnectOnDisconnection=this.baseConstructor.ReconnectOnDisconnection,wg.set(this,"notConnected"),Sg.set(this,[]),Dg.set(this,!1),Rg.set(this,!1),Fg.set(this,{})}get baseConstructor(){return this.constructor}get devices(){return e(this,vg,"f")}get addEventListener(){return e(this,yg,"f").addEventListener}get dispatchEvent(){return e(this,yg,"f").dispatchEvent}get removeEventListener(){return e(this,yg,"f").removeEventListener}get waitForEvent(){return e(this,yg,"f").waitForEvent}assertConnection(){$g.assertWithError(this.isConnected,"notConnected")}assertDisconnection(){$g.assertWithError(this.isDisconnected,"not disconnected")}static get ReconnectOnDisconnection(){return this._reconnectOnDisconnection}static set ReconnectOnDisconnection(t){$g.assertTypeWithError(t,"boolean"),this._reconnectOnDisconnection=t}get reconnectOnDisconnection(){return this._reconnectOnDisconnection}set reconnectOnDisconnection(t){$g.assertTypeWithError(t,"boolean"),this._reconnectOnDisconnection=t}get _connectionStatus(){return e(this,wg,"f")}set _connectionStatus(t){switch($g.assertTypeWithError(t,"string"),$g.log({newConnectionStatus:t}),s(this,wg,t,"f"),this.dispatchEvent("connectionStatus",{connectionStatus:this.connectionStatus}),this.dispatchEvent(this.connectionStatus,{}),t){case"connected":case"notConnected":this.dispatchEvent("isConnected",{isConnected:this.isConnected}),this.isConnected||e(this,ug,"m",mg).call(this)}}get connectionStatus(){return this._connectionStatus}_sendRequiredMessages(){$g.log("sending required messages",e(this,Sg,"f")),this.sendServerMessage(...e(this,ug,"a",Cg))}parseMessage(t){$g.log("parseMessage",{dataView:t}),De(t,Kh,e(this,ug,"m",Mg).bind(this),null,!0),e(this,ug,"m",Eg).call(this)}get isScanningAvailable(){return e(this,ug,"a",kg)}requestIsScanningAvailable(){this.sendServerMessage("isScanningAvailable")}get isScanning(){return e(this,ug,"a",xg)}startScan(){e(this,ug,"m",Ag).call(this),this.sendServerMessage("startScan")}stopScan(){e(this,ug,"m",Ug).call(this),this.sendServerMessage("stopScan")}toggleScan(){e(this,ug,"m",Tg).call(this),this.isScanning?this.stopScan():this.startScan()}get discoveredDevices(){return e(this,Fg,"f")}onDiscoveredDevice(t){$g.log({discoveredDevice:t}),e(this,Fg,"f")[t.bluetoothId]=t,this.dispatchEvent("discoveredDevice",{discoveredDevice:t})}requestDiscoveredDevices(){this.sendServerMessage({type:"discoveredDevices"})}connectToDevice(t,e){return this.requestConnectionToDevice(t,e)}requestConnectionToDevice(t,s){this.assertConnection(),$g.assertTypeWithError(t,"string");const i=e(this,ug,"m",Bg).call(this,t);return s?i.connect({type:"client",subType:s}):i.connect(),i}sendConnectToDeviceMessage(t,e){e?this.sendServerMessage({type:"connectToDevice",data:z(j(t),Yr.indexOf(e))}):this.sendServerMessage({type:"connectToDevice",data:t})}createDevice(t){const s=new bl,i=e(this,Fg,"f")[t],n=new dg;return n.discoveredDevice=Object.assign({},i),n.client=this,n.bluetoothId=t,n.sendClientMessage=this.sendDeviceMessage.bind(this,t),n.sendRequiredDeviceInformationMessage=this.sendRequiredDeviceInformationMessage.bind(this,t),n.sendClientConnectMessage=this.sendConnectToDeviceMessage.bind(this,t),n.sendClientDisconnectMessage=this.sendDisconnectFromDeviceMessage.bind(this,t),s.connectionManager=n,s}onConnectedBluetoothDeviceIds(t){$g.log({bluetoothIds:t}),t.forEach((t=>{const s=e(this,ug,"m",Bg).call(this,t);s.connectionManager.isConnected=!0,Yh._CheckDeviceAvailability(s)}))}disconnectFromDevice(t){this.requestDisconnectionFromDevice(t)}requestDisconnectionFromDevice(t){this.assertConnection(),$g.assertTypeWithError(t,"string");const e=this.devices[t];return $g.assertWithError(e,`no device found with id ${t}`),e.disconnect(),e}sendDisconnectFromDeviceMessage(t){this.sendServerMessage({type:"disconnectFromDevice",data:t})}sendDeviceMessage(t,...e){this.sendServerMessage({type:"deviceMessage",data:[t,tc(...e)]})}sendRequiredDeviceInformationMessage(t){this.sendServerMessage({type:"requiredDeviceInformation",data:[t]})}}var Ng,Vg,qg,zg,jg,Gg,Hg,Xg,Yg,Jg,Kg,Qg,Zg;pg=Pg,vg=new WeakMap,yg=new WeakMap,wg=new WeakMap,Sg=new WeakMap,Dg=new WeakMap,Rg=new WeakMap,Fg=new WeakMap,ug=new WeakSet,mg=function(){s(this,ug,!1,"a",Wg),s(this,ug,!1,"a",Ig);for(const t in e(this,vg,"f")){e(this,vg,"f")[t].connectionManager.isConnected=!1}e(this,Sg,"f").length=0},Cg=function(){return e(pg,pg,"f",bg)},Eg=function(){"connecting"==this.connectionStatus&&($g.log("checking if fully connected..."),e(this,Sg,"f").includes("isScanningAvailable")?!this.isScanningAvailable||e(this,Sg,"f").includes("isScanning")?($g.log("fully connected"),this._connectionStatus="connected"):$g.log("not fully connected - didn't receive isScanning"):$g.log("not fully connected - didn't receive isScanningAvailable"))},Mg=function(t,i){let n=0;switch($g.log({messageType:t},i),t){case"isScanningAvailable":{const t=Boolean(i.getUint8(n++));$g.log({isScanningAvailable:t}),s(this,ug,t,"a",Wg)}break;case"isScanning":{const t=Boolean(i.getUint8(n++));$g.log({isScanning:t}),s(this,ug,t,"a",Ig)}break;case"discoveredDevice":{const{string:t}=Me(i,n);$g.log({discoveredDeviceString:t});const e=JSON.parse(t);$g.log({discoveredDevice:e}),this.onDiscoveredDevice(e)}break;case"expiredDiscoveredDevice":{const{string:t}=Me(i,n);e(this,ug,"m",_g).call(this,t)}break;case"connectedDevices":{if(0==i.byteLength)break;const{string:t}=Me(i,n);$g.log({connectedBluetoothDeviceIdStrings:t});const e=JSON.parse(t).connectedDevices;$g.log({connectedBluetoothDeviceIds:e}),this.onConnectedBluetoothDeviceIds(e)}break;case"deviceMessage":{const{string:t,byteOffset:s}=Me(i,n);n=s;const a=e(this,vg,"f")[t];$g.assertWithError(a,`no device found for id ${t}`);const r=a.connectionManager,o=G(i,n);r.onClientMessage(o)}break;default:$g.error(`uncaught messageType "${t}"`)}"connecting"==this.connectionStatus&&e(this,Sg,"f").push(t)},kg=function(){return e(this,Dg,"f")},Wg=function(t){$g.assertTypeWithError(t,"boolean"),s(this,Dg,t,"f"),this.dispatchEvent("isScanningAvailable",{isScanningAvailable:this.isScanningAvailable}),this.isScanningAvailable&&e(this,ug,"m",Lg).call(this)},Tg=function(){this.assertConnection(),$g.assertWithError(this.isScanningAvailable,"scanning is not available")},xg=function(){return e(this,Rg,"f")},Ig=function(t){$g.assertTypeWithError(t,"boolean"),s(this,Rg,t,"f"),this.dispatchEvent("isScanning",{isScanning:this.isScanning})},Lg=function(){this.sendServerMessage("isScanning")},Ug=function(){$g.assertWithError(this.isScanning,"is not scanning")},Ag=function(){$g.assertWithError(!this.isScanning,"is already scanning")},_g=function(t){$g.log({expiredBluetoothDeviceId:t});const s=e(this,Fg,"f")[t];s?($g.log({expiredDiscoveredDevice:s}),delete e(this,Fg,"f")[t],this.dispatchEvent("expiredDiscoveredDevice",{discoveredDevice:s})):$g.warn(`no discoveredDevice found with id "${t}"`)},Bg=function(t){let s=e(this,vg,"f")[t];return s||(s=this.createDevice(t),e(this,vg,"f")[t]=s),s},Pg._reconnectOnDisconnection=!0,bg={value:["isScanningAvailable","discoveredDevices","connectedDevices"]};const td=T("WebSocketClient",{log:!1});Vg=new WeakMap,zg=new WeakMap,Kg=new WeakMap,Ng=new WeakSet,qg=function(...t){this.sendMessage(ic(...t))},jg=function(t){td.log("webSocket.open",t),e(this,Kg,"f").start(),this._sendRequiredMessages()},Gg=async function(t){td.log("webSocket.message",t);const s=await t.data.arrayBuffer(),i=new DataView(s);e(this,Ng,"m",Yg).call(this,i)},Hg=function(t){td.log("webSocket.close",t),this._connectionStatus="notConnected",Object.entries(this.devices).forEach((([t,e])=>{e.connectionManager.isConnected=!1})),e(this,Kg,"f").stop(),this.reconnectOnDisconnection&&setTimeout((()=>{this.reconnect()}),3e3)},Xg=function(t){td.error("webSocket.error",t)},Yg=function(t){De(t,sc,e(this,Ng,"m",Jg).bind(this),null,!0)},Jg=function(t,s){switch(t){case"ping":e(this,Ng,"m",Zg).call(this);break;case"pong":break;case"serverMessage":this.parseMessage(s);break;default:td.error(`uncaught messageType "${t}"`)}},Qg=function(){e(this,Ng,"m",qg).call(this,"ping")},Zg=function(){e(this,Ng,"m",qg).call(this,"pong")};const ed={addEventListeners:no,removeEventListeners:ao},sd={throttle:function(t,e,s=!1){let i=0,n=null,a=null;return function(...r){const o=Date.now(),h=e-(o-i);h<=0?(n&&(clearTimeout(n),n=null),i=o,t(...r)):s&&(a=r,n||(n=setTimeout((()=>{i=Date.now(),n=null,a&&(t(...a),a=null)}),h)))}},debounce:function(t,e,s=!1){let i=null;return function(...n){const a=s&&!i;i&&clearTimeout(i),i=setTimeout((()=>{i=null,s||t(...n)}),e),a&&t(...n)}}};t.CameraCommands=ss,t.CameraConfigurationTypes=as,t.ContinuousSensorTypes=Ys,t.DefaultNumberOfPressureSensors=8,t.Device=bl,t.DeviceManager=Yh,t.DevicePair=rg,t.DevicePairTypes=["insoles","gloves"],t.DeviceTypes=xn,t.DisplayBrightnesses=Wr,t.DisplayCanvasHelper=class{constructor(){Cl.add(this),Sl.set(this,new x(this,Df)),Ml.set(this,void 0),Dl.set(this,void 0),Wl.set(this,[]),Tl.set(this,[]),Ll.set(this,!1),Ul.set(this,void 0),Al.set(this,{connected:e(this,Cl,"m",Fl).bind(this),notConnected:e(this,Cl,"m",_l).bind(this)}),$l.set(this,0),Pl.set(this,[]),Vl.set(this,[]),zl.set(this,new $a),Zl.set(this,!0),Cf.set(this,"medium"),Sf.set(this,{veryLow:.5,low:.7,medium:.9,high:.95,veryHigh:1}),this.numberOfColors=16}get addEventListener(){return e(this,Sl,"f").addEventListener}get removeEventListener(){return e(this,Sl,"f").removeEventListener}get waitForEvent(){return e(this,Sl,"f").waitForEvent}get removeEventListeners(){return e(this,Sl,"f").removeEventListeners}get removeAllEventListeners(){return e(this,Sl,"f").removeAllEventListeners}get canvas(){return e(this,Ml,"f")}set canvas(t){Mf.assertWithError("CANVAS"==t?.nodeName,`assigned non-canvas type ${t?.nodeName}`),e(this,Ml,"f")!=t?(s(this,Ml,t,"f"),Mf.log("assigned canvas",this.canvas),s(this,Dl,e(this,Ml,"f")?.getContext("2d",{willReadFrequently:!0}),"f"),e(this,Dl,"f").imageSmoothingEnabled=!1,e(this,Cl,"m",kl).call(this)):Mf.log("redundant canvas assignment",t)}get context(){return e(this,Dl,"f")}get width(){return this.canvas?.width||0}get height(){return this.canvas?.height||0}get aspectRatio(){return this.width/this.height}get applyTransparency(){return e(this,Ll,"f")}set applyTransparency(t){s(this,Ll,t,"f"),Mf.log({applyTransparency:this.applyTransparency}),e(this,Cl,"m",Rl).call(this)}get device(){return e(this,Ul,"f")}set device(t){e(this,Ul,"f")!=t?(t&&(Mf.assertWithError(t.isConnected,"device must be connected"),Mf.assertWithError(t.isDisplayAvailable,"display must have a display")),e(this,Ul,"f")&&ao(this.device,e(this,Al,"f")),s(this,Ul,t,"f"),no(e(this,Ul,"f"),e(this,Al,"f")),Mf.log("assigned device",this.device),this.device&&(this.numberOfColors=this.device.numberOfDisplayColors,e(this,Cl,"m",kl).call(this),e(this,Cl,"m",Bl).call(this))):Mf.log("redundant device assignment",t)}get numberOfColors(){return e(this,$l,"f")}set numberOfColors(t){e(this,$l,"f")!=t&&(s(this,$l,t,"f"),Mf.log({numberOfColors:this.numberOfColors}),s(this,Pl,new Array(this.numberOfColors).fill("#000000"),"f"),s(this,Vl,new Array(this.numberOfColors).fill(1),"f"),e(this,Cl,"a",El).call(this,"numberOfColors",{numberOfColors:this.numberOfColors}))}get colors(){return e(this,Pl,"f")}get opacities(){return e(this,Vl,"f")}get contextState(){return e(this,zl,"f").state}showDisplay(t=!0){Mf.log("showDisplay"),s(this,Wl,e(this,Tl,"f").slice(),"f"),e(this,Tl,"f").length=0,e(this,Cl,"m",Rl).call(this),this.device?.isConnected&&this.device.showDisplay(t)}clearDisplay(t=!0){Mf.log("clearDisplay"),this.showDisplay(),e(this,Dl,"f").clearRect(0,0,this.width,this.height),this.device?.isConnected&&this.device.clearDisplay(t),e(this,Cl,"m",Il).call(this)}setColor(t,s,i){"string"==typeof s&&(s=Aa(s));const n=Fa(s);this.colors[t]!=n?(Mf.log(`setting color #${t}`,s),e(this,Cl,"m",Ol).call(this,t),qa(s),this.device?.isConnected&&this.device.setDisplayColor(t,s,i),this.colors[t]=n,e(this,Cl,"m",Rl).call(this),e(this,Cl,"a",El).call(this,"color",{colorIndex:t,colorHex:n,color:s})):Mf.log(`redundant color #${t} ${n}`)}setColorOpacity(t,s,i){e(this,Cl,"m",Ol).call(this,t),za(s),Math.floor(255*e(this,Vl,"f")[t])!=Math.floor(255*s)?(this.device?.isConnected&&this.device.setDisplayColorOpacity(t,s,i),e(this,Vl,"f")[t]=s,e(this,Cl,"m",Rl).call(this),e(this,Cl,"a",El).call(this,"colorOpacity",{colorIndex:t,opacity:s})):Mf.log(`redundant opacity #${t} ${s}`)}setOpacity(t,s){za(t),this.device?.isConnected&&this.device.setDisplayOpacity(t,s),e(this,Vl,"f").fill(t),e(this,Cl,"m",Rl).call(this),e(this,Cl,"a",El).call(this,"opacity",{opacity:t})}selectFillColor(t,s){e(this,Cl,"m",Ol).call(this,t);const i=e(this,zl,"f").update({fillColorIndex:t});0!=i.length&&(this.device?.isConnected&&this.device.selectDisplayFillColor(t,s),e(this,Cl,"m",jl).call(this,i))}selectLineColor(t,s){e(this,Cl,"m",Ol).call(this,t);const i=e(this,zl,"f").update({lineColorIndex:t});0!=i.length&&(this.device?.isConnected&&this.device.selectDisplayLineColor(t,s),e(this,Cl,"m",jl).call(this,i))}setLineWidth(t,s){e(this,Cl,"m",Hl).call(this,t);const i=e(this,zl,"f").update({lineWidth:t});0!=i.length&&(this.device?.isConnected&&this.device.setDisplayLineWidth(t,s),e(this,Cl,"m",jl).call(this,i))}setRotation(t,s,i){t=Kt(t=s?t:Yt(t)),Mf.log({rotation:t});const n=e(this,zl,"f").update({rotation:t});0!=n.length&&(this.device?.isConnected&&this.device.setDisplayRotation(t,!0,i),e(this,Cl,"m",jl).call(this,n))}clearRotation(t){const s=e(this,zl,"f").update({rotation:0});0!=s.length&&(this.device?.isConnected&&this.device.clearDisplayRotation(t),e(this,Cl,"m",jl).call(this,s))}setSegmentStartCap(t,s){Pa(t);const i=e(this,zl,"f").update({segmentStartCap:t});0!=i.length&&(Mf.log({segmentStartCap:t}),this.device?.isConnected&&this.device.setDisplaySegmentStartCap(t,s),e(this,Cl,"m",jl).call(this,i))}setSegmentEndCap(t,s){Pa(t);const i=e(this,zl,"f").update({segmentEndCap:t});0!=i.length&&(Mf.log({segmentEndCap:t}),this.device?.isConnected&&this.device.setDisplaySegmentEndCap(t,s),e(this,Cl,"m",jl).call(this,i))}setSegmentCap(t,s){Pa(t);const i=e(this,zl,"f").update({segmentStartCap:t,segmentEndCap:t});0!=i.length&&(Mf.log({segmentCap:t}),this.device?.isConnected&&this.device.setDisplaySegmentCap(t,s),e(this,Cl,"m",jl).call(this,i))}setSegmentStartRadius(t,s){const i=e(this,zl,"f").update({segmentStartRadius:t});0!=i.length&&(Mf.log({segmentStartRadius:t}),this.device?.isConnected&&this.device.setDisplaySegmentStartRadius(t,s),e(this,Cl,"m",jl).call(this,i))}setSegmentEndRadius(t,s){const i=e(this,zl,"f").update({segmentEndRadius:t});0!=i.length&&(Mf.log({segmentEndRadius:t}),this.device?.isConnected&&this.device.setDisplaySegmentEndRadius(t,s),e(this,Cl,"m",jl).call(this,i))}setSegmentRadius(t,s){const i=e(this,zl,"f").update({segmentStartRadius:t,segmentEndRadius:t});0!=i.length&&(Mf.log({segmentRadius:t}),this.device?.isConnected&&this.device.setDisplaySegmentRadius(t,s),e(this,Cl,"m",jl).call(this,i))}setCrop(t,s,i){Mf.assertEnumWithError(t,ja),s=Math.max(0,s);const n=Ha[t],a=Ga[t],r=e(this,zl,"f").update({[a]:s});0!=r.length&&(Mf.log({[n]:s}),this.device?.isConnected&&this.device.setDisplayCrop(t,s,i),e(this,Cl,"m",jl).call(this,r))}setCropTop(t,e){this.setCrop("top",t,e)}setCropRight(t,e){this.setCrop("right",t,e)}setCropBottom(t,e){this.setCrop("bottom",t,e)}setCropLeft(t,e){this.setCrop("left",t,e)}clearCrop(t){const s=e(this,zl,"f").update({cropTop:0,cropRight:0,cropBottom:0,cropLeft:0});0!=s.length&&(this.device?.isConnected&&this.device.clearDisplayCrop(t),e(this,Cl,"m",jl).call(this,s))}setRotationCrop(t,s,i){Mf.assertEnumWithError(t,ja);const n=Ya[t],a=Xa[t],r=e(this,zl,"f").update({[a]:s});0!=r.length&&(Mf.log({[n]:s}),this.device?.isConnected&&this.device.setDisplayRotationCrop(t,s,i),e(this,Cl,"m",jl).call(this,r))}setRotationCropTop(t,e){this.setRotationCrop("top",t,e)}setRotationCropRight(t,e){this.setRotationCrop("right",t,e)}setRotationCropBottom(t,e){this.setRotationCrop("bottom",t,e)}setRotationCropLeft(t,e){this.setRotationCrop("left",t,e)}clearRotationCrop(t){const s=e(this,zl,"f").update({rotationCropTop:0,rotationCropRight:0,rotationCropBottom:0,rotationCropLeft:0});0!=s.length&&(this.device?.isConnected&&this.device.clearDisplayRotationCrop(t),e(this,Cl,"m",jl).call(this,s))}clearRect(t,s,i,n,a){e(this,Tl,"f").push((()=>e(this,Cl,"m",Xl).call(this,t,s,i,n))),this.device?.isConnected&&this.device.clearDisplayRect(t,s,i,n,a)}drawRect(t,s,i,n,a){const r={...this.contextState};e(this,Tl,"f").push((()=>e(this,Cl,"m",hf).call(this,t,s,i,n,r))),this.device?.isConnected&&this.device.drawDisplayRect(t,s,i,n,a)}drawRoundRect(t,s,i,n,a,r){const o={...this.contextState};e(this,Tl,"f").push((()=>e(this,Cl,"m",cf).call(this,t,s,i,n,a,o))),this.device?.isConnected&&this.device.drawDisplayRoundRect(t,s,i,n,a,r)}drawCircle(t,s,i,n){const a={...this.contextState};e(this,Tl,"f").push((()=>e(this,Cl,"m",ff).call(this,t,s,i,a))),this.device?.isConnected&&this.device.drawDisplayCircle(t,s,i,n)}drawEllipse(t,s,i,n,a){const r={...this.contextState};e(this,Tl,"f").push((()=>e(this,Cl,"m",df).call(this,t,s,i,n,r))),this.device?.isConnected&&this.device.drawDisplayEllipse(t,s,i,n,a)}drawPolygon(t,s,i,n,a){if(n<3)return void Mf.error(`invalid numberOfSides ${n}`);const r={...this.contextState};e(this,Tl,"f").push((()=>e(this,Cl,"m",pf).call(this,t,s,i,n,r))),this.device?.isConnected&&this.device.drawDisplayPolygon(t,s,i,n,a)}drawSegment(t,s,i,n,a){if(t==i&&s==n)return void Mf.error("cannot draw segment of length 0");const r={...this.contextState};e(this,Tl,"f").push((()=>e(this,Cl,"m",bf).call(this,t,s,i,n,r))),this.device?.isConnected&&this.device.drawDisplaySegment(t,s,i,n,a)}get brightness(){return e(this,Cf,"f")}setBrightness(t,i){e(this,Cf,"f")!=t?(s(this,Cf,t,"f"),Mf.log({brightness:this.brightness}),this.device?.isConnected&&this.device.setDisplayBrightness(t,i),e(this,Cl,"m",Rl).call(this),e(this,Cl,"a",El).call(this,"brightness",{brightness:this.brightness})):Mf.log(`redundant brightness ${t}`)}},t.DisplaySegmentCaps=Rr,t.Environment=w,t.EventUtils=ed,t.FileTransferDirections=["sending","receiving"],t.FileTypes=Ot,t.MaxNameLength=30,t.MaxNumberOfVibrationWaveformEffectSegments=8,t.MaxNumberOfVibrationWaveformSegments=20,t.MaxSensorRate=65535,t.MaxVibrationWaveformEffectSegmentDelay=oa,t.MaxVibrationWaveformEffectSegmentLoopCount=3,t.MaxVibrationWaveformEffectSequenceLoopCount=6,t.MaxVibrationWaveformSegmentDuration=ra,t.MaxWifiPasswordLength=64,t.MaxWifiSSIDLength=32,t.MicrophoneCommands=Bs,t.MicrophoneConfigurationTypes=Os,t.MicrophoneConfigurationValues=Vs,t.MinNameLength=2,t.MinWifiPasswordLength=8,t.MinWifiSSIDLength=1,t.RangeHelper=se,t.SensorRateStep=5,t.SensorTypes=Xs,t.Sides=In,t.TfliteSensorTypes=Zi,t.TfliteTasks=Qi,t.ThrottleUtils=sd,t.VibrationLocations=sa,t.VibrationTypes=ia,t.VibrationWaveformEffects=Fn,t.WebSocketClient=class extends Pg{constructor(){super(...arguments),Ng.add(this),Vg.set(this,void 0),zg.set(this,{open:e(this,Ng,"m",jg).bind(this),message:e(this,Ng,"m",Gg).bind(this),close:e(this,Ng,"m",Hg).bind(this),error:e(this,Ng,"m",Xg).bind(this)}),Kg.set(this,new F(e(this,Ng,"m",Qg).bind(this),3e4))}get webSocket(){return e(this,Vg,"f")}set webSocket(t){e(this,Vg,"f")!=t?(td.log("assigning webSocket",t),e(this,Vg,"f")&&ao(e(this,Vg,"f"),e(this,zg,"f")),no(t,e(this,zg,"f")),s(this,Vg,t,"f"),td.log("assigned webSocket")):td.log("redundant webSocket assignment")}get readyState(){return this.webSocket?.readyState}get isConnected(){return this.readyState==WebSocket.OPEN}get isDisconnected(){return this.readyState==WebSocket.CLOSED}connect(t=`wss://${location.host}`){this.webSocket&&this.assertDisconnection(),this._connectionStatus="connecting",u||(this.webSocket=new WebSocket(t))}disconnect(){this.assertConnection(),this.reconnectOnDisconnection&&(this.reconnectOnDisconnection=!1,this.webSocket.addEventListener("close",(()=>{this.reconnectOnDisconnection=!0}),{once:!0})),this._connectionStatus="disconnecting",this.webSocket.close()}reconnect(){this.assertDisconnection(),this.connect(this.webSocket.url)}toggleConnection(t){this.isConnected?this.disconnect():t&&this.webSocket?.url==t?this.reconnect():this.connect(t)}sendMessage(t){this.assertConnection(),e(this,Vg,"f").send(t),e(this,Kg,"f").restart()}sendServerMessage(...t){this.sendMessage(ic({type:"serverMessage",data:Zh(...t)}))}},t.hexToRGB=La,t.rgbToHex=Fa,t.setAllConsoleLevelFlags=function(t){W.setAllLevelFlags(t)},t.setConsoleLevelFlagsForType=function(t,e){W.setLevelFlagsForType(t,e)}}));
//# sourceMappingURL=brilliantsole.min.js.map
