/**
 * @copyright Zack Qattan 2024
 * @license MIT
 */
function t(t,e,s,i){if("a"===s&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?i:"a"===s?i.call(t):i?i.value:e.get(t)}function e(t,e,s,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(t,s):n?n.value=s:e.set(t,s),s}"function"==typeof SuppressedError&&SuppressedError;const s=!1,i="undefined"!=typeof window&&void 0!==window?.document,n="undefined"!=typeof process&&null!=process?.versions?.node,a=i&&navigator.userAgent||"";let r=!1;i?r=Boolean(navigator.bluetooth):n&&(r=!0);const o=i&&/Bluefy/i.test(a),h=i&&/WebBLE/i.test(a),c=i&&/Android/i.test(a),l=i&&/Safari/i.test(a)&&!/Chrome/i.test(a),f=i&&/iPad|iPhone|iPod/i.test(a),g=i&&/Macintosh/i.test(a),d=!i&&!n&&"undefined"!=typeof global&&"undefined"!=typeof Studio;var u,p,m,v,y=Object.freeze({__proto__:null,isAndroid:c,get isBluetoothSupported(){return r},isIOS:f,isInBluefy:o,isInBrowser:i,isInDev:s,isInLensStudio:d,isInNode:n,isInProduction:!0,isInWebBLE:h,isMac:g,isSafari:l});if(d){const t=function(...t){Studio.log(t.map((t=>new String(t))).join(","))};(v={}).log=t,v.warn=t.bind(v,"WARNING"),v.error=t.bind(v,"ERROR")}else v=console;function w(t){return(...e)=>{if(n){const s=function(){const t=(new Error).stack;if(!t)return"";const e=t.split("\n"),s=e[3]||e[2],i=s.match(/at (.*?) \(/)||s.match(/at (.*)/);return i?`[${i[1].trim()}]`:""}();t(s,...e)}else t(...e)}}if(!v.assert){const t=(t,...e)=>{t||v.warn(...e)};v.assert=t}if(!v.table){const t=(...t)=>{v.log(...t)};v.table=t}function b(){}const C=n?w(v.log.bind(v)):v.log.bind(v),S=n?w(v.warn.bind(v)):v.warn.bind(v),E=n?w(v.error.bind(v)):v.error.bind(v),M=n?w(v.table.bind(v)):v.table.bind(v),D=v.assert.bind(v);class k{constructor(e){if(m.set(this,{log:s,warn:s,assert:!0,error:!0,table:!0}),t(u,u,"f",p)[e])throw new Error(`"${e}" console already exists`);t(u,u,"f",p)[e]=this}setLevelFlags(e){Object.assign(t(this,m,"f"),e)}static setLevelFlagsForType(e,s){if(!t(this,u,"f",p)[e])throw new Error(`no console found with type "${e}"`);t(this,u,"f",p)[e].setLevelFlags(s)}static setAllLevelFlags(e){for(const s in t(this,u,"f",p))t(this,u,"f",p)[s].setLevelFlags(e)}static create(e,s){return t(this,u,"f",p)[e]||new u(e)}get log(){return t(this,m,"f").log?C:b}get warn(){return t(this,m,"f").warn?S:b}get error(){return t(this,m,"f").error?E:b}get assert(){return t(this,m,"f").assert?D:b}get table(){return t(this,m,"f").table?M:b}assertWithError(t,e){if(!Boolean(t))throw new Error(e)}assertTypeWithError(t,e){this.assertWithError(typeof t==e,`value ${t} of type "${typeof t}" not of type "${e}"`)}assertEnumWithError(t,e){this.assertWithError(e.includes(t),`invalid enum "${t}"`)}assertRangeWithError(t,e,s,i){this.assertWithError(e>=s&&e<=i,`${t} ${e} must be within ${s}-${i}`)}}function W(t,e){return k.create(t,e)}function T(t,e){k.setLevelFlagsForType(t,e)}function R(t){k.setAllLevelFlags(t)}u=k,m=new WeakMap,p={value:{}};const x=W("EventDispatcher",{log:!1});class I{constructor(t,e){this.target=t,this.validEventTypes=e,this.listeners={},this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.removeEventListeners=this.removeEventListeners.bind(this),this.removeAllEventListeners=this.removeAllEventListeners.bind(this),this.dispatchEvent=this.dispatchEvent.bind(this),this.waitForEvent=this.waitForEvent.bind(this)}isValidEventType(t){return this.validEventTypes.includes(t)}updateEventListeners(t){this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter((e=>(e.shouldRemove&&x.log(`removing "${t}" eventListener`,e),!e.shouldRemove))))}addEventListener(t,e,s={once:!1}){if(!this.isValidEventType(t))throw new Error(`Invalid event type: ${t}`);this.listeners[t]||(this.listeners[t]=[],x.log(`creating "${t}" listeners array`,this.listeners[t]));this.listeners[t].find((t=>t.listener==e&&t.once==s.once))?x.log("already added listener"):(x.log(`adding "${t}" listener`,e,s),this.listeners[t].push({listener:e,once:s.once}),x.log(`currently have ${this.listeners[t].length} "${t}" listeners`))}removeEventListener(t,e){if(!this.isValidEventType(t))throw new Error(`Invalid event type: ${t}`);this.listeners[t]&&(x.log(`removing "${t}" listener...`,e),this.listeners[t].forEach((s=>{s.listener===e&&(x.log(`flagging "${t}" listener`,e),s.shouldRemove=!0)})),this.updateEventListeners(t))}removeEventListeners(t){if(!this.isValidEventType(t))throw new Error(`Invalid event type: ${t}`);this.listeners[t]&&(x.log(`removing "${t}" listeners...`),this.listeners[t]=[])}removeAllEventListeners(){x.log("removing listeners..."),this.listeners={}}dispatchEvent(t,e){if(!this.isValidEventType(t))throw new Error(`Invalid event type: ${t}`);this.listeners[t]&&(this.listeners[t].forEach((s=>{if(!s.shouldRemove){x.log(`dispatching "${t}" listener`,s);try{s.listener({type:t,target:this.target,message:e})}catch(t){console.error(t)}s.once&&(x.log(`flagging "${t}" listener`,s),s.shouldRemove=!0)}})),this.updateEventListeners(t))}waitForEvent(t){return new Promise((e=>{this.addEventListener(t,(t=>{e(t)}),{once:!0})}))}}var L,U,A;const _=W("Timer",{log:!1});class F{get callback(){return t(this,L,"f")}set callback(t){_.assertTypeWithError(t,"function"),_.log({newCallback:t}),e(this,L,t,"f"),this.isRunning&&this.restart()}get interval(){return t(this,U,"f")}set interval(t){_.assertTypeWithError(t,"number"),_.assertWithError(t>0,"interval must be above 0"),_.log({newInterval:t}),e(this,U,t,"f"),this.isRunning&&this.restart()}constructor(t,e){L.set(this,void 0),U.set(this,void 0),A.set(this,void 0),this.interval=e,this.callback=t}get isRunning(){return null!=t(this,A,"f")}start(s=!1){this.isRunning?_.log("interval already running"):(_.log(`starting interval every ${t(this,U,"f")}ms`),e(this,A,setInterval(t(this,L,"f"),t(this,U,"f")),"f"),s&&t(this,L,"f").call(this))}stop(){this.isRunning?(_.log("stopping interval"),clearInterval(t(this,A,"f")),e(this,A,void 0,"f")):_.log("interval already not running")}restart(t=!1){this.stop(),this.start(t)}}function B(t){for(let e=0;e<8;++e)t=(1&t?0:3988292384)^t>>>1;return 4278190080^t}L=new WeakMap,U=new WeakMap,A=new WeakMap,W("checksum",{log:!1});const $=new Uint32Array(256);for(let t=0;t<256;++t)$[t]=B(t);function O(t){let e=new Uint8Array(t),s=0;for(let t=0;t<e.byteLength;++t){const i=255&s,n=e[t];s=($[i^n]^s>>>8)>>>0}return s}var P,N;P="undefined"==typeof TextEncoder?class{encode(t){const e=Array.from(t).map((t=>t.charCodeAt(0)));return Uint8Array.from(e)}}:TextEncoder,N="undefined"==typeof TextDecoder?class{decode(t){return Array.from(new Uint8Array(t)).map((t=>String.fromCharCode(t))).join("")}}:TextDecoder;const V=new P,q=new N,z=W("ArrayBufferUtils",{log:!1});function j(...t){const e=(t=(t=(t=t.filter((t=>null!=t||null!=t))).map((t=>{if("number"==typeof t){const e=t;return Uint8Array.from([Math.floor(e)])}if("boolean"==typeof t){const e=t;return Uint8Array.from([e?1:0])}if("string"==typeof t){return G(t)}if(t instanceof Array){return j(...t)}if(t instanceof ArrayBuffer)return t;if("buffer"in t&&t.buffer instanceof ArrayBuffer){return t.buffer}if(t instanceof DataView){return t.buffer}if("object"==typeof t){return function(t){return G(JSON.stringify(t))}(t)}return t}))).filter((t=>t&&"byteLength"in t))).reduce(((t,e)=>t+e.byteLength),0),s=new Uint8Array(e);let i=0;return t.forEach((t=>{s.set(new Uint8Array(t),i),i+=t.byteLength})),s.buffer}function G(t){const e=V.encode(t);return j(e.byteLength,e)}function H(t,e,s){let i;return null!=s&&(i=t.byteOffset+e+s),z.log({dataView:t,begin:e,end:i,length:s}),new DataView(t.buffer.slice(t.byteOffset+e,i))}async function X(t){let e;if(t instanceof Array)e=Uint8Array.from(t);else if(t instanceof DataView)e=t.buffer;else if("string"==typeof t||t instanceof URL){const s=await fetch(t);e=await s.arrayBuffer()}else if(t instanceof File)e=await t.arrayBuffer();else{if(!(t instanceof ArrayBuffer))throw{error:"invalid file type",file:t};e=t}return e}function Y(t){return Uint8Array.from([t]).buffer}function J(t,{include:e,exclude:s}={}){const i=t=>{const i=e=>"string"==typeof e?t===e:e.test(t);return e?e.some(i):!s||!s.some(i)};for(const[e,s]of(t=>{const e=new Set;do{for(const s of Reflect.ownKeys(t))e.add([t,s])}while((t=Reflect.getPrototypeOf(t))&&t!==Object.prototype);return e})(t.constructor.prototype)){if("constructor"===s||!i(s))continue;const n=Reflect.getOwnPropertyDescriptor(e,s);n&&"function"==typeof n.value&&(t[s]=t[s].bind(t))}return t}var K,Q,Z,tt,et,st,it,nt,at,rt,ot,ht,ct,lt,ft,gt,dt,ut,pt,mt,vt,yt,wt,bt,Ct,St,Et,Mt,Dt,kt,Wt,Tt,Rt,xt,It,Lt,Ut,At,_t,Ft,Bt;const $t=W("FileTransferManager",{log:!1}),Ot=["getFileTypes","maxFileLength","getFileType","setFileType","getFileLength","setFileLength","getFileChecksum","setFileChecksum","setFileTransferCommand","fileTransferStatus","getFileBlock","setFileBlock","fileBytesTransferred"],Pt=["tflite","wifiServerCert","wifiServerKey"],Nt=["idle","sending","receiving"],Vt=["startSend","startReceive","cancel"],qt=["sending","receiving"],zt=[...Ot,"fileTransferProgress","fileTransferComplete","fileReceived"],jt=["maxFileLength","getFileLength","getFileChecksum","getFileType","fileTransferStatus"];class Gt{constructor(){K.add(this),nt.set(this,[]),ot.set(this,Q.MaxLength),ft.set(this,void 0),pt.set(this,0),wt.set(this,0),Mt.set(this,"idle"),Rt.set(this,[]),It.set(this,void 0),Lt.set(this,0),Ft.set(this,!1),Bt.set(this,!1),J(this)}get addEventListener(){return this.eventDispatcher.addEventListener}get removeEventListener(){return this.eventDispatcher.removeEventListener}get waitForEvent(){return this.eventDispatcher.waitForEvent}get fileTypes(){return t(this,nt,"f")}static get MaxLength(){return t(this,Q,"f",rt)}get maxLength(){return t(this,ot,"f")}get type(){return t(this,ft,"f")}get length(){return t(this,pt,"f")}get checksum(){return t(this,wt,"f")}get status(){return t(this,Mt,"f")}parseMessage(e,s){switch($t.log({messageType:e}),e){case"getFileTypes":t(this,K,"m",at).call(this,s);break;case"maxFileLength":t(this,K,"m",ht).call(this,s);break;case"getFileType":case"setFileType":t(this,K,"m",gt).call(this,s);break;case"getFileLength":case"setFileLength":t(this,K,"m",mt).call(this,s);break;case"getFileChecksum":case"setFileChecksum":t(this,K,"m",bt).call(this,s);break;case"fileTransferStatus":t(this,K,"m",Dt).call(this,s);break;case"getFileBlock":t(this,K,"m",xt).call(this,s);break;case"fileBytesTransferred":t(this,K,"m",_t).call(this,s);break;default:throw Error(`uncaught messageType ${e}`)}}async send(e,s){t(this,K,"m",Wt).call(this),t(this,K,"m",tt).call(this,e);const i=await X(s),n=i.byteLength,a=O(i);if(e!=this.type)$t.log("different fileTypes - sending");else if(n!=this.length)$t.log("different fileLengths - sending");else{if(a==this.checksum)return $t.log("already sent file"),!1;$t.log("different fileChecksums - sending")}const r=[];return r.push(t(this,K,"m",ut).call(this,e,!1)),r.push(t(this,K,"m",yt).call(this,n,!1)),r.push(t(this,K,"m",St).call(this,a,!1)),r.push(t(this,K,"m",Et).call(this,"startSend",!1)),this.sendMessage(),await Promise.all(r),await t(this,K,"m",Ut).call(this,i),!0}async receive(e){t(this,K,"m",Wt).call(this),t(this,K,"m",tt).call(this,e),await t(this,K,"m",ut).call(this,e),await t(this,K,"m",Et).call(this,"startReceive")}async cancel(){t(this,K,"m",Tt).call(this),$t.log("cancelling file transfer..."),e(this,Ft,!0,"f"),await t(this,K,"m",Et).call(this,"cancel")}get isServerSide(){return t(this,Bt,"f")}set isServerSide(s){t(this,Bt,"f")!=s?($t.log({newIsServerSide:s}),e(this,Bt,s,"f")):$t.log("redundant isServerSide assignment")}requestRequiredInformation(){$t.log("requesting required fileTransfer information");const t=jt.map((t=>({type:t})));this.sendMessage(t,!1)}}Q=Gt,nt=new WeakMap,ot=new WeakMap,ft=new WeakMap,pt=new WeakMap,wt=new WeakMap,Mt=new WeakMap,Rt=new WeakMap,It=new WeakMap,Lt=new WeakMap,Ft=new WeakMap,Bt=new WeakMap,K=new WeakSet,Z=function(){return this.eventDispatcher.dispatchEvent},tt=function(t){$t.assertEnumWithError(t,Pt)},et=function(t){$t.assertWithError(t in Pt,`invalid typeEnum ${t}`)},st=function(t){$t.assertWithError(t in Nt,`invalid statusEnum ${t}`)},it=function(t){$t.assertEnumWithError(t,Vt)},at=function(s){const i=Array.from(new Uint8Array(s.buffer)).map((t=>Pt[t])).filter(Boolean);e(this,nt,i,"f"),$t.log("fileTypes",i),t(this,K,"a",Z).call(this,"getFileTypes",{fileTypes:t(this,nt,"f")})},ht=function(e){$t.log("parseFileMaxLength",e);const s=e.getUint32(0,!0);$t.log(`maxLength: ${s/1024}kB`),t(this,K,"m",ct).call(this,s)},ct=function(s){$t.log({maxLength:s}),e(this,ot,s,"f"),t(this,K,"a",Z).call(this,"maxFileLength",{maxFileLength:s})},lt=function(t){$t.assertWithError(t<=this.maxLength,`file length ${t}kB too large - must be ${this.maxLength}kB or less`)},gt=function(e){$t.log("parseFileType",e);const s=e.getUint8(0);t(this,K,"m",et).call(this,s);const i=Pt[s];t(this,K,"m",dt).call(this,i)},dt=function(s){$t.log({fileTransferType:s}),e(this,ft,s,"f"),t(this,K,"a",Z).call(this,"getFileType",{fileType:s})},ut=async function(e,s){if(t(this,K,"m",tt).call(this,e),this.type==e)return void $t.log(`redundant type assignment ${e}`);const i=this.waitForEvent("getFileType"),n=Pt.indexOf(e);this.sendMessage([{type:"setFileType",data:Y(n)}],s),await i},mt=function(e){$t.log("parseFileLength",e);const s=e.getUint32(0,!0);t(this,K,"m",vt).call(this,s)},vt=function(s){$t.log(`length: ${s/1024}kB`),e(this,pt,s,"f"),t(this,K,"a",Z).call(this,"getFileLength",{fileLength:s})},yt=async function(e,s){if($t.assertTypeWithError(e,"number"),t(this,K,"m",lt).call(this,e),this.length==e)return void $t.log(`redundant length assignment ${e}`);const i=this.waitForEvent("getFileLength"),n=new DataView(new ArrayBuffer(4));n.setUint32(0,e,!0),this.sendMessage([{type:"setFileLength",data:n.buffer}],s),await i},bt=function(e){$t.log("checksum",e);const s=e.getUint32(0,!0);t(this,K,"m",Ct).call(this,s)},Ct=function(s){$t.log({checksum:s}),e(this,wt,s,"f"),t(this,K,"a",Z).call(this,"getFileChecksum",{fileChecksum:s})},St=async function(t,e){if($t.assertTypeWithError(t,"number"),this.checksum==t)return void $t.log(`redundant checksum assignment ${t}`);const s=this.waitForEvent("getFileChecksum"),i=new DataView(new ArrayBuffer(4));i.setUint32(0,t,!0),this.sendMessage([{type:"setFileChecksum",data:i.buffer}],e),await s},Et=async function(e,s){t(this,K,"m",it).call(this,e);const i=this.waitForEvent("fileTransferStatus");$t.log(`setting command ${e}`);const n=Vt.indexOf(e);this.sendMessage([{type:"setFileTransferCommand",data:Y(n)}],s),await i},Dt=function(e){$t.log("parseFileStatus",e);const s=e.getUint8(0);t(this,K,"m",st).call(this,s);const i=Nt[s];t(this,K,"m",kt).call(this,i)},kt=function(s){$t.log({status:s}),e(this,Mt,s,"f"),t(this,K,"a",Z).call(this,"fileTransferStatus",{fileTransferStatus:s}),t(this,Rt,"f").length=0,e(this,Ft,!1,"f")},Wt=function(){$t.assertWithError("idle"==t(this,Mt,"f"),"status is not idle")},Tt=function(){$t.assertWithError("idle"!=t(this,Mt,"f"),"status is idle")},xt=async function(e){$t.log("parseFileBlock",e),t(this,Rt,"f").push(e.buffer);const s=t(this,Rt,"f").reduce(((t,e)=>t+e.byteLength),0),i=s/t(this,pt,"f");if($t.log(`received ${s} of ${t(this,pt,"f")} bytes (${100*i}%)`),t(this,K,"a",Z).call(this,"fileTransferProgress",{progress:i}),s!=t(this,pt,"f")){const t=new DataView(new ArrayBuffer(4));if(t.setUint32(0,s,!0),this.isServerSide)return;return void await this.sendMessage([{type:"fileBytesTransferred",data:t.buffer}])}$t.log("file transfer complete");let n,a=(new Date).toLocaleString();switch(this.type){case"tflite":a+=".tflite";break;case"wifiServerCert":a+="_server.crt";break;case"wifiServerKey":a+="_server.key"}n="undefined"!=typeof File?new File(t(this,Rt,"f"),a):new Blob(t(this,Rt,"f"));const r=O(await n.arrayBuffer());$t.log({checksum:r}),r==t(this,wt,"f")?($t.log("received file",n),t(this,K,"a",Z).call(this,"getFileBlock",{fileTransferBlock:e}),t(this,K,"a",Z).call(this,"fileTransferComplete",{direction:"receiving"}),t(this,K,"a",Z).call(this,"fileReceived",{file:n})):$t.error(`wrong checksum - expected ${t(this,wt,"f")}, got ${r}`)},Ut=async function(s){return e(this,It,s,"f"),e(this,Lt,0,"f"),t(this,K,"m",At).call(this)},At=async function(){if("sending"!=this.status)return;if(t(this,Ft,"f"))return void $t.error("not sending block - busy cancelling");if(!t(this,It,"f"))return void(this.isServerSide||$t.error("no buffer defined"));const s=t(this,It,"f");let i=t(this,Lt,"f");const n=s.slice(i,i+(this.mtu-3-3));$t.log("slicedBuffer",n);const a=1-(s.byteLength-i)/s.byteLength;$t.log(`sending bytes ${i}-${i+n.byteLength} of ${s.byteLength} bytes (${100*a}%)`),t(this,K,"a",Z).call(this,"fileTransferProgress",{progress:a}),0==n.byteLength?($t.log("finished sending buffer"),t(this,K,"a",Z).call(this,"fileTransferComplete",{direction:"sending"})):(await this.sendMessage([{type:"setFileBlock",data:n}]),e(this,Lt,i+n.byteLength,"f"))},_t=async function(e){$t.log("parseBytesTransferred",e);const s=e.getUint32(0,!0);if($t.log({bytesTransferred:s}),"sending"==this.status)return this.isServerSide||t(this,Lt,"f")==s?void t(this,K,"m",At).call(this):($t.error(`bytesTransferred are not equal - got ${s}, expected ${t(this,Lt,"f")}`),void this.cancel());$t.error("not currently sending file")},rt={value:0};const Ht=W("MathUtils",{log:!1});const Xt=65536;function Yt(t,e){const s=Date.now();var i;let n=(i=s)-i%Xt+t.getUint16(e,!0);return Math.abs(s-n)>6e4&&(Ht.log("correcting timestamp delta"),n+=Xt*Math.sign(s-n)),n}function Jt(t){const{x:e,y:s}=t;return Math.sqrt(e**2+s**2)}function Kt(t){return t*(Math.PI/180)}const Qt=2*Math.PI;function Zt(t){return(t%Qt+Qt)%Qt}var te,ee,se;const ie={min:1/0,max:-1/0,span:0};class ne{constructor(){te.add(this),ee.set(this,Object.assign({},ie))}get min(){return t(this,ee,"f").min}get max(){return t(this,ee,"f").max}set min(e){t(this,ee,"f").min=e,t(this,ee,"f").max=Math.max(e,t(this,ee,"f").max),t(this,te,"m",se).call(this)}set max(e){t(this,ee,"f").max=e,t(this,ee,"f").min=Math.min(e,t(this,ee,"f").min),t(this,te,"m",se).call(this)}reset(){Object.assign(t(this,ee,"f"),ie)}update(e){t(this,ee,"f").min=Math.min(e,t(this,ee,"f").min),t(this,ee,"f").max=Math.max(e,t(this,ee,"f").max),t(this,te,"m",se).call(this)}getNormalization(e,s){let i=function(t,e,s,i){return null==i&&(i=s-e),(t-e)/i}(e,t(this,ee,"f").min,t(this,ee,"f").max,t(this,ee,"f").span);return s&&(i*=t(this,ee,"f").span),i||0}updateAndGetNormalization(t,e){return this.update(t),this.getNormalization(t,e)}}var ae,re,oe,he,ce;ee=new WeakMap,te=new WeakSet,se=function(){t(this,ee,"f").span=t(this,ee,"f").max-t(this,ee,"f").min};class le{constructor(){ae.set(this,{x:new ne,y:new ne})}reset(){t(this,ae,"f").x.reset(),t(this,ae,"f").y.reset()}update(e){t(this,ae,"f").x.update(e.x),t(this,ae,"f").y.update(e.y)}getNormalization(e,s){return{x:t(this,ae,"f").x.getNormalization(e.x,s),y:t(this,ae,"f").y.getNormalization(e.y,s)}}updateAndGetNormalization(t,e){return this.update(t),this.getNormalization(t,e)}}ae=new WeakMap;const fe=W("PressureDataManager",{log:!1}),ge=["pressure"],de=ge,ue=8;class pe{constructor(){re.set(this,[]),oe.set(this,void 0),he.set(this,new ne),ce.set(this,new le)}get positions(){return t(this,re,"f")}get numberOfSensors(){return this.positions.length}parsePositions(t){const s=[];for(let e=0,i=0;i<t.byteLength;e++,i+=2)s.push({x:t.getUint8(i)/256,y:t.getUint8(i+1)/256});var i,n;fe.log({positions:s}),e(this,re,s,"f"),e(this,oe,(i=this.numberOfSensors,n=()=>new ne,new Array(i).fill(1).map(((t,e)=>{if("function"==typeof n)return n(e);{const t=n;return Object.assign({},t)}}))),"f"),this.resetRange()}resetRange(){t(this,oe,"f")?.forEach((t=>t.reset())),t(this,ce,"f").reset(),t(this,he,"f").reset()}parseData(e,s){const i={sensors:[],scaledSum:0,normalizedSum:0};for(let n=0,a=0;a<e.byteLength;n++,a+=2){const r=e.getUint16(a,!0);let o=r*s/this.numberOfSensors;const h=t(this,oe,"f")[n].updateAndGetNormalization(o,!1),c=this.positions[n];i.sensors[n]={rawValue:r,scaledValue:o,normalizedValue:h,position:c,weightedValue:0},i.scaledSum+=o}return i.normalizedSum=t(this,he,"f").updateAndGetNormalization(i.scaledSum,!1),i.scaledSum>0&&(i.center={x:0,y:0},i.sensors.forEach((t=>{t.weightedValue=t.scaledValue/i.scaledSum,i.center.x+=t.position.x*t.weightedValue,i.center.y+=t.position.y*t.weightedValue})),i.normalizedCenter=t(this,ce,"f").updateAndGetNormalization(i.center,!1)),fe.log({pressure:i}),i}}re=new WeakMap,oe=new WeakMap,he=new WeakMap,ce=new WeakMap;const me=W("MotionSensorDataManager",{log:!1}),ve=["still","walking","running","bicycle","vehicle","tilting"],ye=["portraitUpright","landscapeLeft","portraitUpsideDown","landscapeRight","unknown"];class we{parseVector3(t,e){let[s,i,n]=[t.getInt16(0,!0),t.getInt16(2,!0),t.getInt16(4,!0)].map((t=>t*e));const a={x:s,y:i,z:n};return me.log({vector:a}),a}parseQuaternion(t,e){let[s,i,n,a]=[t.getInt16(0,!0),t.getInt16(2,!0),t.getInt16(4,!0),t.getInt16(6,!0)].map((t=>t*e));const r={x:s,y:i,z:n,w:a};return me.log({quaternion:r}),r}parseEuler(t,e){let[s,i,n]=[t.getInt16(0,!0),t.getInt16(2,!0),t.getInt16(4,!0)].map((t=>t*e));i*=-1,s*=-1,s<0&&(s+=360);const a={heading:s,pitch:i,roll:n};return me.log({euler:a}),a}parseStepCounter(t){me.log("parseStepCounter",t);const e=t.getUint32(0,!0);return me.log({stepCount:e}),e}parseActivity(t){me.log("parseActivity",t);const e={},s=t.getUint8(0);return me.log("activityBitfield",s.toString(2)),ve.forEach(((t,i)=>{e[t]=Boolean(s&1<<i)})),me.log("activity",e),e}parseDeviceOrientation(t){me.log("parseDeviceOrientation",t);const e=t.getUint8(0),s=ye[e];return me.assertWithError(s,"undefined deviceOrientation"),me.log({deviceOrientation:s}),s}}var be,Ce;const Se=["barometer"],Ee=Se,Me=W("BarometerSensorDataManager",{log:!1});class De{constructor(){be.add(this)}parseData(e,s){const i=e.getUint32(0,!0)*s,n=t(this,be,"m",Ce).call(this,i);return Me.log({pressure:i,altitude:n}),{pressure:i}}}be=new WeakSet,Ce=function(t){const e=.0065;return 288.15/e*(1-Math.pow(t/101325,.19026643566373183))};const ke=W("ParseUtils",{log:!1});function We(t,e=0){const s=t.getUint8(e++);return{string:q.decode(t.buffer.slice(t.byteOffset+e,t.byteOffset+e+s)),byteOffset:e+=s}}function Te(t,e,s,i,n=!1){let a=0;for(;a<t.byteLength;){const r=t.getUint8(a++);ke.assertWithError(r in e,`invalid messageTypeEnum ${r}`);const o=e[r];let h;n?(h=t.getUint16(a,!0),a+=2):h=t.getUint8(a++),ke.log({messageTypeEnum:r,messageType:o,messageLength:h,dataView:t,byteOffset:a});const c=H(t,a,h);ke.log({_dataView:c}),s(o,c,i),a+=h}}var Re,xe,Ie,Le,Ue,Ae,_e,Fe,Be,$e,Oe,Pe,Ne,Ve,qe,ze,je,Ge,He,Xe,Ye,Je,Ke,Qe,Ze,ts,es,ss,is;const ns=W("CameraManager",{log:!1}),as=["focus","takePicture","stop","sleep","wake"],rs=["idle","focusing","takingPicture","asleep"],os=["headerSize","header","imageSize","image","footerSize","footer"],hs=["resolution","qualityFactor","shutter","gain","redGain","greenGain","blueGain"],cs=["cameraStatus","cameraCommand","getCameraConfiguration","setCameraConfiguration","cameraData"],ls=["getCameraConfiguration","cameraStatus"],fs=[...cs,"cameraImageProgress","cameraImage"];class gs{constructor(){Re.add(this),Le.set(this,void 0),Pe.set(this,0),Ne.set(this,void 0),Ve.set(this,0),qe.set(this,0),ze.set(this,void 0),je.set(this,0),Ge.set(this,0),He.set(this,void 0),Xe.set(this,0),Ye.set(this,!1),Ke.set(this,{}),Qe.set(this,void 0),Ze.set(this,{resolution:{min:100,max:720},qualityFactor:{min:15,max:60},shutter:{min:4,max:16383},gain:{min:1,max:248},redGain:{min:0,max:1023},greenGain:{min:0,max:1023},blueGain:{min:0,max:1023}}),J(this)}get waitForEvent(){return this.eventDispatcher.waitForEvent}requestRequiredInformation(){ns.log("requesting required camera information");const t=ls.map((t=>({type:t})));this.sendMessage(t,!1)}get cameraStatus(){return t(this,Le,"f")}async focus(){t(this,Re,"m",Be).call(this),await t(this,Re,"m",_e).call(this,"focus")}async takePicture(){t(this,Re,"m",Be).call(this),await t(this,Re,"m",_e).call(this,"takePicture")}async stop(){t(this,Re,"m",Be).call(this),await t(this,Re,"m",_e).call(this,"stop")}async sleep(){t(this,Re,"m",Be).call(this),await t(this,Re,"m",_e).call(this,"sleep")}async wake(){t(this,Re,"m",Fe).call(this),await t(this,Re,"m",_e).call(this,"wake")}get cameraConfiguration(){return t(this,Ke,"f")}get availableCameraConfigurationTypes(){return t(this,Qe,"f")}get cameraConfigurationRanges(){return t(this,Ze,"f")}async setCameraConfiguration(e){if(ns.log({newCameraConfiguration:e}),t(this,Re,"m",es).call(this,e))return void ns.log("redundant camera configuration");const s=t(this,Re,"m",is).call(this,e);ns.log({setCameraConfigurationData:s});const i=this.waitForEvent("getCameraConfiguration");this.sendMessage([{type:"setCameraConfiguration",data:s.buffer}]),await i}static AssertValidCameraConfigurationType(t){ns.assertEnumWithError(t,hs)}static AssertValidCameraConfigurationTypeEnum(t){ns.assertTypeWithError(t,"number"),ns.assertWithError(t in hs,`invalid cameraConfigurationTypeEnum ${t}`)}parseMessage(e,s){switch(ns.log({messageType:e,dataView:s}),e){case"cameraStatus":t(this,Re,"m",Ue).call(this,s);break;case"getCameraConfiguration":case"setCameraConfiguration":t(this,Re,"m",ts).call(this,s);break;case"cameraData":t(this,Re,"m",$e).call(this,s);break;default:throw Error(`uncaught messageType ${e}`)}}clear(){e(this,Le,void 0,"f"),e(this,Ve,0,"f"),e(this,je,0,"f"),e(this,Xe,0,"f")}}function ds(t,e,s){const i=function(t,e,s){const i=new ArrayBuffer(44+2*t.length),n=new DataView(i);us(n,0,"RIFF"),n.setUint32(4,36+2*t.length,!0),us(n,8,"WAVE"),us(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,s,!0),n.setUint32(24,e,!0),n.setUint32(28,e*s*2,!0),n.setUint16(32,2*s,!0),n.setUint16(34,16,!0),us(n,36,"data"),n.setUint32(40,2*t.length,!0);for(let e=0;e<t.length;e++)n.setInt16(44+2*e,32767*t[e],!0);return i}(t,e,s);return new Blob([i],{type:"audio/wav"})}function us(t,e,s){for(let i=0;i<s.length;i++)t.setUint8(e+i,s.charCodeAt(i))}var ps,ms,vs,ys,ws,bs,Cs,Ss,Es,Ms,Ds,ks,Ws,Ts,Rs,xs,Is,Ls,Us,As,_s,Fs,Bs,$s;xe=gs,Le=new WeakMap,Pe=new WeakMap,Ne=new WeakMap,Ve=new WeakMap,qe=new WeakMap,ze=new WeakMap,je=new WeakMap,Ge=new WeakMap,He=new WeakMap,Xe=new WeakMap,Ye=new WeakMap,Ke=new WeakMap,Qe=new WeakMap,Ze=new WeakMap,Re=new WeakSet,Ie=function(){return this.eventDispatcher.dispatchEvent},Ue=function(e){const s=e.getUint8(0),i=rs[s];t(this,Re,"m",Ae).call(this,i)},Ae=function(s){if(ns.assertEnumWithError(s,rs),s==t(this,Le,"f"))return void ns.log(`redundant cameraStatus ${s}`);const i=t(this,Le,"f");e(this,Le,s,"f"),ns.log(`updated cameraStatus to "${this.cameraStatus}"`),t(this,Re,"a",Ie).call(this,"cameraStatus",{cameraStatus:this.cameraStatus,previousCameraStatus:i}),"takingPicture"!=t(this,Le,"f")&&t(this,je,"f")>0&&!t(this,Ye,"f")&&t(this,Re,"m",Je).call(this)},_e=async function(t,e){ns.assertEnumWithError(t,as),ns.log(`sending camera command "${t}"`);const s=this.waitForEvent("cameraStatus");ns.log(`setting command "${t}"`);const i=as.indexOf(t);this.sendMessage([{type:"cameraCommand",data:Y(i)}],e),await s},Fe=function(){ns.assertWithError("asleep"==t(this,Le,"f"),`camera is not asleep - currently ${t(this,Le,"f")}`)},Be=function(){ns.assertWithError("asleep"!=t(this,Le,"f"),`camera is not awake - currently ${t(this,Le,"f")}`)},$e=function(e){ns.log("parsing camera data",e),Te(e,os,t(this,Re,"m",Oe).bind(this),null,!0)},Oe=function(s,i){switch(ns.log({cameraDataType:s,dataView:i}),s){case"headerSize":e(this,Pe,i.getUint16(0,!0),"f"),ns.log({headerSize:t(this,Pe,"f")}),e(this,Ne,void 0,"f"),t(this,Ve,"f");break;case"header":e(this,Ne,j(t(this,Ne,"f"),i),"f"),ns.log({headerData:t(this,Ne,"f")}),e(this,Ve,t(this,Ne,"f")?.byteLength/t(this,Pe,"f"),"f"),ns.log({headerProgress:t(this,Ve,"f")}),t(this,Re,"a",Ie).call(this,"cameraImageProgress",{progress:t(this,Ve,"f"),type:"header"}),1==t(this,Ve,"f")&&ns.log("finished getting header data");break;case"imageSize":e(this,qe,i.getUint16(0,!0),"f"),ns.log({imageSize:t(this,qe,"f")}),e(this,ze,void 0,"f"),t(this,je,"f"),e(this,Ye,!1,"f");break;case"image":e(this,ze,j(t(this,ze,"f"),i),"f"),ns.log({imageData:t(this,ze,"f")}),e(this,je,t(this,ze,"f")?.byteLength/t(this,qe,"f"),"f"),ns.log({imageProgress:t(this,je,"f")}),t(this,Re,"a",Ie).call(this,"cameraImageProgress",{progress:t(this,je,"f"),type:"image"}),1==t(this,je,"f")&&(ns.log("finished getting image data"),1==t(this,Ve,"f")&&t(this,Re,"m",Je).call(this));break;case"footerSize":e(this,Ge,i.getUint16(0,!0),"f"),ns.log({footerSize:t(this,Ge,"f")}),e(this,He,void 0,"f"),t(this,Xe,"f");break;case"footer":e(this,He,j(t(this,He,"f"),i),"f"),ns.log({footerData:t(this,He,"f")}),e(this,Xe,t(this,He,"f")?.byteLength/t(this,Ge,"f"),"f"),ns.log({footerProgress:t(this,Xe,"f")}),t(this,Re,"a",Ie).call(this,"cameraImageProgress",{progress:t(this,Xe,"f"),type:"footer"}),1==t(this,Xe,"f")&&(ns.log("finished getting footer data"),1==t(this,je,"f")&&t(this,Re,"m",Je).call(this))}},Je=function(){ns.log("building image...");const s=j(t(this,Ne,"f"),t(this,ze,"f"),t(this,He,"f"));ns.log({imageData:s});let i=new Blob([s],{type:"image/jpeg"});ns.log("created blob",i);const n=URL.createObjectURL(i);ns.log("created url",n),t(this,Re,"a",Ie).call(this,"cameraImage",{url:n,blob:i}),e(this,Ye,!0,"f")},ts=function(s){const i={};let n=0;for(;n<s.byteLength;){const t=s.getUint8(n++),e=hs[t];ns.assertWithError(e,`invalid cameraConfigurationTypeIndex ${t}`),i[e]=s.getUint16(n,!0),n+=2}ns.log({parsedCameraConfiguration:i}),e(this,Qe,Object.keys(i),"f"),e(this,Ke,i,"f"),t(this,Re,"a",Ie).call(this,"getCameraConfiguration",{cameraConfiguration:t(this,Ke,"f")})},es=function(t){return Object.keys(t).every((e=>this.cameraConfiguration[e]==t[e]))},ss=function(e){ns.assertWithError(t(this,Qe,"f"),"must get initial cameraConfiguration");const s=t(this,Qe,"f")?.includes(e);return ns.assertWithError(s,`unavailable camera configuration type "${e}"`),s},is=function(e){let s=Object.keys(e);s=s.filter((e=>t(this,Re,"m",ss).call(this,e)));const i=new DataView(new ArrayBuffer(3*s.length));return s.forEach(((t,s)=>{xe.AssertValidCameraConfigurationType(t);const n=hs.indexOf(t);i.setUint8(3*s,n);const a=e[t];i.setUint16(3*s+1,a,!0)})),ns.log({sensorConfigurationData:i}),i},W("AudioUtils",{log:!0});const Os=W("MicrophoneManager",{log:!1}),Ps=["start","stop","vad"],Ns=["idle","streaming","vad"],Vs=["sampleRate","bitDepth"],qs=["8","16"],zs=["microphoneStatus","microphoneCommand","getMicrophoneConfiguration","setMicrophoneConfiguration","microphoneData"],js={sampleRate:["8000","16000"],bitDepth:qs},Gs=["getMicrophoneConfiguration","microphoneStatus"],Hs=[...zs,"isRecordingMicrophone","microphoneRecording"];class Xs{constructor(){ps.add(this),ys.set(this,void 0),Ms.set(this,.001),Ds.set(this,0),Ts.set(this,{}),Rs.set(this,void 0),As.set(this,void 0),_s.set(this,void 0),Fs.set(this,void 0),Bs.set(this,!1),$s.set(this,void 0),J(this)}get waitForEvent(){return this.eventDispatcher.waitForEvent}requestRequiredInformation(){Os.log("requesting required microphone information");const t=Gs.map((t=>({type:t})));this.sendMessage(t,!1)}get microphoneStatus(){return t(this,ys,"f")}async start(){await t(this,ps,"m",Cs).call(this,"start")}async stop(){t(this,ps,"m",Ss).call(this),await t(this,ps,"m",Cs).call(this,"stop")}async vad(){await t(this,ps,"m",Cs).call(this,"vad")}async toggle(){switch(this.microphoneStatus){case"idle":this.start();break;case"streaming":this.stop()}}get microphoneConfiguration(){return t(this,Ts,"f")}get availableMicrophoneConfigurationTypes(){return t(this,Rs,"f")}get bitDepth(){return t(this,Ts,"f").bitDepth}get sampleRate(){return t(this,Ts,"f").sampleRate}async setMicrophoneConfiguration(e){if(Os.log({newMicrophoneConfiguration:e}),t(this,ps,"m",Is).call(this,e))return void Os.log("redundant microphone configuration");const s=t(this,ps,"m",Us).call(this,e);Os.log({setMicrophoneConfigurationData:s});const i=this.waitForEvent("getMicrophoneConfiguration");this.sendMessage([{type:"setMicrophoneConfiguration",data:s.buffer}]),await i}static AssertValidMicrophoneConfigurationType(t){Os.assertEnumWithError(t,Vs)}static AssertValidMicrophoneConfigurationTypeEnum(t){Os.assertTypeWithError(t,"number"),Os.assertWithError(t in Vs,`invalid microphoneConfigurationTypeEnum ${t}`)}parseMessage(e,s){switch(Os.log({messageType:e,dataView:s}),e){case"microphoneStatus":t(this,ps,"m",ws).call(this,s);break;case"getMicrophoneConfiguration":case"setMicrophoneConfiguration":t(this,ps,"m",xs).call(this,s);break;case"microphoneData":t(this,ps,"m",ks).call(this,s);break;default:throw Error(`uncaught messageType ${e}`)}}get audioContext(){return t(this,As,"f")}set audioContext(s){t(this,As,"f")!=s?(e(this,As,s,"f"),Os.log("assigned new audioContext",t(this,As,"f")),t(this,As,"f")?e(this,Ds,t(this,As,"f").currentTime,"f"):(t(this,Fs,"f")&&(t(this,Fs,"f").disconnect(),e(this,Fs,void 0,"f")),t(this,_s,"f")&&(t(this,_s,"f").disconnect(),e(this,_s,void 0,"f")))):Os.log("redundant audioContext assignment",t(this,As,"f"))}get gainNode(){return Os.assertWithError(t(this,As,"f"),"audioContext assignment required for gainNode"),t(this,_s,"f")||(Os.log("creating gainNode..."),e(this,_s,t(this,As,"f").createGain(),"f"),Os.log("created gainNode",t(this,_s,"f"))),t(this,_s,"f")}get mediaStreamDestination(){return Os.assertWithError(t(this,As,"f"),"audioContext assignment required for mediaStreamDestination"),t(this,Fs,"f")||(Os.log("creating mediaStreamDestination..."),e(this,Fs,t(this,As,"f").createMediaStreamDestination(),"f"),this.gainNode?.connect(t(this,Fs,"f")),Os.log("created mediaStreamDestination",t(this,Fs,"f"))),t(this,Fs,"f")}get isRecording(){return t(this,Bs,"f")}startRecording(){this.isRecording?Os.log("already recording"):(e(this,$s,[],"f"),e(this,Bs,!0,"f"),t(this,ps,"a",vs).call(this,"isRecordingMicrophone",{isRecordingMicrophone:this.isRecording}))}stopRecording(){if(this.isRecording){if(e(this,Bs,!1,"f"),t(this,$s,"f")&&t(this,$s,"f").length>0){Os.log("parsing microphone data...",t(this,$s,"f").length);const e=j(...t(this,$s,"f")),s=new Float32Array(e),i=ds(s,Number(this.sampleRate),1),n=URL.createObjectURL(i);t(this,ps,"a",vs).call(this,"microphoneRecording",{samples:s,sampleRate:this.sampleRate,bitDepth:this.bitDepth,blob:i,url:n})}e(this,$s,void 0,"f"),t(this,ps,"a",vs).call(this,"isRecordingMicrophone",{isRecordingMicrophone:this.isRecording})}else Os.log("already not recording")}toggleRecording(){t(this,Bs,"f")?this.stopRecording():this.startRecording()}clear(){e(this,ys,void 0,"f"),e(this,Ts,{},"f"),this.isRecording&&this.stopRecording()}}var Ys;ms=Xs,ys=new WeakMap,Ms=new WeakMap,Ds=new WeakMap,Ts=new WeakMap,Rs=new WeakMap,As=new WeakMap,_s=new WeakMap,Fs=new WeakMap,Bs=new WeakMap,$s=new WeakMap,ps=new WeakSet,vs=function(){return this.eventDispatcher.dispatchEvent},ws=function(e){const s=e.getUint8(0),i=Ns[s];t(this,ps,"m",bs).call(this,i)},bs=function(s){if(Os.assertEnumWithError(s,Ns),s==t(this,ys,"f"))return void Os.log(`redundant microphoneStatus ${s}`);const i=t(this,ys,"f");e(this,ys,s,"f"),Os.log(`updated microphoneStatus to "${this.microphoneStatus}"`),t(this,ps,"a",vs).call(this,"microphoneStatus",{microphoneStatus:this.microphoneStatus,previousMicrophoneStatus:i})},Cs=async function(t,e){Os.assertEnumWithError(t,Ps),Os.log(`sending microphone command "${t}"`);const s=this.waitForEvent("microphoneStatus");Os.log(`setting command "${t}"`);const i=Ps.indexOf(t);this.sendMessage([{type:"microphoneCommand",data:Y(i)}],e),await s},Ss=function(){Os.assertWithError("idle"!=t(this,ys,"f"),"microphone is idle")},Es=function(){Os.assertEnumWithError(this.bitDepth,qs)},ks=function(s){t(this,ps,"m",Es).call(this),Os.log("parsing microphone data",s);const i=s.byteLength/t(this,ps,"a",Ws),n=new Float32Array(i);for(let t=0;t<i;t++){let e;switch(this.bitDepth){case"16":e=s.getInt16(2*t,!0),n[t]=e/32768;break;case"8":e=s.getInt8(t),n[t]=e/128}}if(Os.log("samples",n),t(this,Bs,"f")&&t(this,$s,"f")&&t(this,$s,"f").push(n),t(this,As,"f")&&t(this,_s,"f")){const s=t(this,As,"f").createBuffer(1,n.length,Number(this.sampleRate));s.getChannelData(0).set(n);const i=t(this,As,"f").createBufferSource();i.buffer=s;const a=s.getChannelData(0),r=Number(this.sampleRate);for(let e=0;e<t(this,Ms,"f")*r;e++)a[e]*=e/(t(this,Ms,"f")*r);for(let e=a.length-1;e>=a.length-t(this,Ms,"f")*r;e--)a[e]*=(a.length-e)/(t(this,Ms,"f")*r);i.connect(t(this,_s,"f")),t(this,Ds,"f")<t(this,As,"f").currentTime&&e(this,Ds,t(this,As,"f").currentTime,"f"),i.start(t(this,Ds,"f")),e(this,Ds,t(this,Ds,"f")+s.duration,"f")}t(this,ps,"a",vs).call(this,"microphoneData",{samples:n,sampleRate:this.sampleRate,bitDepth:this.bitDepth})},Ws=function(){switch(this.bitDepth){case"8":return 1;case"16":return 2}},xs=function(s){const i={};let n=0;for(;n<s.byteLength;){const t=s.getUint8(n++),e=Vs[t];Os.assertWithError(e,`invalid microphoneConfigurationTypeIndex ${t}`);let a=s.getUint8(n++);const r=js[e],o=r[a];Os.assertEnumWithError(o,r),Os.log({microphoneConfigurationType:e,value:o}),i[e]=o}Os.log({parsedMicrophoneConfiguration:i}),e(this,Rs,Object.keys(i),"f"),e(this,Ts,i,"f"),t(this,ps,"a",vs).call(this,"getMicrophoneConfiguration",{microphoneConfiguration:t(this,Ts,"f")})},Is=function(t){return Object.keys(t).every((e=>this.microphoneConfiguration[e]==t[e]))},Ls=function(e){Os.assertWithError(t(this,Rs,"f"),"must get initial microphoneConfiguration");const s=t(this,Rs,"f")?.includes(e);return Os.assertWithError(s,`unavailable microphone configuration type "${e}"`),s},Us=function(e){let s=Object.keys(e);s=s.filter((e=>t(this,ps,"m",Ls).call(this,e)));const i=new DataView(new ArrayBuffer(2*s.length));return s.forEach(((t,s)=>{ms.AssertValidMicrophoneConfigurationType(t);const n=Vs.indexOf(t);i.setUint8(2*s,n);let a=e[t];"number"==typeof a&&(a=a.toString());const r=js[t];Os.assertEnumWithError(a,r);const o=r.indexOf(a);i.setUint8(2*s+1,o)})),Os.log({sensorConfigurationData:i}),i};const Js=W("SensorDataManager",{log:!1}),Ks=[...ge,"acceleration","gravity","linearAcceleration","gyroscope","magnetometer","gameRotation","rotation","orientation","activity","stepCounter","stepDetector","deviceOrientation","tapDetector",...Se,"camera","microphone"],Qs=[...de,"acceleration","gravity","linearAcceleration","gyroscope","magnetometer","gameRotation","rotation","orientation",...Ee],Zs=["getPressurePositions","getSensorScalars","sensorData"],ti=["getPressurePositions"],ei=[...Zs,...Ks];class si{constructor(){this.pressureSensorDataManager=new pe,this.motionSensorDataManager=new we,this.barometerSensorDataManager=new De,Ys.set(this,new Map)}static AssertValidSensorType(t){Js.assertEnumWithError(t,Ks)}static AssertValidSensorTypeEnum(t){Js.assertTypeWithError(t,"number"),Js.assertWithError(t in Ks,`invalid sensorTypeEnum ${t}`)}get dispatchEvent(){return this.eventDispatcher.dispatchEvent}parseMessage(t,e){switch(Js.log({messageType:t}),t){case"getSensorScalars":this.parseScalars(e);break;case"getPressurePositions":this.pressureSensorDataManager.parsePositions(e);break;case"sensorData":this.parseData(e);break;default:throw Error(`uncaught messageType ${t}`)}}parseScalars(e){for(let s=0;s<e.byteLength;s+=5){const i=e.getUint8(s),n=Ks[i];if(!n){Js.warn(`unknown sensorType index ${i}`);continue}const a=e.getFloat32(s+1,!0);Js.log({sensorType:n,sensorScalar:a}),t(this,Ys,"f").set(n,a)}}parseData(t){Js.log("sensorData",Array.from(new Uint8Array(t.buffer)));let e=0;const s=Yt(t,e);e+=2;Te(new DataView(t.buffer,e),Ks,this.parseDataCallback.bind(this),{timestamp:s})}parseDataCallback(e,s,{timestamp:i}){const n=t(this,Ys,"f").get(e)||1;let a=null;switch(e){case"pressure":a=this.pressureSensorDataManager.parseData(s,n);break;case"acceleration":case"gravity":case"linearAcceleration":case"gyroscope":case"magnetometer":a=this.motionSensorDataManager.parseVector3(s,n);break;case"gameRotation":case"rotation":a=this.motionSensorDataManager.parseQuaternion(s,n);break;case"orientation":a=this.motionSensorDataManager.parseEuler(s,n);break;case"stepCounter":a=this.motionSensorDataManager.parseStepCounter(s);break;case"stepDetector":case"tapDetector":a={};break;case"activity":a=this.motionSensorDataManager.parseActivity(s);break;case"deviceOrientation":a=this.motionSensorDataManager.parseDeviceOrientation(s);break;case"barometer":a=this.barometerSensorDataManager.parseData(s,n);break;case"camera":case"microphone":return;default:Js.error(`uncaught sensorType "${e}"`)}Js.assertWithError(null!=a,`no sensorData defined for sensorType "${e}"`),Js.log({sensorType:e,sensorData:a}),this.dispatchEvent(e,{sensorType:e,[e]:a,timestamp:i}),this.dispatchEvent("sensorData",{sensorType:e,[e]:a,timestamp:i})}}var ii,ni,ai,ri,oi,hi,ci,li,fi,gi,di,ui,pi;Ys=new WeakMap;const mi=W("SensorConfigurationManager",{log:!1}),vi=65535,yi=5,wi=["getSensorConfiguration","setSensorConfiguration"],bi=wi;class Ci{constructor(){ii.add(this),ri.set(this,void 0),hi.set(this,{}),J(this)}get addEventListener(){return this.eventDispatcher.addEventListener}get waitForEvent(){return this.eventDispatcher.waitForEvent}get configuration(){return t(this,hi,"f")}async setConfiguration(e,s,i){if(s&&(e=Object.assign({...this.zeroSensorConfiguration},e)),mi.log({newSensorConfiguration:e}),t(this,ii,"m",li).call(this,e))return void mi.log("redundant sensor configuration");const n=t(this,ii,"m",ui).call(this,e);mi.log({setSensorConfigurationData:n});const a=this.waitForEvent("getSensorConfiguration");this.sendMessage([{type:"setSensorConfiguration",data:n.buffer}],i),await a}static get ZeroSensorConfiguration(){return t(this,ni,"f",pi)}get zeroSensorConfiguration(){const e={};return t(this,ri,"f").forEach((t=>{e[t]=0})),e}async clearSensorConfiguration(){return this.setConfiguration(this.zeroSensorConfiguration)}parseMessage(e,s){switch(mi.log({messageType:e}),e){case"getSensorConfiguration":case"setSensorConfiguration":const i=t(this,ii,"m",fi).call(this,s);t(this,ii,"m",ci).call(this,i);break;default:throw Error(`uncaught messageType ${e}`)}}}var Si,Ei,Mi,Di,ki,Wi,Ti,Ri,xi,Ii,Li,Ui,Ai,_i,Fi,Bi,$i,Oi,Pi,Ni,Vi,qi,zi,ji,Gi,Hi,Xi,Yi,Ji,Ki,Qi;ni=Ci,ri=new WeakMap,hi=new WeakMap,ii=new WeakSet,ai=function(){return this.eventDispatcher.dispatchEvent},oi=function(e){mi.assertWithError(t(this,ri,"f"),"must get initial sensorConfiguration");const s=t(this,ri,"f")?.includes(e);return mi.log(s,`unavailable sensor type "${e}"`),s},ci=function(s){e(this,hi,s,"f"),mi.log({updatedConfiguration:t(this,hi,"f")}),t(this,ii,"a",ai).call(this,"getSensorConfiguration",{sensorConfiguration:this.configuration})},li=function(t){return Object.keys(t).every((e=>this.configuration[e]==t[e]))},fi=function(t){const s={};for(let e=0;e<t.byteLength;e+=3){const i=t.getUint8(e),n=Ks[i],a=t.getUint16(e+1,!0);mi.log({sensorType:n,sensorRate:a}),n?s[n]=a:mi.warn(`unknown sensorType index ${i}`)}return mi.log({parsedSensorConfiguration:s}),e(this,ri,Object.keys(s),"f"),s},gi=function(t){mi.assertTypeWithError(t,"number"),mi.assertWithError(t>=0,`sensorRate must be 0 or greater (got ${t})`),mi.assertWithError(t<65535,`sensorRate must be 0 or greater (got ${t})`),mi.assertWithError(t%5==0,"sensorRate must be multiple of 5")},di=function(e){t(ni,ni,"m",gi).call(ni,e)},ui=function(e){let s=Object.keys(e);s=s.filter((e=>t(this,ii,"m",oi).call(this,e)));const i=new DataView(new ArrayBuffer(3*s.length));return s.forEach(((s,n)=>{si.AssertValidSensorType(s);const a=Ks.indexOf(s);i.setUint8(3*n,a);const r=e[s];t(this,ii,"m",di).call(this,r),i.setUint16(3*n+1,r,!0)})),mi.log({sensorConfigurationData:i}),i},pi={value:{}},Ks.forEach((e=>{t(ni,ni,"f",pi)[e]=0}));const Zi=W("TfliteManager",{log:!1}),tn=["getTfliteName","setTfliteName","getTfliteTask","setTfliteTask","getTfliteSampleRate","setTfliteSampleRate","getTfliteSensorTypes","setTfliteSensorTypes","tfliteIsReady","getTfliteCaptureDelay","setTfliteCaptureDelay","getTfliteThreshold","setTfliteThreshold","getTfliteInferencingEnabled","setTfliteInferencingEnabled","tfliteInference"],en=tn,sn=["getTfliteName","getTfliteTask","getTfliteSampleRate","getTfliteSensorTypes","tfliteIsReady","getTfliteCaptureDelay","getTfliteThreshold","getTfliteInferencingEnabled"],nn=["classification","regression"],an=["pressure","linearAcceleration","gyroscope","magnetometer"];class rn{constructor(){Si.add(this),ki.set(this,void 0),Ri.set(this,void 0),Li.set(this,void 0),_i.set(this,[]),$i.set(this,void 0),Vi.set(this,void 0),ji.set(this,void 0),Xi.set(this,void 0),Qi.set(this,void 0),J(this)}get addEventListenter(){return this.eventDispatcher.addEventListener}get removeEventListener(){return this.eventDispatcher.removeEventListener}get waitForEvent(){return this.eventDispatcher.waitForEvent}get name(){return t(this,ki,"f")}async setName(t,e){if(Zi.assertTypeWithError(t,"string"),this.name==t)return void Zi.log(`redundant name assignment ${t}`);const s=this.waitForEvent("getTfliteName"),i=V.encode(t);this.sendMessage([{type:"setTfliteName",data:i.buffer}],e),await s}get task(){return t(this,Ri,"f")}async setTask(e,s){if(t(this,Si,"m",Ei).call(this,e),this.task==e)return void Zi.log(`redundant task assignment ${e}`);const i=this.waitForEvent("getTfliteTask");nn.indexOf(e),this.sendMessage([{type:"setTfliteTask",data:Y(commandEnum)}],s),await i}get sampleRate(){return t(this,Li,"f")}async setSampleRate(e,s){if(Zi.assertTypeWithError(e,"number"),e-=e%5,Zi.assertWithError(e>=5,`sampleRate must be multiple of 5 greater than 0 (got ${e})`),t(this,Li,"f")==e)return void Zi.log(`redundant sampleRate assignment ${e}`);const i=this.waitForEvent("getTfliteSampleRate"),n=new DataView(new ArrayBuffer(2));n.setUint16(0,e,!0),this.sendMessage([{type:"setTfliteSampleRate",data:n.buffer}],s),await i}static AssertValidSensorType(t){si.AssertValidSensorType(t);const e=t;Zi.assertWithError(an.includes(e),`invalid tflite sensorType "${t}"`)}get sensorTypes(){return t(this,_i,"f").slice()}async setSensorTypes(t,e){t.forEach((t=>{rn.AssertValidSensorType(t)}));const s=this.waitForEvent("getTfliteSensorTypes");var i;const n=(t=(i=t).filter(((t,e)=>i.indexOf(t)==e))).map((t=>Ks.indexOf(t))).sort();Zi.log(t,n),this.sendMessage([{type:"setTfliteSensorTypes",data:Uint8Array.from(n).buffer}],e),await s}get isReady(){return t(this,$i,"f")}get captureDelay(){return t(this,Vi,"f")}async setCaptureDelay(e,s){if(Zi.assertTypeWithError(e,"number"),t(this,Vi,"f")==e)return void Zi.log(`redundant captureDelay assignment ${e}`);const i=this.waitForEvent("getTfliteCaptureDelay"),n=new DataView(new ArrayBuffer(2));n.setUint16(0,e,!0),this.sendMessage([{type:"setTfliteCaptureDelay",data:n.buffer}],s),await i}get threshold(){return t(this,ji,"f")}async setThreshold(e,s){if(Zi.assertTypeWithError(e,"number"),Zi.assertWithError(e>=0,`threshold must be positive (got ${e})`),t(this,ji,"f")==e)return void Zi.log(`redundant threshold assignment ${e}`);const i=this.waitForEvent("getTfliteThreshold"),n=new DataView(new ArrayBuffer(4));n.setFloat32(0,e,!0),this.sendMessage([{type:"setTfliteThreshold",data:n.buffer}],s),await i}get inferencingEnabled(){return t(this,Xi,"f")}async setInferencingEnabled(e,s=!0){if(Zi.assertTypeWithError(e,"boolean"),!e&&!this.isReady)return;if(t(this,Si,"m",Ni).call(this),t(this,Xi,"f")==e)return void Zi.log(`redundant inferencingEnabled assignment ${e}`);const i=this.waitForEvent("getTfliteInferencingEnabled");this.sendMessage([{type:"setTfliteInferencingEnabled",data:Y(Number(e))}],s),await i}async toggleInferencingEnabled(){return this.setInferencingEnabled(!this.inferencingEnabled)}async enableInferencing(){this.inferencingEnabled||this.setInferencingEnabled(!0)}async disableInferencing(){this.inferencingEnabled&&this.setInferencingEnabled(!1)}parseMessage(e,s){switch(Zi.log({messageType:e}),e){case"getTfliteName":case"setTfliteName":t(this,Si,"m",Wi).call(this,s);break;case"getTfliteTask":case"setTfliteTask":t(this,Si,"m",xi).call(this,s);break;case"getTfliteSampleRate":case"setTfliteSampleRate":t(this,Si,"m",Ui).call(this,s);break;case"getTfliteSensorTypes":case"setTfliteSensorTypes":t(this,Si,"m",Fi).call(this,s);break;case"tfliteIsReady":t(this,Si,"m",Oi).call(this,s);break;case"getTfliteCaptureDelay":case"setTfliteCaptureDelay":t(this,Si,"m",qi).call(this,s);break;case"getTfliteThreshold":case"setTfliteThreshold":t(this,Si,"m",Gi).call(this,s);break;case"getTfliteInferencingEnabled":case"setTfliteInferencingEnabled":t(this,Si,"m",Yi).call(this,s);break;case"tfliteInference":t(this,Si,"m",Ki).call(this,s);break;default:throw Error(`uncaught messageType ${e}`)}}get configuration(){return t(this,Qi,"f")}sendConfiguration(s,i){if(s==t(this,Qi,"f"))return void Zi.log("redundant tflite configuration assignment");if(e(this,Qi,s,"f"),Zi.log("assigned new tflite configuration",this.configuration),!this.configuration)return;const{name:n,task:a,captureDelay:r,sampleRate:o,threshold:h,sensorTypes:c}=this.configuration;this.setName(n,!1),this.setTask(a,!1),null!=r&&this.setCaptureDelay(r,!1),this.setSampleRate(o,!1),null!=h&&this.setThreshold(h,!1),this.setSensorTypes(c,i)}clear(){e(this,Qi,void 0,"f"),e(this,Xi,!1,"f"),e(this,_i,[],"f"),e(this,Li,0,"f"),e(this,$i,!1,"f")}requestRequiredInformation(){Zi.log("requesting required tflite information");const t=sn.map((t=>({type:t})));this.sendMessage(t,!1)}}var on,hn,cn,ln,fn;ki=new WeakMap,Ri=new WeakMap,Li=new WeakMap,_i=new WeakMap,$i=new WeakMap,Vi=new WeakMap,ji=new WeakMap,Xi=new WeakMap,Qi=new WeakMap,Si=new WeakSet,Ei=function(t){Zi.assertEnumWithError(t,nn)},Mi=function(t){Zi.assertWithError(t in nn,`invalid taskEnum ${t}`)},Di=function(){return this.eventDispatcher.dispatchEvent},Wi=function(e){Zi.log("parseName",e);const s=q.decode(e.buffer);t(this,Si,"m",Ti).call(this,s)},Ti=function(s){Zi.log({name:s}),e(this,ki,s,"f"),t(this,Si,"a",Di).call(this,"getTfliteName",{tfliteName:s})},xi=function(e){Zi.log("parseTask",e);const s=e.getUint8(0);t(this,Si,"m",Mi).call(this,s);const i=nn[s];t(this,Si,"m",Ii).call(this,i)},Ii=function(s){Zi.log({task:s}),e(this,Ri,s,"f"),t(this,Si,"a",Di).call(this,"getTfliteTask",{tfliteTask:s})},Ui=function(e){Zi.log("parseSampleRate",e);const s=e.getUint16(0,!0);t(this,Si,"m",Ai).call(this,s)},Ai=function(s){Zi.log({sampleRate:s}),e(this,Li,s,"f"),t(this,Si,"a",Di).call(this,"getTfliteSampleRate",{tfliteSampleRate:s})},Fi=function(e){Zi.log("parseSensorTypes",e);const s=[];for(let t=0;t<e.byteLength;t++){const i=e.getUint8(t),n=Ks[i];n?an.includes(n)?s.push(n):Zi.error(`invalid tfliteSensorType ${n}`):Zi.error(`invalid sensorTypeEnum ${i}`)}t(this,Si,"m",Bi).call(this,s)},Bi=function(s){Zi.log({sensorTypes:s}),e(this,_i,s,"f"),t(this,Si,"a",Di).call(this,"getTfliteSensorTypes",{tfliteSensorTypes:s})},Oi=function(e){Zi.log("parseIsReady",e);const s=Boolean(e.getUint8(0));t(this,Si,"m",Pi).call(this,s)},Pi=function(s){Zi.log({isReady:s}),e(this,$i,s,"f"),t(this,Si,"a",Di).call(this,"tfliteIsReady",{tfliteIsReady:s})},Ni=function(){Zi.assertWithError(this.isReady,"tflite is not ready")},qi=function(e){Zi.log("parseCaptureDelay",e);const s=e.getUint16(0,!0);t(this,Si,"m",zi).call(this,s)},zi=function(s){Zi.log({captureDelay:s}),e(this,Vi,s,"f"),t(this,Si,"a",Di).call(this,"getTfliteCaptureDelay",{tfliteCaptureDelay:s})},Gi=function(e){Zi.log("parseThreshold",e);const s=e.getFloat32(0,!0);t(this,Si,"m",Hi).call(this,s)},Hi=function(s){Zi.log({threshold:s}),e(this,ji,s,"f"),t(this,Si,"a",Di).call(this,"getTfliteThreshold",{tfliteThreshold:s})},Yi=function(e){Zi.log("parseInferencingEnabled",e);const s=Boolean(e.getUint8(0));t(this,Si,"m",Ji).call(this,s)},Ji=function(s){Zi.log({inferencingEnabled:s}),e(this,Xi,s,"f"),t(this,Si,"a",Di).call(this,"getTfliteInferencingEnabled",{tfliteInferencingEnabled:s})},Ki=function(e){Zi.log("parseInference",e);const s=Yt(e,0);Zi.log({timestamp:s});const i=[];for(let t=0,s=2;s<e.byteLength;t++,s+=4){const t=e.getFloat32(s,!0);i.push(t)}Zi.log("values",i);const n={timestamp:s,values:i};if("classification"==this.task){let e=0,s=0;if(i.forEach(((t,i)=>{t>e&&(e=t,s=i)})),Zi.log({maxIndex:s,maxValue:e}),n.maxIndex=s,n.maxValue=e,t(this,Qi,"f")?.classes){const{classes:e}=t(this,Qi,"f");n.maxClass=e[s],n.classValues={},i.forEach(((t,s)=>{const i=e[s];n.classValues[i]=t}))}}t(this,Si,"a",Di).call(this,"tfliteInference",{tfliteInference:n})};const gn=W("DeviceInformationManager",{log:!1}),dn=["manufacturerName","modelNumber","hardwareRevision","firmwareRevision","softwareRevision","pnpId","serialNumber"],un=[...dn,"deviceInformation"];class pn{constructor(){on.add(this),cn.set(this,{})}get information(){return t(this,cn,"f")}clear(){e(this,cn,{},"f")}parseMessage(e,s){switch(gn.log({messageType:e}),e){case"manufacturerName":const i=q.decode(s.buffer);gn.log({manufacturerName:i}),t(this,on,"m",fn).call(this,{manufacturerName:i});break;case"modelNumber":const n=q.decode(s.buffer);gn.log({modelNumber:n}),t(this,on,"m",fn).call(this,{modelNumber:n});break;case"softwareRevision":const a=q.decode(s.buffer);gn.log({softwareRevision:a}),t(this,on,"m",fn).call(this,{softwareRevision:a});break;case"hardwareRevision":const r=q.decode(s.buffer);gn.log({hardwareRevision:r}),t(this,on,"m",fn).call(this,{hardwareRevision:r});break;case"firmwareRevision":const o=q.decode(s.buffer);gn.log({firmwareRevision:o}),t(this,on,"m",fn).call(this,{firmwareRevision:o});break;case"pnpId":const h={source:1===s.getUint8(0)?"Bluetooth":"USB",productId:s.getUint16(3,!0),productVersion:s.getUint16(5,!0),vendorId:0};"Bluetooth"==h.source&&(h.vendorId=s.getUint16(1,!0)),gn.log({pnpId:h}),t(this,on,"m",fn).call(this,{pnpId:h});break;case"serialNumber":const c=q.decode(s.buffer);gn.log({serialNumber:c});break;default:throw Error(`uncaught messageType ${e}`)}}}var mn,vn,yn,wn,bn,Cn,Sn,En,Mn,Dn,kn,Wn,Tn,Rn,xn,In,Ln,Un;cn=new WeakMap,on=new WeakSet,hn=function(){return this.eventDispatcher.dispatchEvent},ln=function(){return dn.filter((t=>"serialNumber"!=t)).every((e=>e in t(this,cn,"f")))},fn=function(e){gn.log({partialDeviceInformation:e});Object.keys(e).forEach((s=>{t(this,on,"a",hn).call(this,s,{[s]:e[s]})})),Object.assign(t(this,cn,"f"),e),gn.log({deviceInformation:t(this,cn,"f")}),t(this,on,"a",ln)&&(gn.log("completed deviceInformation"),t(this,on,"a",hn).call(this,"deviceInformation",{deviceInformation:this.information}))};const An=W("InformationManager",{log:!1}),_n=["leftInsole","rightInsole","leftGlove","rightGlove","glasses","generic"],Fn=["left","right"],Bn=2,$n=30,On=["isCharging","getBatteryCurrent","getMtu","getId","getName","setName","getType","setType","getCurrentTime","setCurrentTime"],Pn=On;class Nn{constructor(){mn.add(this),yn.set(this,!1),bn.set(this,void 0),Sn.set(this,void 0),Mn.set(this,""),Dn.set(this,void 0),Rn.set(this,0),In.set(this,!1),J(this)}get waitForEvent(){return this.eventDispatcher.waitForEvent}get isCharging(){return t(this,yn,"f")}get batteryCurrent(){return t(this,bn,"f")}async getBatteryCurrent(){An.log("getting battery current...");const t=this.waitForEvent("getBatteryCurrent");this.sendMessage([{type:"getBatteryCurrent"}]),await t}get id(){return t(this,Sn,"f")}get name(){return t(this,Mn,"f")}updateName(s){An.assertTypeWithError(s,"string"),e(this,Mn,s,"f"),An.log({updatedName:t(this,Mn,"f")}),t(this,mn,"a",vn).call(this,"getName",{name:t(this,Mn,"f")})}async setName(t){An.assertTypeWithError(t,"string"),An.assertRangeWithError("newName",t.length,2,30);const e=V.encode(t);An.log({setNameData:e});const s=this.waitForEvent("getName");this.sendMessage([{type:"setName",data:e.buffer}]),await s}get type(){return t(this,Dn,"f")}get typeEnum(){return _n.indexOf(this.type)}updateType(s){t(this,mn,"m",kn).call(this,s),e(this,Dn,s,"f"),An.log({updatedType:t(this,Dn,"f")}),t(this,mn,"a",vn).call(this,"getType",{type:t(this,Dn,"f")})}async setType(e){t(this,mn,"m",kn).call(this,e);const s=_n.indexOf(e);t(this,mn,"m",Tn).call(this,s)}get isInsole(){switch(this.type){case"leftInsole":case"rightInsole":return!0;default:return!1}}get isGlove(){switch(this.type){case"leftGlove":case"rightGlove":return!0;default:return!1}}get side(){switch(this.type){case"leftInsole":case"leftGlove":default:return"left";case"rightInsole":case"rightGlove":return"right"}}get mtu(){return t(this,Rn,"f")}get isCurrentTimeSet(){return t(this,In,"f")}parseMessage(e,s){switch(An.log({messageType:e}),e){case"isCharging":const i=Boolean(s.getUint8(0));An.log({isCharging:i}),t(this,mn,"m",wn).call(this,i);break;case"getBatteryCurrent":const n=s.getFloat32(0,!0);An.log({batteryCurrent:n}),t(this,mn,"m",Cn).call(this,n);break;case"getId":const a=q.decode(s.buffer);An.log({id:a}),t(this,mn,"m",En).call(this,a);break;case"getName":case"setName":const r=q.decode(s.buffer);An.log({name:r}),this.updateName(r);break;case"getType":case"setType":const o=s.getUint8(0),h=_n[o];An.log({typeEnum:o,type:h}),this.updateType(h);break;case"getMtu":let c=s.getUint16(0,!0);"webSocket"!=this.connectionType&&"udp"!=this.connectionType&&(c=Math.min(c,512)),An.log({mtu:c}),t(this,mn,"m",xn).call(this,c);break;case"getCurrentTime":case"setCurrentTime":const l=Number(s.getBigUint64(0,!0));t(this,mn,"m",Ln).call(this,l);break;default:throw Error(`uncaught messageType ${e}`)}}clear(){e(this,In,!1,"f")}}yn=new WeakMap,bn=new WeakMap,Sn=new WeakMap,Mn=new WeakMap,Dn=new WeakMap,Rn=new WeakMap,In=new WeakMap,mn=new WeakSet,vn=function(){return this.eventDispatcher.dispatchEvent},wn=function(s){An.assertTypeWithError(s,"boolean"),e(this,yn,s,"f"),An.log({isCharging:t(this,yn,"f")}),t(this,mn,"a",vn).call(this,"isCharging",{isCharging:t(this,yn,"f")})},Cn=function(s){An.assertTypeWithError(s,"number"),e(this,bn,s,"f"),An.log({batteryCurrent:t(this,bn,"f")}),t(this,mn,"a",vn).call(this,"getBatteryCurrent",{batteryCurrent:t(this,bn,"f")})},En=function(s){An.assertTypeWithError(s,"string"),e(this,Sn,s,"f"),An.log({id:t(this,Sn,"f")}),t(this,mn,"a",vn).call(this,"getId",{id:t(this,Sn,"f")})},kn=function(t){An.assertEnumWithError(t,_n)},Wn=function(t){An.assertTypeWithError(t,"number"),An.assertWithError(t in _n,`invalid typeEnum ${t}`)},Tn=async function(e){t(this,mn,"m",Wn).call(this,e);const s=Y(e);An.log({setTypeData:s});const i=this.waitForEvent("getType");this.sendMessage([{type:"setType",data:s}]),await i},xn=function(s){An.assertTypeWithError(s,"number"),t(this,Rn,"f")!=s?(e(this,Rn,s,"f"),t(this,mn,"a",vn).call(this,"getMtu",{mtu:t(this,Rn,"f")})):An.log("redundant mtu assignment",s)},Ln=function(s){An.log({currentTime:s}),e(this,In,0!=s||Math.abs(Date.now()-s)<Xt,"f"),t(this,In,"f")||t(this,mn,"m",Un).call(this,!1)},Un=async function(t){An.log("setting current time...");const e=new DataView(new ArrayBuffer(8));e.setBigUint64(0,BigInt(Date.now()),!0);const s=this.waitForEvent("getCurrentTime");this.sendMessage([{type:"setCurrentTime",data:e.buffer}],t),await s};const Vn=["none","strongClick100","strongClick60","strongClick30","sharpClick100","sharpClick60","sharpClick30","softBump100","softBump60","softBump30","doubleClick100","doubleClick60","tripleClick100","softFuzz60","strongBuzz100","alert750ms","alert1000ms","strongClick1_100","strongClick2_80","strongClick3_60","strongClick4_30","mediumClick100","mediumClick80","mediumClick60","sharpTick100","sharpTick80","sharpTick60","shortDoubleClickStrong100","shortDoubleClickStrong80","shortDoubleClickStrong60","shortDoubleClickStrong30","shortDoubleClickMedium100","shortDoubleClickMedium80","shortDoubleClickMedium60","shortDoubleSharpTick100","shortDoubleSharpTick80","shortDoubleSharpTick60","longDoubleSharpClickStrong100","longDoubleSharpClickStrong80","longDoubleSharpClickStrong60","longDoubleSharpClickStrong30","longDoubleSharpClickMedium100","longDoubleSharpClickMedium80","longDoubleSharpClickMedium60","longDoubleSharpTick100","longDoubleSharpTick80","longDoubleSharpTick60","buzz100","buzz80","buzz60","buzz40","buzz20","pulsingStrong100","pulsingStrong60","pulsingMedium100","pulsingMedium60","pulsingSharp100","pulsingSharp60","transitionClick100","transitionClick80","transitionClick60","transitionClick40","transitionClick20","transitionClick10","transitionHum100","transitionHum80","transitionHum60","transitionHum40","transitionHum20","transitionHum10","transitionRampDownLongSmooth2_100","transitionRampDownLongSmooth1_100","transitionRampDownMediumSmooth1_100","transitionRampDownMediumSmooth2_100","transitionRampDownShortSmooth1_100","transitionRampDownShortSmooth2_100","transitionRampDownLongSharp1_100","transitionRampDownLongSharp2_100","transitionRampDownMediumSharp1_100","transitionRampDownMediumSharp2_100","transitionRampDownShortSharp1_100","transitionRampDownShortSharp2_100","transitionRampUpLongSmooth1_100","transitionRampUpLongSmooth2_100","transitionRampUpMediumSmooth1_100","transitionRampUpMediumSmooth2_100","transitionRampUpShortSmooth1_100","transitionRampUpShortSmooth2_100","transitionRampUpLongSharp1_100","transitionRampUpLongSharp2_100","transitionRampUpMediumSharp1_100","transitionRampUpMediumSharp2_100","transitionRampUpShortSharp1_100","transitionRampUpShortSharp2_100","transitionRampDownLongSmooth1_50","transitionRampDownLongSmooth2_50","transitionRampDownMediumSmooth1_50","transitionRampDownMediumSmooth2_50","transitionRampDownShortSmooth1_50","transitionRampDownShortSmooth2_50","transitionRampDownLongSharp1_50","transitionRampDownLongSharp2_50","transitionRampDownMediumSharp1_50","transitionRampDownMediumSharp2_50","transitionRampDownShortSharp1_50","transitionRampDownShortSharp2_50","transitionRampUpLongSmooth1_50","transitionRampUpLongSmooth2_50","transitionRampUpMediumSmooth1_50","transitionRampUpMediumSmooth2_50","transitionRampUpShortSmooth1_50","transitionRampUpShortSmooth2_50","transitionRampUpLongSharp1_50","transitionRampUpLongSharp2_50","transitionRampUpMediumSharp1_50","transitionRampUpMediumSharp2_50","transitionRampUpShortSharp1_50","transitionRampUpShortSharp2_50","longBuzz100","smoothHum50","smoothHum40","smoothHum30","smoothHum20","smoothHum10"];var qn,zn,jn,Gn,Hn,Xn,Yn,Jn,Kn,Qn,Zn,ta,ea,sa,ia,na,aa,ra,oa;const ha=W("VibrationManager",{log:!1}),ca=["front","rear"],la=["waveformEffect","waveform"],fa=["getVibrationLocations","triggerVibration"],ga=fa,da=8,ua=2550,pa=1270,ma=3,va=20,ya=6;class wa{constructor(){qn.add(this),ra.set(this,[]),J(this)}get waitForEvent(){return this.eventDispatcher.waitForEvent}async triggerVibration(e,s=!0){let i;e.forEach((e=>{const{type:s}=e;let n,{locations:a}=e;switch(a=a||this.vibrationLocations.slice(),a=a.filter((t=>this.vibrationLocations.includes(t))),s){case"waveformEffect":{const{segments:s,loopCount:i}=e;n=t(this,qn,"m",sa).call(this,a,s,i)}break;case"waveform":{const{segments:s}=e;n=t(this,qn,"m",ia).call(this,a,s)}break;default:throw Error(`invalid vibration type "${s}"`)}ha.log({type:s,arrayBuffer:n}),i=j(i,n)})),await this.sendMessage([{type:"triggerVibration",data:i}],s)}get vibrationLocations(){return t(this,ra,"f")}parseMessage(e,s){if(ha.log({messageType:e}),"getVibrationLocations"!==e)throw Error(`uncaught messageType ${e}`);{const e=Array.from(new Uint8Array(s.buffer)).map((t=>ca[t])).filter(Boolean);t(this,qn,"m",oa).call(this,e)}}}var ba,Ca,Sa,Ea,Ma,Da,ka,Wa,Ta,Ra,xa,Ia,La,Ua,Aa,_a,Fa;ra=new WeakMap,qn=new WeakSet,zn=function(){return this.eventDispatcher.dispatchEvent},jn=function(t){ha.assertTypeWithError(t,"string"),ha.assertWithError(ca.includes(t),`invalid location "${t}"`)},Gn=function(e){t(this,qn,"m",Xn).call(this,e),e.forEach((e=>{t(this,qn,"m",jn).call(this,e)}))},Hn=function(e){t(this,qn,"m",Gn).call(this,e);let s=0;return e.forEach((t=>{const e=ca.indexOf(t);s|=1<<e})),ha.log({locationsBitmask:s}),ha.assertWithError(s>0,"locationsBitmask must not be zero"),s},Xn=function(t){ha.assertWithError(Array.isArray(t),"passed non-array"),ha.assertWithError(t.length>0,"passed empty array")},Yn=function(t){ha.assertWithError(Vn.includes(t),`invalid waveformEffect "${t}"`)},Jn=function(e){if(null!=e.effect){const s=e.effect;t(this,qn,"m",Yn).call(this,s)}else{if(null==e.delay)throw Error("no effect or delay found in waveformEffectSegment");{const{delay:t}=e;ha.assertWithError(t>=0,`delay must be 0ms or greater (got ${t})`),ha.assertWithError(t<=pa,`delay must be 1270ms or less (got ${t})`)}}if(null!=e.loopCount){const{loopCount:s}=e;t(this,qn,"m",Kn).call(this,s)}},Kn=function(t){ha.assertTypeWithError(t,"number"),ha.assertWithError(t>=0,`waveformEffectSegmentLoopCount must be 0 or greater (got ${t})`),ha.assertWithError(t<=3,`waveformEffectSegmentLoopCount must be 3 or fewer (got ${t})`)},Qn=function(e){t(this,qn,"m",Xn).call(this,e),ha.assertWithError(e.length<=8,`must have 8 waveformEffectSegments or fewer (got ${e.length})`),e.forEach((e=>{t(this,qn,"m",Jn).call(this,e)}))},Zn=function(t){ha.assertTypeWithError(t,"number"),ha.assertWithError(t>=0,`waveformEffectSequenceLoopCount must be 0 or greater (got ${t})`),ha.assertWithError(t<=6,`waveformEffectSequenceLoopCount must be 6 or fewer (got ${t})`)},ta=function(t){ha.assertTypeWithError(t.amplitude,"number"),ha.assertWithError(t.amplitude>=0,`amplitude must be 0 or greater (got ${t.amplitude})`),ha.assertWithError(t.amplitude<=1,`amplitude must be 1 or less (got ${t.amplitude})`),ha.assertTypeWithError(t.duration,"number"),ha.assertWithError(t.duration>0,`duration must be greater than 0ms (got ${t.duration}ms)`),ha.assertWithError(t.duration<=ua,`duration must be 2550ms or less (got ${t.duration}ms)`)},ea=function(e){t(this,qn,"m",Xn).call(this,e),ha.assertWithError(e.length<=20,`must have 20 waveformSegments or fewer (got ${e.length})`),e.forEach((e=>{t(this,qn,"m",ta).call(this,e)}))},sa=function(e,s,i=0){t(this,qn,"m",Qn).call(this,s),t(this,qn,"m",Zn).call(this,i);let n=[],a=0;const r=s.some((t=>{const{loopCount:e}=t;return null!=e&&e>0}))||0!=i;for(let t=0;t<s.length||r&&t<8;t++){const e=s[t]||{effect:"none"};if(null!=e.effect){const t=e.effect;n[a++]=Vn.indexOf(t)}else{if(null==e.delay)throw Error("invalid waveformEffectSegment");{const{delay:t}=e;n[a++]=128|Math.floor(t/10)}}}const o=0!=i;for(let t=0;t<s.length||o&&t<8;t++){const e=s[t]?.loopCount||0;0!=t&&4!=t||(n[a]=0);const i=t%4*2;n[a]|=e<<i,3!=t&&7!=t||a++}0!=i&&(n[a++]=i);const h=new DataView(Uint8Array.from(n).buffer);return ha.log({dataArray:n,dataView:h}),t(this,qn,"m",aa).call(this,e,"waveformEffect",h)},ia=function(e,s){t(this,qn,"m",ea).call(this,s);const i=new DataView(new ArrayBuffer(2*s.length));return s.forEach(((t,e)=>{i.setUint8(2*e,Math.floor(127*t.amplitude)),i.setUint8(2*e+1,Math.floor(t.duration/10))})),ha.log({dataView:i}),t(this,qn,"m",aa).call(this,e,"waveform",i)},na=function(t){ha.assertTypeWithError(t,"string"),ha.assertWithError(la.includes(t),`invalid vibrationType "${t}"`)},aa=function(e,s,i){ha.assertWithError(i?.byteLength>0,"no data received");const n=t(this,qn,"m",Hn).call(this,e);t(this,qn,"m",na).call(this,s);const a=la.indexOf(s);ha.log({locationsBitmask:n,vibrationTypeIndex:a,dataView:i});const r=j(n,a,i.byteLength,i);return ha.log({data:r}),r},oa=function(s){e(this,ra,s,"f"),ha.log("vibrationLocations",s),t(this,qn,"a",zn).call(this,"getVibrationLocations",{vibrationLocations:t(this,ra,"f")})};const Ba=W("WifiManager",{log:!1}),$a=1,Oa=32,Pa=8,Na=64,Va=["isWifiAvailable","getWifiSSID","setWifiSSID","getWifiPassword","setWifiPassword","getWifiConnectionEnabled","setWifiConnectionEnabled","isWifiConnected","ipAddress","isWifiSecure"],qa=["getWifiSSID","getWifiPassword","getWifiConnectionEnabled","isWifiConnected","ipAddress","isWifiSecure"],za=Va;class ja{constructor(){ba.add(this),Sa.set(this,!1),Da.set(this,""),Wa.set(this,""),Ra.set(this,void 0),Ia.set(this,!1),Ua.set(this,void 0),_a.set(this,!1),J(this)}get waitForEvent(){return this.eventDispatcher.waitForEvent}requestRequiredInformation(){Ba.log("requesting required wifi information");const t=qa.map((t=>({type:t})));this.sendMessage(t,!1)}get isWifiAvailable(){return t(this,Sa,"f")}get wifiSSID(){return t(this,Da,"f")}async setWifiSSID(e){if(t(this,ba,"m",Ma).call(this),t(this,Ra,"f"))return void Ba.error("cannot change ssid while wifi connection is enabled");Ba.assertTypeWithError(e,"string"),Ba.assertRangeWithError("wifiSSID",e.length,1,32);const s=V.encode(e);Ba.log({setWifiSSIDData:s});const i=this.waitForEvent("getWifiSSID");this.sendMessage([{type:"setWifiSSID",data:s.buffer}]),await i}get wifiPassword(){return t(this,Wa,"f")}async setWifiPassword(e){if(t(this,ba,"m",Ma).call(this),t(this,Ra,"f"))return void Ba.error("cannot change password while wifi connection is enabled");Ba.assertTypeWithError(e,"string"),e.length>0&&Ba.assertRangeWithError("wifiPassword",e.length,8,64);const s=V.encode(e);Ba.log({setWifiPasswordData:s});const i=this.waitForEvent("getWifiPassword");this.sendMessage([{type:"setWifiPassword",data:s.buffer}]),await i}get wifiConnectionEnabled(){return t(this,Ra,"f")}async setWifiConnectionEnabled(e,s=!0){if(t(this,ba,"m",Ma).call(this),Ba.assertTypeWithError(e,"boolean"),t(this,Ra,"f")==e)return void Ba.log(`redundant wifiConnectionEnabled assignment ${e}`);const i=this.waitForEvent("getWifiConnectionEnabled");this.sendMessage([{type:"setWifiConnectionEnabled",data:Y(Number(e))}],s),await i}async toggleWifiConnection(){return this.setWifiConnectionEnabled(!this.wifiConnectionEnabled)}async enableWifiConnection(){return this.setWifiConnectionEnabled(!0)}async disableWifiConnection(){return this.setWifiConnectionEnabled(!1)}get isWifiConnected(){return t(this,Ia,"f")}get ipAddress(){return t(this,Ua,"f")}get isWifiSecure(){return t(this,_a,"f")}parseMessage(e,s){switch(Ba.log({messageType:e}),e){case"isWifiAvailable":const i=Boolean(s.getUint8(0));Ba.log({isWifiAvailable:i}),t(this,ba,"m",Ea).call(this,i);break;case"getWifiSSID":case"setWifiSSID":const n=q.decode(s.buffer);Ba.log({ssid:n}),t(this,ba,"m",ka).call(this,n);break;case"getWifiPassword":case"setWifiPassword":const a=q.decode(s.buffer);Ba.log({password:a}),t(this,ba,"m",Ta).call(this,a);break;case"getWifiConnectionEnabled":case"setWifiConnectionEnabled":const r=Boolean(s.getUint8(0));Ba.log({enableWifiConnection:r}),t(this,ba,"m",xa).call(this,r);break;case"isWifiConnected":const o=Boolean(s.getUint8(0));Ba.log({isWifiConnected:o}),t(this,ba,"m",La).call(this,o);break;case"ipAddress":let h;4==s.byteLength&&(h=new Uint8Array(s.buffer.slice(0,4)).join(".")),Ba.log({ipAddress:h}),t(this,ba,"m",Aa).call(this,h);break;case"isWifiSecure":const c=Boolean(s.getUint8(0));Ba.log({isWifiSecure:c}),t(this,ba,"m",Fa).call(this,c);break;default:throw Error(`uncaught messageType ${e}`)}}clear(){e(this,Da,"","f"),e(this,Wa,"","f"),e(this,Ua,"","f"),e(this,Ia,!1,"f"),e(this,Sa,!1,"f")}}Sa=new WeakMap,Da=new WeakMap,Wa=new WeakMap,Ra=new WeakMap,Ia=new WeakMap,Ua=new WeakMap,_a=new WeakMap,ba=new WeakSet,Ca=function(){return this.eventDispatcher.dispatchEvent},Ea=function(s){Ba.assertTypeWithError(s,"boolean"),e(this,Sa,s,"f"),Ba.log({isWifiAvailable:t(this,Sa,"f")}),t(this,ba,"a",Ca).call(this,"isWifiAvailable",{isWifiAvailable:t(this,Sa,"f")})},Ma=function(){Ba.assertWithError(t(this,Sa,"f"),"wifi is not available")},ka=function(s){Ba.assertTypeWithError(s,"string"),e(this,Da,s,"f"),Ba.log({wifiSSID:t(this,Da,"f")}),t(this,ba,"a",Ca).call(this,"getWifiSSID",{wifiSSID:t(this,Da,"f")})},Ta=function(s){Ba.assertTypeWithError(s,"string"),e(this,Wa,s,"f"),Ba.log({wifiPassword:t(this,Wa,"f")}),t(this,ba,"a",Ca).call(this,"getWifiPassword",{wifiPassword:t(this,Wa,"f")})},xa=function(s){Ba.log({wifiConnectionEnabled:s}),e(this,Ra,s,"f"),t(this,ba,"a",Ca).call(this,"getWifiConnectionEnabled",{wifiConnectionEnabled:s})},La=function(s){Ba.assertTypeWithError(s,"boolean"),e(this,Ia,s,"f"),Ba.log({isWifiConnected:t(this,Ia,"f")}),t(this,ba,"a",Ca).call(this,"isWifiConnected",{isWifiConnected:t(this,Ia,"f")})},Aa=function(s){e(this,Ua,s,"f"),Ba.log({ipAddress:t(this,Ua,"f")}),t(this,ba,"a",Ca).call(this,"ipAddress",{ipAddress:t(this,Ua,"f")})},Fa=function(s){Ba.assertTypeWithError(s,"boolean"),e(this,_a,s,"f"),Ba.log({isWifiSecure:t(this,_a,"f")}),t(this,ba,"a",Ca).call(this,"isWifiSecure",{isWifiSecure:t(this,_a,"f")})};const Ga=W("ColorUtils",{log:!0});function Ha(t){3==(t=t.replace(/^#/,"")).length&&(t=t.split("").map((t=>t+t)).join("")),Ga.assertWithError(6==t.length,`hex length must be 6 (got ${t.length})`);return{r:parseInt(t.substring(0,2),16),g:parseInt(t.substring(2,4),16),b:parseInt(t.substring(4,6),16)}}const Xa={r:0,g:0,b:0};function Ya(t){return t.startsWith("#")?Ha(t):function(t){const e=document.createElement("div");e.style.color=t,document.body.appendChild(e);const s=getComputedStyle(e).color;document.body.removeChild(e);const i=s.match(/^rgba?\((\d+), (\d+), (\d+)/);return i?{r:parseInt(i[1],10),g:parseInt(i[2],10),b:parseInt(i[3],10)}:Xa}(t)}function Ja({r:t,g:e,b:s}){const i=t=>t.toString(16).padStart(2,"0").toUpperCase();return Ga.assertWithError([t,e,s].every((t=>t>=0&&t<=255)),`RGB values must be between 0 and 255 (got r=${t}, g=${e}, b=${s})`),`#${i(t)}${i(e)}${i(s)}`}var Ka;const Qa=W("DisplayContextStateHelper",{log:!1});class Za{constructor(){Ka.set(this,Object.assign({},jr))}get state(){return t(this,Ka,"f")}diff(e){let s=[];return Object.keys(e).forEach((i=>{const n=e[i];t(this,Ka,"f")[i]!=n&&s.push(i)})),Qa.log("diff",e,s),s}update(e){let s=this.diff(e);return 0==s.length&&Qa.log("redundant contextState",e),s.forEach((s=>{const i=e[s];t(this,Ka,"f")[s]=i})),s}reset(){Object.assign(t(this,Ka,"f"),jr)}}Ka=new WeakMap;const tr=W("DisplayUtils",{log:!1});function er(t){tr.assertEnumWithError(t,zr)}function sr(t){tr.assertEnumWithError(t,Vr)}function ir(t,e){tr.assertRangeWithError(t,e,0,255)}function nr(t){ir("red",t.r),ir("green",t.g),ir("blue",t.b)}function ar(t){tr.assertRangeWithError("opacity",t,0,1)}const rr=["top","right","bottom","left"],or={top:"cropTop",right:"cropRight",bottom:"cropBottom",left:"cropLeft"},hr={top:"setCropTop",right:"setCropRight",bottom:"setCropBottom",left:"setCropLeft"},cr={top:"rotationCropTop",right:"rotationCropRight",bottom:"rotationCropBottom",left:"rotationCropLeft"},lr={top:"setRotationCropTop",right:"setRotationCropRight",bottom:"setRotationCropBottom",left:"setRotationCropLeft"};var fr,gr,dr,ur,pr,mr,vr,yr,wr,br,Cr,Sr,Er,Mr,Dr,kr,Wr,Tr,Rr,xr,Ir,Lr,Ur,Ar,_r,Fr,Br;const $r=W("DisplayManager",{log:!1}),Or=["sleep","wake"],Pr=["awake","asleep"],Nr=["type","width","height","pixelDepth"],Vr=["veryLow","low","medium","high","veryHigh"],qr=["isDisplayAvailable","displayStatus","displayInformation","displayCommand","getDisplayBrightness","setDisplayBrightness","displayContextCommands"],zr=["flat","round"],jr={fillColorIndex:1,lineColorIndex:1,lineWidth:0,rotation:0,segmentStartCap:"flat",segmentEndCap:"flat",segmentStartRadius:1,segmentEndRadius:1,cropTop:0,cropRight:0,cropBottom:0,cropLeft:0,rotationCropTop:0,rotationCropRight:0,rotationCropBottom:0,rotationCropLeft:0},Gr={type:["none","generic","monocularLeft","monocularRight","binocular"],pixelDepth:["1","2","4"]},Hr=["show","clear","setColor","setColorOpacity","setOpacity","saveContext","restoreContext","selectFillColor","selectLineColor","setLineWidth","setRotation","clearRotation","setSegmentStartCap","setSegmentEndCap","setSegmentCap","setSegmentStartRadius","setSegmentEndRadius","setSegmentRadius","setCropTop","setCropRight","setCropBottom","setCropLeft","clearCrop","setRotationCropTop","setRotationCropRight","setRotationCropBottom","setRotationCropLeft","clearRotationCrop","clearRect","drawRect","drawRoundRect","drawCircle","drawEllipse","drawPolygon","drawSegment","selectSpriteSheet","sprite","selectFont","drawText"],Xr=["isDisplayAvailable","displayInformation","displayStatus","getDisplayBrightness"],Yr=[...qr,"displayContextState","displayColor","displayColorOpacity","displayOpacity"];class Jr{constructor(){fr.add(this),dr.set(this,!1),mr.set(this,new Za),yr.set(this,void 0),Mr.set(this,void 0),kr.set(this,void 0),Rr.set(this,[]),Ur.set(this,[]),Ar.set(this,[]),Br.set(this,void 0),J(this)}get waitForEvent(){return this.eventDispatcher.waitForEvent}requestRequiredInformation(){$r.log("requesting required display information");const t=Xr.map((t=>({type:t})));this.sendMessage(t,!1)}get isDisplayAvailable(){return t(this,dr,"f")}get displayContextState(){return t(this,mr,"f").state}async setContextState(e,s){const i=t(this,mr,"f").diff(e);0!=i.length&&(i.forEach((t=>{switch(t){case"fillColorIndex":this.selectFillColor(e.fillColorIndex);break;case"lineColorIndex":this.selectLineColor(e.lineColorIndex);break;case"lineWidth":this.setLineWidth(e.lineWidth);break;case"rotation":this.setRotation(e.rotation,!0);break;case"segmentStartCap":this.setSegmentStartCap(e.segmentStartCap);break;case"segmentEndCap":this.setSegmentEndCap(e.segmentEndCap);break;case"segmentStartRadius":this.setSegmentStartRadius(e.segmentStartRadius);break;case"segmentEndRadius":this.setSegmentEndRadius(e.segmentEndRadius);break;case"cropTop":this.setCropTop(e.cropTop);break;case"cropRight":this.setCropRight(e.cropRight);break;case"cropBottom":this.setCropBottom(e.cropBottom);break;case"cropLeft":this.setCropLeft(e.cropLeft);break;case"rotationCropTop":this.setRotationCropTop(e.rotationCropTop);break;case"rotationCropRight":this.setRotationCropRight(e.rotationCropRight);break;case"rotationCropBottom":this.setRotationCropBottom(e.rotationCropBottom);break;case"rotationCropLeft":this.setRotationCropLeft(e.rotationCropLeft)}})),s&&await t(this,fr,"m",Ir).call(this))}get displayStatus(){return t(this,yr,"f")}get isDisplayAwake(){return"awake"==t(this,yr,"f")}async wake(){t(this,fr,"m",Er).call(this),await t(this,fr,"m",Cr).call(this,"wake")}async sleep(){t(this,fr,"m",Sr).call(this),await t(this,fr,"m",Cr).call(this,"sleep")}async toggle(){switch(this.displayStatus){case"asleep":this.wake();break;case"awake":this.sleep()}}get numberOfColors(){return 2**Number(this.pixelDepth)}get displayInformation(){return t(this,Mr,"f")}get pixelDepth(){return t(this,Mr,"f")?.pixelDepth}get width(){return t(this,Mr,"f")?.width}get height(){return t(this,Mr,"f")?.width}get size(){return{width:this.width,height:this.height}}get type(){return t(this,Mr,"f")?.type}get displayBrightness(){return t(this,kr,"f")}async setDisplayBrightness(e,s){if(t(this,fr,"m",ur).call(this),sr(e),this.displayBrightness==e)return void $r.log(`redundant displayBrightness ${e}`);const i=Y(Vr.indexOf(e)),n=this.waitForEvent("getDisplayBrightness");this.sendMessage([{type:"setDisplayBrightness",data:i}],s),await n}flushDisplayContextCommands(){t(this,fr,"m",Ir).call(this)}showDisplay(e=!0){t(this,fr,"m",xr).call(this,"show",void 0,e)}clearDisplay(e=!0){t(this,fr,"m",xr).call(this,"clear",void 0,e)}get colors(){return t(this,Ur,"f")}setColor(e,s,i){"string"==typeof s&&(s=Ya(s));const n=Ja(s);if(this.colors[e]==n)return void $r.log(`redundant color #${e} ${n}`);$r.log(`setting color #${e}`,s),t(this,fr,"m",Lr).call(this,e),nr(s);const a=new DataView(new ArrayBuffer(4));a.setUint8(0,e),a.setUint8(1,s.r),a.setUint8(2,s.g),a.setUint8(3,s.b),t(this,fr,"m",xr).call(this,"setColor",a.buffer,i),this.colors[e]=n,t(this,fr,"a",gr).call(this,"displayColor",{colorIndex:e,color:s,colorHex:n})}get opacities(){return t(this,Ar,"f")}setColorOpacity(e,s,i){if(t(this,fr,"m",Lr).call(this,e),ar(s),Math.floor(255*t(this,Ar,"f")[e])==Math.floor(255*s))return void $r.log(`redundant opacity #${e} ${s}`);const n=new DataView(new ArrayBuffer(2));n.setUint8(0,e),n.setUint8(1,255*s),t(this,fr,"m",xr).call(this,"setColorOpacity",n.buffer,i),t(this,Ar,"f")[e]=s,t(this,fr,"a",gr).call(this,"displayColorOpacity",{colorIndex:e,opacity:s})}setOpacity(e,s){ar(e),t(this,fr,"m",xr).call(this,"setOpacity",Y(Math.round(255*e)),s),t(this,Ar,"f").fill(e),t(this,fr,"a",gr).call(this,"displayOpacity",{opacity:e})}saveContext(e){t(this,fr,"m",xr).call(this,"saveContext",void 0,e)}restoreContext(e){t(this,fr,"m",xr).call(this,"restoreContext",void 0,e)}selectFillColor(e,s){t(this,fr,"m",Lr).call(this,e);const i=t(this,mr,"f").update({fillColorIndex:e});0!=i.length&&(t(this,fr,"m",xr).call(this,"selectFillColor",Y(e),s),t(this,fr,"m",vr).call(this,i))}selectLineColor(e,s){t(this,fr,"m",Lr).call(this,e);const i=t(this,mr,"f").update({lineColorIndex:e});0!=i.length&&(t(this,fr,"m",xr).call(this,"selectLineColor",Y(e),s),t(this,fr,"m",vr).call(this,i))}setLineWidth(e,s){t(this,fr,"m",_r).call(this,e);const i=t(this,mr,"f").update({lineWidth:e});if(0==i.length)return;const n=new DataView(new ArrayBuffer(2));n.setUint16(0,e,!0),t(this,fr,"m",xr).call(this,"setLineWidth",n.buffer,s),t(this,fr,"m",vr).call(this,i)}setRotation(e,s,i){e=Zt(e=s?e:Kt(e)),$r.log({rotation:e});const n=t(this,mr,"f").update({rotation:e});if(0==n.length)return;const a=new DataView(new ArrayBuffer(2));a.setUint16(0,function(t){{const e=t;tr.log({rotationRad:e}),t%=2*Math.PI,t/=2*Math.PI}return t*=Xt,Math.floor(t)}(e),!0),t(this,fr,"m",xr).call(this,"setRotation",a.buffer,i),t(this,fr,"m",vr).call(this,n)}clearRotation(e){const s=t(this,mr,"f").update({rotation:0});0!=s.length&&(t(this,fr,"m",xr).call(this,"clearRotation",void 0,e),t(this,fr,"m",vr).call(this,s))}setSegmentStartCap(e,s){er(e);const i=t(this,mr,"f").update({segmentStartCap:e});if(0==i.length)return;$r.log({segmentStartCap:e});const n=new DataView(new ArrayBuffer(1)),a=zr.indexOf(e);n.setUint8(0,a),t(this,fr,"m",xr).call(this,"setSegmentStartCap",n.buffer,s),t(this,fr,"m",vr).call(this,i)}setSegmentEndCap(e,s){er(e);const i=t(this,mr,"f").update({segmentEndCap:e});if(0==i.length)return;$r.log({segmentEndCap:e});const n=new DataView(new ArrayBuffer(1)),a=zr.indexOf(e);n.setUint8(0,a),t(this,fr,"m",xr).call(this,"setSegmentEndCap",n.buffer,s),t(this,fr,"m",vr).call(this,i)}setSegmentCap(e,s){er(e);const i=t(this,mr,"f").update({segmentStartCap:e,segmentEndCap:e});if(0==i.length)return;$r.log({segmentCap:e});const n=new DataView(new ArrayBuffer(1)),a=zr.indexOf(e);n.setUint8(0,a),t(this,fr,"m",xr).call(this,"setSegmentCap",n.buffer,s),t(this,fr,"m",vr).call(this,i)}setSegmentStartRadius(e,s){const i=t(this,mr,"f").update({segmentStartRadius:e});if(0==i.length)return;$r.log({segmentStartRadius:e});const n=new DataView(new ArrayBuffer(2));n.setUint16(0,e,!0),t(this,fr,"m",xr).call(this,"setSegmentStartRadius",n.buffer,s),t(this,fr,"m",vr).call(this,i)}setSegmentEndRadius(e,s){const i=t(this,mr,"f").update({segmentEndRadius:e});if(0==i.length)return;$r.log({segmentEndRadius:e});const n=new DataView(new ArrayBuffer(2));n.setUint16(0,e,!0),t(this,fr,"m",xr).call(this,"setSegmentEndRadius",n.buffer,s),t(this,fr,"m",vr).call(this,i)}setSegmentRadius(e,s){const i=t(this,mr,"f").update({segmentStartRadius:e,segmentEndRadius:e});if(0==i.length)return;$r.log({segmentRadius:e});const n=new DataView(new ArrayBuffer(2));n.setUint16(0,e,!0),t(this,fr,"m",xr).call(this,"setSegmentRadius",n.buffer,s),t(this,fr,"m",vr).call(this,i)}setCrop(e,s,i){$r.assertEnumWithError(e,rr),s=Math.max(0,s);const n=hr[e],a=or[e],r=t(this,mr,"f").update({[a]:s});if(0==r.length)return;$r.log({[n]:s});const o=new DataView(new ArrayBuffer(2));o.setUint16(0,s,!0),t(this,fr,"m",xr).call(this,n,o.buffer,i),t(this,fr,"m",vr).call(this,r)}setCropTop(t,e){this.setCrop("top",t,e)}setCropRight(t,e){this.setCrop("right",t,e)}setCropBottom(t,e){this.setCrop("bottom",t,e)}setCropLeft(t,e){this.setCrop("left",t,e)}clearCrop(e){const s=t(this,mr,"f").update({cropTop:0,cropRight:0,cropBottom:0,cropLeft:0});0!=s.length&&(t(this,fr,"m",xr).call(this,"clearCrop",void 0,e),t(this,fr,"m",vr).call(this,s))}setRotationCrop(e,s,i){$r.assertEnumWithError(e,rr);const n=lr[e],a=cr[e],r=t(this,mr,"f").update({[a]:s});if(0==r.length)return;$r.log({[n]:s});const o=new DataView(new ArrayBuffer(2));o.setUint16(0,s,!0),t(this,fr,"m",xr).call(this,n,o.buffer,i),t(this,fr,"m",vr).call(this,r)}setRotationCropTop(t,e){this.setRotationCrop("top",t,e)}setRotationCropRight(t,e){this.setRotationCrop("right",t,e)}setRotationCropBottom(t,e){this.setRotationCrop("bottom",t,e)}setRotationCropLeft(t,e){this.setRotationCrop("left",t,e)}clearRotationCrop(e){const s=t(this,mr,"f").update({rotationCropTop:0,rotationCropRight:0,rotationCropBottom:0,rotationCropLeft:0});0!=s.length&&(t(this,fr,"m",xr).call(this,"clearRotationCrop",void 0,e),t(this,fr,"m",vr).call(this,s))}clearRect(e,s,i,n,a){const{x:r,y:o,width:h,height:c}=t(this,fr,"m",Fr).call(this,e,s,i,n),l=new DataView(new ArrayBuffer(8));l.setUint16(0,r,!0),l.setUint16(2,o,!0),l.setUint16(4,h,!0),l.setUint16(6,c,!0),t(this,fr,"m",xr).call(this,"clearRect",l.buffer,a)}drawRect(e,s,i,n,a){const r=new DataView(new ArrayBuffer(8));r.setInt16(0,e,!0),r.setInt16(2,s,!0),r.setUint16(4,i,!0),r.setUint16(6,n,!0),$r.log("drawRect data",r),t(this,fr,"m",xr).call(this,"drawRect",r.buffer,a)}drawRoundRect(e,s,i,n,a,r){const o=new DataView(new ArrayBuffer(9));o.setInt16(0,e,!0),o.setInt16(2,s,!0),o.setUint16(4,i,!0),o.setUint16(6,n,!0),o.setUint8(8,a),$r.log("drawRoundRect data",o),t(this,fr,"m",xr).call(this,"drawRoundRect",o.buffer,r)}drawCircle(e,s,i,n){const a=new DataView(new ArrayBuffer(6));a.setInt16(0,e,!0),a.setInt16(2,s,!0),a.setUint16(4,i,!0),$r.log("drawCircle data",a),t(this,fr,"m",xr).call(this,"drawCircle",a.buffer,n)}drawEllipse(e,s,i,n,a){const r=new DataView(new ArrayBuffer(8));r.setInt16(0,e,!0),r.setInt16(2,s,!0),r.setUint16(4,i,!0),r.setUint16(6,n,!0),$r.log("drawEllipse data",r),t(this,fr,"m",xr).call(this,"drawEllipse",r.buffer,a)}drawPolygon(e,s,i,n,a){const r=new DataView(new ArrayBuffer(7));r.setInt16(0,e,!0),r.setInt16(2,s,!0),r.setUint16(4,i,!0),r.setUint8(6,n),$r.log("drawPolygon data",r),t(this,fr,"m",xr).call(this,"drawPolygon",r.buffer,a)}drawSegment(e,s,i,n,a){const r=new DataView(new ArrayBuffer(8));$r.log({startX:e,startY:s,endX:i,endY:n}),r.setInt16(0,e,!0),r.setInt16(2,s,!0),r.setInt16(4,i,!0),r.setInt16(6,n,!0),$r.log("drawSegment data",r),t(this,fr,"m",xr).call(this,"drawSegment",r.buffer,a)}selectSpriteSheet(t,e){}drawSprite(t,e,s,i){}parseMessage(e,s){switch($r.log({messageType:e,dataView:s}),e){case"isDisplayAvailable":t(this,fr,"m",pr).call(this,s);break;case"displayStatus":t(this,fr,"m",wr).call(this,s);break;case"displayInformation":t(this,fr,"m",Dr).call(this,s);break;case"getDisplayBrightness":case"setDisplayBrightness":t(this,fr,"m",Wr).call(this,s);break;default:throw Error(`uncaught messageType ${e}`)}}clear(){$r.log("clearing displayManager"),e(this,yr,void 0,"f"),e(this,dr,!1,"f"),e(this,Mr,void 0,"f"),e(this,kr,void 0,"f"),e(this,Rr,[],"f"),e(this,dr,!1,"f"),t(this,mr,"f").reset(),t(this,Ur,"f").length=0,t(this,Ar,"f").length=0}get mtu(){return t(this,Br,"f")}set mtu(t){e(this,Br,t,"f")}}var Kr,Qr,Zr,to,eo,so,io,no,ao,ro,oo,ho;dr=new WeakMap,mr=new WeakMap,yr=new WeakMap,Mr=new WeakMap,kr=new WeakMap,Rr=new WeakMap,Ur=new WeakMap,Ar=new WeakMap,Br=new WeakMap,fr=new WeakSet,gr=function(){return this.eventDispatcher.dispatchEvent},ur=function(){$r.assertWithError(t(this,dr,"f"),"display is not available")},pr=function(s){const i=1==s.getUint8(0);e(this,dr,i,"f"),$r.log({isDisplayAvailable:t(this,dr,"f")}),t(this,fr,"a",gr).call(this,"isDisplayAvailable",{isDisplayAvailable:t(this,dr,"f")})},vr=function(e){t(this,fr,"a",gr).call(this,"displayContextState",{displayContextState:{...this.displayContextState},differences:e})},wr=function(e){const s=e.getUint8(0),i=Pr[s];t(this,fr,"m",br).call(this,i)},br=function(s){if($r.assertEnumWithError(s,Pr),s==t(this,yr,"f"))return void $r.log(`redundant displayStatus ${s}`);const i=t(this,yr,"f");e(this,yr,s,"f"),$r.log(`updated displayStatus to "${this.displayStatus}"`),t(this,fr,"a",gr).call(this,"displayStatus",{displayStatus:this.displayStatus,previousDisplayStatus:i})},Cr=async function(t,e){$r.assertEnumWithError(t,Or),$r.log(`sending display command "${t}"`);const s=this.waitForEvent("displayStatus");$r.log(`setting command "${t}"`);const i=Or.indexOf(t);this.sendMessage([{type:"displayCommand",data:Y(i)}],e),await s},Sr=function(){$r.assertWithError("awake"==t(this,yr,"f"),`display is not awake - currently ${t(this,yr,"f")}`)},Er=function(){$r.assertWithError("awake"!=t(this,yr,"f"),"display is awake")},Dr=function(s){const i={};let n=0;for(;n<s.byteLength;){const t=s.getUint8(n++),e=Nr[t];switch($r.assertWithError(e,`invalid displayInformationTypeIndex ${e}`),$r.log({displayInformationType:e}),e){case"width":case"height":{const t=s.getUint16(n,!0);i[e]=t,n+=2}break;case"pixelDepth":case"type":{const t=Gr[e];const a=t[s.getUint8(n++)];$r.assertEnumWithError(a,t),i[e]=a}}}$r.log({parsedDisplayInformation:i});const a=Nr.find((t=>!(t in i)));$r.assertWithError(!a,`missingDisplayInformationType ${a}`),e(this,Mr,i,"f"),e(this,Ur,new Array(this.numberOfColors).fill("#000000"),"f"),e(this,Ar,new Array(this.numberOfColors).fill(1),"f"),t(this,fr,"a",gr).call(this,"displayInformation",{displayInformation:t(this,Mr,"f")})},Wr=function(s){const i=s.getUint8(0),n=Vr[i];sr(n),e(this,kr,n,"f"),$r.log({displayBrightness:t(this,kr,"f")}),t(this,fr,"a",gr).call(this,"getDisplayBrightness",{displayBrightness:t(this,kr,"f")})},Tr=function(t){$r.assertEnumWithError(t,Hr)},xr=async function(e,s,i){t(this,fr,"m",Tr).call(this,e);const n=j(Hr.indexOf(e),s);t(this,Rr,"f").reduce(((t,e)=>t+e.byteLength),n.byteLength)>this.mtu-6&&($r.log("displayContextCommandBuffers too full - sending now"),await t(this,fr,"m",Ir).call(this)),t(this,Rr,"f").push(n),i&&await t(this,fr,"m",Ir).call(this)},Ir=async function(){if(0==t(this,Rr,"f").length)return;const e=j(t(this,Rr,"f"));$r.log("sending displayContextCommands",t(this,Rr,"f"),e),await this.sendMessage([{type:"displayContextCommands",data:e}],!0),t(this,Rr,"f").length=0},Lr=function(t){$r.assertRangeWithError("colorIndex",t,0,this.numberOfColors)},_r=function(t){$r.assertRangeWithError("lineWidth",t,0,this.width)},Fr=function(t,e,s,i){return $r.log("clampBox",{x:t,y:e,width:s,height:i}),{x:t,y:e,width:s,height:i}};const co=W("BaseConnectionManager",{log:!1}),lo=["webBluetooth","noble","client","webSocket","udp"],fo=["notConnected","connecting","connected","disconnecting"],go=[...fo,"connectionStatus","isConnected"],uo=[...On,...wi,...Zs,...fa,...Ot,...tn,...Va,...cs,...zs,...qr],po=["batteryLevel"],mo=["rx","tx"],vo=[...po,...dn,...mo,...uo,"smp"];class yo{get baseConstructor(){return this.constructor}static get isSupported(){return!1}get isSupported(){return this.baseConstructor.isSupported}get canUpdateFirmware(){return!1}get type(){return this.baseConstructor.type}constructor(){Kr.add(this),eo.set(this,"notConnected"),no.set(this,[]),ao.set(this,!1),this.defaultMtu=23,this.mtu=this.defaultMtu,oo.set(this,new F(t(this,Kr,"m",ho).bind(this),5e3)),t(this,Kr,"m",to).call(this)}get status(){return t(this,eo,"f")}set status(s){co.assertEnumWithError(s,fo),t(this,eo,"f")!=s?(co.log(`new connection status "${s}"`),e(this,eo,s,"f"),this.onStatusUpdated(this.status),this.isConnected?t(this,oo,"f").start():t(this,oo,"f").stop(),"notConnected"==t(this,eo,"f")&&(this.mtu=this.defaultMtu)):co.log(`tried to assign same connection status "${s}"`)}get isConnected(){return"connected"==this.status}get isAvailable(){return!1}assertIsNotConnected(){co.assertWithError(!this.isConnected,"device is already connected")}assertIsConnected(){co.assertWithError(this.isConnected,"device is not connected")}assertIsConnectedAndNotDisconnecting(){this.assertIsConnected(),t(this,Kr,"m",io).call(this)}async connect(){this.assertIsNotConnected(),t(this,Kr,"m",so).call(this),this.status="connecting"}get canReconnect(){return!1}async reconnect(){this.assertIsNotConnected(),t(this,Kr,"m",so).call(this),co.assertWithError(this.canReconnect,"unable to reconnect"),this.status="connecting",co.log("attempting to reconnect...")}async disconnect(){this.assertIsConnected(),t(this,Kr,"m",io).call(this),this.status="disconnecting",co.log("disconnecting from device...")}async sendSmpMessage(t){this.assertIsConnectedAndNotDisconnecting(),co.log("sending smp message",t)}async sendTxMessages(s,i=!0){if(this.assertIsConnectedAndNotDisconnecting(),s&&(t(this,no,"f").push(...s),co.log(`appended ${s.length} messages`)),!i)return void co.log("not sending immediately - waiting until later");if(t(this,ao,"f"))return void co.log("already sending messages - waiting until later");if(0==t(this,no,"f").length)return void co.log("no pendingMessages");e(this,ao,!0,"f"),co.log("sendTxMessages",t(this,no,"f").slice());const n=t(this,no,"f").map((e=>{t(Qr,Qr,"m",Zr).call(Qr,e.type);const s=uo.indexOf(e.type),i=new DataView(new ArrayBuffer(2));return i.setUint16(0,e.data?.byteLength||0,!0),j(s,i,e.data)}));if(t(this,no,"f").length=0,this.mtu)for(;n.length>0;){if(n.every((t=>t.byteLength>this.mtu-3))){co.log("every arrayBuffer is too big to send");break}co.log("remaining arrayBuffers.length",n.length);let t=0,e=0;n.some((s=>{if(t+s.byteLength>this.mtu-3)return co.log(`stopping appending arrayBuffers ( length ${s.byteLength} too much)`),!0;co.log(`allowing arrayBuffer with length ${s.byteLength}`),e++,t+=s.byteLength}));const s=n.splice(0,e);co.log({arrayBufferCount:e,arrayBuffersToSend:s});const i=j(...s);co.log("sending arrayBuffer (partitioned)",i),await this.sendTxData(i)}else{const t=j(...n);co.log("sending arrayBuffer (all)",t),await this.sendTxData(t)}e(this,ao,!1,"f"),this.sendTxMessages(void 0,!0)}async sendTxData(t){co.log("sendTxData",t)}parseRxMessage(e){Te(e,uo,t(this,Kr,"m",ro).bind(this),null,!0),this.onMessagesReceived()}clear(){e(this,ao,!1,"f"),t(this,no,"f").length=0}remove(){this.clear(),this.onStatusUpdated=void 0,this.onMessageReceived=void 0,this.onMessagesReceived=void 0}}Qr=yo,eo=new WeakMap,no=new WeakMap,ao=new WeakMap,oo=new WeakMap,Kr=new WeakSet,Zr=function(t){co.assertEnumWithError(t,uo)},to=function(){co.assertWithError(this.isSupported,`${this.constructor.name} is not supported`)},so=function(){co.assertWithError("connecting"!=this.status,"device is already connecting")},io=function(){co.assertWithError("disconnecting"!=this.status,"device is already disconnecting")},ro=function(t,e){co.log({messageType:t,dataView:e}),this.onMessageReceived(t,e)},ho=function(){this.isConnected||(co.log("timer detected disconnection"),this.status="notConnected")};const wo=W("EventUtils",{log:!1});function bo(t,e){let s=t.addEventListener||t.addListener||t.on||t.AddEventListener;wo.assertWithError(s,"no add listener function found for target"),s=s.bind(t),Object.entries(e).forEach((([t,e])=>{s(t,e)}))}function Co(t,e){let s=t.removeEventListener||t.removeListener||t.RemoveEventListener;wo.assertWithError(s,"no remove listener function found for target"),s=s.bind(t),Object.entries(e).forEach((([t,e])=>{s(t,e)}))}const So=W("bluetoothUUIDs",{log:!1});if(i)var Eo=window.BluetoothUUID;function Mo(t){return So.assertTypeWithError(t,"string"),So.assertWithError(4==t.length,"value must be 4 characters long"),`ea6d${t}-a725-4f9b-893d-c3913e33b39f`}function Do(t){return Eo?.getCharacteristic?.(t)}function ko(t){return Eo?.getService?.(t)}const Wo=Object.freeze({services:{deviceInformation:{uuid:ko("device_information"),characteristics:{manufacturerName:{uuid:Do("manufacturer_name_string")},modelNumber:{uuid:Do("model_number_string")},hardwareRevision:{uuid:Do("hardware_revision_string")},firmwareRevision:{uuid:Do("firmware_revision_string")},softwareRevision:{uuid:Do("software_revision_string")},pnpId:{uuid:Do("pnp_id")},serialNumber:{uuid:Do("serial_number_string")}}},battery:{uuid:ko("battery_service"),characteristics:{batteryLevel:{uuid:Do("battery_level")}}},main:{uuid:Mo("0000"),characteristics:{rx:{uuid:Mo("1000")},tx:{uuid:Mo("1001")}}},smp:{uuid:"8d53dc1d-1db7-4cd3-868b-8a527460aa84",characteristics:{smp:{uuid:"da2e7828-fbce-4e01-ae9e-261174997c48"}}}}}),To=[Wo.services.main.uuid],Ro=[Wo.services.deviceInformation.uuid,Wo.services.battery.uuid,Wo.services.smp.uuid];function xo(t){t=t.toString().toLowerCase();return Object.keys(Wo.services).find((e=>{let s=Wo.services[e].uuid.toString();return 4==t.length&&(s=s.slice(4,8)),t.includes("-")||(s=s.replaceAll("-","")),t==s}))}const Io=[],Lo=[];function Uo(t){var e;return t=t.toString().toLowerCase(),Object.values(Wo.services).some((s=>{const i=Object.keys(s.characteristics);return e=i.find((e=>{let i=s.characteristics[e].uuid.toString();return 4==t.length&&(i=i.slice(4,8)),t.includes("-")||(i=i.replaceAll("-","")),t==i}))})),e}function Ao(t){const e={broadcast:!1,read:!0,writeWithoutResponse:!1,write:!1,notify:!1,indicate:!1,authenticatedSignedWrites:!1,reliableWrite:!1,writableAuxiliaries:!1};switch(t){case"rx":case"tx":case"smp":e.read=!1}switch(t){case"batteryLevel":case"rx":case"smp":e.notify=!0}if("smp"===t)e.writeWithoutResponse=!0;if("tx"===t)e.write=!0;return e}Object.values(Wo.services).forEach((t=>{if(!t.characteristics)return;const e=Object.keys(t.characteristics);e.forEach((s=>{const i=t.characteristics[s];To.includes(t.uuid)&&(Io.push(i.uuid),e.push(s)),Lo.push(i.uuid)}))}),[]);const _o=W("BluetoothConnectionManager",{log:!1});class Fo extends yo{constructor(){super(...arguments),this.isInRange=!0}get isAvailable(){return!0}onCharacteristicValueChanged(t,e){"rx"==t?this.parseRxMessage(e):this.onMessageReceived?.(t,e)}async writeCharacteristic(t,e){_o.log("writeCharacteristic",...arguments)}async sendSmpMessage(t){super.sendSmpMessage(t),await this.writeCharacteristic("smp",t)}async sendTxData(t){super.sendTxData(t),0!=t.byteLength&&await this.writeCharacteristic("tx",t)}}var Bo,$o,Oo,Po,No,Vo,qo,zo,jo,Go,Ho;const Xo=W("WebBluetoothConnectionManager",{log:!1});var Yo;i&&(Yo=window.navigator.bluetooth);class Jo extends Fo{constructor(){super(...arguments),Bo.add(this),$o.set(this,{characteristicvaluechanged:t(this,Bo,"m",jo).bind(this)}),Oo.set(this,{gattserverdisconnected:t(this,Bo,"m",Ho).bind(this)}),Po.set(this,void 0),No.set(this,new Map),Vo.set(this,new Map)}get bluetoothId(){return this.device.id}get canUpdateFirmware(){return t(this,Vo,"f").has("smp")}static get isSupported(){return Boolean(Yo)}static get type(){return"webBluetooth"}get device(){return t(this,Po,"f")}set device(s){t(this,Po,"f")!=s?(t(this,Po,"f")&&Co(t(this,Po,"f"),t(this,Oo,"f")),s&&bo(s,t(this,Oo,"f")),e(this,Po,s,"f")):Xo.log("tried to assign the same BluetoothDevice")}get server(){return t(this,Po,"f")?.gatt}get isConnected(){return this.server?.connected||!1}async connect(){await super.connect();try{const e=await Yo.requestDevice({filters:[{services:To}],optionalServices:i?Ro:[]});Xo.log("got BluetoothDevice"),this.device=e,Xo.log("connecting to device...");const s=await this.server.connect();Xo.log(`connected to device? ${s.connected}`),await t(this,Bo,"m",qo).call(this),Xo.log("fully connected"),this.status="connected"}catch(e){Xo.error(e),this.status="notConnected",this.server?.disconnect(),t(this,Bo,"m",zo).call(this)}}async disconnect(){await t(this,Bo,"m",zo).call(this),await super.disconnect(),this.server?.disconnect(),this.status="notConnected"}async writeCharacteristic(e,s){super.writeCharacteristic(e,s);const i=t(this,Vo,"f").get(e);Xo.assertWithError(i,`${e} characteristic not found`),Xo.log("writing characteristic",i,s);const n=i.properties||Ao(e);n.writeWithoutResponse?(Xo.log("writing without response"),await i.writeValueWithoutResponse(s)):(Xo.log("writing with response"),await i.writeValueWithResponse(s)),Xo.log("wrote characteristic"),n.read&&!n.notify&&(Xo.log("reading value after write..."),await i.readValue(),(o||h)&&t(this,Bo,"m",Go).call(this,i))}get canReconnect(){return Boolean(this.server&&!this.server.connected&&this.isInRange)}async reconnect(){await super.reconnect();try{await this.server.connect()}catch(t){Xo.error(t),this.isInRange=!1}this.isConnected?(Xo.log("successfully reconnected!"),await t(this,Bo,"m",qo).call(this),this.status="connected"):(Xo.log("unable to reconnect"),this.status="notConnected")}remove(){super.remove(),this.device=void 0}}$o=new WeakMap,Oo=new WeakMap,Po=new WeakMap,No=new WeakMap,Vo=new WeakMap,Bo=new WeakSet,qo=async function(){t(this,Bo,"m",zo).call(this),Xo.log("getting services...");const e=await this.server.getPrimaryServices();Xo.log("got services",e.length),Xo.log("getting characteristics...");for(const s in e){const i=e[s];Xo.log({service:i});const n=xo(i.uuid);Xo.assertWithError(n,`no name found for service uuid "${i.uuid}"`),Xo.log(`got "${n}" service`),i.name=n,t(this,No,"f").set(n,i),Xo.log(`getting characteristics for "${n}" service`);const a=await i.getCharacteristics();Xo.log(`got characteristics for "${n}" service`);for(const e in a){const s=a[e];Xo.log({characteristic:s});const i=Uo(s.uuid);Xo.assertWithError(Boolean(i),`no name found for characteristic uuid "${s.uuid}" in "${n}" service`),Xo.log(`got "${i}" characteristic in "${n}" service`),s.name=i,t(this,Vo,"f").set(i,s),bo(s,t(this,$o,"f"));const r=s.properties||Ao(i);r.notify&&(Xo.log(`starting notifications for "${i}" characteristic`),await s.startNotifications()),r.read&&(Xo.log(`reading "${i}" characteristic...`),await s.readValue(),(o||h)&&t(this,Bo,"m",Go).call(this,s))}}},zo=async function(){this.device&&Co(this.device,t(this,Oo,"f"));const e=Array.from(t(this,Vo,"f").keys()).map((e=>{const s=t(this,Vo,"f").get(e);Co(s,t(this,$o,"f"));if((s.properties||Ao(e)).notify)return Xo.log(`stopping notifications for "${e}" characteristic`),s.stopNotifications()}));return Promise.allSettled(e)},jo=function(e){Xo.log("oncharacteristicvaluechanged");const s=e.target;t(this,Bo,"m",Go).call(this,s)},Go=function(t){Xo.log("onCharacteristicValue");const e=t.name;Xo.assertWithError(Boolean(e),`no name found for characteristic with uuid "${t.uuid}"`),Xo.log(`oncharacteristicvaluechanged for "${e}" characteristic`);const s=t.value;Xo.assertWithError(s,`no data found for "${e}" characteristic`),Xo.log(`data for "${e}" characteristic`,Array.from(new Uint8Array(s.buffer)));try{this.onCharacteristicValueChanged(e,s)}catch(t){Xo.error(t)}},Ho=function(){Xo.log("gattserverdisconnected"),this.status="notConnected"};const Ko=4294967296,Qo=9007199254740992;const Zo={encode:function(t){let e,s=new ArrayBuffer(256),i=new DataView(s),n=0;function a(t){let a=s.byteLength;const r=n+t;for(;a<r;)a<<=1;if(a!==s.byteLength){const t=i;s=new ArrayBuffer(a),i=new DataView(s);const e=n+3>>2;for(let s=0;s<e;++s)i.setUint32(s<<2,t.getUint32(s<<2))}return e=t,i}function r(){n+=e}function o(t){r(a(1).setUint8(n,t))}function h(t){const e=a(t.length);for(let s=0;s<t.length;++s)e.setUint8(n+s,t[s]);r()}function c(t,e){e<24?o(t<<5|e):e<256?(o(t<<5|24),o(e)):e<65536?(o(t<<5|25),function(t){r(a(2).setUint16(n,t))}(e)):e<4294967296?(o(t<<5|26),function(t){r(a(4).setUint32(n,t))}(e)):(o(t<<5|27),function(t){const e=t%Ko,s=(t-e)/Ko,i=a(8);i.setUint32(n,s),i.setUint32(n+4,e),r()}(e))}if(function t(e){let s;const i=[];let l;if(!1===e)return o(244);if(!0===e)return o(245);if(null===e)return o(246);if(void 0===e)return o(247);switch(typeof e){case"number":if(Math.floor(e)===e){if(e>=0&&e<=Qo)return c(0,e);if(-Qo<=e&&e<0)return c(1,-(e+1))}return o(251),function(t){r(a(8).setFloat64(n,t))}(e);case"string":for(s=0;s<e.length;++s){let t=e.charCodeAt(s);t<128?i.push(t):t<2048?(i.push(192|t>>6),i.push(128|63&t)):t<55296?(i.push(224|t>>12),i.push(128|t>>6&63),i.push(128|63&t)):(t=(1023&t)<<10,t|=1023&e.charCodeAt(++s),t+=65536,i.push(240|t>>18),i.push(128|t>>12&63),i.push(128|t>>6&63),i.push(128|63&t))}return c(3,i.length),h(i);default:if(Array.isArray(e))for(l=e.length,c(4,l),s=0;s<l;++s)t(e[s]);else if(e instanceof Uint8Array)c(2,e.length),h(e);else{const i=Object.keys(e);for(l=i.length,c(5,l),s=0;s<l;++s){const n=i[s];t(n),t(e[n])}}}}(t),"slice"in s)return s.slice(0,n);const l=new ArrayBuffer(n),f=new DataView(l);for(let t=0;t<n;++t)f.setUint8(t,i.getUint8(t));return l},decode:function(t,e,s){const i=new DataView(t);let n=0;function a(t,e){return n+=t,e}function r(e){return a(e,new Uint8Array(t,n,e))}function o(){return a(1,i.getUint8(n))}function h(){return a(2,i.getUint16(n))}function c(){return a(4,i.getUint32(n))}function l(){return 255===i.getUint8(n)&&(n+=1,!0)}function f(t){if(t<24)return t;if(24===t)return o();if(25===t)return h();if(26===t)return c();if(27===t)return c()*Ko+c();if(31===t)return-1;throw new Error("Invalid length encoding")}function g(t){const e=o();if(255===e)return-1;const s=f(31&e);if(s<0||e>>5!==t)throw new Error("Invalid indefinite length element");return s}function d(t,e){for(let s=0;s<e;++s){let s=o();128&s&&(s<224?(s=(31&s)<<6|63&o(),e-=1):s<240?(s=(15&s)<<12|(63&o())<<6|63&o(),e-=2):(s=(15&s)<<18|(63&o())<<12|(63&o())<<6|63&o(),e-=3)),s<65536?t.push(s):(s-=65536,t.push(55296|s>>10),t.push(56320|1023&s))}}"function"!=typeof e&&(e=function(t){return t}),"function"!=typeof s&&(s=function(){});const u=function t(){const c=o(),u=c>>5,p=31&c;let m,v;if(7===u)switch(p){case 25:return function(){const t=new ArrayBuffer(4),e=new DataView(t),s=h(),i=32768&s;let n=31744&s;const a=1023&s;if(31744===n)n=261120;else if(0!==n)n+=114688;else if(0!==a)return(i?-1:1)*a*5.960464477539063e-8;return e.setUint32(0,i<<16|n<<13|a<<13),e.getFloat32(0)}();case 26:return a(4,i.getFloat32(n));case 27:return a(8,i.getFloat64(n))}if(v=f(p),v<0&&(u<2||u>6))throw new Error("Invalid length");const y=[];let w;const b={};switch(u){case 0:return v;case 1:return-1-v;case 2:if(v<0){const t=[];let e=0;for(;(v=g(u))>=0;)e+=v,t.push(r(v));const s=new Uint8Array(e);let i=0;for(m=0;m<t.length;++m)s.set(t[m],i),i+=t[m].length;return s}return r(v);case 3:if(v<0)for(;(v=g(u))>=0;)d(y,v);else d(y,v);return String.fromCharCode.apply(null,y);case 4:if(v<0)for(w=[];!l();)w.push(t());else for(w=new Array(v),m=0;m<v;++m)w[m]=t();return w;case 5:for(m=0;m<v||v<0&&!l();++m){b[t()]=t()}return b;case 6:return e(t(),v);case 7:switch(v){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;default:return s(v)}}}();if(n!==t.byteLength)throw new Error("Remaining bytes");return u}},th=W("mcumgr",{log:!1}),eh=0,sh=1,ih=2,nh=3,ah=0,rh=1,oh=8,hh=0,ch=2,lh=3,fh=5,gh=0,dh=1,uh=5,ph=0;class mh{constructor(){this._mtu=256,this._messageCallback=null,this._imageUploadProgressCallback=null,this._imageUploadNextCallback=null,this._fileUploadProgressCallback=null,this._fileUploadNextCallback=null,this._uploadIsInProgress=!1,this._downloadIsInProgress=!1,this._buffer=new Uint8Array,this._seq=0}onMessage(t){return this._messageCallback=t,this}onImageUploadNext(t){return this._imageUploadNextCallback=t,this}onImageUploadProgress(t){return this._imageUploadProgressCallback=t,this}onImageUploadFinished(t){return this._imageUploadFinishedCallback=t,this}onFileUploadNext(t){return this._fileUploadNextCallback=t,this}onFileUploadProgress(t){return this._fileUploadProgressCallback=t,this}onFileUploadFinished(t){return this._fileUploadFinishedCallback=t,this}onFileDownloadNext(t){return this._fileDownloadNextCallback=t,this}onFileDownloadProgress(t){return this._fileDownloadProgressCallback=t,this}onFileDownloadFinished(t){return this._fileDownloadFinishedCallback=t,this}_getMessage(t,e,s,i){let n=[];void 0!==i&&(n=[...new Uint8Array(Zo.encode(i))]);const a=255&n.length,r=[t,0,n.length>>8,a,e>>8,255&e,this._seq,s,...n];return this._seq=(this._seq+1)%256,r}_notification(t){th.log("mcumgr - message received");const e=new Uint8Array(t);this._buffer=new Uint8Array([...this._buffer,...e]);const s=256*this._buffer[2]+this._buffer[3];this._buffer.length<s+8||(this._processMessage(this._buffer.slice(0,s+8)),this._buffer=this._buffer.slice(s+8))}_processMessage(t){const[e,,s,i,n,a,,r]=t,o=Zo.decode(t.slice(8).buffer),h=256*s+i,c=256*n+a;return th.log("mcumgr - Process Message - Group: "+c+", Id: "+r+", Off: "+o.off),c===rh&&r===dh&&o.off?(this._uploadOffset=o.off,void this._uploadNext()):e===nh&&c===oh&&r===ph&&o.off?(this._uploadFileOffset=o.off,void this._uploadFileNext()):e===sh&&c===oh&&r===ph?(this._downloadFileOffset+=o.data.length,null!=o.len&&(this._downloadFileLength=o.len),th.log("downloaded "+this._downloadFileOffset+" bytes of "+this._downloadFileLength),this._downloadFileLength>0&&this._fileDownloadProgressCallback({percentage:Math.floor(this._downloadFileOffset/this._downloadFileLength*100)}),this._messageCallback&&this._messageCallback({op:e,group:c,id:r,data:o,length:h}),void this._downloadFileNext()):void(this._messageCallback&&this._messageCallback({op:e,group:c,id:r,data:o,length:h}))}cmdReset(){return this._getMessage(ih,ah,fh)}smpEcho(t){return this._getMessage(ih,ah,hh,{d:t})}cmdImageState(){return this._getMessage(eh,rh,gh)}cmdImageErase(){return this._getMessage(ih,rh,uh,{})}cmdImageTest(t){return this._getMessage(ih,rh,gh,{hash:t,confirm:!1})}cmdImageConfirm(t){return this._getMessage(ih,rh,gh,{hash:t,confirm:!0})}_hash(t){return crypto.subtle.digest("SHA-256",t)}async _uploadNext(){if(!this._uploadImage)return;if(this._uploadOffset>=this._uploadImage.byteLength)return this._uploadIsInProgress=!1,void this._imageUploadFinishedCallback();const t={data:new Uint8Array,off:this._uploadOffset};0===this._uploadOffset&&(t.len=this._uploadImage.byteLength,t.sha=new Uint8Array(await this._hash(this._uploadImage))),this._imageUploadProgressCallback({percentage:Math.floor(this._uploadOffset/this._uploadImage.byteLength*100)});const e=this._mtu-Zo.encode(t).byteLength-8-3-5;t.data=new Uint8Array(this._uploadImage.slice(this._uploadOffset,this._uploadOffset+e)),this._uploadOffset+=e;const s=this._getMessage(ih,rh,dh,t);th.log("mcumgr - _uploadNext: Message Length: "+s.length),this._imageUploadNextCallback({packet:s})}async reset(){this._messageCallback=null,this._imageUploadProgressCallback=null,this._imageUploadNextCallback=null,this._fileUploadProgressCallback=null,this._fileUploadNextCallback=null,this._uploadIsInProgress=!1,this._downloadIsInProgress=!1,this._buffer=new Uint8Array,this._seq=0}async cmdUpload(t,e=0){this._uploadIsInProgress?th.error("Upload is already in progress."):(this._uploadIsInProgress=!0,this._uploadOffset=0,this._uploadImage=t,this._uploadSlot=e,this._uploadNext())}async cmdUploadFile(t,e){this._uploadIsInProgress?th.error("Upload is already in progress."):(this._uploadIsInProgress=!0,this._uploadFileOffset=0,this._uploadFile=t,this._uploadFilename=e,this._uploadFileNext())}async _uploadFileNext(){if(th.log("uploadFileNext - offset: "+this._uploadFileOffset+", length: "+this._uploadFile.byteLength),this._uploadFileOffset>=this._uploadFile.byteLength)return this._uploadIsInProgress=!1,void this._fileUploadFinishedCallback();const t={data:new Uint8Array,off:this._uploadFileOffset};0===this._uploadFileOffset&&(t.len=this._uploadFile.byteLength),t.name=this._uploadFilename,this._fileUploadProgressCallback({percentage:Math.floor(this._uploadFileOffset/this._uploadFile.byteLength*100)});const e=this._mtu-Zo.encode(t).byteLength-8;t.data=new Uint8Array(this._uploadFile.slice(this._uploadFileOffset,this._uploadFileOffset+e)),this._uploadFileOffset+=e;const s=this._getMessage(ih,oh,ph,t);th.log("mcumgr - _uploadNext: Message Length: "+s.length),this._fileUploadNextCallback({packet:s})}async cmdDownloadFile(t,e){this._downloadIsInProgress?th.error("Download is already in progress."):(this._downloadIsInProgress=!0,this._downloadFileOffset=0,this._downloadFileLength=0,this._downloadRemoteFilename=t,this._downloadLocalFilename=e,this._downloadFileNext())}async _downloadFileNext(){if(this._downloadFileLength>0&&this._downloadFileOffset>=this._downloadFileLength)return this._downloadIsInProgress=!1,void this._fileDownloadFinishedCallback();const t={off:this._downloadFileOffset};0===this._downloadFileOffset&&(t.name=this._downloadRemoteFilename);const e=this._getMessage(eh,oh,ph,t);th.log("mcumgr - _downloadNext: Message Length: "+e.length),this._fileDownloadNextCallback({packet:e})}async imageInfo(t){const e={},s=new Uint8Array(t);if(s.length<32)throw new Error("Invalid image (too short file)");if(61!==s[0]||184!==s[1]||243!==s[2]||150!==s[3])throw new Error("Invalid image (wrong magic bytes)");if(0!==s[4]||0!==s[5]||0!==s[6]||0!==s[7])throw new Error("Invalid image (wrong load address)");const i=s[8]+256*s[9];if(0!==s[10]||0!==s[11])throw new Error("Invalid image (wrong protected TLV area size)");const n=s[12]+256*s[13]+65536*s[14]+s[15]*2**24;if(e.imageSize=n,s.length<n+i)throw new Error("Invalid image (wrong image size)");if(0!==s[16]||0!==s[17]||0!==s[18]||0!==s[19])throw new Error("Invalid image (wrong flags)");const a=`${s[20]}.${s[21]}.${s[22]+256*s[23]}`;return e.version=a,e.hash=[...new Uint8Array(await this._hash(t.slice(0,n+32)))].map((t=>t.toString(16).padStart(2,"0"))).join(""),e}}var vh,yh,wh,bh,Ch,Sh,Eh,Mh,Dh,kh,Wh,Th,Rh,xh,Ih,Lh,Uh,Ah,_h,Fh,Bh;const $h=W("FirmwareManager",{log:!1}),Oh=["smp"],Ph=[...Oh,"firmwareImages","firmwareUploadProgress","firmwareStatus","firmwareUploadComplete"],Nh=["idle","uploading","uploaded","pending","testing","erasing"];class Vh{constructor(){vh.add(this),wh.set(this,"idle"),Ch.set(this,void 0),Mh.set(this,void 0),Dh.set(this,new mh),t(this,vh,"m",kh).call(this),J(this)}get addEventListenter(){return this.eventDispatcher.addEventListener}get removeEventListener(){return this.eventDispatcher.removeEventListener}get waitForEvent(){return this.eventDispatcher.waitForEvent}parseMessage(e,s){if($h.log({messageType:e}),"smp"!==e)throw Error(`uncaught messageType ${e}`);t(this,Dh,"f")._notification(Array.from(new Uint8Array(s.buffer))),t(this,vh,"a",yh).call(this,"smp",{dataView:s})}async uploadFirmware(e){$h.log("uploadFirmware",e);const s=this.waitForEvent("firmwareUploadComplete");await this.getImages();const i=await X(e),n=await t(this,Dh,"f").imageInfo(i);$h.log({imageInfo:n}),t(this,Dh,"f").cmdUpload(i,1),t(this,vh,"m",bh).call(this,"uploading"),await s}get status(){return t(this,wh,"f")}get images(){return t(this,Ch,"f")}async getImages(){const e=this.waitForEvent("firmwareImages");$h.log("getting firmware image state..."),this.sendMessage(Uint8Array.from(t(this,Dh,"f").cmdImageState()).buffer),await e}async testImage(e=1){if(t(this,vh,"m",Eh).call(this,e),t(this,vh,"m",Sh).call(this),!t(this,Ch,"f")[e])return void $h.log(`image ${e} not found`);if(1==t(this,Ch,"f")[e].pending)return void $h.log(`image ${e} is already pending`);if(t(this,Ch,"f")[e].empty)return void $h.log(`image ${e} is empty`);const s=this.waitForEvent("smp");$h.log("testing firmware image..."),this.sendMessage(Uint8Array.from(t(this,Dh,"f").cmdImageTest(t(this,Ch,"f")[e].hash)).buffer),await s}async eraseImage(){t(this,vh,"m",Sh).call(this);const e=this.waitForEvent("smp");$h.log("erasing image..."),this.sendMessage(Uint8Array.from(t(this,Dh,"f").cmdImageErase()).buffer),t(this,vh,"m",bh).call(this,"erasing"),await e,await this.getImages()}async confirmImage(e=0){if(t(this,vh,"m",Eh).call(this,e),t(this,vh,"m",Sh).call(this),!0===t(this,Ch,"f")[e].confirmed)return void $h.log(`image ${e} is already confirmed`);const s=this.waitForEvent("smp");$h.log("confirming image..."),this.sendMessage(Uint8Array.from(t(this,Dh,"f").cmdImageConfirm(t(this,Ch,"f")[e].hash)).buffer),await s}async echo(e){$h.assertTypeWithError(e,"string");const s=this.waitForEvent("smp");$h.log("sending echo..."),this.sendMessage(Uint8Array.from(t(this,Dh,"f").smpEcho(e)).buffer),await s}async reset(){const e=this.waitForEvent("smp");$h.log("resetting..."),this.sendMessage(Uint8Array.from(t(this,Dh,"f").cmdReset()).buffer),await e}get mtu(){return t(this,Mh,"f")}set mtu(s){e(this,Mh,s,"f"),t(this,Dh,"f")._mtu=s}}var qh,zh,jh,Gh,Hh,Xh,Yh,Jh,Kh,Qh,Zh,tc,ec,sc,ic,nc,ac,rc;wh=new WeakMap,Ch=new WeakMap,Mh=new WeakMap,Dh=new WeakMap,vh=new WeakSet,yh=function(){return this.eventDispatcher.dispatchEvent},bh=function(s){$h.assertEnumWithError(s,Nh),t(this,wh,"f")!=s?(e(this,wh,s,"f"),$h.log({firmwareStatus:t(this,wh,"f")}),t(this,vh,"a",yh).call(this,"firmwareStatus",{firmwareStatus:t(this,wh,"f")})):$h.log(`redundant firmwareStatus assignment "${s}"`)},Sh=function(){$h.assertWithError(t(this,Ch,"f"),"didn't get imageState")},Eh=function(t){$h.assertTypeWithError(t,"number"),$h.assertWithError(0==t||1==t,"imageIndex must be 0 or 1")},kh=function(){t(this,Dh,"f").onMessage(t(this,vh,"m",Wh).bind(this)),t(this,Dh,"f").onFileDownloadNext(t(this,vh,"m",Th)),t(this,Dh,"f").onFileDownloadProgress(t(this,vh,"m",Rh).bind(this)),t(this,Dh,"f").onFileDownloadFinished(t(this,vh,"m",xh).bind(this)),t(this,Dh,"f").onFileUploadNext(t(this,vh,"m",Ih).bind(this)),t(this,Dh,"f").onFileUploadProgress(t(this,vh,"m",Lh).bind(this)),t(this,Dh,"f").onFileUploadFinished(t(this,vh,"m",Uh).bind(this)),t(this,Dh,"f").onImageUploadNext(t(this,vh,"m",Ah).bind(this)),t(this,Dh,"f").onImageUploadProgress(t(this,vh,"m",_h).bind(this)),t(this,Dh,"f").onImageUploadFinished(t(this,vh,"m",Fh).bind(this))},Wh=function({op:e,group:s,id:i,data:n,length:a}){switch($h.log("onMcuMessage",...arguments),s){case ah:switch(i){case hh:$h.log(`echo "${n.r}"`);break;case ch:$h.table(n.tasks);break;case lh:$h.log(n)}break;case rh:if(i===gh)t(this,vh,"m",Bh).call(this,n);break;default:throw Error(`uncaught mcuMessage group ${s}`)}},Th=function(){$h.log("onMcuFileDownloadNext",...arguments)},Rh=function(){$h.log("onMcuFileDownloadProgress",...arguments)},xh=function(){$h.log("onMcuFileDownloadFinished",...arguments)},Ih=function(){$h.log("onMcuFileUploadNext")},Lh=function(){$h.log("onMcuFileUploadProgress")},Uh=function(){$h.log("onMcuFileUploadFinished")},Ah=function({packet:t}){$h.log("onMcuImageUploadNext"),this.sendMessage(Uint8Array.from(t).buffer)},_h=function({percentage:e}){const s=e/100;$h.log("onMcuImageUploadProgress",...arguments),t(this,vh,"a",yh).call(this,"firmwareUploadProgress",{progress:s})},Fh=async function(){$h.log("onMcuImageUploadFinished",...arguments),await this.getImages(),t(this,vh,"a",yh).call(this,"firmwareUploadProgress",{progress:100}),t(this,vh,"a",yh).call(this,"firmwareUploadComplete",{})},Bh=function({images:s}){if(!s)return void $h.log("no images found");e(this,Ch,s,"f"),$h.log("images",t(this,Ch,"f"));let i="idle";2==t(this,Ch,"f").length&&(t(this,Ch,"f")[1].bootable?t(this,Ch,"f")[0].confirmed?t(this,Ch,"f")[1].pending?($h.log("reset to upload to the new firmware image"),i="pending"):($h.log("Slot 1 has a valid image. run testImage() to test it or upload a different image."),i="uploaded"):($h.log('Slot 0 has a valid image. Click "Confirm Image" to confirm it or wait and the device will swap images back.'),i="testing"):$h.warn('Slot 1 has a invalid image. Click "Erase Image" to erase it or upload a different image')),1==t(this,Ch,"f").length&&(t(this,Ch,"f").push({slot:1,empty:!0,version:"Empty",pending:!1,confirmed:!1,bootable:!1,active:!1,permanent:!1}),$h.log("Select a firmware upload image to upload to slot 1.")),t(this,vh,"m",bh).call(this,i),t(this,vh,"a",yh).call(this,"firmwareImages",{firmwareImages:t(this,Ch,"f")})};const oc=W("DeviceManager",{log:!1}),hc=["deviceConnected","deviceDisconnected","deviceIsConnected","availableDevices","connectedDevices"];class cc{constructor(){if(qh.add(this),zh.set(this,{getType:t(this,qh,"m",jh).bind(this),isConnected:t(this,qh,"m",nc).bind(this)}),Gh.set(this,[]),Hh.set(this,!1),Xh.set(this,{devices:[]}),Yh.set(this,void 0),Kh.set(this,"BS.Device"),ec.set(this,[]),sc.set(this,new I(this,hc)),cc.shared&&this!=cc.shared)throw Error("DeviceManager is a singleton - use DeviceManager.shared");this.CanUseLocalStorage&&(this.UseLocalStorage=!0)}onDevice(e){bo(e,t(this,zh,"f"))}OnDeviceConnectionStatusUpdated(e,s){if("notConnected"==s&&!e.canReconnect&&t(this,ec,"f").includes(e)){const s=t(this,ec,"f").indexOf(e);this.AvailableDevices.splice(s,1),t(this,qh,"m",ac).call(this)}}get ConnectedDevices(){return t(this,Gh,"f")}get UseLocalStorage(){return t(this,Hh,"f")}set UseLocalStorage(s){t(this,qh,"m",Jh).call(this),oc.assertTypeWithError(s,"boolean"),e(this,Hh,s,"f"),t(this,Hh,"f")&&!t(this,Yh,"f")&&t(this,qh,"m",Zh).call(this)}get CanUseLocalStorage(){return i&&window.localStorage}get AvailableDevices(){return t(this,ec,"f")}get CanGetDevices(){return i&&navigator.bluetooth?.getDevices}async GetDevices(){if(!i)return void oc.warn("GetDevices is only available in the browser");if(!navigator.bluetooth)return void oc.warn("bluetooth is not available in this browser");if(o)return void oc.warn("bluefy lists too many devices...");if(!navigator.bluetooth.getDevices)return void oc.warn("bluetooth.getDevices() is not available in this browser");if(!this.CanGetDevices)return void oc.log("CanGetDevices is false");t(this,Yh,"f")||t(this,qh,"m",Zh).call(this);const e=t(this,Yh,"f");if(!e.devices||0==e.devices.length)return void oc.log("no devices found in configuration");const s=await navigator.bluetooth.getDevices();return oc.log({bluetoothDevices:s}),s.forEach((s=>{if(!s.gatt)return;let i=e.devices.find((t=>s.id==t.bluetoothId));if(!i)return;let n=this.ConnectedDevices.filter((t=>"webBluetooth"==t.connectionType)).find((t=>t.bluetoothId==s.id));const a=this.AvailableDevices.filter((t=>"webBluetooth"==t.connectionType)).find((t=>t.bluetoothId==s.id));if(a)return void(n&&n?.bluetoothId==a.bluetoothId&&n!=a&&(this.AvailableDevices[t(this,ec,"f").indexOf(a)]=n));if(n)return void this.AvailableDevices.push(n);const r=new _l,o=new Jo;o.device=s,s.name&&r._informationManager.updateName(s.name),r._informationManager.updateType(i.type),r.connectionManager=o,this.AvailableDevices.push(r)})),t(this,qh,"m",ac).call(this),this.AvailableDevices}get AddEventListener(){return t(this,sc,"f").addEventListener}get RemoveEventListener(){return t(this,sc,"f").removeEventListener}get RemoveEventListeners(){return t(this,sc,"f").removeEventListeners}get RemoveAllEventListeners(){return t(this,sc,"f").removeAllEventListeners}_CheckDeviceAvailability(e){e.isConnected||e.isAvailable||!t(this,ec,"f").includes(e)||(oc.log("removing device from availableDevices..."),t(this,ec,"f").splice(t(this,ec,"f").indexOf(e),1),t(this,qh,"m",ac).call(this))}}zh=new WeakMap,Gh=new WeakMap,Hh=new WeakMap,Xh=new WeakMap,Yh=new WeakMap,Kh=new WeakMap,ec=new WeakMap,sc=new WeakMap,qh=new WeakSet,jh=function(e){t(this,Hh,"f")&&t(this,qh,"m",tc).call(this,e.target)},Jh=function(){oc.assertWithError(i,"localStorage is only available in the browser"),oc.assertWithError(window.localStorage,"localStorage not found")},Qh=function(){t(this,qh,"m",Jh).call(this),localStorage.setItem(t(this,Kh,"f"),JSON.stringify(t(this,Yh,"f")))},Zh=async function(){t(this,qh,"m",Jh).call(this);let s=localStorage.getItem(t(this,Kh,"f"));if("string"!=typeof s)return oc.log("no info found in localStorage"),e(this,Yh,Object.assign({},t(this,Xh,"f")),"f"),void t(this,qh,"m",Qh).call(this);try{const t=JSON.parse(s);oc.log({configuration:t}),e(this,Yh,t,"f"),this.CanGetDevices&&await this.GetDevices()}catch(t){oc.error(t)}},tc=function(e){if("webBluetooth"!=e.connectionType)return void oc.log("localStorage is only for webBluetooth devices");t(this,qh,"m",Jh).call(this);const s=t(this,Yh,"f").devices.findIndex((t=>t.bluetoothId==e.bluetoothId));-1!=s&&(t(this,Yh,"f").devices[s].type=e.type,t(this,qh,"m",Qh).call(this))},ic=function(){return t(this,sc,"f").dispatchEvent},nc=function(e){const{target:s}=e;if(s.isConnected)if(t(this,Gh,"f").includes(s))oc.log("device already included");else{if(oc.log("adding device",s),t(this,Gh,"f").push(s),this.UseLocalStorage&&"webBluetooth"==s.connectionType){const e={type:s.type,bluetoothId:s.bluetoothId,ipAddress:s.ipAddress,isWifiSecure:s.isWifiSecure},i=t(this,Yh,"f").devices.findIndex((t=>t.bluetoothId==e.bluetoothId));-1==i?t(this,Yh,"f").devices.push(e):t(this,Yh,"f").devices[i]=e,t(this,qh,"m",Qh).call(this)}t(this,qh,"a",ic).call(this,"deviceConnected",{device:s}),t(this,qh,"a",ic).call(this,"deviceIsConnected",{device:s}),t(this,qh,"m",rc).call(this)}else t(this,Gh,"f").includes(s)?(oc.log("removing device",s),t(this,Gh,"f").splice(t(this,Gh,"f").indexOf(s),1),t(this,qh,"a",ic).call(this,"deviceDisconnected",{device:s}),t(this,qh,"a",ic).call(this,"deviceIsConnected",{device:s}),t(this,qh,"m",rc).call(this)):oc.log("device already not included");if(this.CanGetDevices&&this.GetDevices(),s.isConnected&&!this.AvailableDevices.includes(s)){const e=this.AvailableDevices.find((t=>t.bluetoothId==s.bluetoothId));oc.log({existingAvailableDevice:e}),e?this.AvailableDevices[this.AvailableDevices.indexOf(e)]=s:this.AvailableDevices.push(s),t(this,qh,"m",ac).call(this)}this._CheckDeviceAvailability(s)},ac=function(){oc.log({AvailableDevices:this.AvailableDevices}),t(this,qh,"a",ic).call(this,"availableDevices",{availableDevices:this.AvailableDevices})},rc=function(){oc.log({ConnectedDevices:this.ConnectedDevices}),t(this,qh,"a",ic).call(this,"connectedDevices",{connectedDevices:this.ConnectedDevices})},cc.shared=new cc;var lc=cc.shared;const fc=W("ServerUtils",{log:!1}),gc=["isScanningAvailable","isScanning","startScan","stopScan","discoveredDevice","discoveredDevices","expiredDiscoveredDevice","connectToDevice","disconnectFromDevice","connectedDevices","deviceMessage","requiredDeviceInformation"];function dc(t,...e){fc.log("createMessage",...e);const s=e.map((e=>{"string"==typeof e&&(e={type:e}),null!=e.data?Array.isArray(e.data)||(e.data=[e.data]):e.data=[];const s=j(...e.data),i=s.byteLength;fc.assertEnumWithError(e.type,t);const n=t.indexOf(e.type),a=new DataView(new ArrayBuffer(2));return a.setUint16(0,i,!0),j(n,a,s)}));return fc.log("messageBuffers",...s),j(...s)}function uc(...t){return fc.log("createServerMessage",...t),dc(gc,...t)}function pc(...t){return fc.log("createClientDeviceMessage",...t),dc(vo,...t)}uc("isScanningAvailable"),uc("isScanning"),uc("startScan"),uc("stopScan"),uc("discoveredDevices");const mc=W("WebSocketUtils",{log:!1}),vc=["ping","pong","serverMessage"];function yc(...t){return mc.log("createWebSocketMessage",...t),dc(vc,...t)}var wc,bc,Cc,Sc,Ec,Mc,Dc,kc,Wc,Tc,Rc,xc,Ic,Lc,Uc,Ac,_c,Fc;yc("ping"),yc("pong");const Bc=W("WebSocketConnectionManager",{log:!1}),$c=["ping","pong","batteryLevel","deviceInformation","message"];const Oc=["deviceInformation","batteryLevel"];class Pc extends yo{get bluetoothId(){return t(this,bc,"f")??""}constructor(s,i=!1,n){super(),wc.add(this),bc.set(this,void 0),this.defaultMtu=1024,Cc.set(this,void 0),Sc.set(this,void 0),Ec.set(this,!1),kc.set(this,{open:t(this,wc,"m",Wc).bind(this),message:t(this,wc,"m",Tc).bind(this),close:t(this,wc,"m",Rc).bind(this),error:t(this,wc,"m",xc).bind(this)}),Uc.set(this,new F(t(this,wc,"m",Ac).bind(this),29e3)),this.ipAddress=s,this.isSecure=i,this.mtu=this.defaultMtu,e(this,bc,n,"f")}get isAvailable(){return!0}static get isSupported(){return!0}static get type(){return"webSocket"}get webSocket(){return t(this,Cc,"f")}set webSocket(s){t(this,Cc,"f")!=s?(Bc.log("assigning webSocket",s),t(this,Cc,"f")&&(Co(t(this,Cc,"f"),t(this,kc,"f")),t(this,Cc,"f").readyState==t(this,Cc,"f").OPEN&&t(this,Cc,"f").close()),s&&bo(s,t(this,kc,"f")),e(this,Cc,s,"f"),Bc.log("assigned webSocket")):Bc.log("redundant webSocket assignment")}get ipAddress(){return t(this,Sc,"f")}set ipAddress(s){this.assertIsNotConnected(),t(this,Sc,"f")!=s?(e(this,Sc,s,"f"),Bc.log(`updated ipAddress to "${this.ipAddress}"`)):Bc.log(`redundnant ipAddress assignment "${s}"`)}get isSecure(){return t(this,Ec,"f")}set isSecure(s){this.assertIsNotConnected(),t(this,Ec,"f")!=s?(e(this,Ec,s,"f"),Bc.log(`updated isSecure to "${this.isSecure}"`)):Bc.log(`redundant isSecure assignment ${s}`)}get url(){return`${this.isSecure?"wss":"ws"}://${this.ipAddress}/ws`}async connect(){await super.connect();try{this.webSocket=new WebSocket(this.url)}catch(t){Bc.error("error connecting to webSocket",t),this.status="notConnected"}}async disconnect(){await super.disconnect(),Bc.log("closing websocket"),t(this,Uc,"f").stop(),t(this,Cc,"f")?.close()}get canReconnect(){return Boolean(this.webSocket)}async reconnect(){await super.reconnect(),this.webSocket=new WebSocket(this.url)}async sendSmpMessage(t){super.sendSmpMessage(t),Bc.error("smp not supported on webSockets")}async sendTxData(e){await super.sendTxData(e),0!=e.byteLength&&t(this,wc,"m",Dc).call(this,{type:"message",data:e})}remove(){super.remove(),this.webSocket=void 0}}var Nc,Vc,qc,zc,jc,Gc,Hc,Xc,Yc,Jc,Kc,Qc,Zc,tl,el,sl,il,nl,al,rl,ol,hl,cl,ll,fl,gl,dl,ul,pl,ml,vl,yl,wl,bl,Cl,Sl,El,Ml,Dl,kl,Wl,Tl,Rl,xl,Il;bc=new WeakMap,Cc=new WeakMap,Sc=new WeakMap,Ec=new WeakMap,kc=new WeakMap,Uc=new WeakMap,wc=new WeakSet,Mc=function(e){this.assertIsConnected(),Bc.log("sending webSocket message",e),t(this,Cc,"f").send(e),t(this,Uc,"f").restart()},Dc=function(...e){t(this,wc,"m",Mc).call(this,function(...t){return Bc.log("createWebSocketMessage",...t),dc($c,...t)}(...e))},Wc=function(e){Bc.log("webSocket.open",e),t(this,Uc,"f").start(),this.status="connected",t(this,wc,"m",Fc).call(this)},Tc=async function(e){const s=await e.data.arrayBuffer(),i=new DataView(s);Bc.log(`webSocket.message (${i.byteLength} bytes)`),t(this,wc,"m",Ic).call(this,i)},Rc=function(e){Bc.log("webSocket.close",e),this.status="notConnected",t(this,Uc,"f").stop()},xc=function(t){Bc.error("webSocket.error",t)},Ic=function(e){Te(e,$c,t(this,wc,"m",Lc).bind(this),null,!0)},Lc=function(e,s){switch(Bc.log(`received "${e}" message (${s.byteLength} bytes)`),e){case"ping":t(this,wc,"m",_c).call(this);break;case"pong":break;case"batteryLevel":this.onMessageReceived?.("batteryLevel",s);break;case"deviceInformation":Te(s,dn,((t,e)=>{this.onMessageReceived(t,e)}));break;case"message":this.parseRxMessage(s);break;default:Bc.error(`uncaught messageType "${e}"`)}},Ac=function(){Bc.log("pinging"),t(this,wc,"m",Dc).call(this,"ping")},_c=function(){Bc.log("ponging"),t(this,wc,"m",Dc).call(this,"pong")},Fc=function(){t(this,wc,"m",Dc).call(this,...Oc)};const Ll=W("Device",{log:!0}),Ul=["connectionMessage",...go,...mo,...po,...Pn,...un,...bi,...ei,...ga,...zt,...en,...za,...fs,...Hs,...Yr,...Ph],Al=["isCharging","getBatteryCurrent","getId","getMtu","getName","getType","getCurrentTime","getSensorConfiguration","getSensorScalars","getVibrationLocations","getFileTypes","isWifiAvailable"];class _l{get bluetoothId(){return t(this,Gc,"f")?.bluetoothId}get isAvailable(){return t(this,Gc,"f")?.isAvailable}constructor(){Nc.add(this),zc.set(this,new I(this,Ul)),Gc.set(this,void 0),this.sendTxMessages=t(this,Nc,"m",Hc).bind(this),Xc.set(this,!1),el.set(this,Vc.ReconnectOnDisconnection),sl.set(this,void 0),this.latestConnectionMessages=new Map,ll.set(this,new pn),fl.set(this,0),this._informationManager=new Nn,dl.set(this,new Ci),pl.set(this,Vc.ClearSensorConfigurationOnLeave),ml.set(this,new si),vl.set(this,new wa),yl.set(this,new Gt),wl.set(this,new rn),bl.set(this,new Vh),this.sendSmpMessage=t(this,Nc,"m",Sl).bind(this),El.set(this,!1),Ml.set(this,new ja),Dl.set(this,new gs),Wl.set(this,new Xs),xl.set(this,new Jr),t(this,ll,"f").eventDispatcher=t(this,zc,"f"),this._informationManager.sendMessage=this.sendTxMessages,this._informationManager.eventDispatcher=t(this,zc,"f"),t(this,dl,"f").sendMessage=this.sendTxMessages,t(this,dl,"f").eventDispatcher=t(this,zc,"f"),t(this,ml,"f").eventDispatcher=t(this,zc,"f"),t(this,vl,"f").sendMessage=this.sendTxMessages,t(this,vl,"f").eventDispatcher=t(this,zc,"f"),t(this,wl,"f").sendMessage=this.sendTxMessages,t(this,wl,"f").eventDispatcher=t(this,zc,"f"),t(this,yl,"f").sendMessage=this.sendTxMessages,t(this,yl,"f").eventDispatcher=t(this,zc,"f"),t(this,Ml,"f").sendMessage=this.sendTxMessages,t(this,Ml,"f").eventDispatcher=t(this,zc,"f"),t(this,Dl,"f").sendMessage=this.sendTxMessages,t(this,Dl,"f").eventDispatcher=t(this,zc,"f"),t(this,Wl,"f").sendMessage=this.sendTxMessages,t(this,Wl,"f").eventDispatcher=t(this,zc,"f"),t(this,xl,"f").sendMessage=this.sendTxMessages,t(this,xl,"f").eventDispatcher=t(this,zc,"f"),t(this,bl,"f").sendMessage=this.sendSmpMessage,t(this,bl,"f").eventDispatcher=t(this,zc,"f"),this.addEventListener("getMtu",(()=>{t(this,bl,"f").mtu=this.mtu,t(this,yl,"f").mtu=this.mtu,this.connectionManager.mtu=this.mtu,t(this,xl,"f").mtu=this.mtu})),this.addEventListener("getSensorConfiguration",(()=>{if("connecting"==this.connectionStatus){if(this.sensorTypes.includes("pressure")){Ll.log("requesting required pressure information");const t=ti.map((t=>({type:t})));this.sendTxMessages(t,!1)}else Ll.log("don't need to request pressure infomration");if(this.sensorTypes.includes("camera")){Ll.log("requesting required camera information");const t=ls.map((t=>({type:t})));this.sendTxMessages(t,!1)}else Ll.log("don't need to request camera infomration");if(this.sensorTypes.includes("microphone")){Ll.log("requesting required microphone information");const t=Gs.map((t=>({type:t})));this.sendTxMessages(t,!1)}else Ll.log("don't need to request microphone infomration")}})),this.addEventListener("getFileTypes",(()=>{"connecting"==this.connectionStatus&&(this.fileTypes.length>0&&t(this,yl,"f").requestRequiredInformation(),this.fileTypes.includes("tflite")&&t(this,wl,"f").requestRequiredInformation())})),this.addEventListener("isWifiAvailable",(()=>{"connecting"==this.connectionStatus&&("client"!=this.connectionType||n)&&this.isWifiAvailable&&"client"!=this.connectionType&&t(this,Ml,"f").requestRequiredInformation()})),this.addEventListener("getType",(()=>{"connecting"==this.connectionStatus&&(console.log("lozers",this.type),("client"!=this.connectionType||n)&&"glasses"==this.type&&"client"!=this.connectionType&&t(this,xl,"f").requestRequiredInformation())})),lc.onDevice(this),i&&window.addEventListener("beforeunload",(()=>{this.isConnected&&this.clearSensorConfigurationOnLeave&&this.clearSensorConfiguration()})),n&&process.on("exit",(()=>{this.isConnected&&this.clearSensorConfigurationOnLeave&&this.clearSensorConfiguration()}))}get addEventListener(){return t(this,zc,"f").addEventListener}get removeEventListener(){return t(this,zc,"f").removeEventListener}get waitForEvent(){return t(this,zc,"f").waitForEvent}get removeEventListeners(){return t(this,zc,"f").removeEventListeners}get removeAllEventListeners(){return t(this,zc,"f").removeAllEventListeners}get connectionManager(){return t(this,Gc,"f")}set connectionManager(s){this.connectionManager!=s?(this.connectionManager&&this.connectionManager.remove(),s&&(s.onStatusUpdated=t(this,Nc,"m",il).bind(this),s.onMessageReceived=t(this,Nc,"m",hl).bind(this),s.onMessagesReceived=t(this,Nc,"m",cl).bind(this)),e(this,Gc,s,"f"),Ll.log("assigned new connectionManager",t(this,Gc,"f")),this._informationManager.connectionType=this.connectionType):Ll.log("same connectionManager is already assigned")}async connect(e){if(Ll.log("connect options",e),e)switch(e.type){case"webBluetooth":"webBluetooth"!=this.connectionType&&(this.connectionManager=new Jo);break;case"webSocket":{let t=!1;if("webSocket"==this.connectionType){const s=this.connectionManager;s.ipAddress==e.ipAddress&&s.isSecure==e.isWifiSecure||(t=!0)}else t=!0;t&&(this.connectionManager=new Pc(e.ipAddress,e.isWifiSecure,this.bluetoothId))}break;case"udp":{let t=!1;if("udp"==this.connectionType){this.connectionManager.ipAddress!=e.ipAddress&&(t=!0),this.reconnectOnDisconnection=!0}else t=!0;t&&(this.connectionManager=new UDPConnectionManager(e.ipAddress,this.bluetoothId))}}if(this.connectionManager||(this.connectionManager=t(Vc,Vc,"m",qc).call(Vc)),t(this,Nc,"m",rl).call(this),"client"==e?.type){Ll.assertWithError("client"==this.connectionType,"expected clientConnectionManager");const t=this.connectionManager;return t.subType=e.subType,t.connect()}return Ll.log("connectionManager type",this.connectionManager.type),this.connectionManager.connect()}get isConnected(){return t(this,Xc,"f")}get canReconnect(){return this.connectionManager?.canReconnect}async reconnect(){return t(this,Nc,"m",Zc).call(this),t(this,Nc,"m",rl).call(this),this.connectionManager?.reconnect()}static async Connect(){const t=new Vc;return await t.connect(),t}static get ReconnectOnDisconnection(){return t(this,Vc,"f",tl)}static set ReconnectOnDisconnection(t){Ll.assertTypeWithError(t,"boolean"),e(this,Vc,t,"f",tl)}get reconnectOnDisconnection(){return t(this,el,"f")}set reconnectOnDisconnection(t){Ll.assertTypeWithError(t,"boolean"),e(this,el,t,"f")}get connectionType(){return this.connectionManager?.type}async disconnect(){return t(this,Nc,"m",Yc).call(this),this.reconnectOnDisconnection&&(this.reconnectOnDisconnection=!1,this.addEventListener("isConnected",(()=>{this.reconnectOnDisconnection=!0}),{once:!0})),this.connectionManager.disconnect()}toggleConnection(){if(this.isConnected)this.disconnect();else if(this.canReconnect)try{this.reconnect()}catch(t){Ll.error("error trying to reconnect",t),this.connect()}else this.connect()}get connectionStatus(){switch(t(this,Gc,"f")?.status){case"connected":return this.isConnected?"connected":"connecting";case"notConnected":case"connecting":case"disconnecting":return t(this,Gc,"f").status;default:return"notConnected"}}get isConnectionBusy(){return"connecting"==this.connectionStatus||"disconnecting"==this.connectionStatus}get deviceInformation(){return t(this,ll,"f").information}get batteryLevel(){return t(this,fl,"f")}get id(){return this._informationManager.id}get isCharging(){return this._informationManager.isCharging}get batteryCurrent(){return this._informationManager.batteryCurrent}get getBatteryCurrent(){return this._informationManager.getBatteryCurrent}get name(){return this._informationManager.name}get setName(){return this._informationManager.setName}get type(){return this._informationManager.type}get setType(){return this._informationManager.setType}get isInsole(){return this._informationManager.isInsole}get isGlove(){return this._informationManager.isGlove}get side(){return this._informationManager.side}get mtu(){return this._informationManager.mtu}get sensorTypes(){return Object.keys(this.sensorConfiguration)}get continuousSensorTypes(){return Qs.filter((t=>this.sensorTypes.includes(t)))}get sensorConfiguration(){return t(this,dl,"f").configuration}get setSensorConfiguration(){return t(this,dl,"f").setConfiguration}async clearSensorConfiguration(){return t(this,dl,"f").clearSensorConfiguration()}static get ClearSensorConfigurationOnLeave(){return t(this,Vc,"f",ul)}static set ClearSensorConfigurationOnLeave(t){Ll.assertTypeWithError(t,"boolean"),e(this,Vc,t,"f",ul)}get clearSensorConfigurationOnLeave(){return t(this,pl,"f")}set clearSensorConfigurationOnLeave(t){Ll.assertTypeWithError(t,"boolean"),e(this,pl,t,"f")}get numberOfPressureSensors(){return t(this,ml,"f").pressureSensorDataManager.numberOfSensors}resetPressureRange(){t(this,ml,"f").pressureSensorDataManager.resetRange()}get vibrationLocations(){return t(this,vl,"f").vibrationLocations}async triggerVibration(e,s){t(this,vl,"f").triggerVibration(e,s)}get fileTypes(){return t(this,yl,"f").fileTypes}get maxFileLength(){return t(this,yl,"f").maxLength}get validFileTypes(){return Pt.filter((t=>!(t.includes("wifi")&&!this.isWifiAvailable)))}async sendFile(e,s){Ll.assertWithError(this.validFileTypes.includes(e),`invalid fileType ${e}`);const i=this.waitForEvent("fileTransferComplete");t(this,yl,"f").send(e,s),await i}async receiveFile(e){const s=this.waitForEvent("fileTransferComplete");t(this,yl,"f").receive(e),await s}get fileTransferStatus(){return t(this,yl,"f").status}cancelFileTransfer(){t(this,yl,"f").cancel()}get tfliteName(){return t(this,wl,"f").name}get setTfliteName(){return t(this,wl,"f").setName}async sendTfliteConfiguration(e){e.type="tflite",t(this,wl,"f").sendConfiguration(e,!1);await t(this,yl,"f").send(e.type,e.file)||t(this,Nc,"m",Hc).call(this)}get tfliteTask(){return t(this,wl,"f").task}get setTfliteTask(){return t(this,wl,"f").setTask}get tfliteSampleRate(){return t(this,wl,"f").sampleRate}get setTfliteSampleRate(){return t(this,wl,"f").setSampleRate}get tfliteSensorTypes(){return t(this,wl,"f").sensorTypes}get allowedTfliteSensorTypes(){return this.sensorTypes.filter((t=>an.includes(t)))}get setTfliteSensorTypes(){return t(this,wl,"f").setSensorTypes}get tfliteIsReady(){return t(this,wl,"f").isReady}get tfliteInferencingEnabled(){return t(this,wl,"f").inferencingEnabled}get setTfliteInferencingEnabled(){return t(this,wl,"f").setInferencingEnabled}async enableTfliteInferencing(){return this.setTfliteInferencingEnabled(!0)}async disableTfliteInferencing(){return this.setTfliteInferencingEnabled(!1)}get toggleTfliteInferencing(){return t(this,wl,"f").toggleInferencingEnabled}get tfliteCaptureDelay(){return t(this,wl,"f").captureDelay}get setTfliteCaptureDelay(){return t(this,wl,"f").setCaptureDelay}get tfliteThreshold(){return t(this,wl,"f").threshold}get setTfliteThreshold(){return t(this,wl,"f").setThreshold}get canUpdateFirmware(){return t(this,Gc,"f")?.canUpdateFirmware}get uploadFirmware(){return t(this,Nc,"m",Cl).call(this),t(this,bl,"f").uploadFirmware}get canReset(){return this.canUpdateFirmware}async reset(){return Ll.assertWithError(this.canReset,"reset is not enabled for this device"),await t(this,bl,"f").reset(),t(this,Gc,"f").disconnect()}get firmwareStatus(){return t(this,bl,"f").status}get getFirmwareImages(){return t(this,Nc,"m",Cl).call(this),t(this,bl,"f").getImages}get firmwareImages(){return t(this,bl,"f").images}get eraseFirmwareImage(){return t(this,Nc,"m",Cl).call(this),t(this,bl,"f").eraseImage}get confirmFirmwareImage(){return t(this,Nc,"m",Cl).call(this),t(this,bl,"f").confirmImage}get testFirmwareImage(){return t(this,Nc,"m",Cl).call(this),t(this,bl,"f").testImage}get isServerSide(){return t(this,El,"f")}set isServerSide(s){t(this,El,"f")!=s?(Ll.log({newIsServerSide:s}),e(this,El,s,"f"),t(this,yl,"f").isServerSide=this.isServerSide):Ll.log("redundant isServerSide assignment")}get isUkaton(){return this.deviceInformation.modelNumber.includes("Ukaton")}get isWifiAvailable(){return t(this,Ml,"f").isWifiAvailable}get wifiSSID(){return t(this,Ml,"f").wifiSSID}async setWifiSSID(e){return t(this,Ml,"f").setWifiSSID(e)}get wifiPassword(){return t(this,Ml,"f").wifiPassword}async setWifiPassword(e){return t(this,Ml,"f").setWifiPassword(e)}get isWifiConnected(){return t(this,Ml,"f").isWifiConnected}get ipAddress(){return t(this,Ml,"f").ipAddress}get wifiConnectionEnabled(){return t(this,Ml,"f").wifiConnectionEnabled}get enableWifiConnection(){return t(this,Ml,"f").enableWifiConnection}get setWifiConnectionEnabled(){return t(this,Ml,"f").setWifiConnectionEnabled}get disableWifiConnection(){return t(this,Ml,"f").disableWifiConnection}get toggleWifiConnection(){return t(this,Ml,"f").toggleWifiConnection}get isWifiSecure(){return t(this,Ml,"f").isWifiSecure}async reconnectViaWebSockets(){Ll.assertWithError(this.isWifiConnected,"wifi is not connected"),Ll.assertWithError("webSocket"!=this.connectionType,"already connected via webSockets"),Ll.assertTypeWithError(this.ipAddress,"string"),Ll.log("reconnecting via websockets..."),await this.disconnect(),await this.connect({type:"webSocket",ipAddress:this.ipAddress,isWifiSecure:this.isWifiSecure})}async reconnectViaUDP(){Ll.assertWithError(n,"udp is only available in node"),Ll.assertWithError(this.isWifiConnected,"wifi is not connected"),Ll.assertWithError("udp"!=this.connectionType,"already connected via udp"),Ll.assertTypeWithError(this.ipAddress,"string"),Ll.log("reconnecting via udp..."),await this.disconnect(),await this.connect({type:"udp",ipAddress:this.ipAddress})}get hasCamera(){return this.sensorTypes.includes("camera")}get cameraStatus(){return t(this,Dl,"f").cameraStatus}async takePicture(e=10){t(this,Nc,"m",kl).call(this),0==this.sensorConfiguration.camera&&this.setSensorConfiguration({camera:e},!1,!1),await t(this,Dl,"f").takePicture()}async focusCamera(e=10){t(this,Nc,"m",kl).call(this),0==this.sensorConfiguration.camera&&this.setSensorConfiguration({camera:e},!1,!1),await t(this,Dl,"f").focus()}async stopCamera(){t(this,Nc,"m",kl).call(this),await t(this,Dl,"f").stop()}async wakeCamera(){t(this,Nc,"m",kl).call(this),await t(this,Dl,"f").wake()}async sleepCamera(){t(this,Nc,"m",kl).call(this),await t(this,Dl,"f").sleep()}get cameraConfiguration(){return t(this,Dl,"f").cameraConfiguration}get availableCameraConfigurationTypes(){return t(this,Dl,"f").availableCameraConfigurationTypes}get cameraConfigurationRanges(){return t(this,Dl,"f").cameraConfigurationRanges}get setCameraConfiguration(){return t(this,Dl,"f").setCameraConfiguration}get hasMicrophone(){return this.sensorTypes.includes("microphone")}get microphoneStatus(){return t(this,Wl,"f").microphoneStatus}async startMicrophone(){t(this,Nc,"m",Tl).call(this),await t(this,Wl,"f").start()}async stopMicrophone(){t(this,Nc,"m",Tl).call(this),await t(this,Wl,"f").stop()}async enableMicrophoneVad(){t(this,Nc,"m",Tl).call(this),await t(this,Wl,"f").vad()}async toggleMicrophone(){t(this,Nc,"m",Tl).call(this),await t(this,Wl,"f").toggle()}get microphoneConfiguration(){return t(this,Wl,"f").microphoneConfiguration}get availableMicrophoneConfigurationTypes(){return t(this,Wl,"f").availableMicrophoneConfigurationTypes}get setMicrophoneConfiguration(){return t(this,Wl,"f").setMicrophoneConfiguration}get audioContext(){return t(this,Nc,"m",Rl).call(this),t(this,Wl,"f").audioContext}set audioContext(e){t(this,Nc,"m",Rl).call(this),t(this,Wl,"f").audioContext=e}get microphoneMediaStreamDestination(){return t(this,Nc,"m",Rl).call(this),t(this,Wl,"f").mediaStreamDestination}get microphoneGainNode(){return t(this,Nc,"m",Rl).call(this),t(this,Wl,"f").gainNode}get isRecordingMicrophone(){return t(this,Wl,"f").isRecording}startRecordingMicrophone(){t(this,Nc,"m",Rl).call(this),t(this,Wl,"f").startRecording()}stopRecordingMicrophone(){t(this,Nc,"m",Rl).call(this),t(this,Wl,"f").stopRecording()}toggleMicrophoneRecording(){t(this,Nc,"m",Rl).call(this),t(this,Wl,"f").toggleRecording()}get isDisplayAvailable(){return t(this,xl,"f").isDisplayAvailable}get displayContextState(){return t(this,xl,"f").displayContextState}get displayColors(){return t(this,xl,"f").colors}get displayColorOpacities(){return t(this,xl,"f").opacities}get displayStatus(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").displayStatus}get displayBrightness(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").displayBrightness}get setDisplayBrightness(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setDisplayBrightness}get displayInformation(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").displayInformation}get numberOfDisplayColors(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").numberOfColors}get wakeDisplay(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").wake}get sleepDisplay(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").sleep}get toggleDisplay(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").toggle}get isDisplayAwake(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").isDisplayAwake}get showDisplay(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").showDisplay}get clearDisplay(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").clearDisplay}get setDisplayColor(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setColor}get setDisplayColorOpacity(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setColorOpacity}get setDisplayOpacity(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setOpacity}get saveDisplayContext(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").saveContext}get restoreDisplayContext(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").restoreContext}get clearDisplayRect(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").clearRect}get selectDisplayFillColor(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").selectFillColor}get selectDisplayLineColor(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").selectLineColor}get setDisplayLineWidth(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setLineWidth}get setDisplayRotation(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setRotation}get clearDisplayRotation(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").clearRotation}get setDisplaySegmentStartCap(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setSegmentStartCap}get setDisplaySegmentEndCap(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setSegmentEndCap}get setDisplaySegmentCap(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setSegmentCap}get setDisplaySegmentStartRadius(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setSegmentStartRadius}get setDisplaySegmentEndRadius(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setSegmentEndRadius}get setDisplaySegmentRadius(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setSegmentRadius}get setDisplayCropTop(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setCropTop}get setDisplayCropRight(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setCropRight}get setDisplayCropBottom(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setCropBottom}get setDisplayCropLeft(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setCropLeft}get setDisplayCrop(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setCrop}get clearDisplayCrop(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").clearCrop}get setDisplayRotationCropTop(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setRotationCropTop}get setDisplayRotationCropRight(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setRotationCropRight}get setDisplayRotationCropBottom(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setRotationCropBottom}get setDisplayRotationCropLeft(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setRotationCropLeft}get setDisplayRotationCrop(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setRotationCrop}get clearDisplayRotationCrop(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").clearRotationCrop}get flushDisplayContextCommands(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").flushDisplayContextCommands}get drawDisplayRect(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").drawRect}get drawDisplayCircle(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").drawCircle}get drawDisplayEllipse(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").drawEllipse}get drawDisplayRoundRect(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").drawRoundRect}get drawDisplayPolygon(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").drawPolygon}get drawDisplaySegment(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").drawSegment}get setDisplayContextState(){return t(this,Nc,"m",Il).call(this),t(this,xl,"f").setContextState}}var Fl,Bl,$l,Ol,Pl,Nl,Vl,ql,zl,jl,Gl,Hl,Xl,Yl,Jl,Kl,Ql,Zl,tf,ef,sf,nf,af,rf,of,hf,cf,lf,ff,gf,df,uf,pf,mf,vf,yf,wf,bf,Cf,Sf,Ef,Mf,Df,kf,Wf,Tf,Rf,xf,If,Lf,Uf,Af,_f,Ff,Bf,$f;Vc=_l,zc=new WeakMap,Gc=new WeakMap,Xc=new WeakMap,el=new WeakMap,sl=new WeakMap,ll=new WeakMap,fl=new WeakMap,dl=new WeakMap,pl=new WeakMap,ml=new WeakMap,vl=new WeakMap,yl=new WeakMap,wl=new WeakMap,bl=new WeakMap,El=new WeakMap,Ml=new WeakMap,Dl=new WeakMap,Wl=new WeakMap,xl=new WeakMap,Nc=new WeakSet,qc=function(){return new Jo},jc=function(){return t(this,zc,"f").dispatchEvent},Hc=async function(e,s){await(t(this,Gc,"f")?.sendTxMessages(e,s))},Yc=function(){Ll.assertWithError(this.isConnected,"notConnected")},Jc=function(t){return t.every((t=>{const e=this.latestConnectionMessages.has(t);return e||Ll.log(`didn't receive "${t}" message`),e}))},Kc=function(){let e=t(this,Nc,"m",Jc).call(this,Al);return e&&this.sensorTypes.includes("pressure")&&(e=t(this,Nc,"m",Jc).call(this,ti)),e&&this.isWifiAvailable&&(e=t(this,Nc,"m",Jc).call(this,qa)),e&&this.fileTypes.length>0&&(e=t(this,Nc,"m",Jc).call(this,jt)),e&&this.fileTypes.includes("tflite")&&(e=t(this,Nc,"m",Jc).call(this,sn)),e&&this.hasCamera&&(e=t(this,Nc,"m",Jc).call(this,ls)),e&&this.hasMicrophone&&(e=t(this,Nc,"m",Jc).call(this,Gs)),e&&this.isDisplayAvailable&&(e=t(this,Nc,"m",Jc).call(this,Xr)),e},Qc=function(){Ll.log("requesting required information");const e=Al.map((t=>({type:t})));t(this,Nc,"m",Hc).call(this,e)},Zc=function(){Ll.assertWithError(this.canReconnect,"cannot reconnect to device")},il=function(s){Ll.log({connectionStatus:s}),"notConnected"==s?(t(this,Nc,"m",ol).call(this),this.canReconnect&&this.reconnectOnDisconnection&&(Ll.log("starting reconnect interval..."),e(this,sl,setInterval((()=>{Ll.log("attempting reconnect..."),this.reconnect()}),1e3),"f"))):null!=t(this,sl,"f")&&(Ll.log("clearing reconnect interval"),clearInterval(t(this,sl,"f")),e(this,sl,void 0,"f")),t(this,Nc,"m",al).call(this),"connected"!=s||t(this,Xc,"f")||"client"!=this.connectionType&&t(this,Nc,"m",Qc).call(this),lc.OnDeviceConnectionStatusUpdated(this,s)},nl=function(e=!1){t(this,Nc,"a",jc).call(this,"connectionStatus",{connectionStatus:this.connectionStatus}),t(this,Nc,"a",jc).call(this,this.connectionStatus,{}),e&&t(this,Nc,"a",jc).call(this,"isConnected",{isConnected:this.isConnected})},al=function(){switch(e(this,Xc,Boolean(this.connectionManager?.isConnected)&&t(this,Nc,"a",Kc)&&this._informationManager.isCurrentTimeSet,"f"),this.connectionStatus){case"connected":t(this,Xc,"f")&&t(this,Nc,"m",nl).call(this,!0);break;case"notConnected":t(this,Nc,"m",nl).call(this,!0);break;default:t(this,Nc,"m",nl).call(this,!1)}},rl=function(){t(this,Nc,"m",ol).call(this),this._informationManager.clear(),t(this,ll,"f").clear(),t(this,wl,"f").clear(),t(this,Ml,"f").clear(),t(this,Dl,"f").clear(),t(this,Wl,"f").clear(),t(this,xl,"f").clear()},ol=function(){this.connectionManager?.clear(),this.latestConnectionMessages.clear()},hl=function(e,s){if(Ll.log({messageType:e,dataView:s}),"batteryLevel"===e){const e=s.getUint8(0);Ll.log("received battery level",{batteryLevel:e}),t(this,Nc,"m",gl).call(this,e)}else if(Ot.includes(e))t(this,yl,"f").parseMessage(e,s);else if(tn.includes(e))t(this,wl,"f").parseMessage(e,s);else if(Zs.includes(e))t(this,ml,"f").parseMessage(e,s);else if(Oh.includes(e))t(this,bl,"f").parseMessage(e,s);else if(dn.includes(e))t(this,ll,"f").parseMessage(e,s);else if(On.includes(e))this._informationManager.parseMessage(e,s);else if(wi.includes(e))t(this,dl,"f").parseMessage(e,s);else if(fa.includes(e))t(this,vl,"f").parseMessage(e,s);else if(Va.includes(e))t(this,Ml,"f").parseMessage(e,s);else if(cs.includes(e))t(this,Dl,"f").parseMessage(e,s);else if(zs.includes(e))t(this,Wl,"f").parseMessage(e,s);else{if(!qr.includes(e))throw Error(`uncaught messageType ${e}`);t(this,xl,"f").parseMessage(e,s)}this.latestConnectionMessages.set(e,s),e.startsWith("set")&&this.latestConnectionMessages.set(e.replace("set","get"),s),t(this,Nc,"a",jc).call(this,"connectionMessage",{messageType:e,dataView:s})},cl=function(){!this.isConnected&&t(this,Nc,"a",Kc)&&t(this,Nc,"m",al).call(this),"notConnected"!=this.connectionStatus&&t(this,Nc,"m",Hc).call(this)},gl=function(s){Ll.assertTypeWithError(s,"number"),t(this,fl,"f")!=s?(e(this,fl,s,"f"),Ll.log({updatedBatteryLevel:t(this,fl,"f")}),t(this,Nc,"a",jc).call(this,"batteryLevel",{batteryLevel:t(this,fl,"f")})):Ll.log(`duplicate batteryLevel assignment ${s}`)},Cl=function(){Ll.assertWithError(this.canUpdateFirmware,"can't update firmware")},Sl=function(e){return t(this,Nc,"m",Cl).call(this),t(this,Gc,"f").sendSmpMessage(e)},kl=function(){Ll.assertWithError(this.hasCamera,"camera not available")},Tl=function(){Ll.assertWithError(this.hasMicrophone,"microphone not available")},Rl=function(){Ll.assertWithError(AudioContext,"WebAudio is not supported")},Il=function(){Ll.assertWithError(this.isDisplayAvailable,"display not available")},tl={value:!1},ul={value:!0};const Of=W("DisplayCanvasHelper",{log:!1}),Pf=["contextState","numberOfColors","brightness","color","colorOpacity","opacity","resize","update"];class Nf{constructor(){Fl.add(this),Bl.set(this,new I(this,Pf)),Ol.set(this,void 0),Pl.set(this,void 0),Vl.set(this,[]),ql.set(this,[]),Hl.set(this,!1),Xl.set(this,void 0),Yl.set(this,{connected:t(this,Fl,"m",Jl).bind(this),notConnected:t(this,Fl,"m",Kl).bind(this)}),Zl.set(this,0),ef.set(this,[]),nf.set(this,[]),rf.set(this,new Za),pf.set(this,!0),Ff.set(this,"medium"),Bf.set(this,{veryLow:.5,low:.7,medium:.9,high:.95,veryHigh:1}),this.numberOfColors=16}get addEventListener(){return t(this,Bl,"f").addEventListener}get removeEventListener(){return t(this,Bl,"f").removeEventListener}get waitForEvent(){return t(this,Bl,"f").waitForEvent}get removeEventListeners(){return t(this,Bl,"f").removeEventListeners}get removeAllEventListeners(){return t(this,Bl,"f").removeAllEventListeners}get canvas(){return t(this,Ol,"f")}set canvas(s){Of.assertWithError("CANVAS"==s?.nodeName,`assigned non-canvas type ${s?.nodeName}`),t(this,Ol,"f")!=s?(e(this,Ol,s,"f"),Of.log("assigned canvas",this.canvas),e(this,Pl,t(this,Ol,"f")?.getContext("2d",{willReadFrequently:!0}),"f"),t(this,Pl,"f").imageSmoothingEnabled=!1,t(this,Fl,"m",Nl).call(this)):Of.log("redundant canvas assignment",s)}get context(){return t(this,Pl,"f")}get width(){return this.canvas?.width||0}get height(){return this.canvas?.height||0}get aspectRatio(){return this.width/this.height}get applyTransparency(){return t(this,Hl,"f")}set applyTransparency(s){e(this,Hl,s,"f"),Of.log({applyTransparency:this.applyTransparency}),t(this,Fl,"m",zl).call(this)}get device(){return t(this,Xl,"f")}set device(s){t(this,Xl,"f")!=s?(s&&(Of.assertWithError(s.isConnected,"device must be connected"),Of.assertWithError(s.isDisplayAvailable,"display must have a display")),t(this,Xl,"f")&&Co(this.device,t(this,Yl,"f")),e(this,Xl,s,"f"),bo(t(this,Xl,"f"),t(this,Yl,"f")),Of.log("assigned device",this.device),this.device&&(this.numberOfColors=this.device.numberOfDisplayColors,t(this,Fl,"m",Nl).call(this),t(this,Fl,"m",Ql).call(this))):Of.log("redundant device assignment",s)}get numberOfColors(){return t(this,Zl,"f")}set numberOfColors(s){t(this,Zl,"f")!=s&&(e(this,Zl,s,"f"),Of.log({numberOfColors:this.numberOfColors}),e(this,ef,new Array(this.numberOfColors).fill("#000000"),"f"),e(this,nf,new Array(this.numberOfColors).fill(1),"f"),t(this,Fl,"a",$l).call(this,"numberOfColors",{numberOfColors:this.numberOfColors}))}get colors(){return t(this,ef,"f")}get opacities(){return t(this,nf,"f")}get contextState(){return t(this,rf,"f").state}showDisplay(s=!0){Of.log("showDisplay"),e(this,Vl,t(this,ql,"f").slice(),"f"),t(this,ql,"f").length=0,t(this,Fl,"m",zl).call(this),this.device?.isConnected&&this.device.showDisplay(s)}clearDisplay(e=!0){Of.log("clearDisplay"),this.showDisplay(),t(this,Pl,"f").clearRect(0,0,this.width,this.height),this.device?.isConnected&&this.device.clearDisplay(e),t(this,Fl,"m",Gl).call(this)}setColor(e,s,i){"string"==typeof s&&(s=Ya(s));const n=Ja(s);this.colors[e]!=n?(Of.log(`setting color #${e}`,s),t(this,Fl,"m",tf).call(this,e),nr(s),this.device?.isConnected&&this.device.setDisplayColor(e,s,i),this.colors[e]=n,t(this,Fl,"m",zl).call(this),t(this,Fl,"a",$l).call(this,"color",{colorIndex:e,colorHex:n,color:s})):Of.log(`redundant color #${e} ${n}`)}setColorOpacity(e,s,i){t(this,Fl,"m",tf).call(this,e),ar(s),Math.floor(255*t(this,nf,"f")[e])!=Math.floor(255*s)?(this.device?.isConnected&&this.device.setDisplayColorOpacity(e,s,i),t(this,nf,"f")[e]=s,t(this,Fl,"m",zl).call(this),t(this,Fl,"a",$l).call(this,"colorOpacity",{colorIndex:e,opacity:s})):Of.log(`redundant opacity #${e} ${s}`)}setOpacity(e,s){ar(e),this.device?.isConnected&&this.device.setDisplayOpacity(e,s),t(this,nf,"f").fill(e),t(this,Fl,"m",zl).call(this),t(this,Fl,"a",$l).call(this,"opacity",{opacity:e})}selectFillColor(e,s){t(this,Fl,"m",tf).call(this,e);const i=t(this,rf,"f").update({fillColorIndex:e});0!=i.length&&(this.device?.isConnected&&this.device.selectDisplayFillColor(e,s),t(this,Fl,"m",of).call(this,i))}selectLineColor(e,s){t(this,Fl,"m",tf).call(this,e);const i=t(this,rf,"f").update({lineColorIndex:e});0!=i.length&&(this.device?.isConnected&&this.device.selectDisplayLineColor(e,s),t(this,Fl,"m",of).call(this,i))}setLineWidth(e,s){t(this,Fl,"m",cf).call(this,e);const i=t(this,rf,"f").update({lineWidth:e});0!=i.length&&(this.device?.isConnected&&this.device.setDisplayLineWidth(e,s),t(this,Fl,"m",of).call(this,i))}setRotation(e,s,i){e=Zt(e=s?e:Kt(e)),Of.log({rotation:e});const n=t(this,rf,"f").update({rotation:e});0!=n.length&&(this.device?.isConnected&&this.device.setDisplayRotation(e,!0,i),t(this,Fl,"m",of).call(this,n))}clearRotation(e){const s=t(this,rf,"f").update({rotation:0});0!=s.length&&(this.device?.isConnected&&this.device.clearDisplayRotation(e),t(this,Fl,"m",of).call(this,s))}setSegmentStartCap(e,s){er(e);const i=t(this,rf,"f").update({segmentStartCap:e});0!=i.length&&(Of.log({segmentStartCap:e}),this.device?.isConnected&&this.device.setDisplaySegmentStartCap(e,s),t(this,Fl,"m",of).call(this,i))}setSegmentEndCap(e,s){er(e);const i=t(this,rf,"f").update({segmentEndCap:e});0!=i.length&&(Of.log({segmentEndCap:e}),this.device?.isConnected&&this.device.setDisplaySegmentEndCap(e,s),t(this,Fl,"m",of).call(this,i))}setSegmentCap(e,s){er(e);const i=t(this,rf,"f").update({segmentStartCap:e,segmentEndCap:e});0!=i.length&&(Of.log({segmentCap:e}),this.device?.isConnected&&this.device.setDisplaySegmentCap(e,s),t(this,Fl,"m",of).call(this,i))}setSegmentStartRadius(e,s){const i=t(this,rf,"f").update({segmentStartRadius:e});0!=i.length&&(Of.log({segmentStartRadius:e}),this.device?.isConnected&&this.device.setDisplaySegmentStartRadius(e,s),t(this,Fl,"m",of).call(this,i))}setSegmentEndRadius(e,s){const i=t(this,rf,"f").update({segmentEndRadius:e});0!=i.length&&(Of.log({segmentEndRadius:e}),this.device?.isConnected&&this.device.setDisplaySegmentEndRadius(e,s),t(this,Fl,"m",of).call(this,i))}setSegmentRadius(e,s){const i=t(this,rf,"f").update({segmentStartRadius:e,segmentEndRadius:e});0!=i.length&&(Of.log({segmentRadius:e}),this.device?.isConnected&&this.device.setDisplaySegmentRadius(e,s),t(this,Fl,"m",of).call(this,i))}setCrop(e,s,i){Of.assertEnumWithError(e,rr),s=Math.max(0,s);const n=hr[e],a=or[e],r=t(this,rf,"f").update({[a]:s});0!=r.length&&(Of.log({[n]:s}),this.device?.isConnected&&this.device.setDisplayCrop(e,s,i),t(this,Fl,"m",of).call(this,r))}setCropTop(t,e){this.setCrop("top",t,e)}setCropRight(t,e){this.setCrop("right",t,e)}setCropBottom(t,e){this.setCrop("bottom",t,e)}setCropLeft(t,e){this.setCrop("left",t,e)}clearCrop(e){const s=t(this,rf,"f").update({cropTop:0,cropRight:0,cropBottom:0,cropLeft:0});0!=s.length&&(this.device?.isConnected&&this.device.clearDisplayCrop(e),t(this,Fl,"m",of).call(this,s))}setRotationCrop(e,s,i){Of.assertEnumWithError(e,rr);const n=lr[e],a=cr[e],r=t(this,rf,"f").update({[a]:s});0!=r.length&&(Of.log({[n]:s}),this.device?.isConnected&&this.device.setDisplayRotationCrop(e,s,i),t(this,Fl,"m",of).call(this,r))}setRotationCropTop(t,e){this.setRotationCrop("top",t,e)}setRotationCropRight(t,e){this.setRotationCrop("right",t,e)}setRotationCropBottom(t,e){this.setRotationCrop("bottom",t,e)}setRotationCropLeft(t,e){this.setRotationCrop("left",t,e)}clearRotationCrop(e){const s=t(this,rf,"f").update({rotationCropTop:0,rotationCropRight:0,rotationCropBottom:0,rotationCropLeft:0});0!=s.length&&(this.device?.isConnected&&this.device.clearDisplayRotationCrop(e),t(this,Fl,"m",of).call(this,s))}clearRect(e,s,i,n,a){t(this,ql,"f").push((()=>t(this,Fl,"m",lf).call(this,e,s,i,n))),this.device?.isConnected&&this.device.clearDisplayRect(e,s,i,n,a)}drawRect(e,s,i,n,a){const r={...this.contextState};t(this,ql,"f").push((()=>t(this,Fl,"m",Ef).call(this,e,s,i,n,r))),this.device?.isConnected&&this.device.drawDisplayRect(e,s,i,n,a)}drawRoundRect(e,s,i,n,a,r){const o={...this.contextState};t(this,ql,"f").push((()=>t(this,Fl,"m",Mf).call(this,e,s,i,n,a,o))),this.device?.isConnected&&this.device.drawDisplayRoundRect(e,s,i,n,a,r)}drawCircle(e,s,i,n){const a={...this.contextState};t(this,ql,"f").push((()=>t(this,Fl,"m",kf).call(this,e,s,i,a))),this.device?.isConnected&&this.device.drawDisplayCircle(e,s,i,n)}drawEllipse(e,s,i,n,a){const r={...this.contextState};t(this,ql,"f").push((()=>t(this,Fl,"m",Tf).call(this,e,s,i,n,r))),this.device?.isConnected&&this.device.drawDisplayEllipse(e,s,i,n,a)}drawPolygon(e,s,i,n,a){if(n<3)return void Of.error(`invalid numberOfSides ${n}`);const r={...this.contextState};t(this,ql,"f").push((()=>t(this,Fl,"m",xf).call(this,e,s,i,n,r))),this.device?.isConnected&&this.device.drawDisplayPolygon(e,s,i,n,a)}drawSegment(e,s,i,n,a){if(e==i&&s==n)return void Of.error("cannot draw segment of length 0");const r={...this.contextState};t(this,ql,"f").push((()=>t(this,Fl,"m",_f).call(this,e,s,i,n,r))),this.device?.isConnected&&this.device.drawDisplaySegment(e,s,i,n,a)}get brightness(){return t(this,Ff,"f")}setBrightness(s,i){t(this,Ff,"f")!=s?(e(this,Ff,s,"f"),Of.log({brightness:this.brightness}),this.device?.isConnected&&this.device.setDisplayBrightness(s,i),t(this,Fl,"m",zl).call(this),t(this,Fl,"a",$l).call(this,"brightness",{brightness:this.brightness})):Of.log(`redundant brightness ${s}`)}}var Vf,qf,zf,jf,Gf,Hf;Bl=new WeakMap,Ol=new WeakMap,Pl=new WeakMap,Vl=new WeakMap,ql=new WeakMap,Hl=new WeakMap,Xl=new WeakMap,Yl=new WeakMap,Zl=new WeakMap,ef=new WeakMap,nf=new WeakMap,rf=new WeakMap,pf=new WeakMap,Ff=new WeakMap,Bf=new WeakMap,Fl=new WeakSet,$l=function(){return t(this,Bl,"f").dispatchEvent},Nl=function(){if(!this.canvas)return;if(this.canvas.style.aspectRatio=`${this.aspectRatio}`,!this.device?.isConnected)return;const{width:e,height:s}=this.device.displayInformation;Of.log({width:e,height:s}),this.canvas.width=e,this.canvas.height=s,this.canvas.style.aspectRatio=""+e/s,t(this,Fl,"a",$l).call(this,"resize",{width:this.width,height:this.height}),this.clearDisplay()},zl=function(){t(this,Pl,"f").clearRect(0,0,this.width,this.height),t(this,Fl,"m",Gl).call(this),t(this,Vl,"f").forEach((t=>t())),t(this,Hl,"f")&&t(this,Fl,"m",jl).call(this),t(this,Fl,"a",$l).call(this,"update",{})},jl=function(){const t=this.context,e=t.getImageData(0,0,this.canvas.width,this.canvas.height),s=e.data;for(let t=0;t<s.length;t+=4){const e=s[t],i=s[t+1],n=s[t+2],a=.299*e+.587*i+.114*n,r=Math.min(255,1.5*a),o=r>0?255/r:0;s[t]=Math.min(255,e*o),s[t+1]=Math.min(255,i*o),s[t+2]=Math.min(255,n*o),s[t+3]=r}t.putImageData(e,0,0)},Gl=function(){t(this,Fl,"m",ff).call(this),this.context.fillStyle=t(this,Fl,"m",Cf).call(this,0),this.context.fillRect(0,0,this.width,this.height),t(this,Fl,"m",gf).call(this)},Jl=function(e){Of.log("device connected"),t(this,Fl,"m",Nl).call(this),t(this,Fl,"m",Ql).call(this)},Kl=function(t){Of.log("device not connected")},Ql=function(){t(this,Fl,"m",sf).call(this,!0),t(this,Fl,"m",af).call(this,!0),t(this,Fl,"m",hf).call(this,!0),t(this,Fl,"m",$f).call(this,!0)},tf=function(t){Of.assertRangeWithError("colorIndex",t,0,this.numberOfColors)},sf=function(e){this.device?.isConnected&&(this.colors.forEach(((t,s)=>{this.device?.setDisplayColor(s,t,e)})),e&&t(this,Xl,"f")?.flushDisplayContextCommands())},af=function(e){this.device?.isConnected&&t(this,nf,"f").forEach(((t,s)=>{this.device?.setDisplayColorOpacity(s,t,e&&s==this.colors.length-1)}))},of=function(e){t(this,Fl,"a",$l).call(this,"contextState",{contextState:{...this.contextState},differences:e})},hf=function(t){this.device?.isConnected&&(Of.log("updateDeviceContextState"),this.device?.setDisplayContextState(this.contextState,t))},cf=function(t){Of.assertRangeWithError("lineWidth",t,0,this.width)},lf=function(e,s,i,n){t(this,Fl,"m",ff).call(this),this.context.resetTransform(),this.context.fillStyle=t(this,Fl,"m",Cf).call(this,0),this.context.fillRect(e,s,i,n),t(this,Fl,"m",gf).call(this)},ff=function(){this.context.save()},gf=function(){this.context.restore()},df=function(t,e,s){const i=this.context;i.translate(t,e),i.rotate(s)},uf=function(t,e){const s=t.x+t.width/2,i=t.y+t.height/2,n=t.width/2,a=t.height/2,r=Math.cos(e),o=Math.sin(e),h=[{x:-n,y:-a},{x:n,y:-a},{x:n,y:a},{x:-n,y:a}].map((({x:t,y:e})=>({x:t*r-e*o,y:t*o+e*r}))),c=h.map((t=>t.x)),l=h.map((t=>t.y)),f=Math.min(...c),g=Math.max(...c),d=Math.min(...l);return{x:s+f,y:i+d,width:g-f,height:Math.max(...l)-d}},mf=function({x:e,y:s,width:i,height:n}){t(this,Fl,"m",lf).call(this,e,s,i,n)},vf=function(t,e,s,i,{lineWidth:n}){const a=Math.ceil(n/2);return{x:t-s/2-a,y:e-i/2-a,width:s+2*a,height:i+2*a}},yf=function({x:t,y:e,height:s,width:i},{cropTop:n,cropRight:a,cropBottom:r,cropLeft:o}){const h=this.context;h.beginPath(),h.rect(t+o,e+n,i-a,s-r),h.clip()},wf=function({x:t,y:e,height:s,width:i},{rotationCropTop:n,rotationCropRight:a,rotationCropBottom:r,rotationCropLeft:o}){const h=this.context;h.beginPath(),h.rect(-i/2+o,-s/2+n,i-o-a,s-n-r),h.clip()},bf=function(t,e){4===t.length&&(t="#"+[...t.slice(1)].map((t=>t+t)).join(""));const s=parseInt(t.slice(1,3),16),i=parseInt(t.slice(3,5),16),n=parseInt(t.slice(5,7),16),a=t=>Math.round(t*e);return`rgb(${a(s)}, ${a(i)}, ${a(n)})`},Cf=function(e){return t(this,Fl,"m",bf).call(this,this.colors[e],1)},Sf=function({lineWidth:e,fillColorIndex:s,lineColorIndex:i}){this.context.fillStyle=t(this,Fl,"m",Cf).call(this,s),this.context.strokeStyle=t(this,Fl,"m",Cf).call(this,i),this.context.lineWidth=e},Ef=function(e,s,i,n,a){t(this,Fl,"m",Sf).call(this,a),t(this,Fl,"m",ff).call(this);const r=t(this,Fl,"m",vf).call(this,e,s,i,n,a);t(this,pf,"f")&&t(this,Fl,"m",mf).call(this,r);const o=t(this,Fl,"m",uf).call(this,r,a.rotation);t(this,Fl,"m",yf).call(this,o,a),t(this,Fl,"m",df).call(this,e,s,a.rotation),t(this,Fl,"m",wf).call(this,r,a);const h=-i/2,c=-n/2;this.context.fillRect(h,c,i,n),a.lineWidth>0&&this.context.strokeRect(h,c,i,n),t(this,Fl,"m",gf).call(this)},Mf=function(e,s,i,n,a,r){t(this,Fl,"m",Sf).call(this,r),t(this,Fl,"m",ff).call(this);const o=t(this,Fl,"m",vf).call(this,e,s,i,n,r);t(this,pf,"f")&&t(this,Fl,"m",mf).call(this,o);const h=t(this,Fl,"m",uf).call(this,o,r.rotation);t(this,Fl,"m",yf).call(this,h,r),t(this,Fl,"m",df).call(this,e,s,r.rotation),t(this,Fl,"m",wf).call(this,o,r);const c=-i/2,l=-n/2;this.context.beginPath(),this.context.roundRect(c,l,i,n,a),this.context.fill(),r.lineWidth>0&&this.context.stroke(),t(this,Fl,"m",gf).call(this)},Df=function(e,s,i,n){const a=2*i;return t(this,Fl,"m",vf).call(this,e,s,a,a,n)},kf=function(e,s,i,n){t(this,Fl,"m",Sf).call(this,n),t(this,Fl,"m",ff).call(this);const a=t(this,Fl,"m",Df).call(this,e,s,i,n);t(this,pf,"f")&&t(this,Fl,"m",mf).call(this,a),t(this,Fl,"m",yf).call(this,a,n),t(this,Fl,"m",df).call(this,e,s,n.rotation),t(this,Fl,"m",wf).call(this,a,n),this.context.beginPath(),this.context.arc(0,0,i,0,2*Math.PI),this.context.fill(),n.lineWidth&&this.context.stroke(),t(this,Fl,"m",gf).call(this)},Wf=function(e,s,i,n,a){const r=2*i,o=2*n;return t(this,Fl,"m",vf).call(this,e,s,r,o,a)},Tf=function(e,s,i,n,a){t(this,Fl,"m",Sf).call(this,a),t(this,Fl,"m",ff).call(this);const r=t(this,Fl,"m",Wf).call(this,e,s,i,n,a);t(this,pf,"f")&&t(this,Fl,"m",mf).call(this,r);const o=t(this,Fl,"m",uf).call(this,r,a.rotation);t(this,Fl,"m",yf).call(this,o,a),t(this,Fl,"m",df).call(this,e,s,a.rotation),t(this,Fl,"m",wf).call(this,r,a),this.context.beginPath(),this.context.ellipse(0,0,i,n,0,0,2*Math.PI),this.context.fill(),a.lineWidth>0&&this.context.stroke(),t(this,Fl,"m",gf).call(this)},Rf=function(t,e,s,i,{lineWidth:n}){let a=Math.ceil(n/2);const r=1/Math.cos(Math.PI/i);a=Math.ceil(a*r);const o=2*s;return{x:t-s-a,y:e-s-a,width:o+2*a,height:o+2*a}},xf=function(e,s,i,n,a){t(this,Fl,"m",Sf).call(this,a),t(this,Fl,"m",ff).call(this);const r=t(this,Fl,"m",Rf).call(this,e,s,i,n,a);t(this,pf,"f")&&t(this,Fl,"m",mf).call(this,r),t(this,Fl,"m",yf).call(this,r,a),t(this,Fl,"m",df).call(this,e,s,a.rotation),t(this,Fl,"m",wf).call(this,r,a),this.context.beginPath();const o=2*Math.PI/n;for(let t=0;t<n;t++){const e=t*o,s=i*Math.cos(e),n=i*Math.sin(e);0===t?this.context.moveTo(s,n):this.context.lineTo(s,n)}this.context.closePath(),this.context.fill(),a.lineWidth>0&&this.context.stroke(),t(this,Fl,"m",gf).call(this)},If=function(t,e,s,i,{lineWidth:n,segmentStartRadius:a,segmentEndRadius:r}){const o=Math.ceil(n/2),h=a+o,c=r+o;Of.log({segmentStartFullRadius:h,segmentEndFullRadius:c});const l=Math.min(t-h,s-c),f=Math.max(t+h,s+c),g=Math.min(e-h,i-c),d=Math.max(e+h,i+c);Of.log("segmentBounds",{minX:l,minY:g,maxX:f,maxY:d});const u={x:l,y:g,width:f-l,height:d-g};return Of.log("getSegmentBoundingBox",u),u},Lf=function(t,e,s,i,{lineWidth:n,segmentStartRadius:a,segmentEndRadius:r,segmentEndCap:o,segmentStartCap:h}){const c=Math.ceil(n/2),l="round"==h?a+c:c,f="round"==o?r+c:c,g=function(t){return function(t,e){let{x:s,y:i}=t;return s*=e,i*=e,{x:s,y:i}}(t,1/Jt(t))}({x:s-t,y:i-e}),d=t-g.x*l,u=e-g.y*l;return{x:(d+(s+g.x*f))/2,y:(u+(i+g.y*f))/2}},Uf=function(t,e,s,i,{lineWidth:n,segmentStartRadius:a,segmentEndRadius:r,segmentEndCap:o,segmentStartCap:h}){const c=Math.ceil(n/2),l="round"==h?a+c:c,f="round"==o?r+c:c,g=Jt({x:s-t,y:i-e})+l+f,d=2*(Math.max(a,r)+c);return{x:-d/2,y:-g/2,width:d,height:g}},Af=function(e,s,i,n,a){let r=function(t){const{x:e,y:s}=t;return Math.atan2(s,e)}({x:i-e,y:n-s});r-=Math.PI/2,Of.log({segmentRotation:r});const o=t(this,Fl,"m",Lf).call(this,e,s,i,n,a);this.context.translate(o.x,o.y),this.context.rotate(r);const h=t(this,Fl,"m",Uf).call(this,e,s,i,n,a);t(this,Fl,"m",wf).call(this,h,a),this.context.resetTransform()},_f=function(e,s,i,n,a){t(this,Fl,"m",Sf).call(this,a),Of.log("drawSegmentToCanvas",{startX:e,startY:s,endX:i,endY:n}),t(this,Fl,"m",ff).call(this);const r=t(this,Fl,"m",If).call(this,e,s,i,n,a);t(this,pf,"f")&&t(this,Fl,"m",mf).call(this,r),t(this,Fl,"m",yf).call(this,r,a),t(this,Fl,"m",Af).call(this,e,s,i,n,a);const o=e,h=i,c=s,l=n,f=a.segmentStartRadius,g=a.segmentEndRadius,d=h-o,u=l-c,p=Math.sqrt(d*d+u*u);if(0===p)return;const m=d/p,v=-(u/p),y=o+v*f,w=c+m*f,b=o-v*f,C=c-m*f,S=h+v*g,E=l+m*g,M=h-v*g,D=l-m*g;"round"==a.segmentStartCap&&(this.context.beginPath(),this.context.arc(o,c,f,0,2*Math.PI),this.context.closePath(),this.context.fill(),a.lineWidth>0&&this.context.stroke()),"round"==a.segmentEndCap&&(this.context.beginPath(),this.context.arc(h,l,g,0,2*Math.PI),this.context.closePath(),this.context.fill(),a.lineWidth>0&&this.context.stroke()),this.context.beginPath(),this.context.moveTo(y,w),this.context.lineTo(S,E),this.context.lineTo(M,D),this.context.lineTo(b,C),this.context.closePath(),this.context.fill(),a.lineWidth>0&&(this.context.beginPath(),this.context.moveTo(y,w),this.context.lineTo(S,E),"flat"===a.segmentEndCap?this.context.lineTo(M,D):this.context.moveTo(M,D),this.context.lineTo(b,C),"flat"===a.segmentStartCap&&"flat"===a.segmentEndCap?this.context.closePath():"flat"===a.segmentStartCap&&(this.context.lineTo(y,w),this.context.lineTo(S,E)),this.context.stroke()),t(this,Fl,"m",gf).call(this)},$f=function(t){this.device?.isConnected&&(Of.log("updateDeviceBrightness"),this.device?.setDisplayBrightness(this.brightness,t))};const Xf=W("DevicePairPressureSensorDataManager",{log:!1});class Yf{constructor(){Vf.add(this),qf.set(this,{}),zf.set(this,new le),jf.set(this,new ne),this.resetPressureRange()}resetPressureRange(){t(this,zf,"f").reset(),t(this,jf,"f").reset()}onDevicePressureData(e){const{pressure:s}=e.message,{side:i}=e.target;if(Xf.log({pressure:s,side:i}),t(this,qf,"f")[i]=s,t(this,Vf,"a",Gf))return t(this,Vf,"m",Hf).call(this);Xf.log("doesn't have all pressure data yet...")}}var Jf;qf=new WeakMap,zf=new WeakMap,jf=new WeakMap,Vf=new WeakSet,Gf=function(){return Fn.every((e=>e in t(this,qf,"f")))},Hf=function(){const e={scaledSum:0,normalizedSum:0,sensors:{left:[],right:[]}};return Fn.forEach((s=>{const i=t(this,qf,"f")[s];e.scaledSum+=i.scaledSum})),e.normalizedSum+=t(this,jf,"f").updateAndGetNormalization(e.scaledSum,!1),e.scaledSum>0&&(e.center={x:0,y:0},Fn.forEach((s=>{t(this,qf,"f")[s].sensors.forEach((t=>{const i={...t};i.weightedValue=t.scaledValue/e.scaledSum;let{x:n,y:a}=t.position;n/=2,"right"==s&&(n+=.5),i.position={x:n,y:a},e.center.x+=i.position.x*i.weightedValue,e.center.y+=i.position.y*i.weightedValue,e.sensors[s].push(i)}))})),e.normalizedCenter=t(this,zf,"f").updateAndGetNormalization(e.center,!1)),Xf.log({devicePairPressure:e}),e};const Kf=W("DevicePairSensorDataManager",{log:!1}),Qf=["pressure","sensorData"];class Zf{constructor(){Jf.set(this,{}),this.pressureSensorDataManager=new Yf}get dispatchEvent(){return this.eventDispatcher.dispatchEvent}resetPressureRange(){this.pressureSensorDataManager.resetPressureRange()}onDeviceSensorData(e){const{timestamp:s,sensorType:i}=e.message;let n;if(Kf.log({sensorType:i,timestamp:s,event:e}),t(this,Jf,"f")[i]||(t(this,Jf,"f")[i]={}),t(this,Jf,"f")[i][e.target.side]=s,"pressure"===i)n=this.pressureSensorDataManager.onDevicePressureData(e);else Kf.log(`uncaught sensorType "${i}"`);if(n){const e=Object.assign({},t(this,Jf,"f")[i]);this.dispatchEvent(i,{sensorType:i,timestamps:e,[i]:n}),this.dispatchEvent("sensorData",{sensorType:i,timestamps:e,[i]:n})}else Kf.log("no value received")}}var tg,eg,sg,ig,ng,ag,rg,og,hg,cg,lg,fg,gg,dg,ug,pg,mg,vg,yg;Jf=new WeakMap;const wg=W("DevicePair",{log:!1});function bg(t){return`device${e=t,e[0].toUpperCase()+e.slice(1)}`;var e}const Cg=["isConnected",...Qf,...Ul.map((t=>bg(t)))],Sg=["insoles","gloves"];class Eg{constructor(s){tg.add(this),sg.set(this,void 0),ig.set(this,new I(this,Cg)),ag.set(this,void 0),rg.set(this,void 0),fg.set(this,{isConnected:t(this,tg,"m",dg).bind(this),sensorData:t(this,tg,"m",mg).bind(this),getType:t(this,tg,"m",ug).bind(this)}),pg.set(this,new Zf),e(this,sg,s,"f"),t(this,pg,"f").eventDispatcher=t(this,ig,"f")}get sides(){return Fn}get type(){return t(this,sg,"f")}get addEventListener(){return t(this,ig,"f").addEventListener}get removeEventListener(){return t(this,ig,"f").removeEventListener}get waitForEvent(){return t(this,ig,"f").waitForEvent}get removeEventListeners(){return t(this,ig,"f").removeEventListeners}get removeAllEventListeners(){return t(this,ig,"f").removeAllEventListeners}get left(){return t(this,ag,"f")}get right(){return t(this,rg,"f")}get isConnected(){return Fn.every((t=>this[t]?.isConnected))}get isPartiallyConnected(){return Fn.some((t=>this[t]?.isConnected))}get isHalfConnected(){return this.isPartiallyConnected&&!this.isConnected}assignDevice(s){if(!t(this,tg,"m",og).call(this,s))return void wg.log(`device is incorrect type ${s.type} for ${this.type} devicePair`);const i=s.side,n=this[i];if(s!=n){switch(n&&t(this,tg,"m",cg).call(this,n),t(this,tg,"m",hg).call(this,s),i){case"left":e(this,ag,s,"f");break;case"right":e(this,rg,s,"f")}return wg.log(`assigned ${i} ${this.type} device`,s),this.resetPressureRange(),t(this,tg,"a",ng).call(this,"isConnected",{isConnected:this.isConnected}),t(this,tg,"a",ng).call(this,"deviceIsConnected",{device:s,isConnected:s.isConnected,side:i}),n}wg.log("device already assigned")}async setSensorConfiguration(t){for(let e=0;e<Fn.length;e++){const s=Fn[e];this[s]?.isConnected&&await this[s].setSensorConfiguration(t)}}resetPressureRange(){Fn.forEach((t=>this[t]?.resetPressureRange())),t(this,pg,"f").resetPressureRange()}async triggerVibration(t,e){const s=Fn.map((s=>this[s]?.triggerVibration(t,e))).filter(Boolean);return Promise.allSettled(s)}static get insoles(){return t(this,eg,"f",vg)}static get gloves(){return t(this,eg,"f",yg)}}var Mg,Dg,kg,Wg,Tg;eg=Eg,sg=new WeakMap,ig=new WeakMap,ag=new WeakMap,rg=new WeakMap,fg=new WeakMap,pg=new WeakMap,tg=new WeakSet,ng=function(){return t(this,ig,"f").dispatchEvent},og=function(t){switch(this.type){case"insoles":return t.isInsole;case"gloves":return t.isGlove}},hg=function(e){bo(e,t(this,fg,"f")),Ul.forEach((s=>{e.addEventListener(s,t(this,tg,"m",gg).bind(this))}))},cg=function(e){Co(e,t(this,fg,"f")),Ul.forEach((s=>{e.removeEventListener(s,t(this,tg,"m",gg).bind(this))}))},lg=function(s){const i=Fn.some((i=>{if(this[i]!=s)return!1;switch(wg.log(`removing ${i} ${this.type} device`,s),Co(s,t(this,fg,"f")),i){case"left":e(this,ag,void 0,"f");break;case"right":e(this,rg,void 0,"f")}return!0}));return i&&t(this,tg,"a",ng).call(this,"isConnected",{isConnected:this.isConnected}),i},gg=function(e){const{type:s,target:i,message:n}=e;t(this,tg,"a",ng).call(this,bg(s),{...n,device:i,side:i.side})},dg=function(e){t(this,tg,"a",ng).call(this,"isConnected",{isConnected:this.isConnected})},ug=function(e){const{target:s}=e;if(this[s.side]==s)return;t(this,tg,"m",lg).call(this,s)&&this.assignDevice(s)},mg=function(e){this.isConnected&&t(this,pg,"f").onDeviceSensorData(e)},vg={value:new eg("insoles")},yg={value:new eg("gloves")},lc.AddEventListener("deviceConnected",(e=>{const{device:s}=e.message;s.isInsole&&t(eg,eg,"f",vg).assignDevice(s),s.isGlove&&t(eg,eg,"f",yg).assignDevice(s)}));const Rg=W("ClientConnectionManager",{log:!0});class xg extends yo{constructor(){super(...arguments),Mg.add(this),Dg.set(this,void 0),kg.set(this,!1)}static get isSupported(){return i}static get type(){return"client"}get canUpdateFirmware(){return!1}get bluetoothId(){return t(this,Dg,"f")}set bluetoothId(s){Rg.assertTypeWithError(s,"string"),t(this,Dg,"f")!=s?e(this,Dg,s,"f"):Rg.log("redundant bluetoothId assignment")}get isConnected(){return t(this,kg,"f")}set isConnected(s){Rg.assertTypeWithError(s,"boolean"),t(this,kg,"f")!=s?(e(this,kg,s,"f"),this.status=t(this,kg,"f")?"connected":"notConnected",this.isConnected&&t(this,Mg,"m",Wg).call(this)):Rg.log("redundant newIsConnected assignment",s)}get isAvailable(){return this.client.isConnected}async connect(){await super.connect(),this.sendClientConnectMessage(this.subType)}async disconnect(){await super.disconnect(),this.sendClientDisconnectMessage()}get canReconnect(){return!0}async reconnect(){await super.reconnect(),this.sendClientConnectMessage()}async sendSmpMessage(t){super.sendSmpMessage(t),this.sendClientMessage({type:"smp",data:t})}async sendTxData(t){super.sendTxData(t),0!=t.byteLength&&this.sendClientMessage({type:"tx",data:t})}onClientMessage(e){Rg.log({dataView:e}),Te(e,Ul,t(this,Mg,"m",Tg).bind(this),null,!0),this.onMessagesReceived()}}var Ig,Lg,Ug,Ag,_g,Fg,Bg,$g,Og,Pg,Ng,Vg,qg,zg,jg,Gg,Hg,Xg,Yg,Jg,Kg,Qg,Zg,td;Dg=new WeakMap,kg=new WeakMap,Mg=new WeakSet,Wg=function(){this.sendRequiredDeviceInformationMessage()},Tg=function(t,e){let s=0;switch(Rg.log({messageType:t},e),t){case"isConnected":const i=Boolean(e.getUint8(s++));Rg.log({isConnected:i}),this.isConnected=i;break;case"rx":this.parseRxMessage(e);break;default:this.onMessageReceived(t,e)}};const ed=W("BaseClient",{log:!0}),sd=["notConnected","connecting","connected","disconnecting","connectionStatus","isConnected","isScanningAvailable","isScanning","discoveredDevice","expiredDiscoveredDevice"];class id{constructor(){Ig.add(this),Ag.set(this,{}),_g.set(this,new I(this,sd)),this._reconnectOnDisconnection=this.baseConstructor.ReconnectOnDisconnection,Fg.set(this,"notConnected"),Og.set(this,[]),Vg.set(this,!1),Gg.set(this,!1),Qg.set(this,{})}get baseConstructor(){return this.constructor}get devices(){return t(this,Ag,"f")}get addEventListener(){return t(this,_g,"f").addEventListener}get dispatchEvent(){return t(this,_g,"f").dispatchEvent}get removeEventListener(){return t(this,_g,"f").removeEventListener}get waitForEvent(){return t(this,_g,"f").waitForEvent}assertConnection(){ed.assertWithError(this.isConnected,"notConnected")}assertDisconnection(){ed.assertWithError(this.isDisconnected,"not disconnected")}static get ReconnectOnDisconnection(){return this._reconnectOnDisconnection}static set ReconnectOnDisconnection(t){ed.assertTypeWithError(t,"boolean"),this._reconnectOnDisconnection=t}get reconnectOnDisconnection(){return this._reconnectOnDisconnection}set reconnectOnDisconnection(t){ed.assertTypeWithError(t,"boolean"),this._reconnectOnDisconnection=t}get _connectionStatus(){return t(this,Fg,"f")}set _connectionStatus(s){switch(ed.assertTypeWithError(s,"string"),ed.log({newConnectionStatus:s}),e(this,Fg,s,"f"),this.dispatchEvent("connectionStatus",{connectionStatus:this.connectionStatus}),this.dispatchEvent(this.connectionStatus,{}),s){case"connected":case"notConnected":this.dispatchEvent("isConnected",{isConnected:this.isConnected}),this.isConnected||t(this,Ig,"m",Ug).call(this)}}get connectionStatus(){return this._connectionStatus}_sendRequiredMessages(){ed.log("sending required messages",t(this,Og,"f")),this.sendServerMessage(...t(this,Ig,"a",$g))}parseMessage(e){ed.log("parseMessage",{dataView:e}),Te(e,gc,t(this,Ig,"m",Ng).bind(this),null,!0),t(this,Ig,"m",Pg).call(this)}get isScanningAvailable(){return t(this,Ig,"a",qg)}requestIsScanningAvailable(){this.sendServerMessage("isScanningAvailable")}get isScanning(){return t(this,Ig,"a",Hg)}startScan(){t(this,Ig,"m",Kg).call(this),this.sendServerMessage("startScan")}stopScan(){t(this,Ig,"m",Jg).call(this),this.sendServerMessage("stopScan")}toggleScan(){t(this,Ig,"m",jg).call(this),this.isScanning?this.stopScan():this.startScan()}get discoveredDevices(){return t(this,Qg,"f")}onDiscoveredDevice(e){ed.log({discoveredDevice:e}),t(this,Qg,"f")[e.bluetoothId]=e,this.dispatchEvent("discoveredDevice",{discoveredDevice:e})}requestDiscoveredDevices(){this.sendServerMessage({type:"discoveredDevices"})}connectToDevice(t,e){return this.requestConnectionToDevice(t,e)}requestConnectionToDevice(e,s){this.assertConnection(),ed.assertTypeWithError(e,"string");const i=t(this,Ig,"m",td).call(this,e);return s?i.connect({type:"client",subType:s}):i.connect(),i}sendConnectToDeviceMessage(t,e){e?this.sendServerMessage({type:"connectToDevice",data:j(G(t),lo.indexOf(e))}):this.sendServerMessage({type:"connectToDevice",data:t})}createDevice(e){const s=new _l,i=t(this,Qg,"f")[e],n=new xg;return n.discoveredDevice=Object.assign({},i),n.client=this,n.bluetoothId=e,n.sendClientMessage=this.sendDeviceMessage.bind(this,e),n.sendRequiredDeviceInformationMessage=this.sendRequiredDeviceInformationMessage.bind(this,e),n.sendClientConnectMessage=this.sendConnectToDeviceMessage.bind(this,e),n.sendClientDisconnectMessage=this.sendDisconnectFromDeviceMessage.bind(this,e),s.connectionManager=n,s}onConnectedBluetoothDeviceIds(e){ed.log({bluetoothIds:e}),e.forEach((e=>{const s=t(this,Ig,"m",td).call(this,e);s.connectionManager.isConnected=!0,lc._CheckDeviceAvailability(s)}))}disconnectFromDevice(t){this.requestDisconnectionFromDevice(t)}requestDisconnectionFromDevice(t){this.assertConnection(),ed.assertTypeWithError(t,"string");const e=this.devices[t];return ed.assertWithError(e,`no device found with id ${t}`),e.disconnect(),e}sendDisconnectFromDeviceMessage(t){this.sendServerMessage({type:"disconnectFromDevice",data:t})}sendDeviceMessage(t,...e){this.sendServerMessage({type:"deviceMessage",data:[t,pc(...e)]})}sendRequiredDeviceInformationMessage(t){this.sendServerMessage({type:"requiredDeviceInformation",data:[t]})}}var nd,ad,rd,od,hd,cd,ld,fd,gd,dd,ud,pd,md;Lg=id,Ag=new WeakMap,_g=new WeakMap,Fg=new WeakMap,Og=new WeakMap,Vg=new WeakMap,Gg=new WeakMap,Qg=new WeakMap,Ig=new WeakSet,Ug=function(){e(this,Ig,!1,"a",zg),e(this,Ig,!1,"a",Xg);for(const e in t(this,Ag,"f")){t(this,Ag,"f")[e].connectionManager.isConnected=!1}t(this,Og,"f").length=0},$g=function(){return t(Lg,Lg,"f",Bg)},Pg=function(){"connecting"==this.connectionStatus&&(ed.log("checking if fully connected..."),t(this,Og,"f").includes("isScanningAvailable")?!this.isScanningAvailable||t(this,Og,"f").includes("isScanning")?(ed.log("fully connected"),this._connectionStatus="connected"):ed.log("not fully connected - didn't receive isScanning"):ed.log("not fully connected - didn't receive isScanningAvailable"))},Ng=function(s,i){let n=0;switch(ed.log({messageType:s},i),s){case"isScanningAvailable":{const t=Boolean(i.getUint8(n++));ed.log({isScanningAvailable:t}),e(this,Ig,t,"a",zg)}break;case"isScanning":{const t=Boolean(i.getUint8(n++));ed.log({isScanning:t}),e(this,Ig,t,"a",Xg)}break;case"discoveredDevice":{const{string:t}=We(i,n);ed.log({discoveredDeviceString:t});const e=JSON.parse(t);ed.log({discoveredDevice:e}),this.onDiscoveredDevice(e)}break;case"expiredDiscoveredDevice":{const{string:e}=We(i,n);t(this,Ig,"m",Zg).call(this,e)}break;case"connectedDevices":{if(0==i.byteLength)break;const{string:t}=We(i,n);ed.log({connectedBluetoothDeviceIdStrings:t});const e=JSON.parse(t).connectedDevices;ed.log({connectedBluetoothDeviceIds:e}),this.onConnectedBluetoothDeviceIds(e)}break;case"deviceMessage":{const{string:e,byteOffset:s}=We(i,n);n=s;const a=t(this,Ag,"f")[e];ed.assertWithError(a,`no device found for id ${e}`);const r=a.connectionManager,o=H(i,n);r.onClientMessage(o)}break;default:ed.error(`uncaught messageType "${s}"`)}"connecting"==this.connectionStatus&&t(this,Og,"f").push(s)},qg=function(){return t(this,Vg,"f")},zg=function(s){ed.assertTypeWithError(s,"boolean"),e(this,Vg,s,"f"),this.dispatchEvent("isScanningAvailable",{isScanningAvailable:this.isScanningAvailable}),this.isScanningAvailable&&t(this,Ig,"m",Yg).call(this)},jg=function(){this.assertConnection(),ed.assertWithError(this.isScanningAvailable,"scanning is not available")},Hg=function(){return t(this,Gg,"f")},Xg=function(t){ed.assertTypeWithError(t,"boolean"),e(this,Gg,t,"f"),this.dispatchEvent("isScanning",{isScanning:this.isScanning})},Yg=function(){this.sendServerMessage("isScanning")},Jg=function(){ed.assertWithError(this.isScanning,"is not scanning")},Kg=function(){ed.assertWithError(!this.isScanning,"is already scanning")},Zg=function(e){ed.log({expiredBluetoothDeviceId:e});const s=t(this,Qg,"f")[e];s?(ed.log({expiredDiscoveredDevice:s}),delete t(this,Qg,"f")[e],this.dispatchEvent("expiredDiscoveredDevice",{discoveredDevice:s})):ed.warn(`no discoveredDevice found with id "${e}"`)},td=function(e){let s=t(this,Ag,"f")[e];return s||(s=this.createDevice(e),t(this,Ag,"f")[e]=s),s},id._reconnectOnDisconnection=!0,Bg={value:["isScanningAvailable","discoveredDevices","connectedDevices"]};const vd=W("WebSocketClient",{log:!1});class yd extends id{constructor(){super(...arguments),nd.add(this),ad.set(this,void 0),od.set(this,{open:t(this,nd,"m",hd).bind(this),message:t(this,nd,"m",cd).bind(this),close:t(this,nd,"m",ld).bind(this),error:t(this,nd,"m",fd).bind(this)}),ud.set(this,new F(t(this,nd,"m",pd).bind(this),3e4))}get webSocket(){return t(this,ad,"f")}set webSocket(s){t(this,ad,"f")!=s?(vd.log("assigning webSocket",s),t(this,ad,"f")&&Co(t(this,ad,"f"),t(this,od,"f")),bo(s,t(this,od,"f")),e(this,ad,s,"f"),vd.log("assigned webSocket")):vd.log("redundant webSocket assignment")}get readyState(){return this.webSocket?.readyState}get isConnected(){return this.readyState==WebSocket.OPEN}get isDisconnected(){return this.readyState==WebSocket.CLOSED}connect(t=`wss://${location.host}`){this.webSocket&&this.assertDisconnection(),this._connectionStatus="connecting",d||(this.webSocket=new WebSocket(t))}disconnect(){this.assertConnection(),this.reconnectOnDisconnection&&(this.reconnectOnDisconnection=!1,this.webSocket.addEventListener("close",(()=>{this.reconnectOnDisconnection=!0}),{once:!0})),this._connectionStatus="disconnecting",this.webSocket.close()}reconnect(){this.assertDisconnection(),this.connect(this.webSocket.url)}toggleConnection(t){this.isConnected?this.disconnect():t&&this.webSocket?.url==t?this.reconnect():this.connect(t)}sendMessage(e){this.assertConnection(),t(this,ad,"f").send(e),t(this,ud,"f").restart()}sendServerMessage(...t){this.sendMessage(yc({type:"serverMessage",data:uc(...t)}))}}ad=new WeakMap,od=new WeakMap,ud=new WeakMap,nd=new WeakSet,rd=function(...t){this.sendMessage(yc(...t))},hd=function(e){vd.log("webSocket.open",e),t(this,ud,"f").start(),this._sendRequiredMessages()},cd=async function(e){vd.log("webSocket.message",e);const s=await e.data.arrayBuffer(),i=new DataView(s);t(this,nd,"m",gd).call(this,i)},ld=function(e){vd.log("webSocket.close",e),this._connectionStatus="notConnected",Object.entries(this.devices).forEach((([t,e])=>{e.connectionManager.isConnected=!1})),t(this,ud,"f").stop(),this.reconnectOnDisconnection&&setTimeout((()=>{this.reconnect()}),3e3)},fd=function(t){vd.error("webSocket.error",t)},gd=function(e){Te(e,vc,t(this,nd,"m",dd).bind(this),null,!0)},dd=function(e,s){switch(e){case"ping":t(this,nd,"m",md).call(this);break;case"pong":break;case"serverMessage":this.parseMessage(s);break;default:vd.error(`uncaught messageType "${e}"`)}},pd=function(){t(this,nd,"m",rd).call(this,"ping")},md=function(){t(this,nd,"m",rd).call(this,"pong")};const wd={addEventListeners:bo,removeEventListeners:Co},bd={throttle:function(t,e,s=!1){let i=0,n=null,a=null;return function(...r){const o=Date.now(),h=e-(o-i);h<=0?(n&&(clearTimeout(n),n=null),i=o,t(...r)):s&&(a=r,n||(n=setTimeout((()=>{i=Date.now(),n=null,a&&(t(...a),a=null)}),h)))}},debounce:function(t,e,s=!1){let i=null;return function(...n){const a=s&&!i;i&&clearTimeout(i),i=setTimeout((()=>{i=null,s||t(...n)}),e),a&&t(...n)}}};export{as as CameraCommands,hs as CameraConfigurationTypes,Qs as ContinuousSensorTypes,ue as DefaultNumberOfPressureSensors,_l as Device,lc as DeviceManager,Eg as DevicePair,Sg as DevicePairTypes,_n as DeviceTypes,Vr as DisplayBrightnesses,Nf as DisplayCanvasHelper,zr as DisplaySegmentCaps,y as Environment,wd as EventUtils,qt as FileTransferDirections,Pt as FileTypes,$n as MaxNameLength,da as MaxNumberOfVibrationWaveformEffectSegments,va as MaxNumberOfVibrationWaveformSegments,vi as MaxSensorRate,pa as MaxVibrationWaveformEffectSegmentDelay,ma as MaxVibrationWaveformEffectSegmentLoopCount,ya as MaxVibrationWaveformEffectSequenceLoopCount,ua as MaxVibrationWaveformSegmentDuration,Na as MaxWifiPasswordLength,Oa as MaxWifiSSIDLength,Ps as MicrophoneCommands,Vs as MicrophoneConfigurationTypes,js as MicrophoneConfigurationValues,Bn as MinNameLength,Pa as MinWifiPasswordLength,$a as MinWifiSSIDLength,ne as RangeHelper,yi as SensorRateStep,Ks as SensorTypes,Fn as Sides,an as TfliteSensorTypes,nn as TfliteTasks,bd as ThrottleUtils,ca as VibrationLocations,la as VibrationTypes,Vn as VibrationWaveformEffects,yd as WebSocketClient,Ha as hexToRGB,Ja as rgbToHex,R as setAllConsoleLevelFlags,T as setConsoleLevelFlagsForType};
//# sourceMappingURL=brilliantsole.module.min.js.map
